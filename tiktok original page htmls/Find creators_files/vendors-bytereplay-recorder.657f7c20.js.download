/*! For license information please see vendors-bytereplay-recorder.657f7c20.js.LICENSE.txt */
"use strict";(window.webpackChunkecom_seller=window.webpackChunkecom_seller||[]).push([[81],{90087:function(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Kr:function(){return StandardRecorder}});var console=__webpack_require__(64399);!function(){try{if("undefined"!=typeof document&&document.head){var e=document.createElement("style");e.appendChild(document.createTextNode("._container_1lxa9_1{display:flex;flex-direction:column;align-items:center;width:100%;transition:all .4s ease-in-out}._container_1lxa9_1 svg{display:block}._second_1lxa9_11{display:flex;align-items:center;position:absolute;height:120px;font-size:40px;transition:opacity .2s ease-in-out}._tips_1lxa9_19{margin-top:18px;transition:opacity .2s ease-in-out;text-align:center;padding:0 8px}._tips_1lxa9_19 span{color:#fd6f8e}._cancelButton_1lxa9_28{width:72px;height:32px;margin-top:24px;color:#fff;background:rgba(255,255,255,.1);border:none;border-radius:8px;cursor:pointer}._stopped_1lxa9_38,._stopped_1lxa9_38 ._tips_1lxa9_19,._stopped_1lxa9_38 ._second_1lxa9_11{opacity:0}._container_2hh0t_1{display:flex;flex-direction:column;padding:16px}._title_2hh0t_6{color:#fff;margin-bottom:12px}._message_2hh0t_10{color:#98a2b3}._buttons_2hh0t_13{display:flex;flex-grow:1;justify-content:flex-end;align-items:flex-end}._buttons_2hh0t_13 button{min-width:80px;height:28px;margin-left:8px;border:none;color:#fff;background:rgba(255,255,255,.1);border-radius:4px;cursor:pointer}._buttons_2hh0t_13 button._primary_2hh0t_29{background:linear-gradient(90deg,#fe1889 0%,#ff5f7d 100%),#f63d68}._container_15hlf_1{width:36px;height:36px;border-radius:36px;cursor:pointer;opacity:1}._container_15hlf_1:hover{opacity:1}._circle_15hlf_11{display:flex;width:36px;height:36px;align-items:center;justify-content:center;border-radius:36px;border:2px solid white}._rect_15hlf_20{width:14px;height:14px;background:#e54136;border-radius:2px}._active_15hlf_26._container_15hlf_1 ._rect_15hlf_20{animation:1.2s infinite alternate _stop-button-animation_15hlf_1}@keyframes _stop-button-animation_15hlf_1{0%{opacity:1}70%{opacity:.7}to{opacity:1}}._container_14o0x_1{display:flex;align-items:center}._stopButton_14o0x_5{transition:all .4s ease-in-out}._timeDisplay_14o0x_8{margin-left:9px;font-size:14px;transition:all .3s ease-in-out}._buttons_14o0x_13{display:flex;margin-left:4px}.mini ._container_14o0x_1{width:64px;height:32px}.mini ._container_14o0x_1._recording_14o0x_21{animation:1.2s infinite alternate _mini-recorder-controller-animation_14o0x_1}.mini ._container_14o0x_1 ._stopButton_14o0x_5{transform:scale(0);width:0;opacity:0}.mini ._container_14o0x_1 ._buttons_14o0x_13{opacity:0}._container_36akj_7{display:flex;align-items:center;justify-content:center;position:fixed;z-index:9999999;width:136px;height:48px;color:#fff;background:linear-gradient(63.44deg,#1d2939 16.72%,#475467 83.39%);border-radius:32px;user-select:none;font-size:14px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;cursor:default;transition:all .3s ease-in-out}._container_36akj_7 *{box-sizing:border-box}._overlay_36akj_27{position:fixed;z-index:9999998;inset:0;user-select:none;transition:all .3s ease-in-out}._overlay_36akj_27._masking_36akj_37{user-select:all;backdrop-filter:brightness(66%) blur(4px)}._controller_36akj_41{position:absolute;margin-left:8px;opacity:0;transition:all .3s ease-in-out}._countdown_36akj_47{position:absolute;opacity:0;transition:all .5s ease-in-out}._messageBox_36akj_52{position:absolute;inset:0;opacity:0;pointer-events:none;transition:all .24s ease-in-out}._handleBar_36akj_62{display:flex;flex-wrap:wrap;position:absolute;right:16px;width:24px;height:24px;padding:2px 4px;pointer-events:none;cursor:move;opacity:0;transition:opacity .3s ease-in-out}._handleBar_36akj_62 ._dot_36akj_78{display:flex;align-items:center;justify-content:center;flex-grow:0;flex-shrink:0;width:50%;height:33%}._handleBar_36akj_62 ._dot_36akj_78>div{width:3px;height:3px;border-radius:100%;background:#d9d9d9}._initial_36akj_93._container_36akj_7{opacity:0;transform:translateY(-100px)}._countingDown_36akj_97._container_36akj_7{width:216px;height:268px;border-radius:24px;transition:all .5s ease-in-out}._countingDown_36akj_97._container_36akj_7._center_36akj_103{transform:translate(-40px)}._countingDown_36akj_97._container_36akj_7 ._controller_36akj_41 ::global(._stopButton_36akj_106){transform:translate(200px) scale(7)}._countingDown_36akj_97._container_36akj_7 ._countdown_36akj_47{opacity:1;transform:none}._recording_36akj_113._container_36akj_7{justify-content:flex-start;transition:all .3s ease-in-out}._recording_36akj_113._container_36akj_7 ._controller_36akj_41{opacity:1}._recording_36akj_113._container_36akj_7 ._countdown_36akj_47{transform:scale(.3) translate(-200px,-20px)}._recording_36akj_113._container_36akj_7 ._handleBar_36akj_62{opacity:.5;pointer-events:all}._recording_36akj_113._container_36akj_7 ._handleBar_36akj_62:hover{opacity:1}._mini_36akj_130._container_36akj_7{overflow:hidden;width:64px;height:32px;border-radius:24px;background:linear-gradient(63.44deg,#1d2939 16.72%,#475467 83.39%);transition:all .4s ease-in-out}._mini_36akj_130._container_36akj_7.recording{animation:1.2s infinite alternate _mini-recorder-controller-animation_36akj_1}._mini_36akj_130._container_36akj_7._center_36akj_103{transform:translate(36px)}._mini_36akj_130._container_36akj_7 ._controller_36akj_41{opacity:1}._message_36akj_52._container_36akj_7{width:300px;height:140px;border-radius:24px}._message_36akj_52._container_36akj_7._center_36akj_103{transform:translate(-82px)}._message_36akj_52._container_36akj_7 ._messageBox_36akj_52{opacity:1;pointer-events:all}@keyframes _mini-recorder-controller-animation_36akj_1{0%{background:#f04438}70%{background:#d92d20}to{background:#f04438}}._dragContainer_36akj_170{position:absolute;inset:0;z-index:9999997}")),document.head.appendChild(e)}}catch(n){console.error("vite-plugin-css-injected-by-js",n)}}();var Ve=Object.defineProperty,We=Object.defineProperties,Re=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,fe=Object.getPrototypeOf,Ze=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,Ye=Reflect.get,he=Math.pow,de=(e,t,n)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))Ze.call(t,n)&&de(e,n,t[n]);if(te)for(var n of te(t))pe.call(t,n)&&de(e,n,t[n]);return e},M=(e,t)=>We(e,Re(t)),le=(e,t)=>{var n={};for(var l in e)Ze.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&te)for(var l of te(e))t.indexOf(l)<0&&pe.call(e,l)&&(n[l]=e[l]);return n},d=(e,t,n)=>(de(e,"symbol"!=typeof t?t+"":t,n),n),Xe=(e,t,n)=>Ye(fe(e),n,t),V=(e,t,n)=>new Promise(((l,i)=>{var s=e=>{try{o(n.next(e))}catch(t){i(t)}},c=e=>{try{o(n.throw(e))}catch(t){i(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,c);o((n=n.apply(e,t)).next())})),ne=function(e,t){this[0]=e,this[1]=t},ye=(e,t,n)=>{var l=(e,t,i,s)=>{try{var c=n[e](t),o=(t=c.value)instanceof ne,a=c.done;Promise.resolve(o?t[0]:t).then((n=>o?l("return"===e?e:"next",t[1]?{done:n.done,value:n.value}:n,i,s):i({value:n,done:a}))).catch((e=>l("throw",e,i,s)))}catch(r){s(r)}},i=e=>s[e]=t=>new Promise(((n,i)=>l(e,t,n,i))),s={};return n=n.apply(e,t),s[Symbol.asyncIterator]=()=>s,i("next"),i("throw"),i("return"),s};class RuntimeError extends Error{constructor(e,t){var n;super(e,t),d(this,"localizedMessage"),this.name="bytereplay.core.RuntimeError",this.localizedMessage=null!=(n=null==t?void 0:t.localizedMessage)?n:e}}class ServerError extends RuntimeError{constructor(e,t){super(e,t),d(this,"_code"),this.name="bytereplay.core.ServerError",this._code=null==t?void 0:t.code}get code(){return this._code}}class UnsupportedError extends RuntimeError{constructor(e,t){super(e,t),this.name="bytereplay.core.UnsupportedError"}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createFormData(){return new FormData}function isFormData(e){return e instanceof FormData}!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var l,i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof commonjsGlobal&&commonjsGlobal];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{var l=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var c=e[s];if(!(c in l))break e;l=l[c]}(t=t(s=l[e=e[e.length-1]]))!=s&&null!=t&&n(l,e,{configurable:!0,writable:!0,value:t})}}function c(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function o(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(s("Symbol",(function(e){function t(e,t){this.A=e,n(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var l="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(n){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(l+(n||"")+"_"+i++,n)}})),s("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var l="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),s=0;s<l.length;s++){var o=i[l[s]];"function"==typeof o&&"function"!=typeof o.prototype[e]&&n(o.prototype,e,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var a;e:{var r={};try{r.__proto__={a:!0},a=r.a;break e}catch(L){}a=!1}l=a?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=l;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function u(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function b(e,t){return e.h=3,{value:t}}function m(e){this.g=new h,this.G=e}function p(e,t,n,l){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var s=i.value}catch(c){return e.g.j=null,e.g.s(c),Z(e)}return e.g.j=null,l.call(e.g,s),Z(e)}function Z(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(n){e.g.v=void 0,e.g.s(n)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function y(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){u(e.g);var n=e.g.j;return n?p(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),Z(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function X(e,t){return t=new y(new m(t)),d&&e.prototype&&d(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return u(this.g),this.g.j?p(this,this.g.j.next,e,this.g.o):(this.g.o(e),Z(this))},m.prototype.s=function(e){return u(this.g),this.g.j?p(this,this.g.j.throw,e,this.g.o):(this.g.s(e),Z(this))},s("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,l=!1,i={next:function(){if(!l&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return l=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var G=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},V=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},W=function(e,t,n){return t instanceof Blob?(n=void 0!==n?n+"":"string"==typeof t.name?t.name:"blob",(t.name!==n||"[object Blob]"===Object.prototype.toString.call(t))&&(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},R=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},v="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,Y=v.FormData,T=v.XMLHttpRequest&&v.XMLHttpRequest.prototype.send,g=v.Request&&v.fetch,N=v.navigator&&v.navigator.sendBeacon,J=v.Element&&v.Element.prototype,S=v.Symbol&&Symbol.toStringTag;S&&(Blob.prototype[S]||(Blob.prototype[S]="Blob"),"File"in v&&!File.prototype[S]&&(File.prototype[S]="File"));try{new File([],"")}catch(L){v.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),S&&Object.defineProperty(e,S,{value:"File"}),e}}var f=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},x=function(e){this.i=[];var t=this;e&&G(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];G(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?G(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?V(e.value):e.value,t.append(e.name,n))}))};if((e=x.prototype).append=function(e,t,n){R(arguments,2),this.i.push(W(e,t,n))},e.delete=function(e){R(arguments,1);var t=[];e=String(e),G(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return X(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=b(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){R(arguments,1);for(var n=o(this),l=n.next();!l.done;l=n.next()){var i=o(l.value);l=i.next().value,i=i.next().value,e.call(t,i,l,this)}},e.get=function(e){R(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){R(arguments,1);var t=[];return e=String(e),G(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){R(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,l,i,s=this;return X(e,(function(e){if(1==e.h&&(t=o(s),n=t.next()),3!=e.h)return n.done?void(e.h=0):(l=n.value,i=o(l),b(e,i.next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){R(arguments,2),e=String(e);var l=[],i=W(e,t,n),s=!0;G(this.i,(function(t){t[0]===e?s&&(s=!l.push(i)):l.push(t)})),s&&l.push(i),this.i=l},e.values=function e(){var t,n,l,i,s=this;return X(e,(function(e){if(1==e.h&&(t=o(s),n=t.next()),3!=e.h)return n.done?void(e.h=0):(l=n.value,(i=o(l)).next(),b(e,i.next().value));n=t.next(),e.h=2}))},x.prototype._asNative=function(){for(var e=new Y,t=o(this),n=t.next();!n.done;n=t.next()){var l=o(n.value);n=l.next().value,l=l.next().value,e.append(n,l)}return e},x.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,l){return"string"==typeof e?t.push(n+f(V(l))+'"\r\n\r\n'+V(e)+"\r\n"):t.push(n+f(V(l))+'"; filename="'+f(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},x.prototype[Symbol.iterator]=function(){return this.entries()},x.prototype.toString=function(){return"[object FormData]"},J&&!J.matches&&(J.matches=J.matchesSelector||J.mozMatchesSelector||J.msMatchesSelector||J.oMatchesSelector||J.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),S&&(x.prototype[S]="FormData"),T){var I=v.XMLHttpRequest.prototype.setRequestHeader;v.XMLHttpRequest.prototype.setRequestHeader=function(e,t){I.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},v.XMLHttpRequest.prototype.send=function(e){e instanceof x?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),T.call(this,e)):T.call(this,e)}}g&&(v.fetch=function(e,t){return t&&t.body&&t.body instanceof x&&(t.body=t.body._blob()),g.call(this,e,t)}),N&&(v.navigator.sendBeacon=function(e,t){return t instanceof x&&(t=t._asNative()),N.call(this,e,t)}),v.FormData=x}}();var check$1=function(e){return e&&e.Math===Math&&e},globalThis_1=check$1("object"==typeof globalThis&&globalThis)||check$1("object"==typeof window&&window)||check$1("object"==typeof self&&self)||check$1("object"==typeof commonjsGlobal&&commonjsGlobal)||check$1("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$8=function(e){try{return!!e()}catch(t){return!0}},fails$7=fails$8,descriptors=!fails$7((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),fails$6=fails$8,functionBindNative=!fails$6((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND$1=functionBindNative,call$4=Function.prototype.call,functionCall=NATIVE_BIND$1?call$4.bind(call$4):function(){return call$4.apply(call$4,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$1&&!$propertyIsEnumerable.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$1(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable;var createPropertyDescriptor$2=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},NATIVE_BIND=functionBindNative,FunctionPrototype$1=Function.prototype,call$3=FunctionPrototype$1.call,uncurryThisWithBind=NATIVE_BIND&&FunctionPrototype$1.bind.bind(call$3,call$3),functionUncurryThis=NATIVE_BIND?uncurryThisWithBind:function(e){return function(){return call$3.apply(e,arguments)}},uncurryThis$8=functionUncurryThis,toString$2=uncurryThis$8({}.toString),stringSlice$1=uncurryThis$8("".slice),classofRaw=function(e){return stringSlice$1(toString$2(e),8,-1)},uncurryThis$7=functionUncurryThis,fails$5=fails$8,classof=classofRaw,$Object$2=Object,split=uncurryThis$7("".split),indexedObject=fails$5((function(){return!$Object$2("z").propertyIsEnumerable(0)}))?function(e){return"String"===classof(e)?split(e,""):$Object$2(e)}:$Object$2,isNullOrUndefined$2=function(e){return null==e},isNullOrUndefined$1=isNullOrUndefined$2,$TypeError$5=TypeError,requireObjectCoercible$2=function(e){if(isNullOrUndefined$1(e))throw new $TypeError$5("Can't call method on "+e);return e},IndexedObject=indexedObject,requireObjectCoercible$1=requireObjectCoercible$2,toIndexedObject$3=function(e){return IndexedObject(requireObjectCoercible$1(e))},documentAll="object"==typeof document&&document.all,isCallable$a="undefined"==typeof documentAll&&void 0!==documentAll?function(e){return"function"==typeof e||e===documentAll}:function(e){return"function"==typeof e},isCallable$9=isCallable$a,isObject$7=function(e){return"object"==typeof e?null!==e:isCallable$9(e)},globalThis$c=globalThis_1,isCallable$8=isCallable$a,aFunction=function(e){return isCallable$8(e)?e:void 0},getBuiltIn$2=function(e,t){return arguments.length<2?aFunction(globalThis$c[e]):globalThis$c[e]&&globalThis$c[e][t]},uncurryThis$6=functionUncurryThis,objectIsPrototypeOf=uncurryThis$6({}.isPrototypeOf),globalThis$b=globalThis_1,navigator=globalThis$b.navigator,userAgent$1=navigator&&navigator.userAgent,environmentUserAgent=userAgent$1?String(userAgent$1):"",globalThis$a=globalThis_1,userAgent=environmentUserAgent,process$1=globalThis$a.process,Deno=globalThis$a.Deno,versions=process$1&&process$1.versions||Deno&&Deno.version,v8=versions&&versions.v8,match,version$1;v8&&(match=v8.split("."),version$1=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version$1&&userAgent&&(match=userAgent.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent.match(/Chrome\/(\d+)/),match&&(version$1=+match[1])));var environmentV8Version=version$1,V8_VERSION=environmentV8Version,fails$4=fails$8,globalThis$9=globalThis_1,$String$3=globalThis$9.String,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails$4((function(){var e=Symbol("symbol detection");return!$String$3(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41})),NATIVE_SYMBOL$1=symbolConstructorDetection,useSymbolAsUid=NATIVE_SYMBOL$1&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,getBuiltIn$1=getBuiltIn$2,isCallable$7=isCallable$a,isPrototypeOf=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,$Object$1=Object,isSymbol$3=USE_SYMBOL_AS_UID$1?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn$1("Symbol");return isCallable$7(t)&&isPrototypeOf(t.prototype,$Object$1(e))},$String$2=String,tryToString$1=function(e){try{return $String$2(e)}catch(t){return"Object"}},isCallable$6=isCallable$a,tryToString=tryToString$1,$TypeError$4=TypeError,aCallable$1=function(e){if(isCallable$6(e))return e;throw new $TypeError$4(tryToString(e)+" is not a function")},aCallable=aCallable$1,isNullOrUndefined=isNullOrUndefined$2,getMethod$2=function(e,t){var n=e[t];return isNullOrUndefined(n)?void 0:aCallable(n)},call$2=functionCall,isCallable$5=isCallable$a,isObject$6=isObject$7,$TypeError$3=TypeError,ordinaryToPrimitive$1=function(e,t){var n,l;if("string"===t&&isCallable$5(n=e.toString)&&!isObject$6(l=call$2(n,e))||isCallable$5(n=e.valueOf)&&!isObject$6(l=call$2(n,e))||"string"!==t&&isCallable$5(n=e.toString)&&!isObject$6(l=call$2(n,e)))return l;throw new $TypeError$3("Can't convert object to primitive value")},sharedStore={exports:{}},globalThis$8=globalThis_1,defineProperty$1=Object.defineProperty,defineGlobalProperty$3=function(e,t){try{defineProperty$1(globalThis$8,e,{value:t,configurable:!0,writable:!0})}catch(n){globalThis$8[e]=t}return t},globalThis$7=globalThis_1,defineGlobalProperty$2=defineGlobalProperty$3,SHARED="__core-js_shared__",store$3=sharedStore.exports=globalThis$7[SHARED]||defineGlobalProperty$2(SHARED,{});(store$3.versions||(store$3.versions=[])).push({version:"3.38.1",mode:"global",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"});var sharedStoreExports=sharedStore.exports,store$2=sharedStoreExports,shared$3=function(e,t){return store$2[e]||(store$2[e]=t||{})},requireObjectCoercible=requireObjectCoercible$2,$Object=Object,toObject$1=function(e){return $Object(requireObjectCoercible(e))},uncurryThis$5=functionUncurryThis,toObject=toObject$1,hasOwnProperty=uncurryThis$5({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty(toObject(e),t)},uncurryThis$4=functionUncurryThis,id=0,postfix=Math.random(),toString$1=uncurryThis$4(1..toString),uid$2=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$1(++id+postfix,36)},globalThis$6=globalThis_1,shared$2=shared$3,hasOwn$6=hasOwnProperty_1,uid$1=uid$2,NATIVE_SYMBOL=symbolConstructorDetection,USE_SYMBOL_AS_UID=useSymbolAsUid,Symbol$1=globalThis$6.Symbol,WellKnownSymbolsStore=shared$2("wks"),createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol$1.for||Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid$1,wellKnownSymbol$1=function(e){return hasOwn$6(WellKnownSymbolsStore,e)||(WellKnownSymbolsStore[e]=NATIVE_SYMBOL&&hasOwn$6(Symbol$1,e)?Symbol$1[e]:createWellKnownSymbol("Symbol."+e)),WellKnownSymbolsStore[e]},call$1=functionCall,isObject$5=isObject$7,isSymbol$2=isSymbol$3,getMethod$1=getMethod$2,ordinaryToPrimitive=ordinaryToPrimitive$1,wellKnownSymbol=wellKnownSymbol$1,$TypeError$2=TypeError,TO_PRIMITIVE=wellKnownSymbol("toPrimitive"),toPrimitive$1=function(e,t){if(!isObject$5(e)||isSymbol$2(e))return e;var n,l=getMethod$1(e,TO_PRIMITIVE);if(l){if(void 0===t&&(t="default"),n=call$1(l,e,t),!isObject$5(n)||isSymbol$2(n))return n;throw new $TypeError$2("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPrimitive=toPrimitive$1,isSymbol$1=isSymbol$3,toPropertyKey$2=function(e){var t=toPrimitive(e,"string");return isSymbol$1(t)?t:t+""},globalThis$5=globalThis_1,isObject$4=isObject$7,document$1=globalThis$5.document,EXISTS$1=isObject$4(document$1)&&isObject$4(document$1.createElement),documentCreateElement=function(e){return EXISTS$1?document$1.createElement(e):{}},DESCRIPTORS$6=descriptors,fails$3=fails$8,createElement=documentCreateElement,ie8DomDefine=!DESCRIPTORS$6&&!fails$3((function(){return 7!==Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a})),DESCRIPTORS$5=descriptors,call=functionCall,propertyIsEnumerableModule=objectPropertyIsEnumerable,createPropertyDescriptor$1=createPropertyDescriptor$2,toIndexedObject$2=toIndexedObject$3,toPropertyKey$1=toPropertyKey$2,hasOwn$5=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$5?$getOwnPropertyDescriptor$1:function(e,t){if(e=toIndexedObject$2(e),t=toPropertyKey$1(t),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$1(e,t)}catch(n){}if(hasOwn$5(e,t))return createPropertyDescriptor$1(!call(propertyIsEnumerableModule.f,e,t),e[t])};var objectDefineProperty={},DESCRIPTORS$4=descriptors,fails$2=fails$8,v8PrototypeDefineBug=DESCRIPTORS$4&&fails$2((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),isObject$3=isObject$7,$String$1=String,$TypeError$1=TypeError,anObject$2=function(e){if(isObject$3(e))return e;throw new $TypeError$1($String$1(e)+" is not an object")},DESCRIPTORS$3=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,anObject$1=anObject$2,toPropertyKey=toPropertyKey$2,$TypeError=TypeError,$defineProperty=Object.defineProperty,$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable";objectDefineProperty.f=DESCRIPTORS$3?V8_PROTOTYPE_DEFINE_BUG?function(e,t,n){if(anObject$1(e),t=toPropertyKey(t),anObject$1(n),"function"==typeof e&&"prototype"===t&&"value"in n&&WRITABLE in n&&!n[WRITABLE]){var l=$getOwnPropertyDescriptor(e,t);l&&l[WRITABLE]&&(e[t]=n.value,n={configurable:CONFIGURABLE$1 in n?n[CONFIGURABLE$1]:l[CONFIGURABLE$1],enumerable:ENUMERABLE in n?n[ENUMERABLE]:l[ENUMERABLE],writable:!1})}return $defineProperty(e,t,n)}:$defineProperty:function(e,t,n){if(anObject$1(e),t=toPropertyKey(t),anObject$1(n),IE8_DOM_DEFINE)try{return $defineProperty(e,t,n)}catch(l){}if("get"in n||"set"in n)throw new $TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var DESCRIPTORS$2=descriptors,definePropertyModule$2=objectDefineProperty,createPropertyDescriptor=createPropertyDescriptor$2,createNonEnumerableProperty$2=DESCRIPTORS$2?function(e,t,n){return definePropertyModule$2.f(e,t,createPropertyDescriptor(1,n))}:function(e,t,n){return e[t]=n,e},makeBuiltIn$2={exports:{}},DESCRIPTORS$1=descriptors,hasOwn$4=hasOwnProperty_1,FunctionPrototype=Function.prototype,getDescriptor=DESCRIPTORS$1&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$4(FunctionPrototype,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS$1||DESCRIPTORS$1&&getDescriptor(FunctionPrototype,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},uncurryThis$3=functionUncurryThis,isCallable$4=isCallable$a,store$1=sharedStoreExports,functionToString=uncurryThis$3(Function.toString);isCallable$4(store$1.inspectSource)||(store$1.inspectSource=function(e){return functionToString(e)});var inspectSource$1=store$1.inspectSource,globalThis$4=globalThis_1,isCallable$3=isCallable$a,WeakMap$2=globalThis$4.WeakMap,weakMapBasicDetection=isCallable$3(WeakMap$2)&&/native code/.test(String(WeakMap$2)),shared$1=shared$3,uid=uid$2,keys$1=shared$1("keys"),sharedKey$1=function(e){return keys$1[e]||(keys$1[e]=uid(e))},hiddenKeys$3={},NATIVE_WEAK_MAP=weakMapBasicDetection,globalThis$3=globalThis_1,isObject$2=isObject$7,createNonEnumerableProperty$1=createNonEnumerableProperty$2,hasOwn$3=hasOwnProperty_1,shared=sharedStoreExports,sharedKey=sharedKey$1,hiddenKeys$2=hiddenKeys$3,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$1=globalThis$3.TypeError,WeakMap$1=globalThis$3.WeakMap,set$1,get$1,has,enforce=function(e){return has(e)?get$1(e):set$1(e,{})},getterFor=function(e){return function(t){var n;if(!isObject$2(t)||(n=get$1(t)).type!==e)throw new TypeError$1("Incompatible receiver, "+e+" required");return n}};if(NATIVE_WEAK_MAP||shared.state){var store=shared.state||(shared.state=new WeakMap$1);store.get=store.get,store.has=store.has,store.set=store.set,set$1=function(e,t){if(store.has(e))throw new TypeError$1(OBJECT_ALREADY_INITIALIZED);return t.facade=e,store.set(e,t),t},get$1=function(e){return store.get(e)||{}},has=function(e){return store.has(e)}}else{var STATE=sharedKey("state");hiddenKeys$2[STATE]=!0,set$1=function(e,t){if(hasOwn$3(e,STATE))throw new TypeError$1(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$1(e,STATE,t),t},get$1=function(e){return hasOwn$3(e,STATE)?e[STATE]:{}},has=function(e){return hasOwn$3(e,STATE)}}var internalState={set:set$1,get:get$1,has:has,enforce:enforce,getterFor:getterFor},uncurryThis$2=functionUncurryThis,fails$1=fails$8,isCallable$2=isCallable$a,hasOwn$2=hasOwnProperty_1,DESCRIPTORS=descriptors,CONFIGURABLE_FUNCTION_NAME=functionName.CONFIGURABLE,inspectSource=inspectSource$1,InternalStateModule=internalState,enforceInternalState=InternalStateModule.enforce,getInternalState=InternalStateModule.get,$String=String,defineProperty=Object.defineProperty,stringSlice=uncurryThis$2("".slice),replace=uncurryThis$2("".replace),join=uncurryThis$2([].join),CONFIGURABLE_LENGTH=DESCRIPTORS&&!fails$1((function(){return 8!==defineProperty((function(){}),"length",{value:8}).length})),TEMPLATE=String(String).split("String"),makeBuiltIn$1=makeBuiltIn$2.exports=function(e,t,n){"Symbol("===stringSlice($String(t),0,7)&&(t="["+replace($String(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!hasOwn$2(e,"name")||CONFIGURABLE_FUNCTION_NAME&&e.name!==t)&&(DESCRIPTORS?defineProperty(e,"name",{value:t,configurable:!0}):e.name=t),CONFIGURABLE_LENGTH&&n&&hasOwn$2(n,"arity")&&e.length!==n.arity&&defineProperty(e,"length",{value:n.arity});try{n&&hasOwn$2(n,"constructor")&&n.constructor?DESCRIPTORS&&defineProperty(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var l=enforceInternalState(e);return hasOwn$2(l,"source")||(l.source=join(TEMPLATE,"string"==typeof t?t:"")),e};Function.prototype.toString=makeBuiltIn$1((function(){return isCallable$2(this)&&getInternalState(this).source||inspectSource(this)}),"toString");var makeBuiltInExports=makeBuiltIn$2.exports,isCallable$1=isCallable$a,definePropertyModule$1=objectDefineProperty,makeBuiltIn=makeBuiltInExports,defineGlobalProperty$1=defineGlobalProperty$3,defineBuiltIn$1=function(e,t,n,l){l||(l={});var i=l.enumerable,s=void 0!==l.name?l.name:t;if(isCallable$1(n)&&makeBuiltIn(n,s,l),l.global)i?e[t]=n:defineGlobalProperty$1(t,n);else{try{l.unsafe?e[t]&&(i=!0):delete e[t]}catch(c){}i?e[t]=n:definePropertyModule$1.f(e,t,{value:n,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return e},objectGetOwnPropertyNames={},ceil=Math.ceil,floor=Math.floor,mathTrunc=Math.trunc||function(e){var t=+e;return(t>0?floor:ceil)(t)},trunc=mathTrunc,toIntegerOrInfinity$2=function(e){var t=+e;return t!==t||0===t?0:trunc(t)},toIntegerOrInfinity$1=toIntegerOrInfinity$2,max=Math.max,min$1=Math.min,toAbsoluteIndex$1=function(e,t){var n=toIntegerOrInfinity$1(e);return n<0?max(n+t,0):min$1(n,t)},toIntegerOrInfinity=toIntegerOrInfinity$2,min=Math.min,toLength$1=function(e){var t=toIntegerOrInfinity(e);return t>0?min(t,9007199254740991):0},toLength=toLength$1,lengthOfArrayLike$1=function(e){return toLength(e.length)},toIndexedObject$1=toIndexedObject$3,toAbsoluteIndex=toAbsoluteIndex$1,lengthOfArrayLike=lengthOfArrayLike$1,createMethod=function(e){return function(t,n,l){var i=toIndexedObject$1(t),s=lengthOfArrayLike(i);if(0===s)return!e&&-1;var c,o=toAbsoluteIndex(l,s);if(e&&n!==n){for(;s>o;)if((c=i[o++])!==c)return!0}else for(;s>o;o++)if((e||o in i)&&i[o]===n)return e||o||0;return!e&&-1}},arrayIncludes={includes:createMethod(!0),indexOf:createMethod(!1)},uncurryThis$1=functionUncurryThis,hasOwn$1=hasOwnProperty_1,toIndexedObject=toIndexedObject$3,indexOf=arrayIncludes.indexOf,hiddenKeys$1=hiddenKeys$3,push=uncurryThis$1([].push),objectKeysInternal=function(e,t){var n,l=toIndexedObject(e),i=0,s=[];for(n in l)!hasOwn$1(hiddenKeys$1,n)&&hasOwn$1(l,n)&&push(s,n);for(;t.length>i;)hasOwn$1(l,n=t[i++])&&(~indexOf(s,n)||push(s,n));return s},enumBugKeys$1=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys=objectKeysInternal,enumBugKeys=enumBugKeys$1,hiddenKeys=enumBugKeys.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys(e,hiddenKeys)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getBuiltIn=getBuiltIn$2,uncurryThis=functionUncurryThis,getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,anObject=anObject$2,concat=uncurryThis([].concat),ownKeys$1=getBuiltIn("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule.f(anObject(e)),n=getOwnPropertySymbolsModule.f;return n?concat(t,n(e)):t},hasOwn=hasOwnProperty_1,ownKeys=ownKeys$1,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,definePropertyModule=objectDefineProperty,copyConstructorProperties$1=function(e,t,n){for(var l=ownKeys(t),i=definePropertyModule.f,s=getOwnPropertyDescriptorModule.f,c=0;c<l.length;c++){var o=l[c];!hasOwn(e,o)&&(!n||!hasOwn(n,o))&&i(e,o,s(t,o))}},fails=fails$8,isCallable=isCallable$a,replacement=/#|\.prototype\./,isForced$1=function(e,t){var n=data[normalize(e)];return n===POLYFILL||n!==NATIVE&&(isCallable(t)?fails(t):!!t)},normalize=isForced$1.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced$1.data={},NATIVE=isForced$1.NATIVE="N",POLYFILL=isForced$1.POLYFILL="P",isForced_1=isForced$1,globalThis$2=globalThis_1,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty=createNonEnumerableProperty$2,defineBuiltIn=defineBuiltIn$1,defineGlobalProperty=defineGlobalProperty$3,copyConstructorProperties=copyConstructorProperties$1,isForced=isForced_1,_export=function(e,t){var n,l,i,s,c,o=e.target,a=e.global,r=e.stat;if(n=a?globalThis$2:r?globalThis$2[o]||defineGlobalProperty(o,{}):globalThis$2[o]&&globalThis$2[o].prototype)for(l in t){if(s=t[l],e.dontCallGetSet?i=(c=getOwnPropertyDescriptor(n,l))&&c.value:i=n[l],!isForced(a?l:o+(r?".":"#")+l,e.forced)&&void 0!==i){if(typeof s==typeof i)continue;copyConstructorProperties(s,i)}(e.sham||i&&i.sham)&&createNonEnumerableProperty(s,"sham",!0),defineBuiltIn(n,l,s,e)}},$=_export,globalThis$1=globalThis_1;function includes(e,t){return null!=e&&-1!==e.indexOf(t)}function isFunction$1(e){return"function"==typeof e}function isFetchRequest(e){return e instanceof Request}function isFetchHeaders(e){return e instanceof Headers}function isObject$1(e){return"[object Object]"===Object.prototype.toString.call(e)}function isString(e){return"string"==typeof e||e instanceof String}function isSymbol(e){return"symbol"==typeof e}function isEmptyString(e){return""===e.trim()}function isPlainObject(e){if(!isObject$1(e))return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function performanceObserver(){return!!globalThis.PerformanceObserver}function performance$1(){return!!globalThis.performance}function performanceNow(){var e;return isFunction$1(null==(e=globalThis.performance)?void 0:e.now)}function compressionStream(){return isFunction$1(globalThis.CompressionStream)}function structuredClone$1(){return isFunction$1(globalThis.structuredClone)}function webWorkers(){return!!globalThis.Worker}function webSockets(){return!!globalThis.WebSocket}function fetch$1(e){var t;return isFunction$1(null==(t=null!=e?e:globalThis)?void 0:t.fetch)}$({global:!0,forced:globalThis$1.globalThis!==globalThis$1},{globalThis:globalThis$1});const ciu=Object.freeze(Object.defineProperty({__proto__:null,compressionStream:compressionStream,fetch:fetch$1,performance:performance$1,performanceNow:performanceNow,performanceObserver:performanceObserver,structuredClone:structuredClone$1,webSockets:webSockets,webWorkers:webWorkers},Symbol.toStringTag,{value:"Module"})),VOID=-1,PRIMITIVE=0,ARRAY=1,OBJECT=2,DATE=3,REGEXP=4,MAP=5,SET=6,ERROR=7,BIGINT=8,env$1="object"==typeof self?self:globalThis,deserializer=(e,t)=>{const n=(t,n)=>(e.set(n,t),t),l=i=>{if(e.has(i))return e.get(i);const[s,c]=t[i];switch(s){case PRIMITIVE:case VOID:return n(c,i);case ARRAY:{const e=n([],i);for(const t of c)e.push(l(t));return e}case OBJECT:{const e=n({},i);for(const[t,n]of c)e[l(t)]=l(n);return e}case DATE:return n(new Date(c),i);case REGEXP:{const{source:e,flags:t}=c;return n(new RegExp(e,t),i)}case MAP:{const e=n(new Map,i);for(const[t,n]of c)e.set(l(t),l(n));return e}case SET:{const e=n(new Set,i);for(const t of c)e.add(l(t));return e}case ERROR:{const{name:e,message:t}=c;return n(new env$1[e](t),i)}case BIGINT:return n(BigInt(c),i);case"BigInt":return n(Object(BigInt(c)),i)}return n(new env$1[s](c),i)};return l},deserialize$1=e=>deserializer(new Map,e)(0),EMPTY$1="",{toString:toString}={},{keys:keys}=Object,typeOf=e=>{const t=typeof e;if("object"!==t||!e)return[PRIMITIVE,t];const n=toString.call(e).slice(8,-1);switch(n){case"Array":return[ARRAY,EMPTY$1];case"Object":return[OBJECT,EMPTY$1];case"Date":return[DATE,EMPTY$1];case"RegExp":return[REGEXP,EMPTY$1];case"Map":return[MAP,EMPTY$1];case"Set":return[SET,EMPTY$1]}return n.includes("Array")?[ARRAY,n]:n.includes("Error")?[ERROR,n]:[OBJECT,n]},shouldSkip=([e,t])=>e===PRIMITIVE&&("function"===t||"symbol"===t),serializer=(e,t,n,l)=>{const i=(e,t)=>{const i=l.push(e)-1;return n.set(t,i),i},s=l=>{if(n.has(l))return n.get(l);let[c,o]=typeOf(l);switch(c){case PRIMITIVE:{let t=l;switch(o){case"bigint":c=BIGINT,t=l.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+o);t=null;break;case"undefined":return i([VOID],l)}return i([c,t],l)}case ARRAY:{if(o)return i([o,[...l]],l);const e=[],t=i([c,e],l);for(const n of l)e.push(s(n));return t}case OBJECT:{if(o)switch(o){case"BigInt":return i([o,l.toString()],l);case"Boolean":case"Number":case"String":return i([o,l.valueOf()],l)}if(t&&"toJSON"in l)return s(l.toJSON());const n=[],a=i([c,n],l);for(const t of keys(l))(e||!shouldSkip(typeOf(l[t])))&&n.push([s(t),s(l[t])]);return a}case DATE:return i([c,l.toISOString()],l);case REGEXP:{const{source:e,flags:t}=l;return i([c,{source:e,flags:t}],l)}case MAP:{const t=[],n=i([c,t],l);for(const[i,c]of l)(e||!shouldSkip(typeOf(i))&&!shouldSkip(typeOf(c)))&&t.push([s(i),s(c)]);return n}case SET:{const t=[],n=i([c,t],l);for(const i of l)(e||!shouldSkip(typeOf(i)))&&t.push(s(i));return n}}const{message:a}=l;return i([c,{name:o,message:a}],l)};return s},serialize$1=(e,{json:t,lossy:n}={})=>{const l=[];return serializer(!(t||n),!!t,new Map,l)(e),l},_structuredClone="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?deserialize$1(serialize$1(e,t)):structuredClone(e):(e,t)=>deserialize$1(serialize$1(e,t)),clone$1=structuredClone$1()?globalThis.structuredClone:_structuredClone;function deepClone(e){return clone$1(e)}var VMutationType,n,VNodeType;function isHTMLStyleElement(e){return"STYLE"===e.tagName}function isHTMLInputElement(e){return"INPUT"===e.tagName}function isHTMLOptionElement(e){return"OPTION"===e.tagName}function isHTMLScriptElement(e){return"SCRIPT"===e.tagName}function isHTMLSelectElement(e){return"SELECT"===e.tagName}function isHTMLTextAreaElement(e){return"TEXTAREA"===e.tagName}function isWindow(e){return"object"==typeof e&&!!e&&"window"in e&&e.window===e}function isHTMLElement(e){return e.nodeType===Node.ELEMENT_NODE}function isVNode(e){return null!=e&&null!=e.id&&null!=e.type&&!(e instanceof Node)}function isVParentNode(e){return"children"in e}function isVElement(e){return e.type===VNodeType.ElementNode}function isVStyleElement(e){return isVElement(e)&&"STYLE"===e.tag}function isVTextNode(e){return e.type===VNodeType.TextNode}function isReactRef(e){return null!==e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function parseHeaders(e){let t={};return null!=e&&(isFetchHeaders(e)?e.forEach(((e,n)=>{t[n]=e})):Array.isArray(e)?e.forEach((([e,n])=>{t[e]=n})):isString(e)?e.trim().split(/[\r\n]+/).forEach((e=>{const n=e.split(": "),l=n[0];null!=l&&""!==l.trim()&&(t[l]=n[1])})):t=v({},e)),t}function flattenFormData(e){const t={};return e.forEach(((e,n)=>{e instanceof File?t[n]="[object File]":t[n]=e})),t}function generateUUID$1(){return"function"==typeof crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}n=VMutationType||(VMutationType={}),n[n.AddNode=1]="AddNode",n[n.RemoveNode=2]="RemoveNode",n[n.ChangeAttributes=3]="ChangeAttributes",n[n.CharacterData=4]="CharacterData",n[n.Document=10]="Document",n[n.StyleSheetRule=20]="StyleSheetRule",n[n.StyleSheetAdopted=21]="StyleSheetAdopted",function(e){e[e.ElementNode=1]="ElementNode",e[e.TextNode=3]="TextNode",e[e.CommentNode=8]="CommentNode",e[e.DocumentNode=9]="DocumentNode",e[e.HTMLNode=10]="HTMLNode",e[e.DocumentFragmentNode=11]="DocumentFragmentNode"}(VNodeType||(VNodeType={}));const caniuse=ciu;function now(){return caniuse.performanceNow()?globalThis.performance.now():Date.now()}const time={offset:0,now(){return now()+time.offset},sync(e){time.offset=e-now()}};function convertDOMHighResTimeStamp2AbsoluteTime(e){return performance.timeOrigin+e}let ric=globalThis.requestIdleCallback;ric||(ric=function(e,t){const n=now();return setTimeout((()=>{var l;const i=now()-n;e({didTimeout:null!=(l=null!=(null==t?void 0:t.timeout)&&i>t.timeout)&&l,timeRemaining(){return Math.max(0,7-i)}})}))});class APIError extends ServerError{constructor(e,t,n,l){super(`Error occurs when invoking API "${e}": ${n}`,M(v({},null!=l?l:{}),{code:t})),d(this,"path"),this.path=e,this.name="bytereplay.core.APIError"}}const FETCH_FLAG="bytereplay";class APIClient{constructor(e){d(this,"_env"),d(this,"_requestInterceptor"),this._env=e}get apiURL(){return`${this._env.baseURL}${this._env.apiPrefix}`}get env(){return this._env}set requestInterceptor(value){isString(value)?this._requestInterceptor=eval(value):this._requestInterceptor=value}get(e,t,n){return V(this,null,(function*(){return this._request("GET",e,t,n)}))}post(e,t,n){return V(this,null,(function*(){return this._request("POST",e,t,n)}))}_request(e,t,n,l){return V(this,null,(function*(){let i={path:t,headers:l};if(this._requestInterceptor)try{i=this._requestInterceptor(t,l)}catch(d){}const s="POST"===e,c=this._makeURL(i.path);if("GET"===e&&n)for(const[e,t]of Object.entries(n))if(null!=t){let n;n=t instanceof Date?t.toISOString():t.toString(),c.searchParams.set(e,n)}const o={};let a;s&&(isFormData(n)?a=n:(a=JSON.stringify(n),o["Content-Type"]="application/json"));const r=fetch(c.href,{method:e,mode:"cors",body:a,headers:v(v(v({},o),this._env.headers||{}),i.headers||{}),[FETCH_FLAG]:!0});return this._dealWithResponse(i.path,r)}))}_dealWithResponse(e,t){return V(this,null,(function*(){let n,l;try{n=yield t}catch(i){throw new ServerError(`Error occurs when invoking API "${e}": ${i.message}`,{cause:i})}try{l=yield n.json()}catch(i){throw new ServerError(`Response of API "${e}" can not be parsed into JSON.`,{cause:i})}if(l.success)return l.data;throw new APIError(e,l.code,l.message)}))}_makeURL(e){return new URL(e,this.apiURL)}}class AbstractRecordingStorage{}const instanceOfAny=(e,t)=>t.some((t=>e instanceof t));let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const t=new Promise(((t,n)=>{const l=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(wrap$1(e.result)),l()},s=()=>{n(e.error),l()};e.addEventListener("success",i),e.addEventListener("error",s)}));return reverseTransformCache.set(t,e),t}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const t=new Promise(((t,n)=>{const l=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),l()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),l()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));transactionDoneMap.set(e,t)}let idbProxyTraps={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return transactionDoneMap.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wrap$1(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap$1(this.request)}:function(...t){return wrap$1(e.apply(unwrap(this),t))}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap$1(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const t=transformCachableValue(e);return t!==e&&(transformCache.set(e,t),reverseTransformCache.set(t,e)),t}const unwrap=e=>reverseTransformCache.get(e);function openDB(e,t,{blocked:n,upgrade:l,blocking:i,terminated:s}={}){const c=indexedDB.open(e,t),o=wrap$1(c);return l&&c.addEventListener("upgradeneeded",(e=>{l(wrap$1(c.result),e.oldVersion,e.newVersion,wrap$1(c.transaction),e)})),n&&c.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(cachedMethods.get(t))return cachedMethods.get(t);const n=t.replace(/FromIndex$/,""),l=t!==n,i=writeMethods.includes(n);if(!(n in(l?IDBIndex:IDBObjectStore).prototype)||!i&&!readMethods.includes(n))return;const s=function(e,...t){return V(this,null,(function*(){const s=this.transaction(e,i?"readwrite":"readonly");let c=s.store;return l&&(c=c.index(t.shift())),(yield Promise.all([c[n](...t),i&&s.done]))[0]}))};return cachedMethods.set(t,s),s}replaceTraps((e=>M(v({},e),{get:(t,n,l)=>getMethod(t,n)||e.get(t,n,l),has:(t,n)=>!!getMethod(t,n)||e.has(t,n)})));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(e,t){if(!advanceMethodProps.includes(t))return e[t];let n=methodMap[t];return n||(n=methodMap[t]=function(...e){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[t](...e))}),n}};function iterate(...e){return ye(this,null,(function*(){let t=this;if(t instanceof IDBCursor||(t=yield new ne(t.openCursor(...e))),!t)return;const n=new Proxy(t,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(n,t),reverseTransformCache.set(n,unwrap(t));t;)yield n,t=yield new ne(advanceResults.get(n)||t.continue()),advanceResults.delete(n)}))}function isIteratorProp(e,t){return t===Symbol.asyncIterator&&instanceOfAny(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&instanceOfAny(e,[IDBIndex,IDBObjectStore])}replaceTraps((e=>M(v({},e),{get(t,n,l){return isIteratorProp(t,n)?iterate:e.get(t,n,l)},has(t,n){return isIteratorProp(t,n)||e.has(t,n)}})));const DATABASE_NAME="bytereplay-database",TABLE_NAME="recordings";class IndexedDBRecordingStorage extends AbstractRecordingStorage{constructor(){super(...arguments),d(this,"_db"),d(this,"_openLock")}getRecordings(){return V(this,null,(function*(){return(yield this._getDatabase()).getAll(TABLE_NAME)}))}putRecordings(e,t){return V(this,null,(function*(){if(e.length>0){const n=(yield this._getDatabase()).transaction(TABLE_NAME,"readwrite");if(yield Promise.all(e.map((e=>n.store.put(e)))),null!=t){let e=(yield n.store.count())-t;if(e>0){let t=yield n.store.openCursor();for(;e>0&&t;)e--,yield t.delete(),t=yield t.continue()}}yield n.done}}))}deleteRecordings(...e){return V(this,null,(function*(){if(e.length>0){const t=e.map((e=>e.id));let n=yield(yield this._getDatabase()).transaction(TABLE_NAME,"readwrite").store.openCursor();for(;n;)t.some((e=>(null==n?void 0:n.value.id)===e))&&(yield n.delete(),n=yield n.continue())}}))}_getDatabase(){return V(this,null,(function*(){return null!=this._db?this._db:(null==this._openLock&&(this._openLock=openDB(DATABASE_NAME,1,{upgrade(e){e.createObjectStore("recordings",{autoIncrement:!0})}}).then((e=>(this._db=e,e)))),this._openLock)}))}}class IndexedDBRecordingStorageProvider{constructor(){d(this,"_storage")}getStorage(){return this._storage||(this._storage=new IndexedDBRecordingStorage),this._storage}}class Queue{constructor(){d(this,"_queue",[])}get length(){return this._queue.length}clear(){this._queue.length=0}dequeue(){return this._queue.shift()}dump(){const e=this.toArray();return this._queue.splice(0,e.length),e}enqueue(...e){return this._queue.push(...e)}find(e,t){return this._queue.find(e,t)}findIndex(e,t){return this._queue.findIndex(e,t)}forEach(e,t){this._queue.forEach(e,t||this)}map(e,t){return this._queue.map(e,t||this)}peek(){return this._queue[0]}remove(e){return this._queue.splice(e,1)[0]}slice(e,t){return this._queue.slice(e,t)}toArray(){return[...this._queue]}}const se=class e{constructor(e){d(this,"_options"),this._options=this._normalize(e)}attempt(e,t){return V(this,null,(function*(){return"function"!=typeof e?Promise.reject(new Error("executor is not function")):this._attempt(e,this._normalize(t,this._options))}))}_attempt(e,t,n=1){return V(this,null,(function*(){return e().catch((l=>{if(t.shouldRetry&&!t.shouldRetry(l))throw l;if(n<t.retries)return this._delay(this._randomTimeout(n,t)).then((()=>this._attempt(e,t,n+1)));throw l}))}))}_normalize(t,n=e.DEFAULT_OPTIONS){const l=v({},n);if(t){const{retries:e,initialTimeout:n,maxTimeout:i,randomize:s}=t;null!=e&&e>=0&&(l.retries=e),null!=n&&n>=0&&(l.initialTimeout=n),null!=i&&i>=l.initialTimeout&&(l.maxTimeout=i),null!=s&&s>=1&&s<=2&&(l.randomize=s<1?1:s>2?2:s),null!=t&&t.shouldRetry&&(l.shouldRetry=t.shouldRetry)}return l}_delay(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}_randomTimeout(e,t){const{randomize:n,initialTimeout:l,maxTimeout:i,factor:s}=t;return Math.min(n*l*he(s,e),i)}};d(se,"DEFAULT_OPTIONS",{retries:3,initialTimeout:1e3,maxTimeout:1/0,randomize:1.5,factor:1.5,shouldRetry:()=>!0});let Retry=se;var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function l(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,l,s,c){if("function"!=typeof l)throw new TypeError("The listener must be a function");var o=new i(l,s||e,c),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],o]:e._events[a].push(o):(e._events[a]=o,e._eventsCount++),e}function c(e,t){0===--e._eventsCount?e._events=new l:delete e._events[t]}function o(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),(new l).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,l,i=[];if(0===this._eventsCount)return i;for(l in e=this._events)t.call(e,l)&&i.push(n?l.slice(1):l);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,l=this._events[t];if(!l)return[];if(l.fn)return[l.fn];for(var i=0,s=l.length,c=new Array(s);i<s;i++)c[i]=l[i].fn;return c},o.prototype.listenerCount=function(e){var t=n?n+e:e,l=this._events[t];return l?l.fn?1:l.length:0},o.prototype.emit=function(e,t,l,i,s,c){var o=n?n+e:e;if(!this._events[o])return!1;var a,r,d=this._events[o],h=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),h){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,l),!0;case 4:return d.fn.call(d.context,t,l,i),!0;case 5:return d.fn.call(d.context,t,l,i,s),!0;case 6:return d.fn.call(d.context,t,l,i,s,c),!0}for(r=1,a=new Array(h-1);r<h;r++)a[r-1]=arguments[r];d.fn.apply(d.context,a)}else{var u,b=d.length;for(r=0;r<b;r++)switch(d[r].once&&this.removeListener(e,d[r].fn,void 0,!0),h){case 1:d[r].fn.call(d[r].context);break;case 2:d[r].fn.call(d[r].context,t);break;case 3:d[r].fn.call(d[r].context,t,l);break;case 4:d[r].fn.call(d[r].context,t,l,i);break;default:if(!a)for(u=1,a=new Array(h-1);u<h;u++)a[u-1]=arguments[u];d[r].fn.apply(d[r].context,a)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,l,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!l||o.context===l)&&c(this,s);else{for(var a=0,r=[],d=o.length;a<d;a++)(o[a].fn!==t||i&&!o[a].once||l&&o[a].context!==l)&&r.push(o[a]);r.length?this._events[s]=1===r.length?r[0]:r:c(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&c(this,t)):(this._events=new l,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class RotatingQueue extends Queue{constructor(e){super(),d(this,"_size"),d(this,"_emitter"),this._size=Math.max(e,1),this._emitter=new EventEmitter}get isFull(){return this._size===this.length}enqueue(...e){let t=0,n=!1;const l=e.length,i=this.length+l-this._size;i>0&&(n=!0,this._queue.splice(0,i));const s=l-this._size;return s>0?(n=!0,t=super.enqueue(...e.slice(s))):t=super.enqueue(...e),n&&this._emitter.emit("rotated"),t}on(e,t){return this._emitter.on(e,t),this}off(e,t){return this._emitter.off(e,t),this}}const DATA_MASK="data-bytereplay-mask",DATA_MASK_EMPTY=["","true"],DATA_MASK_MAP={ignore:"ignore",name:"name"};class AbstractDataMask{constructor(e,t="*"){d(this,"_searchCondition"),d(this,"_maskingCharacter"),this._searchCondition=e,this._maskingCharacter=t}mask(e){return e.replace(this._searchCondition,(e=>this.maskSubstring(e,this._maskingCharacter)))}}class CombinedDataMask{constructor(...e){d(this,"_masks"),this._masks=e}mask(e){return this._masks.reduce(((e,t)=>t.mask(e)),e)}}var DataMaskingLevel;!function(e){e.BALANCE="BALANCE",e.STRICT="STRICT"}(DataMaskingLevel||(DataMaskingLevel={}));class BankAccountDataMask extends AbstractDataMask{constructor(){super(/\b[1-9](?:\d{18}|\d{17}|\d{16}|\d{15}|\d{11})\b/gm)}maskSubstring(e,t){return`${e.slice(0,-4).replace(/\S/g,t)}${e.slice(-4)}`}}class ChineseNameDataMask extends AbstractDataMask{constructor(){super(/[\u4e00-\u9fa5]+(\xb7[\u4e00-\u9fa5]+)*/gm)}maskSubstring(e,t){const n=e.length<=3?1:2;return`${e.slice(0,n).replace(/\S/g,t)}${e.slice(n)}`}}class EmailDataMask extends AbstractDataMask{constructor(){super(/[A-Za-z0-9.\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_-]+)+/gim)}maskSubstring(e,t){const n=e.indexOf("@");return`${e.slice(0,n).slice(0,3)}${t.repeat(3)}${e.slice(n)}`}}class EnglishNameDataMask extends AbstractDataMask{constructor(){super(/(?:[a-zA-Z']{2,} ?)+/gm)}maskSubstring(e,t){const n=e.indexOf(" ");return-1===n?`${e.slice(0,1)}${e.slice(1).replace(/\S/g,t)}`:`${e.slice(0,n).replace(/\S/g,t)}${e.slice(n)}`}}class IDCardDataMask extends AbstractDataMask{constructor(){super(/([1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx])|([1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}[0-9Xx])/gm)}maskSubstring(e,t){return`${e.slice(0,1)}${e.slice(1,-1).replace(/\S/g,t)}${e.slice(-1)}`}}class IPAddressDataMask extends AbstractDataMask{constructor(){super(/((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/gm)}maskSubstring(e,t){const n=e.indexOf(".")+1;return`${e.slice(0,n)}${e.slice(n).replace(/[^.]/g,t)}`}}class LicensePlateDataMask extends AbstractDataMask{constructor(){super(/([\u4eac\u6d25\u6caa\u6e1d\u5180\u8c6b\u4e91\u8fbd\u9ed1\u6e58\u7696\u9c81\u65b0\u82cf\u6d59\u8d63\u9102\u6842\u7518\u664b\u8499\u9655\u5409\u95fd\u8d35\u7ca4\u9752\u85cf\u5ddd\u5b81\u743c\u4f7f\u9886][A-Z](([0-9]{5}[DF])|([DF]([A-HJ-NP-Z0-9])[0-9]{4})))|([\u4eac\u6d25\u6caa\u6e1d\u5180\u8c6b\u4e91\u8fbd\u9ed1\u6e58\u7696\u9c81\u65b0\u82cf\u6d59\u8d63\u9102\u6842\u7518\u664b\u8499\u9655\u5409\u95fd\u8d35\u7ca4\u9752\u85cf\u5ddd\u5b81\u743c\u4f7f\u9886][A-Z][A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9\u6302\u5b66\u8b66\u6e2f\u6fb3\u4f7f\u9886])/gm)}maskSubstring(e,t){return`${e.slice(0,2)}${e.slice(2,-3).replace(/\S/g,t)}${e.slice(-3)}`}}class MACAddressDataMask extends AbstractDataMask{constructor(){super(/(([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2}))|(([0-9A-Fa-f]{2}-){5}([0-9A-Fa-f]{2}))/gm)}maskSubstring(e,t){const n=e.indexOf(":")+1,l=e.indexOf("-")+1,i=0===n?l:n;return`${e.slice(0,i)}${e.slice(i).replace(/[^:]/g,t)}`}}class MobilePhoneDataMask extends AbstractDataMask{constructor(){super(/\b(?:(?:\+?86)?1(?:3\d{3}|5[^4\D]\d{2}|8\d{3}|7(?:[0-35-9]\d{2}|4(?:0\d|1[0-2]|9\d))|9[0-35-9]\d{2}|6[2567]\d{2}|4(?:(?:10|4[01])\d{3}|[68]\d{4}|[579]\d{2}))\d{6})|(0?(?:10|(?:2|3[1,5,7]|4[1,5,7]|5[1,3,5,7]|7[1,3,5,7,9]|8[1,3,7,9])[0-9]|91[0-7,9]|(?:43|59|85)[1-9]|39[1-8]|54[3,6]|(?:701|580|349|335)|54[3,6]|69[1-2]|44[0,8]|48[2,3]|46[4,7,8,9]|52[0,3,7]|42[1,7,9]|56[1-6]|63[1-5]|66[0-3,8]|72[2,4,8]|74[3-6]|76[0,2,3,5,6,8,9]|82[5-7]|88[1,3,6-8]|90[1-3,6,8,9])\-?\d{7,8})\b/gm),d(this,"_regexCountryCode",/^\+?86/)}maskSubstring(e,t){let n="",l=e;const i=this._regexCountryCode.exec(e);return i&&(n=i[0],l=e.slice(n.length)),`${n}${l.slice(0,3)}${l.slice(3,-2).replace(/\S/g,t)}${l.slice(-2)}`}}class TextDataMask extends AbstractDataMask{constructor(){super(/\S+/gm)}maskSubstring(e,t){return t.repeat(e.length)}}class VINDataMask extends AbstractDataMask{constructor(){super(/\b[A-HJ-NPR-Z\d]{17}\b/gm)}maskSubstring(e,t){return`${e.slice(0,3)}${e.slice(3,-3).replace(/\S/g,t)}${e.slice(-3)}`}}function shouldIgnore(e){return!(!e||!isHTMLElement(e)||e.getAttribute(DATA_MASK)!==DATA_MASK_MAP.ignore)}const AVAILABLE_ENV_TYPE=["BOE","DEV","PROD-INTERNAL","PROD-PUBLIC","PROD-SG","PROD-PUBLIC-SG","PROD-PUBLIC-SG-TT","PROD-VA","PROD-PUBLIC-VA","PROD-PUBLIC-VA-TT","PROD-US-TTP","PROD-PUBLIC-US-TTP"],DEFAULT_ENV="PROD-INTERNAL";let _currentEnv=DEFAULT_ENV;function set(e){const t=parse(e);if(!t)throw new Error(`Invalid environment type, it must be one of the following: ${AVAILABLE_ENV_TYPE.join(", ")}.`);_currentEnv=t}function get(){return _currentEnv}function parse(e){if(isString(e)){const t=e.trim().toUpperCase();if(includes(AVAILABLE_ENV_TYPE,t))return t}}const e=Object.freeze(Object.defineProperty({__proto__:null,get:get,set:set},Symbol.toStringTag,{value:"Module"}));class Environment{constructor(e){var t;d(this,"_domains",["bytedance","zijieapi","tiktok-row","byteintl","tiktok-usts","tiktokw","tiktok"]),d(this,"DEFAULT_ENV_TYPE","PROD-INTERNAL"),d(this,"_type",this.DEFAULT_ENV_TYPE),d(this,"_baseURL"),d(this,"_apiPrefix"),d(this,"_headers"),this.baseURL=null==e?void 0:e.baseURL,this.type=null!=(t=null==e?void 0:e.type)?t:get(),this.apiPrefix=null==e?void 0:e.apiPrefix,this.headers=null==e?void 0:e.headers}set type(e){if(null!=e){const t=this.parse(e);if(t)return void(this._type=t);throw new Error(`Invalid environment type, it must be one of the following: ${AVAILABLE_ENV_TYPE.join(", ")}.`)}}get type(){return this._type}set baseURL(e){if(null==e||isEmptyString(e))this._baseURL=void 0;else try{this._baseURL=new URL(e).href}catch(t){throw new RuntimeError("Invalid base URL: "+e)}}set apiPrefix(e){e&&(e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")||(e+="/")),this._apiPrefix=null!=e?e:"api/"}get apiPrefix(){return this._apiPrefix}set headers(e){this._headers=e}get headers(){return this._headers}get baseURL(){return null!=this._baseURL?this._baseURL.startsWith("//")?location.protocol+":"+this._baseURL:this._baseURL:this.isBOE()?`https://bytereplay-boe.${this._domains[0]}.net/`:this.isDev()?"http://localhost:6789/":this.isProdPublic()?"https://bytereplay."+this._domains[1]+".com/":this.isProdSG()?"https://bytereplay-sg."+this._domains[2]+".net/":this.isProdPublicSG()?"https://bytereplay-sg."+this._domains[3]+"api.com/":this.isProdVA()?"https://bytereplay-va."+this._domains[2]+".net/":this.isProdPublicVA()?"https://bytereplay-va."+this._domains[3]+"api.com/":this.isProdUS_TTP()?"https://bytereplay."+this._domains[4]+".net/":this.isProdPublicUS_TTP()?"https://bytereplay."+this._domains[5]+".us/":this.isProdPublicSGForTT()?"https://tsr16-normal-alisg."+this._domains[6]+".com/":this.isProdPublicVATForTT()?"https://tsr16-normal-useast1a."+this._domains[6]+".com/":`https://bytereplay.${this._domains[0]}.net/`}getFullUrl(e,t=!1){if(/^(wss?:\/\/|https?:\/\/|\/\/)/.test(e))return e;const n=this.baseURL.replace(/^https?:\/\/|\/+$/g,""),l=e.replace(/^\/+/,"");return`${this._getProtocol(t)}://${n}/${this.apiPrefix}${l}`}parse(e){if(isString(e)){const t=e.trim().toUpperCase();if(includes(AVAILABLE_ENV_TYPE,t))return t}}isBOE(){return"BOE"===this._type}isDev(){return"DEV"===this._type}isProdInternal(){return"PROD-INTERNAL"===this._type}isProdPublic(){return"PROD-PUBLIC"===this._type}isProdSG(){return"PROD-SG"===this._type}isProdPublicSG(){return"PROD-PUBLIC-SG"===this._type}isProdPublicSGForTT(){return"PROD-PUBLIC-SG-TT"===this._type}isProdVA(){return"PROD-VA"===this._type}isProdPublicVA(){return"PROD-PUBLIC-VA"===this._type}isProdPublicVATForTT(){return"PROD-PUBLIC-VA-TT"===this._type}isProdUS_TTP(){return"PROD-US-TTP"===this._type}isProdPublicUS_TTP(){return"PROD-PUBLIC-US-TTP"===this.type}toOptions(){return{type:this.type,baseURL:this.baseURL,apiPrefix:this.apiPrefix,headers:this.headers}}_getProtocol(e=!1){return this.baseURL.startsWith("http:")?e?"ws":"http":e?"wss":"https"}}const version="1.0.14.34",env=e;class IOError extends RuntimeError{constructor(e,t){super(e,t),this.name="bytereplay.core.IOError"}}function createReadableStreamFromUint8Array(e){return new ReadableStream({start(t){return t.enqueue(e),t.close(),Promise.resolve()}})}function mergeUint8Arrays(e,t){const n=void 0===t?e.reduce(((e,t)=>e+t.length),0):t,l=new Uint8Array(n);let i=0;for(const s of e)l.set(s,i),i+=s.length;return l}function readAllFromStream(e){return V(this,null,(function*(){return readAllFromReader(e.getReader())}))}function readAllFromReader(e){return V(this,null,(function*(){let t;const n=[];for(;!(t=yield e.read()).done;)n.push(t.value);return mergeUint8Arrays(n)}))}var ConnectionCloseReason,HeartbeatSignal;function GetCloseReasonByServerCode(e){return 1e3===e?ConnectionCloseReason.ClosedByClient:3001===e?ConnectionCloseReason.HeartbeatTimeout:e>=3e3?ConnectionCloseReason.ClosedByServer:ConnectionCloseReason.Unknown}!function(e){e.ClosedByClient="ClosedByClient",e.ClosedByServer="ClosedByServer",e.HeartbeatTimeout="HeartbeatTimeout",e.Unknown="unknown"}(ConnectionCloseReason||(ConnectionCloseReason={})),function(e){e.Ping="ping",e.Pong="pong"}(HeartbeatSignal||(HeartbeatSignal={}));const ie=class e extends EventEmitter{constructor(t,n){super(),d(this,"connection"),d(this,"_options"),d(this,"_timer"),d(this,"_handleMessage",(e=>{e===HeartbeatSignal.Ping&&(this._pong(),this._resetTimeout())})),d(this,"_handleTimeout",(()=>{this.stop(),this.emit("timeout")})),this.connection=t,this._options=v(v({},e.DEFAULT_OPTIONS),n)}start(){this.connection.on("message",this._handleMessage),this._startTimeout()}stop(){this._clearTimeout(),this.connection.off("message",this._handleMessage)}_pong(){this.connection.isReady&&this.connection.send(HeartbeatSignal.Pong)}_startTimeout(){this._resetTimeout()}_resetTimeout(){this._clearTimeout(),this._timer=setTimeout(this._handleTimeout,this._options.timeout)}_clearTimeout(){clearTimeout(this._timer),this._timer=void 0}};d(ie,"DEFAULT_OPTIONS",{timeout:12e3});let Heartbeat=ie;class NetworkError extends RuntimeError{constructor(e,t){super(e,t),this.name="bytereplay.core.NetworkError"}}var WebSocketMessageType,WebSocketConnectionEvent;function NewCommand(e){return{type:WebSocketMessageType.Command,data:e}}!function(e){e[e.ACK=0]="ACK",e[e.Chunk=1]="Chunk",e[e.Command=10]="Command"}(WebSocketMessageType||(WebSocketMessageType={})),function(e){e.Open="open",e.Send="send",e.Message="message",e.Closed="closed"}(WebSocketConnectionEvent||(WebSocketConnectionEvent={}));class WebSocketConnection{constructor(e,t){d(this,"_url"),d(this,"_emitter"),d(this,"_heartbeat"),d(this,"_retry"),d(this,"_ws"),d(this,"_opening"),d(this,"_closing"),d(this,"_closeReason"),d(this,"_handleClose",(e=>{this._unsubscribe(this._ws),void 0===this._closeReason&&(this._closeReason=GetCloseReasonByServerCode(e.code)),this._heartbeat.stop(),this._closeReason===ConnectionCloseReason.ClosedByClient||this._closeReason===ConnectionCloseReason.ClosedByServer?this._emitter.emit(WebSocketConnectionEvent.Closed):this._reopen()})),d(this,"_handleMessage",(e=>{const{data:t}=e;if(isString(t)&&t!==HeartbeatSignal.Pong&&t!==HeartbeatSignal.Ping)try{this._emitter.emit(WebSocketConnectionEvent.Message,JSON.parse(e.data))}catch(n){}else this._emitter.emit(WebSocketConnectionEvent.Message,t)})),d(this,"_handleHeartbeatTimeout",(()=>{void 0===this._closeReason&&(this._close(ConnectionCloseReason.HeartbeatTimeout),this._reopen())})),this._url=e,this._emitter=new EventEmitter,this._heartbeat=new Heartbeat(this,null==t?void 0:t.heartbeat),this._heartbeat.on("timeout",this._handleHeartbeatTimeout),this._retry=new Retry(null==t?void 0:t.retry)}get isReady(){var e;return(null==(e=this._ws)?void 0:e.readyState)===WebSocket.OPEN}on(e,t,n){return this._emitter.on(e,t,n),this}off(e,t,n){return this._emitter.off(e,t,n),this}open(){return V(this,null,(function*(){return this._opening||(this._opening=new Promise(((e,t)=>{this._unsubscribe(this._ws),this._ws=new WebSocket(this._url);const n=()=>{var t,i;null==(t=this._ws)||t.removeEventListener("open",n),null==(i=this._ws)||i.removeEventListener("close",l),this._subscribe(this._ws),this._emitter.emit(WebSocketConnectionEvent.Open),this._heartbeat.start(),this._opening=void 0,e()},l=()=>{var e,i;null==(e=this._ws)||e.removeEventListener("open",n),null==(i=this._ws)||i.removeEventListener("close",l),this._opening=void 0,t(new NetworkError(`Failed to connect to "${this._url}"`))};this._ws.addEventListener("open",n),this._ws.addEventListener("close",l),this._ws.onerror=e=>{console.error(e)}}))),this._closeReason=void 0,this._opening}))}sendChunk(e){this._emitter.emit(WebSocketConnectionEvent.Send,e),this.send(e.data)}send(e){var t;this.isReady&&(null==(t=this._ws)||t.send(e))}close(){return this._close(ConnectionCloseReason.ClosedByClient)}_subscribe(e){null==e||e.addEventListener("close",this._handleClose),null==e||e.addEventListener("message",this._handleMessage)}_unsubscribe(e){null==e||e.removeEventListener("close",this._handleClose),null==e||e.removeEventListener("message",this._handleMessage)}_close(e){return V(this,null,(function*(){var t,n;if(this._ws)return this._closeReason=e,(null==(t=this._ws)?void 0:t.readyState)===WebSocket.CLOSED||(null==(n=this._ws)?void 0:n.readyState)===WebSocket.CLOSING?void 0:(this._closing||(this._closing=new Promise((e=>{var t,n;const l=()=>{var t;null==(t=this._ws)||t.removeEventListener("close",l),this._closing=void 0,e()};null==(t=this._ws)||t.addEventListener("close",l),null==(n=this._ws)||n.close(1e3)}))),this._closing)}))}_reopen(){this._retry.attempt((()=>this.open())).catch((e=>{this._emitter.emit(WebSocketConnectionEvent.Closed,e)}))}}function getEnvironmentMeta(e=document,t=window){return{device:{appCodeName:t.navigator.appCodeName,appName:t.navigator.appName,appVersion:t.navigator.appVersion,deviceMemory:t.navigator.deviceMemory,hardwareConcurrency:t.navigator.hardwareConcurrency,language:t.navigator.language,languages:[...t.navigator.languages],platform:t.navigator.platform,userAgent:t.navigator.userAgent},screen:[t.screen.width,t.screen.height],window:{location:t.location.href,size:[t.innerWidth,t.innerHeight]},document:{title:e.title,size:[e.body.scrollWidth,e.body.scrollHeight]},version:version}}let Sampler$1=class{constructor(e=1,t){d(this,"samplingFrequency"),d(this,"callback"),d(this,"_data",new Map),d(this,"_lastTick",0),d(this,"_isStopped",!0),d(this,"_handleFrameCallback",(e=>{e.timeRemaining()<=0?this._nextFrame():((0===this._lastTick||now()-this._lastTick>=1e3/this.samplingFrequency)&&this._tick(),this._data.size>0?this._nextFrame():this.stop())})),this.samplingFrequency=e,this.callback=t}get isStopped(){return this._isStopped}sample(e,t){this._data.set(e,t),this._isStopped&&this.start()}start(){this._lastTick=0,this._isStopped=!1,this._nextFrame()}stop(){this._isStopped=!0,this.flush()}flush(){if(this._data.size){for(const[e,t]of this._data.entries())this.callback(e,t);this._data.clear()}}_tick(){this._lastTick=now(),this.flush()}_nextFrame(){ric(this._handleFrameCallback,{timeout:1e3/this.samplingFrequency})}};const DEFAULT_STRINGIFY_OPTIONS={maxDepth:5,maxKeys:50};function stringify(e,t){const n=[],l=[],i=v(v({},DEFAULT_STRINGIFY_OPTIONS),t);return JSON.stringify(e,(function(e,t){if(n.length>0){const i=n.indexOf(this);~i?n.splice(i+1):n.push(this),~i?l.splice(i,1/0,e):l.push(e),~n.indexOf(t)&&(t=n[0]===t?"[Circular ~]":"[Circular ~."+l.slice(0,n.indexOf(t)).join(".")+"]")}else n.push(t);return null===t?t:void 0===t?"undefined":_shouldIgnore(t,i)?String(t):t}))}function exceedMaxKeys(e,t){return!(t<=0)&&Object.keys(e).length>t}function exceedMaxDepth(e,t){return!(t<=0)&&_exceedMaxDepth(e,t)}function _exceedMaxDepth(e,t){if(0===t)return!0;for(const n of Object.values(e))if(isObject$1(n)&&_exceedMaxDepth(n,t-1))return!0;return!1}function _shouldIgnore(e,t){return!!(e instanceof Blob||e instanceof Error||e instanceof Event||e instanceof EventTarget||isFormData(e)||isFunction$1(e)||isSymbol(e)||isReactRef(e)||isObject$1(e)&&(exceedMaxKeys(e,t.maxKeys)||exceedMaxDepth(e,t.maxDepth)))}var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __awaiter(e,t,n,l){return new(n||(n=Promise))((function(i,s){function c(e){try{a(l.next(e))}catch(t){s(t)}}function o(e){try{a(l.throw(e))}catch(t){s(t)}}function a(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(c,o)}a((l=l.apply(e,t||[])).next())}))}function __generator(e,t){var n,l,i,s,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(c=0)),c;)try{if(n=1,l&&(i=2&o[0]?l.return:o[0]?l.throw||((i=l.return)&&i.call(l),0):l.next)&&!(i=i.call(l,o[1])).done)return i;switch(l=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,l=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(!(i=(i=c.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){c=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){c.label=o[1];break}if(6===o[0]&&c.label<i[1]){c.label=i[1],i=o;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(o);break}i[2]&&c.ops.pop(),c.trys.pop();continue}o=t.call(e,c)}catch(a){o=[6,a],l=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],l=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&l>=e.length&&(e=void 0),{value:e&&e[l++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var l,i,s=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(l=s.next()).done;)c.push(l.value)}catch(o){i={error:o}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return c}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var l,i=0,s=t.length;i<s;i++)(l||!(i in t))&&(l||(l=Array.prototype.slice.call(t,0,i)),l[i]=t[i]);return e.concat(l||Array.prototype.slice.call(t))}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,i=n.apply(e,t||[]),s=[];return l={},c("next"),c("throw"),c("return"),l[Symbol.asyncIterator]=function(){return this},l;function c(e){i[e]&&(l[e]=function(t){return new Promise((function(n,l){s.push([e,t,n,l])>1||o(e,t)}))})}function o(e,t){try{!function(e){e.value instanceof __await?Promise.resolve(e.value.v).then(a,r):d(s[0][2],e)}(i[e](t))}catch(n){d(s[0][3],n)}}function a(e){o("next",e)}function r(e){o("throw",e)}function d(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},l("next"),l("throw"),l("return"),t[Symbol.asyncIterator]=function(){return this},t);function l(n){t[n]=e[n]&&function(t){return new Promise((function(l,i){(function(e,t,n,l){Promise.resolve(l).then((function(t){e({value:t,done:n})}),t)})(l,i,(t=e[n](t)).done,t.value)}))}}}function isFunction(e){return"function"==typeof e}function createErrorClass(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var UnsubscriptionError=createErrorClass((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function arrRemove(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Subscription=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,l,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=__values(s),o=c.next();!o.done;o=c.next()){o.value.remove(this)}}catch(b){e={error:b}}finally{try{o&&!o.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else s.remove(this);var a=this.initialTeardown;if(isFunction(a))try{a()}catch(b){i=b instanceof UnsubscriptionError?b.errors:[b]}var r=this._finalizers;if(r){this._finalizers=null;try{for(var d=__values(r),h=d.next();!h.done;h=d.next()){var u=h.value;try{execFinalizer(u)}catch(b){i=null!=i?i:[],b instanceof UnsubscriptionError?i=__spreadArray(__spreadArray([],__read(i)),__read(b.errors)):i.push(b)}}}catch(b){n={error:b}}finally{try{h&&!h.done&&(l=d.return)&&l.call(d)}finally{if(n)throw n.error}}}if(i)throw new UnsubscriptionError(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)execFinalizer(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&arrRemove(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&arrRemove(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(e){return e instanceof Subscription||e&&"closed"in e&&isFunction(e.remove)&&isFunction(e.add)&&isFunction(e.unsubscribe)}function execFinalizer(e){isFunction(e)?e():e.unsubscribe()}var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider={setTimeout:function(e,t){for(var n=[],l=2;l<arguments.length;l++)n[l-2]=arguments[l];var i=timeoutProvider.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,__spreadArray([e,t],__read(n))):setTimeout.apply(void 0,__spreadArray([e,t],__read(n)))},clearTimeout:function(e){var t=timeoutProvider.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function reportUnhandledError(e){timeoutProvider.setTimeout((function(){throw e}))}function noop(){}function errorContext(e){e()}var Subscriber=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,isSubscription(t)&&t.add(n)):n.destination=EMPTY_OBSERVER,n}return __extends(t,e),t.create=function(e,t,n){return new SafeSubscriber(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Subscription),_bind=Function.prototype.bind;function bind(e,t){return _bind.call(e,t)}var ConsumerObserver=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){handleUnhandledError(n)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){handleUnhandledError(n)}else handleUnhandledError(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){handleUnhandledError(t)}},e}(),SafeSubscriber=function(e){function t(t,n,l){var i,s,c=e.call(this)||this;isFunction(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=l?l:void 0}:c&&config.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return c.unsubscribe()},i={next:t.next&&bind(t.next,s),error:t.error&&bind(t.error,s),complete:t.complete&&bind(t.complete,s)}):i=t;return c.destination=new ConsumerObserver(i),c}return __extends(t,e),t}(Subscriber);function handleUnhandledError(e){reportUnhandledError(e)}function defaultErrorHandler(e){throw e}var EMPTY_OBSERVER={closed:!0,next:noop,error:defaultErrorHandler,complete:noop},observable="function"==typeof Symbol&&Symbol.observable||"@@observable";function identity(e){return e}function pipeFromArray(e){return 0===e.length?identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Observable=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var l=this,i=isSubscriber(e)?e:new SafeSubscriber(e,t,n);return errorContext((function(){var e=l,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?l._subscribe(i):l._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=getPromiseCtor(t))((function(t,l){var i=new SafeSubscriber({next:function(t){try{e(t)}catch(n){l(n),i.unsubscribe()}},error:l,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=getPromiseCtor(e))((function(e,n){var l;t.subscribe((function(e){return l=e}),(function(e){return n(e)}),(function(){return e(l)}))}))},e.create=function(t){return new e(t)},e}();function getPromiseCtor(e){var t;return null!==(t=null!=e?e:config.Promise)&&void 0!==t?t:Promise}function isObserver(e){return e&&isFunction(e.next)&&isFunction(e.error)&&isFunction(e.complete)}function isSubscriber(e){return e&&e instanceof Subscriber||isObserver(e)&&isSubscription(e)}function hasLift(e){return isFunction(null==e?void 0:e.lift)}function operate(e){return function(t){if(hasLift(t))return t.lift((function(t){try{return e(t,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function createOperatorSubscriber(e,t,n,l,i){return new OperatorSubscriber(e,t,n,l,i)}var OperatorSubscriber=function(e){function t(t,n,l,i,s,c){var o=e.call(this,t)||this;return o.onFinalize=s,o.shouldUnsubscribe=c,o._next=n?function(e){try{n(e)}catch(l){t.error(l)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(n){t.error(n)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=l?function(){try{l()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return __extends(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Subscriber),ObjectUnsubscribedError=createErrorClass((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Subject=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return __extends(t,e),t.prototype.lift=function(e){var t=new AnonymousSubject(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;errorContext((function(){var n,l;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=__values(t.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(e)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;errorContext((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;errorContext((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,l=n.hasError,i=n.isStopped,s=n.observers;return l||i?EMPTY_SUBSCRIPTION:(this.currentObservers=null,s.push(e),new Subscription((function(){t.currentObservers=null,arrRemove(s,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,l=t.thrownError,i=t.isStopped;n?e.error(l):i&&e.complete()},t.prototype.asObservable=function(){var e=new Observable;return e.source=this,e},t.create=function(e,t){return new AnonymousSubject(e,t)},t}(Observable),AnonymousSubject=function(e){function t(t,n){var l=e.call(this)||this;return l.destination=t,l.source=n,l}return __extends(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:EMPTY_SUBSCRIPTION},t}(Subject),EMPTY=new Observable((function(e){return e.complete()}));function isScheduler(e){return e&&isFunction(e.schedule)}function last(e){return e[e.length-1]}function popScheduler(e){return isScheduler(last(e))?e.pop():void 0}function popNumber(e,t){return"number"==typeof last(e)?e.pop():t}var isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function isPromise(e){return isFunction(null==e?void 0:e.then)}function isInteropObservable(e){return isFunction(e[observable])}function isAsyncIterable(e){return Symbol.asyncIterator&&isFunction(null==e?void 0:e[Symbol.asyncIterator])}function createInvalidObservableTypeError(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var iterator=getSymbolIterator(),IFrameActionType;function isIterable(e){return isFunction(null==e?void 0:e[iterator])}function readableStreamLikeToAsyncGenerator(e){return __asyncGenerator(this,arguments,(function(){var t,n,l;return __generator(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,__await(t.read())];case 3:return n=i.sent(),l=n.value,n.done?[4,__await(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,__await(l)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function isReadableStreamLike(e){return isFunction(null==e?void 0:e.getReader)}function innerFrom(e){if(e instanceof Observable)return e;if(null!=e){if(isInteropObservable(e))return fromInteropObservable(e);if(isArrayLike(e))return fromArrayLike(e);if(isPromise(e))return fromPromise(e);if(isAsyncIterable(e))return fromAsyncIterable(e);if(isIterable(e))return fromIterable(e);if(isReadableStreamLike(e))return fromReadableStreamLike(e)}throw createInvalidObservableTypeError(e)}function fromInteropObservable(e){return new Observable((function(t){var n=e[observable]();if(isFunction(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function fromArrayLike(e){return new Observable((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function fromPromise(e){return new Observable((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,reportUnhandledError)}))}function fromIterable(e){return new Observable((function(t){var n,l;try{for(var i=__values(e),s=i.next();!s.done;s=i.next()){var c=s.value;if(t.next(c),t.closed)return}}catch(o){n={error:o}}finally{try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(n)throw n.error}}t.complete()}))}function fromAsyncIterable(e){return new Observable((function(t){process(e,t).catch((function(e){return t.error(e)}))}))}function fromReadableStreamLike(e){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(e))}function process(e,t){var n,l,i,s;return __awaiter(this,void 0,void 0,(function(){var c,o;return __generator(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=__asyncValues(e),a.label=1;case 1:return[4,n.next()];case 2:if((l=a.sent()).done)return[3,4];if(c=l.value,t.next(c),t.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=a.sent(),i={error:o},[3,11];case 6:return a.trys.push([6,,9,10]),l&&!l.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))}function executeSchedule(e,t,n,l,i){void 0===l&&(l=0),void 0===i&&(i=!1);var s=t.schedule((function(){n(),i?e.add(this.schedule(null,l)):this.unsubscribe()}),l);if(e.add(s),!i)return s}function observeOn(e,t){return void 0===t&&(t=0),operate((function(n,l){n.subscribe(createOperatorSubscriber(l,(function(n){return executeSchedule(l,e,(function(){return l.next(n)}),t)}),(function(){return executeSchedule(l,e,(function(){return l.complete()}),t)}),(function(n){return executeSchedule(l,e,(function(){return l.error(n)}),t)})))}))}function subscribeOn(e,t){return void 0===t&&(t=0),operate((function(n,l){l.add(e.schedule((function(){return n.subscribe(l)}),t))}))}function scheduleObservable(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}function schedulePromise(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}function scheduleArray(e,t){return new Observable((function(n){var l=0;return t.schedule((function(){l===e.length?n.complete():(n.next(e[l++]),n.closed||this.schedule())}))}))}function scheduleIterable(e,t){return new Observable((function(n){var l;return executeSchedule(n,t,(function(){l=e[iterator](),executeSchedule(n,t,(function(){var e,t,i;try{t=(e=l.next()).value,i=e.done}catch(s){return void n.error(s)}i?n.complete():n.next(t)}),0,!0)})),function(){return isFunction(null==l?void 0:l.return)&&l.return()}}))}function scheduleAsyncIterable(e,t){if(!e)throw new Error("Iterable cannot be null");return new Observable((function(n){executeSchedule(n,t,(function(){var l=e[Symbol.asyncIterator]();executeSchedule(n,t,(function(){l.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function scheduleReadableStreamLike(e,t){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(e),t)}function scheduled(e,t){if(null!=e){if(isInteropObservable(e))return scheduleObservable(e,t);if(isArrayLike(e))return scheduleArray(e,t);if(isPromise(e))return schedulePromise(e,t);if(isAsyncIterable(e))return scheduleAsyncIterable(e,t);if(isIterable(e))return scheduleIterable(e,t);if(isReadableStreamLike(e))return scheduleReadableStreamLike(e,t)}throw createInvalidObservableTypeError(e)}function from(e,t){return t?scheduled(e,t):innerFrom(e)}function map(e,t){return operate((function(n,l){var i=0;n.subscribe(createOperatorSubscriber(l,(function(n){l.next(e.call(t,n,i++))})))}))}function mergeInternals(e,t,n,l,i,s,c,o){var a=[],r=0,d=0,h=!1,u=function(){h&&!a.length&&!r&&t.complete()},b=function(e){return r<l?m(e):a.push(e)},m=function(e){s&&t.next(e),r++;var o=!1;innerFrom(n(e,d++)).subscribe(createOperatorSubscriber(t,(function(e){null==i||i(e),s?b(e):t.next(e)}),(function(){o=!0}),void 0,(function(){if(o)try{r--;for(var e=function(){var e=a.shift();c?executeSchedule(t,c,(function(){return m(e)})):m(e)};a.length&&r<l;)e();u()}catch(n){t.error(n)}})))};return e.subscribe(createOperatorSubscriber(t,b,(function(){h=!0,u()}))),function(){null==o||o()}}function mergeMap(e,t,n){return void 0===n&&(n=1/0),isFunction(t)?mergeMap((function(n,l){return map((function(e,i){return t(n,e,l,i)}))(innerFrom(e(n,l)))}),n):("number"==typeof t&&(n=t),operate((function(t,l){return mergeInternals(t,l,e,n)})))}function mergeAll(e){return void 0===e&&(e=1/0),mergeMap(identity,e)}function merge(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=popScheduler(e),l=popNumber(e,1/0),i=e;return i.length?1===i.length?innerFrom(i[0]):mergeAll(l)(from(i,n)):EMPTY}function share(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Subject}:t,l=e.resetOnError,i=void 0===l||l,s=e.resetOnComplete,c=void 0===s||s,o=e.resetOnRefCountZero,a=void 0===o||o;return function(e){var t,l,s,o=0,r=!1,d=!1,h=function(){null==l||l.unsubscribe(),l=void 0},u=function(){h(),t=s=void 0,r=d=!1},b=function(){var e=t;u(),null==e||e.unsubscribe()};return operate((function(e,m){o++,!d&&!r&&h();var p=s=null!=s?s:n();m.add((function(){0===--o&&!d&&!r&&(l=handleReset(b,a))})),p.subscribe(m),!t&&o>0&&(t=new SafeSubscriber({next:function(e){return p.next(e)},error:function(e){d=!0,h(),l=handleReset(u,i,e),p.error(e)},complete:function(){r=!0,h(),l=handleReset(u,c),p.complete()}}),innerFrom(e).subscribe(t))}))(e)}}function handleReset(e,t){for(var n=[],l=2;l<arguments.length;l++)n[l-2]=arguments[l];if(!0!==t){if(!1!==t){var i=new SafeSubscriber({next:function(){i.unsubscribe(),e()}});return innerFrom(t.apply(void 0,__spreadArray([],__read(n)))).subscribe(i)}}else e()}function tap(e,t,n){var l=isFunction(e)||t||n?{next:e,error:t,complete:n}:e;return l?operate((function(e,t){var n;null===(n=l.subscribe)||void 0===n||n.call(l);var i=!0;e.subscribe(createOperatorSubscriber(t,(function(e){var n;null===(n=l.next)||void 0===n||n.call(l,e),t.next(e)}),(function(){var e;i=!1,null===(e=l.complete)||void 0===e||e.call(l),t.complete()}),(function(e){var n;i=!1,null===(n=l.error)||void 0===n||n.call(l,e),t.error(e)}),(function(){var e,t;i&&(null===(e=l.unsubscribe)||void 0===e||e.call(l)),null===(t=l.finalize)||void 0===t||t.call(l)})))})):identity}class AbstractFlow{constructor(){d(this,"_downstream",new Subject),d(this,"pipe",this._downstream.pipe.bind(this._downstream))}output(e){this._downstream.next(e)}asPipeable(){return e=>(e.subscribe((e=>{this.handleInput(e)})),this._downstream)}}!function(e){e.StartRecording="startRecording",e.StopRecording="stopRecording",e.Unload="unload",e.Load="load"}(IFrameActionType||(IFrameActionType={}));const IFrameEvent="ReplayIFrameEvent";function buildIFrameEvent(e){return new CustomEvent(IFrameEvent,{detail:e})}var IFrameState,TrackerEventType,TrackType,RefType,RecordingMode,StreamingCommandType,TransportChannelType;function isCustomTrackType(e){return e>=1001&&e<=1999}function checkCustomTrackType(e){if(!isCustomTrackType(e))throw new Error("custom tracker type must be in range [1001 ~ 1999].");return e}function newNoopFrame(e){return{time:e,trackType:TrackType.Noop,event:{eventType:TrackerEventType.Noop,data:0}}}!function(e){e.Loading="loading",e.Loaded="loaded",e.Recording="recording"}(IFrameState||(IFrameState={})),function(e){e[e.Noop=0]="Noop",e[e.HTMLSnapshot=101]="HTMLSnapshot",e[e.HTMLMutations=102]="HTMLMutations",e[e.HTMLScroll=103]="HTMLScroll",e[e.HTMLFocus=104]="HTMLFocus",e[e.HTMLBlur=105]="HTMLBlur",e[e.HTMLValueChange=106]="HTMLValueChange",e[e.HTMLSelectionChange=107]="HTMLSelectionChange",e[e.HTMLResize=110]="HTMLResize",e[e.HTMLIncrementalSnapshot=111]="HTMLIncrementalSnapshot",e[e.HTMLNavigation=115]="HTMLNavigation",e[e.HTMLCanvas=120]="HTMLCanvas",e[e.HTMLImage=122]="HTMLImage",e[e.HTMLIFrame=130]="HTMLIFrame",e[e.MouseMove=201]="MouseMove",e[e.MouseDown=202]="MouseDown",e[e.MouseUp=203]="MouseUp",e[e.MouseClick=204]="MouseClick",e[e.TouchStart=205]="TouchStart",e[e.TouchMove=206]="TouchMove",e[e.TouchEnd=207]="TouchEnd",e[e.TouchCancel=208]="TouchCancel",e[e.KeyDown=301]="KeyDown",e[e.ConsoleAssert=401]="ConsoleAssert",e[e.ConsoleDebug=402]="ConsoleDebug",e[e.ConsoleDir=403]="ConsoleDir",e[e.ConsoleDirxml=404]="ConsoleDirxml",e[e.ConsoleError=405]="ConsoleError",e[e.ConsoleInfo=406]="ConsoleInfo",e[e.ConsoleLog=407]="ConsoleLog",e[e.ConsoleTable=408]="ConsoleTable",e[e.ConsoleTrace=409]="ConsoleTrace",e[e.ConsoleWarn=410]="ConsoleWarn",e[e.ERROR_SCRIPT=501]="ERROR_SCRIPT",e[e.ERROR_RUNTIME=502]="ERROR_RUNTIME",e[e.ERROR_NOTFOUND=503]="ERROR_NOTFOUND",e[e.ERROR_PROMISEREJECTION=504]="ERROR_PROMISEREJECTION",e[e.NETWORK_SEND=601]="NETWORK_SEND",e[e.NETWORK_DONE=602]="NETWORK_DONE",e[e.NETWORK_ABORT=603]="NETWORK_ABORT",e[e.NETWORK_ERROR=604]="NETWORK_ERROR",e[e.NETWORK_TIMEOUT=605]="NETWORK_TIMEOUT",e[e.INSIGHT_RAGE_CLICK=701]="INSIGHT_RAGE_CLICK",e[e.INSIGHT_DEAD_CLICK=702]="INSIGHT_DEAD_CLICK",e[e.INSIGHT_LONG_HOVER=703]="INSIGHT_LONG_HOVER",e[e.INSIGHT_EXCESSIVE_SCROLLING=704]="INSIGHT_EXCESSIVE_SCROLLING",e[e.PERFORMANCE_LONG_TASK=801]="PERFORMANCE_LONG_TASK",e[e.PERFORMANCE_RESOURCE=802]="PERFORMANCE_RESOURCE",e[e.PERFORMANCE_NAVIGATION=803]="PERFORMANCE_NAVIGATION"}(TrackerEventType||(TrackerEventType={})),function(e){e[e.Noop=0]="Noop",e[e.HTML=100]="HTML",e[e.Mouse=200]="Mouse",e[e.Keyboard=300]="Keyboard",e[e.Console=400]="Console",e[e.Error=500]="Error",e[e.Network=600]="Network",e[e.Insight=700]="Insight",e[e.Performance=800]="Performance"}(TrackType||(TrackType={})),function(e){e.IFrame="iframe",e.Blackbox="blackbox",e.Transaction="transaction"}(RefType||(RefType={})),function(e){e.Blackbox="blackbox",e.Blocking="blocking",e.InMemory="in-memory",e.LiveStreaming="live-streaming",e.Streaming="streaming"}(RecordingMode||(RecordingMode={})),function(e){e.RecorderStopped="RecorderStopped",e.ReceiverStopped="ReceiverStopped",e.RecorderDisconnected="RecorderDisconnected",e.SyncBlock="SyncBlock",e.SyncPacket="SyncPacket"}(StreamingCommandType||(StreamingCommandType={})),function(e){e.Websocket="websocket",e.QUIC="quic",e.HTTP="http"}(TransportChannelType||(TransportChannelType={}));class Component extends EventEmitter{constructor(e){super(),d(this,"container"),this.container=this.createElement(e)}get tagName(){return this.container.tagName}addClass(...e){this.container.classList.add(...e)}removeClass(e){this.container.classList.remove(e)}setAttribute(e,t){this.container.setAttribute(e,t)}toggleClass(e,t){return this.container.classList.toggle(e,t)}placeAt(e){e instanceof HTMLElement?e.appendChild(this.container):e.container.appendChild(this.container)}createElement(e,...t){const n=document.createElement(e);return null!=t&&t.length&&n.classList.add(...t),n}createElementNS(e,...t){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return null!=t&&t.length&&n.classList.add(...t),n}}const CTX_API=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createConicGradient","createImageData","createLinearGradient","createPattern","createRadialGradient","drawFocusIfNeeded","drawImage","ellipse","fill","fillRect","fillText","getContextAttributes","getImageData","getLineDash","getTransform","isContextLost","isPointInPath","isPointInStroke","lineTo","measureText","moveTo","putImageData","quadraticCurveTo","rect","reset","resetTransform","restore","rotate","roundRect","save","scale","scrollPathIntoView","setLineDash","setTransform","stroke","strokeRect","strokeText","transform","translate"],CTX_API_ENCODER={setTransform:0,lineTo:1,beginPath:2,fill:3,setAttr:4,stroke:5,clip:6,save:7,restore:8,fillText:9,fillRect:10,arc:11,arcTo:12,bezierCurveTo:13,clearRect:14,closePath:15,createConicGradient:16,createImageData:17,createLinearGradient:18,createPattern:19,createRadialGradient:20,drawFocusIfNeeded:21,drawImage:22,ellipse:23,getContextAttributes:24,getImageData:25,getLineDash:26,getTransform:27,isContextLost:28,isPointInPath:29,isPointInStroke:30,measureText:31,moveTo:32,putImageData:33,quadraticCurveTo:34,rect:35,reset:36,resetTransform:37,rotate:38,roundRect:39,scale:40,scrollPathIntoView:41,setLineDash:42,strokeRect:43,strokeText:44,transform:45,translate:46,snapshot:47},CTX_API_DECODER=Object.keys(CTX_API_ENCODER),CTX_DRAWING_API={arc:!1,arcTo:!1,beginPath:!0,bezierCurveTo:!1,clearRect:!0,clip:!1,closePath:!0,createConicGradient:!1,createImageData:!1,createLinearGradient:!1,createPattern:!1,createRadialGradient:!1,drawFocusIfNeeded:!1,drawImage:!0,ellipse:!1,fill:!0,fillRect:!0,fillText:!0,getContextAttributes:!1,getImageData:!1,getLineDash:!1,getTransform:!1,isContextLost:!1,isPointInPath:!1,isPointInStroke:!1,lineTo:!1,measureText:!1,moveTo:!1,putImageData:!1,quadraticCurveTo:!1,rect:!1,reset:!1,resetTransform:!1,restore:!1,rotate:!1,roundRect:!1,save:!1,scale:!1,scrollPathIntoView:!1,setLineDash:!1,setTransform:!1,stroke:!0,strokeRect:!0,strokeText:!0,transform:!1,translate:!1},CTX_SETTING_API=["resetTransform","setLineDash","setTransform"],CTX_ATTR=["direction","fillStyle","filter","font","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"],CTX_ATTR_ENCODER={textRendering:0,fillStyle:1,strokeStyle:2,font:3,textAlign:4,wordSpacing:5,lineCap:6,lineDashOffset:7,lineJoin:8,letterSpacing:9,direction:10,filter:11,fontKerning:12,fontStretch:13,fontVariantCaps:14,lineWidth:15,globalCompositeOperation:16,imageSmoothingEnabled:17,imageSmoothingQuality:18,miterLimit:19,shadowBlur:20,shadowColor:21,shadowOffsetX:22,shadowOffsetY:23,textBaseline:24,globalAlpha:25},CTX_ATTR_DECODER=Object.keys(CTX_ATTR_ENCODER),LONG_STR_ATTR=[],pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function append(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function appendRound(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return append;const n=he(10,t);return function(e){this._+=e[0];for(let t=1,l=e.length;t<l;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}class Path{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?append:appendRound(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,l){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+l}`}bezierCurveTo(e,t,n,l,i,s){this._append`C${+e},${+t},${+n},${+l},${this._x1=+i},${this._y1=+s}`}arcTo(e,t,n,l,i){if(e=+e,t=+t,n=+n,l=+l,(i=+i)<0)throw new Error(`negative radius: ${i}`);let s=this._x1,c=this._y1,o=n-e,a=l-t,r=s-e,d=c-t,h=r*r+d*d;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(h>epsilon)if(Math.abs(d*o-a*r)>epsilon&&i){let u=n-s,b=l-c,m=o*o+a*a,p=u*u+b*b,Z=Math.sqrt(m),y=Math.sqrt(h),X=i*Math.tan((pi-Math.acos((m+h-p)/(2*Z*y)))/2),G=X/y,V=X/Z;Math.abs(G-1)>epsilon&&this._append`L${e+G*r},${t+G*d}`,this._append`A${i},${i},0,0,${+(d*u>r*b)},${this._x1=e+V*o},${this._y1=t+V*a}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,n,l,i,s){if(e=+e,t=+t,s=!!s,(n=+n)<0)throw new Error(`negative radius: ${n}`);let c=n*Math.cos(l),o=n*Math.sin(l),a=e+c,r=t+o,d=1^s,h=s?l-i:i-l;null===this._x1?this._append`M${a},${r}`:(Math.abs(this._x1-a)>epsilon||Math.abs(this._y1-r)>epsilon)&&this._append`L${a},${r}`,n&&(h<0&&(h=h%tau+tau),h>tauEpsilon?this._append`A${n},${n},0,1,${d},${e-c},${t-o}A${n},${n},0,1,${d},${this._x1=a},${this._y1=r}`:h>epsilon&&this._append`A${n},${n},0,${+(h>=pi)},${d},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,l){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+l}h${-n}Z`}toString(){return this._}}function path(){return new Path}function Transform(e,t,n){this.k=e,this.x=t,this.y=n}path.prototype=Path.prototype,Transform.prototype={constructor:Transform,scale:function(e){return 1===e?this:new Transform(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Transform(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Transform.prototype;const check=function(e){return e&&e.Math===Math&&e},GLOBAL_OBJ=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof global&&global)||check("object"==typeof globalThis&&globalThis)||function(){return this}()||Function("return this")();function proxyPath2D(){if(GLOBAL_OBJ.Path2D){class e extends GLOBAL_OBJ.Path2D{constructor(e){super(e),this.path=e,this._d3Path=path();const t=Object.getPrototypeOf(this),n=Object.getPrototypeOf(t),l=Object.getOwnPropertyDescriptors(n),i=Object.getPrototypeOf(this._d3Path),s=Object.getOwnPropertyDescriptors(i);return Object.keys(l).forEach((e=>{Object.defineProperty(this,e,{writable:!0,value:(...t)=>(Reflect.apply(s[e].value,this._d3Path,t),Reflect.apply(l[e].value,this,t))})})),this}toJSON(){return{type:"Path2D",value:this._d3Path.toString()}}}return e.CANVAS_OBSERVER_PROXYED_PATH2D=!0,e}return null}function isProxyed(e){return null!=e&&!0===e.CANVAS_OBSERVER_PROXYED_PATH2D}class QuickLRU extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,n)&&(yield e)}for(const e of this.cache){const[t,n]=e;!1===this._deleteIfExpired(t,n)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const l="number"==typeof n&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:l}):this._set(e,{value:t,expiry:l}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;!1===this._deleteIfExpired(t,n)&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,n)&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[l,i]=n;!1===this._deleteIfExpired(l,i)&&(yield[l,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[l,i]=n;this.cache.has(l)||!1===this._deleteIfExpired(l,i)&&(yield[l,i.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,l]of this.entriesAscending())e.call(t,l,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class ImageDeserializer{constructor(){this._imageCache=new QuickLRU({maxSize:1e3,maxAge:2e4})}deserialize(e){return V(this,null,(function*(){if(!e)return;return this._imageCache.get(e)||new Promise((t=>{const n=new Image;n.onload=()=>{t(n)},n.src=e,this._imageCache.set(e,n)}))}))}}const defaultImageDeserializer=new ImageDeserializer;function serialize2DMatrix(e){if(e)return[e.a,e.b,e.c,e.d,e.e,e.f]}function deserialize2DMatrix(e){return new DOMMatrix(e)}class Decoder{constructor(e){this._stringRecorder=[];const{canvas:t}=e;this._stringRecorder=[],this._canvas=t}decode(e){return V(this,null,(function*(){const{api:t,args:n}=e,l=CTX_API_DECODER[t],i="setAttr"===l?yield this.decodeAttr(n):this.decodeArgs(n);if("stroke"===l&&i.length&&!isProxyed(i[0]))throw new Error("argument type invalid, Path2D is not ProxyPath2D");return{api:l,args:i||[]}}))}decodeAttr(e){return V(this,null,(function*(){const t=[];let n=0;for(;n<e.length-1;){const l=e[n],i=e[n+1];if(LONG_STR_ATTR.includes(CTX_ATTR_DECODER[l])&&"string"==typeof i||"number"==typeof i)if("number"==typeof i){const e=this._stringRecorder[i];t.push({key:CTX_ATTR_DECODER[l],value:e})}else t.push({key:CTX_ATTR_DECODER[l],value:i}),this._stringRecorder.push(i);else"ProxyLinearGradient"===(null==i?void 0:i.type)?t.push({key:CTX_ATTR_DECODER[l],value:getLinearGradient(i.value,this._canvas)}):"ProxyPattern"===(null==i?void 0:i.type)?t.push({key:CTX_ATTR_DECODER[l],value:yield getCanvasPattern(i.value,this._canvas)}):t.push({key:CTX_ATTR_DECODER[l],value:i});n+=2}return t}))}decodeArgs(e){return null!=e&&e.map?e.map((e=>isProxyPath2D(e)?new GLOBAL_OBJ.Path2D(e.value):e)):e}}function isProxyPath2D(e){return"Path2D"===(null==e?void 0:e.type)}function getLinearGradient(e,t){const n=t.getContext("2d");if(!n)return null;const l=e[0],i=n.createLinearGradient(l[0],l[1],l[2],l[3]);for(let s=1;s<e.length;s++){const t=e[s];i.addColorStop(t[0],t[1])}return i}function getCanvasPattern(e,t){return V(this,null,(function*(){var n,l;const i=t.getContext("2d");if(!i)return null;const s=null!==(n=e[0])&&void 0!==n?n:[],c=yield defaultImageDeserializer.deserialize(null===(l=s[0])||void 0===l?void 0:l.src);if(!c)return;const o=i.createPattern(c,s[1]);if(o)for(let t=1;t<e.length;t++){const n=e[t];n&&o.setTransform(deserialize2DMatrix(n))}return o}))}class CanvasPlayer{constructor(e){this._prevApi=-1,this._instructionsQueue=[],this._executePromise=null;const{canvas:t}=e;this._canvas=t,this._decoder=new Decoder({canvas:t})}get canvas(){return this._canvas}execute(e){null!=e&&e.length&&(this._instructionsQueue.length?this._instructionsQueue.push(...e):(this._instructionsQueue.push(...e),this._execute()))}_execute(){return V(this,null,(function*(){for(;this._instructionsQueue.length;){const e=this._instructionsQueue.shift();if(isAPI(e)){const t=e;if(this._instructionsQueue.length>0&&isArg(this._instructionsQueue[0])){const e=this._instructionsQueue.shift();yield this.executeOne({api:t,args:e}),this._executePromise=null}else yield this.executeOne({api:t,args:[]}),this._executePromise=null;this._prevApi=t}else isArg(e)?(yield this.executeOne({api:this._prevApi,args:e}),this._executePromise=null):console.log("sth error")}}))}executeOne(e){return V(this,null,(function*(){return this._executePromise=new Promise(((t,n)=>V(this,null,(function*(){var l,i,s;const c=null===(i=null===(l=this._canvas)||void 0===l?void 0:l.getContext)||void 0===i?void 0:i.call(l,"2d");if(this._decoder&&this._canvas&&c)try{const{api:n,args:l}=yield this._decoder.decode(e);if(null!=n&&n.length)if("setAttr"===n){for(let e=0;e<l.length;e++){const{key:t,value:n}=l[e];c[t]=n}t(1)}else if("snapshot"===n)defaultImageDeserializer.deserialize(l).then((e=>{c.drawImage(e,0,0),t(1)}));else if("lineTo"===n){let e=0;for(;e<l.length-1;){const t=l[e],i=l[e+1];c[n].apply(c,[t,i]),e+=2}t(1)}else"drawImage"===n&&Array.isArray(l)&&null!==(s=l[0])&&void 0!==s&&s.src?defaultImageDeserializer.deserialize(l[0].src).then((e=>{l[0].__drawFullPage&&c.clearRect(0,0,this._canvas.width,this._canvas.height),c.drawImage(e,...l.slice(1)),t(1)})):(c[n].apply(c,[...l]),t(1));else console.log("invalid api"),t(-1)}catch(o){localStorage&&localStorage.bytereplay_debug&&console.error("[bytereplay] Execute canvas command error",o,{instruction:e}),t(-1)}else n(-1)})))),this._executePromise}))}snapshot(){return V(this,null,(function*(){if(this.canvas instanceof OffscreenCanvas){const e=yield this.canvas.convertToBlob({type:"image/png",quality:1});return yield new Promise((t=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.readAsDataURL(e)}))}return this.canvas.toDataURL("image/png",1)}))}decode(e){return V(this,null,(function*(){const t=[];if(null==e||!e.length||!this._decoder)return t;const n=[...e];for(;n.length;){const e=n.shift();if(isAPI(e)){const l=e;if(n.length>0&&isArg(n[0])){const e=n.shift();t.push(yield this._decoder.decode({api:l,args:e}))}else t.push(yield this._decoder.decode({api:l,args:[]}));this._prevApi=l}else isArg(e)?t.push(yield this._decoder.decode({api:this._prevApi,args:e})):console.log("sth error")}return t}))}}function isAPI(e){return"string"!=typeof e&&"undefined"!=typeof e&&("setAttr"===CTX_API_DECODER[e]||"snapshot"===CTX_API_DECODER[e]||CTX_API.includes(CTX_API_DECODER[e]))}function isArg(e){return!!("object"==typeof e||"string"==typeof e&&e.startsWith("data:"))}class ImageSerializer{constructor(){this._serializeCache=new WeakMap,this._canvas=null}serialize(e){if(e instanceof HTMLCanvasElement)return{type:e.constructor.name,src:e.toDataURL()};if(e instanceof OffscreenCanvas){const t=e.transferToImageBitmap(),n=this._serializeCache.get(t);if(n)return n;const l=e.transferToImageBitmap(),i={type:e.constructor.name,src:this._convertImageBitmapIntoBase64(l)};return this._serializeCache.set(l,i),i}if(GLOBAL_OBJ.VideoFrame&&e instanceof VideoFrame){const t={type:e.constructor.name,src:this._convertVideoFrameIntoBase64(e)};return this._serializeCache.set(e,t),t}if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof Image){const t={type:e.constructor.name,src:e.src};return this._serializeCache.set(e,t),t}if(e instanceof ImageBitmap){const t={type:e.constructor.name,src:this._convertImageBitmapIntoBase64(e)};return this._serializeCache.set(e,t),t}if(e instanceof SVGImageElement){const t={type:e.constructor.name,src:e.href.baseVal};return this._serializeCache.set(e,t),t}}isCanvasImageSource(e){return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof Image||e instanceof ImageBitmap||e instanceof OffscreenCanvas||e instanceof SVGImageElement||GLOBAL_OBJ.VideoFrame&&e instanceof VideoFrame}_convertImageBitmapIntoBase64(e){const t=this.canvas;return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png",1)}_convertVideoFrameIntoBase64(e){const t=document.createElement("canvas");return t.width=e.displayWidth,t.height=e.displayHeight,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png",1)}get canvas(){return this._canvas||(this._canvas=document.createElement("canvas")),this._canvas}}const defaultImageSerializer=new ImageSerializer;function once(e){let t,n=!1;return function(...l){return n||(n=!0,t=e.apply(this,l)),t}}const bootstrap=once((()=>{if(GLOBAL_OBJ.CanvasRenderingContext2D){const e=CanvasRenderingContext2D.prototype.createLinearGradient;CanvasRenderingContext2D.prototype.createLinearGradient=function(...t){const n=e.apply(this,t),l=n.addColorStop;return n._values=[t],n._type="ProxyLinearGradient",n.addColorStop=(...e)=>{l.apply(n,e),n._values.push(e)},n};const t=CanvasRenderingContext2D.prototype.createPattern;if(CanvasRenderingContext2D.prototype.createPattern=function(...e){const n=t.apply(this,e);if(!n)return null;const l=n.setTransform;return n._type="ProxyPattern",n._values=[[defaultImageSerializer.serialize(e[0]),e[1]]],n.setTransform=e=>{l.apply(n,[e]),e&&(n._values[1]=serialize2DMatrix(e))},n},GLOBAL_OBJ.Path2D&&!isProxyed(GLOBAL_OBJ.Path2D)){const e=proxyPath2D();e&&(GLOBAL_OBJ.Path2D=e)}}}));class StepRecorder{constructor(e){this.canvas=null,this.callback=()=>{},this.lastCtxAttrs=[],this.originApis=null,this.wrappedApis=null,this.sampler=null;const{canvas:t,callback:n,sampler:l}=e;this.canvas=t,this.callback=n,this.originApis=new Map,this.wrappedApis=new Map,this.sampler=l}observe(e){if(!this.canvas)return;const t=this.canvas.getContext("2d");CTX_ATTR.forEach((e=>{this.lastCtxAttrs.push({key:e,value:t[e]})})),this.callback({api:"setAttr",args:this.lastCtxAttrs}),this.context2DWrapper(this.canvas),null!=e&&e.snapshot&&this.callback({api:"snapshot",args:this.getSnapshot()})}disconnect(){if(!this.canvas)return;const e=this.canvas.getContext("2d");CTX_API.forEach((t=>{this.wrappedApis.get(t)===e[t]&&(e[t]=this.originApis.get(t))})),this.sampler.close()}getSnapshot(){if(this.canvas)return String(this.canvas.toDataURL("image/png",1))}context2DWrapper(e){const t=this,n=e.getContext("2d");CTX_API.forEach((e=>{const l=n[e],i=function(...i){if(CTX_DRAWING_API[e]){const e=t.getChangedAttrs(n);null!=e&&e.length&&t.callback({api:"setAttr",args:e})}return t.callback({api:e,args:i}),l.apply(n,[...i])};this.originApis.set(e,l),this.wrappedApis.set(e,i),n[e]=i}))}getChangedAttrs(e){const t=[];return CTX_ATTR.forEach((n=>{this.lastCtxAttrs[n]!==e[n]&&(t.push({key:n,value:e[n]}),this.lastCtxAttrs[n]=e[n])})),t}}class Encoder{constructor(){this.stringRecorder=[],this.stringRecorder=[]}encode(e,t){var n;const l=CTX_API_ENCODER[e];if(null!=t&&t.length||t&&null!==(n=Object.keys(t))&&void 0!==n&&n.length){return[l,"setAttr"===e?this.encodeAttr(t):this.encodeArgs(t)]}return[l]}encodeAttr(e){const t=[];return e.forEach((e=>{const{key:n,value:l}=e;LONG_STR_ATTR.includes(n)&&"string"==typeof l?this.stringRecorder.includes(l)?t.push(CTX_ATTR_ENCODER[n],this.stringRecorder.indexOf(l)):(this.stringRecorder.push(l),t.push(CTX_ATTR_ENCODER[n],l)):"ProxyLinearGradient"===(null==l?void 0:l._type)?t.push(CTX_ATTR_ENCODER[n],{type:"ProxyLinearGradient",value:l._values}):"ProxyPattern"===(null==l?void 0:l._type)?t.push(CTX_ATTR_ENCODER[n],{type:"ProxyPattern",value:l._values}):t.push(CTX_ATTR_ENCODER[n],l)})),t}encodeArgs(e){return null!=e&&e.map?e.map((e=>null!=e&&e._d3Path?e.toJSON():defaultImageSerializer.isCanvasImageSource(e)?defaultImageSerializer.serialize(e):e)):e}}class Sampler{constructor(e){const{callback:t,canvas:n}=e;this._canvas=n,this._records=[],this._callback=t,this._encoder=new Encoder,this._animationHandle=GLOBAL_OBJ.requestAnimationFrame((e=>this.producer()))}sample(e){this._records.push(e)}close(){GLOBAL_OBJ.cancelAnimationFrame(this._animationHandle)}producer(){const e=this._sample(this._records);this._callback(e,this._canvas),this._records=[],this._animationHandle=GLOBAL_OBJ.requestAnimationFrame((()=>this.producer()))}_sample(e){var t;if(null==e||!e.length)return[];const n=[];let l=0,i=[];for(;l<e.length;){const s=e[l],c=l===e.length-1?{api:""}:e[l+1],o=s.api===c.api&&isSettingApi(s.api),a=s.api===c.api&&"lineTo"===s.api;if(!o){const e=s.api;let{args:l}=s;"clip"===e&&"undefined"!=typeof l[0]&&"undefined"==typeof l[1]&&(s.args=[l[0]]),l=null===(t=null==l?void 0:l.map)||void 0===t?void 0:t.call(l,(e=>"number"==typeof e?toFixed2(e):e)),a?i.push(...l):"lineTo"===e?(n.push({api:e,args:[...i,...l]}),i=[]):n.push({api:e,args:s.args})}l++}const s=[];return n.forEach((e=>{const{api:t,args:n}=e,l=this._encoder.encode(t,n);s.push(...l)})),s}}const toFixed2=e=>Number(e.toString().match(/^\d+(?:\.\d{0,2})?/)),isSettingApi=e=>CTX_SETTING_API.includes(e);class ImageBitmapConverter{constructor(){this._offscreenMap=new QuickLRU({maxSize:1e3,maxAge:24e4}),this.clear=()=>{this._offscreenMap.clear()}}toBase64(e,t){return V(this,null,(function*(){const n=`${e.width}x${e.height}`;let l=this._offscreenMap.get(n);l||(l=new OffscreenCanvas(e.width,e.height),this._offscreenMap.set(n,l));const i=l.getContext("bitmaprenderer");null==i||i.transferFromImageBitmap(e);const s=yield l.convertToBlob(t);return new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=e=>{t(e)},n.readAsDataURL(s)}))}))}}const imageBitmapConverter=new ImageBitmapConverter,DEFAULT_SAMPLING_OPTIONS={fps:3,dataURLOptions:{type:"image/webp",quality:.6}};class FpsRecorder{constructor(e,t){this._canvas=e,this._callback=t,this._animeId=null,this._prevImg=null,this.observe=e=>{var t;null!==this._animeId&&cancelAnimationFrame(this._animeId);const n=!0!==(null==e?void 0:e.sampling)&&null!=e&&e.sampling?e.sampling:DEFAULT_SAMPLING_OPTIONS;let l=0;const i=1e3/(null!==(t=n.fps)&&void 0!==t?t:DEFAULT_SAMPLING_OPTIONS.fps),s=e=>V(this,null,(function*(){if(l&&e-l<i)return void(this._animeId=requestAnimationFrame(s));l=e;const t=yield this._snapshotCanvas(n.dataURLOptions||DEFAULT_SAMPLING_OPTIONS.dataURLOptions);t&&t!==this._prevImg&&(this._callback({api:"drawImage",args:[{src:t,__drawFullPage:!0},0,0,this._canvas.width,this._canvas.height]}),this._prevImg=t),this._animeId=requestAnimationFrame(s)}));this._animeId=requestAnimationFrame(s)},this.disconnect=()=>{null!==this._animeId&&cancelAnimationFrame(this._animeId)},this.getSnapshot=()=>{if(this._canvas)return String(this._canvas.toDataURL("image/png",1))},this._snapshotCanvas=e=>V(this,null,(function*(){if(!this._canvas||0===this._canvas.width||0===this._canvas.height)return;const t=yield createImageBitmap(this._canvas);return imageBitmapConverter.toBase64(t,e)}))}}bootstrap();const DEFAULT_OBSERVE_OPTIONS={snapshot:!0,sampling:!1};class CanvasObserver{constructor(e){this._canvasMap=new WeakMap,this._callback=e,this._canvasList=[]}observe(e,t){const n=this._canvasMap.get(e);if(n)n.observe();else{const n=new Sampler({canvas:e,callback:this._callback});if(null!=t&&t.sampling)new FpsRecorder(e,(e=>n.sample(e))).observe(t);else{const l=new StepRecorder({canvas:e,callback:e=>n.sample(e),sampler:n});this._canvasMap.set(e,l),this._canvasList.push(e),l.observe(v(v({},DEFAULT_OBSERVE_OPTIONS),t))}}}disconnect(e){if(!e)return this.disconnectAll();const t=this._canvasMap.get(e);if(t){t.disconnect(),this._canvasMap.delete(e);const n=this._canvasList.indexOf(e);n>=0&&this._canvasList.splice(n,1)}else console.error("no recorder to disconnect")}disconnectAll(){this._canvasList.forEach((e=>{const t=this._canvasMap.get(e);t&&t.disconnect()})),this._canvasList=[],this._canvasMap=new WeakMap}getSnapshot(e){if(!e)return{};const t=this._canvasMap.get(e);return t?{url:t.getSnapshot(),width:e.width,height:e.height}:(console.error("no recorder to getSnapshot"),{})}}class CanvasElementObserver{constructor(e,t){d(this,"options"),d(this,"callback"),d(this,"_canvasObserver"),d(this,"_canvas",new WeakMap),d(this,"_handleCanvasChange",((e,t)=>{if(0===e.length)return;const n=this._canvas.get(t),l=null==n?void 0:n.nodes.getNodeId(t);l&&this.callback({eventType:TrackerEventType.HTMLCanvas,data:{target:l,data:e}})})),this.options=e,this.callback=t,this._canvasObserver=new CanvasObserver(this._handleCanvasChange)}get nodeName(){return"CANVAS"}observe(e,t,n){this._canvasObserver.observe(t,v({snapshot:!1},this.options)),this._canvas.set(t,e),n.extra={image:t.toDataURL("image/png",1),width:t.width,height:t.height}}disconnect(e){this._canvasObserver.disconnect(e),this._canvas.delete(e)}disconnectAll(){this._canvasObserver.disconnectAll()}}class SnapshotError extends RuntimeError{constructor(e,t){super(e,t),this.name="SnapshotError"}}class CapturingError extends SnapshotError{constructor(e,t){super(e,t),this.name="CapturingError"}}class RenderingError extends SnapshotError{constructor(e,t){super(e,t),this.name="RenderingError"}}function captureDocument(e,t){const n=t.nodes.getNodeId(e);console.assert(1===n,`Unexpected id: expected 1 but got ${n}.`);const l=captureElementNode(e.documentElement,t);return{id:n,type:VNodeType.DocumentNode,title:e.title,baseURI:e.baseURI,root:l,visibilityState:e.visibilityState,scrollSize:[e.documentElement.scrollWidth,e.documentElement.scrollHeight],offsetSize:[e.documentElement.offsetWidth,e.documentElement.offsetHeight]}}function captureNode(e,t,n){switch(e.nodeType){case VNodeType.ElementNode:const l=captureElementNode(e,t,n);return t.onNodeCapture(e,l),l;case VNodeType.DocumentFragmentNode:const i=captureDocumentFragmentNode(e,t,n);return t.onNodeCapture(e,i),i;case VNodeType.TextNode:case VNodeType.CommentNode:const s=captureBasicNode(e,t,n);return t.onNodeCapture(e,s),s;case VNodeType.HTMLNode:return;default:throw new UnsupportedError(`Unsupported node type '${e.nodeType}'.`)}}function captureElementNode(e,t,n){const l=captureBasicNode(e,t,n);if(l.type=VNodeType.ElementNode,l.tag=e.tagName,captureNamespace(e,l),captureAttributes(e,l,n),l.ignored||(captureValue(e,l),captureChecked(e,l),captureScroll(e,l)),captureChildren(e,t,l),e.shadowRoot){const n=captureNode(e.shadowRoot,t,l);n&&(n.parentId=l.id,l.shadowRoot=n)}return l}function captureDocumentFragmentNode(e,t,n){const l=captureBasicNode(e,t,n);return l.tag=e.nodeName,captureChildren(e,t,l),l}function captureBasicNode(e,t,n){const l={id:t.nodes.getNodeId(e),type:e.nodeType};return isHTMLScriptElement(e)&&(l.ignored=!0),n?isVNode(n)?(l.parentId=n.id,n.ignored&&(l.ignored=n.ignored)):(l.parentId=captureParentNode(e,t,n),shouldIgnore(n)&&(l.ignored=!0)):l.parentId=captureParentNode(e,t),!l.ignored&&null!=e.nodeValue&&(l.text=isHTMLScriptElement(e)?"":e.nodeValue),l}function captureParentNode(e,t,n){const l=null!=n?n:e.parentNode;if(l){const e=t.nodes.getNodeId(l,!1);if(null==e)throw new CapturingError("Parent node is not captured yet.");return e}}function captureChildren(e,t,n){if(e.hasChildNodes()){const l=[];e.childNodes.forEach((e=>{const i=captureNode(e,t,n);i&&l.push(i)})),n.children=l}}function captureNamespace(e,t){e.namespaceURI&&!e.ownerDocument.isDefaultNamespace(e.namespaceURI)&&(t.ns=e.namespaceURI)}function captureAttributes(e,t,n){var l;if(e.hasAttributes()){shouldIgnore(e)&&(t.ignored=!0);const n={};for(const t of e.getAttributeNames()){const l=e.getAttribute(t);null!=l&&(n[t]=l)}t.attrs=n}let i;if(n)if(isVNode(n))i=null==(l=null==n?void 0:n.attrs)?void 0:l[DATA_MASK];else if(isHTMLElement(n))if(n.hasAttribute(DATA_MASK))i=n.getAttribute(DATA_MASK);else{let e=n.parentElement;for(;e;){if(e.hasAttribute(DATA_MASK)){i=e.getAttribute(DATA_MASK);break}e=e.parentElement}}null!=i&&(t.attrs?t.attrs[DATA_MASK]=i:t.attrs={[DATA_MASK]:i})}function captureValue(e,t){let n,l,i=!1;isHTMLInputElement(e)||isHTMLSelectElement(e)?(n=e.value,l=e.getAttribute("value"),i="password"===e.type):isHTMLTextAreaElement(e)&&(n=e.value,l=e.textContent),isString(n)&&n!==l&&(t.value=i?"*".repeat(n.length):n)}function captureChecked(e,t){isHTMLInputElement(e)?t.checked=e.checked:isHTMLOptionElement(e)&&(t.checked=e.selected)}function captureScroll(e,t){(e.scrollTop||e.scrollLeft)&&(t.scroll=[e.scrollLeft,e.scrollTop])}function captureMutations(e,t){t.optimizer.start();for(const l of e){const e=t.nodes.getNodeId(l.target,!1);if(void 0!==e)switch(l.type){case"attributes":const n=captureChangedAttribute(e,l);t.optimizer.onAttributesMutation(n);break;case"childList":if(l.addedNodes.length){const n=captureAddedNodes(e,l,t);t.optimizer.onNodeAddMutation(...n)}if(l.removedNodes.length){const n=captureRemovedNodes(e,l,t);t.optimizer.onNodeRemoveMutation(...n)}break;case"characterData":const i=captureCharacterData(e,l);t.optimizer.onCharacterMutation(i);break;default:throw new UnsupportedError(`Unsupported mutation type: ${l.type}`)}}const n=t.optimizer.merge();return t.optimizer.stop(),n}function captureChangedAttribute(e,t){const n=t.attributeName,l=t.target.getAttribute(n);return{type:VMutationType.ChangeAttributes,target:e,data:{[n]:l}}}function captureAddedNodes(e,t,n){const l=[];let i;return t.nextSibling&&(i=n.nodes.getNodeId(t.nextSibling,!1)),t.addedNodes.forEach((s=>{const c=s.parentNode;let o=e;if(c){const t=n.nodes.getNodeId(c,!1);t&&t!==e&&(o=t)}const a=n.nodes.getNodeId(s,!1);if(void 0!==a&&n.optimizer.isNewAddedNode(a))checkChildren(s,n,l);else{const e=captureNode(s,n,t.target);if(!e)return;const c={type:VMutationType.AddNode,target:o,data:{node:e}};i&&(c.data.before=i),l.push(c)}})),l}function checkChildren(e,t,n){if(!t.nodes.has(e))if(e.parentElement){const l=t.nodes.getNodeId(e.parentElement,!1);if(l){const i=captureNode(e,t,e.parentElement);if(!i)return;n.push({type:VMutationType.AddNode,target:l,data:{node:i}})}else console.warn("parent id is null",e.parentElement)}else console.warn("parent is null",e);e.childNodes.forEach((e=>{checkChildren(e,t,n)}))}function captureRemovedNodes(e,t,n){const l=[];return t.removedNodes.forEach((t=>{const i=n.nodes.getNodeId(t,!1);if(void 0===i)return;const s=[];let c=e;if(t.parentNode){const l=n.nodes.getNodeId(t.parentNode,!1);l&&l!==e&&(c=l)}n.onNodeRemove(t,i),n.nodes.removeNode(t,!0,s),s.length>0&&s[s.length-1]===i&&s.pop(),i&&l.push({type:VMutationType.RemoveNode,target:c,data:{id:i,children:s}})})),l}function captureCharacterData(e,t){const n=t.target.nodeValue;return{type:VMutationType.CharacterData,target:e,data:n}}function captureWindow(e){return{location:e.location.href,size:[e.innerWidth,e.innerHeight]}}class DocumentObserver{constructor(e){d(this,"callback"),d(this,"_mutationObserver"),d(this,"_context"),d(this,"_handleMutationObserver",(e=>{if(!this._context)return;const t=captureMutations(e,this._context);this.callback({eventType:TrackerEventType.HTMLMutations,data:t})})),d(this,"_handleDocumentVisibilityChange",(()=>{this.callback({eventType:TrackerEventType.HTMLMutations,data:[{type:VMutationType.Document,target:1,data:{visibilityState:document.visibilityState}}]})})),d(this,"_handleSelectionChange",(()=>{if(!this._context)return;const e=document.getSelection();if(!e)return;const t=[];for(let n=0;n<e.rangeCount;n++){const l=e.getRangeAt(n),i=this._context.getNodeId(l.startContainer),s=this._context.getNodeId(l.endContainer);null!=i&&null!=s&&t.push({startTargetId:i,startOffset:l.startOffset,endTargetId:s,endOffset:l.endOffset})}this.callback({eventType:TrackerEventType.HTMLSelectionChange,data:t})})),this.callback=e,this._mutationObserver=new MutationObserver(this._handleMutationObserver)}observe(e,t){this._context=e,this._mutationObserver.observe(t,{childList:!0,subtree:!0,attributes:!0,characterData:!0});const n=this.capture(e);t.addEventListener("visibilitychange",this._handleDocumentVisibilityChange),t.addEventListener("selectionchange",this._handleSelectionChange),this.callback({eventType:TrackerEventType.HTMLSnapshot,data:n})}disconnect(e){this._mutationObserver.disconnect(),e.removeEventListener("visibilitychange",this._handleDocumentVisibilityChange),e.removeEventListener("selectionchange",this._handleSelectionChange)}disconnectAll(){this.disconnect(document)}capture(e){return{version:1,window:captureWindow(window),document:captureDocument(document,e),id:generateUUID$1()}}}function captureEvent(e,t){switch(e.type){case"scroll":return captureScrollEvent(e,t);case"focus":case"blur":return captureFocusAndBlurEvent(e,t);case"input":case"change":return captureInputAndChangeEvent(e,t);case"resize":return captureResizeEvent()}}function captureScrollEvent({target:e},t){let n;n=e===document?document.scrollingElement?document.scrollingElement:document.documentElement:e;const l=t.nodes.getNodeId(n,!1);if(null!=l)return{eventType:TrackerEventType.HTMLScroll,data:{target:l,scroll:[n.scrollLeft,n.scrollTop]}}}function captureFocusAndBlurEvent({target:e,type:t},n){const l=e,i=n.nodes.getNodeId(l,!1);if(null!=i)return{eventType:"focus"===t?TrackerEventType.HTMLFocus:TrackerEventType.HTMLBlur,data:{target:i}}}function captureInputAndChangeEvent({target:e},t){const n=e,l=t.nodes.getNodeId(n,!1);if(null!=l){if(isHTMLInputElement(n)&&"checkbox"===n.type||"radio"===n.type)return{eventType:TrackerEventType.HTMLValueChange,data:{target:l,value:n.checked}};let e=n.value;return"string"!=typeof e&&(e=String(e)),isHTMLInputElement(n)&&"password"===n.type&&(e="*".repeat(n.value.length)),{eventType:TrackerEventType.HTMLValueChange,data:{target:l,value:e}}}}function captureResizeEvent(){return{eventType:TrackerEventType.HTMLResize,data:{size:[window.innerWidth,window.innerHeight]}}}const WINDOW_EVENTS=["focus","blur","change","input"];class GlobalEventObserver{constructor(e){d(this,"callback"),d(this,"_context"),d(this,"_handleEvent",(e=>{if(!this._context)return;const t=captureEvent(e,this._context);t&&this.callback(t)})),d(this,"_handleScroll",(e=>{if(!this._context)return;const t=captureEvent(e,this._context);t&&t.eventType===TrackerEventType.HTMLScroll&&this._scrollSampler.sample(t.data.target,t.data.scroll)})),d(this,"_handleScrollSampleCallback",((e,t)=>{this.callback({eventType:TrackerEventType.HTMLScroll,data:{target:e,scroll:t}})})),d(this,"_scrollSampler",new Sampler$1(5,this._handleScrollSampleCallback)),d(this,"_handleResize",(e=>{if(!this._context)return;const t=captureEvent(e,this._context);t&&t.eventType===TrackerEventType.HTMLResize&&this._resizeSampler.sample(0,t.data.size)})),d(this,"_handleResizeSampleCallback",((e,t)=>{this.callback({eventType:TrackerEventType.HTMLResize,data:{size:t}})})),d(this,"_resizeSampler",new Sampler$1(1,this._handleResizeSampleCallback)),this.callback=e}observe(e,t){this._context=e,isWindow(t)&&WINDOW_EVENTS.forEach((e=>t.addEventListener(e,this._handleEvent,!0))),t.addEventListener("scroll",this._handleScroll,{capture:!0,passive:!0}),t.addEventListener("resize",this._handleResize,{capture:!0,passive:!0})}disconnect(e){isWindow(e)&&WINDOW_EVENTS.forEach((t=>e.removeEventListener(t,this._handleEvent,!0))),e.removeEventListener("scroll",this._handleScroll,!0),e.removeEventListener("resize",this._handleResize,!0)}disconnectAll(){this._context=void 0,this._scrollSampler.stop(),this._resizeSampler.stop()}}class ImageElementObserver{constructor(e,t){d(this,"options"),d(this,"callback"),this.options=e,this.callback=t}get nodeName(){return"IMG"}observe(e,t,n){if(this.options.captureStatus&&(t.decode().then((()=>{const n=e.nodes.getNodeId(t,!1);n&&this.callback({eventType:TrackerEventType.HTMLImage,data:{target:n,data:{status:"loaded"}}})})).catch((()=>{const n=e.nodes.getNodeId(t,!1);n&&this.callback({eventType:TrackerEventType.HTMLImage,data:{target:n,data:{status:"failed"}}})})),n.extra={status:"unknown"}),this.options.captureAttributes){const e=this.options.captureAttributes(t),l=n;l.attrs=v(v({},l.attrs),e)}}disconnect(e){}disconnectAll(){}}class DeferredTaskQueue{constructor(){d(this,"_tasks",[])}enqueue(e){this._tasks.push(e)}executeAll(){return V(this,null,(function*(){for(const e of this._tasks)yield e();this.clear()}))}clear(){this._tasks.splice(0,this._tasks.length)}size(){return this._tasks.length}}class Id2NodeMap extends EventEmitter{constructor(){super(...arguments),d(this,"_map",new Map)}reset(){this._map.clear(),this.emit("nodeReset")}has(e){return this._map.has(e)}getNode(e){return this._map.get(e)}addNode(e,t){this._map.set(e,t),t&&this.emit("nodeAdded",t,e)}keys(){return this._map.keys()}size(){return this._map.size}removeNode(e){const t=this._map.get(e);this._map.delete(e),t&&this.emit("nodeRemoved",t,e)}}class Node2IdMap{constructor(){d(this,"_events",new EventEmitter),d(this,"_map",new WeakMap),d(this,"_sequentialId",0),this.reset()}has(e){return this._map.has(e)}getNodeId(e,t=!0){return this.has(e)?this._map.get(e):t?this.addNode(e):void 0}reset(){this._sequentialId=0,this._map=new WeakMap}addNode(e){if(this.has(e))throw new RuntimeError("Node already added.");const t=this._nextId();this._map.set(e,t);try{this._events.emit("nodeAdded",e,t)}catch(n){}return t}removeNode(e,t=!1,n=[]){t&&e.hasChildNodes()&&e.childNodes.forEach((e=>{this.removeNode(e,!0,n)})),e instanceof Element&&e.shadowRoot&&this.removeNode(e.shadowRoot,!0,n);const l=this._map.get(e);if(this._map.delete(e),l&&l>=0){n.push(l);try{this._events.emit("nodeRemoved",e,l)}catch(i){}}}_nextId(){return++this._sequentialId}on(e,t,n){return this._events.on(e,t,n)}once(e,t,n){return this._events.once(e,t,n)}off(e,t,n,l){return this._events.off(e,t,n,l)}addListener(e,t,n){return this._events.addListener(e,t,n)}removeListener(e,t,n,l){return this._events.removeListener(e,t,n,l)}}class PromiseList{constructor(){d(this,"_promises",[])}add(e){this._promises.push(e)}all(){return V(this,null,(function*(){yield Promise.all(this._promises),this.clear()}))}clear(){this._promises.splice(0,this._promises.length)}size(){return this._promises.length}}class MutationOptimizer{constructor(e){d(this,"context"),d(this,"mutations",[]),d(this,"nodes",new Set),d(this,"attributeChangingMutationMap",new Map),d(this,"characterDataMutationMap",new Map),d(this,"removedNodes",new Map),d(this,"addedNodes",new Map),d(this,"handleNodeAdd",((e,t)=>{this.nodes.add(t),this.addedNodes.set(t,!0)})),d(this,"handleNodeRemove",((e,t)=>{this.addedNodes.has(t)&&this.removedNodes.set(t,!0),this.nodes.delete(t)})),this.context=e}start(){this.context.nodes.on("nodeAdded",this.handleNodeAdd),this.context.nodes.on("nodeRemoved",this.handleNodeRemove)}stop(){this.context.nodes.off("nodeAdded",this.handleNodeAdd),this.context.nodes.off("nodeRemoved",this.handleNodeRemove),this.mutations=[],this.nodes.clear(),this.attributeChangingMutationMap.clear(),this.characterDataMutationMap.clear(),this.removedNodes.clear(),this.addedNodes.clear()}onAttributesMutation(e){const t=e.target,n=this.attributeChangingMutationMap.get(t);n?Object.assign(n.data,e.data):this.removedNodes.has(e.target)||(this.attributeChangingMutationMap.set(t,e),this.mutations.push(e))}onNodeAddMutation(...e){this.mutations.push(...e)}onNodeRemoveMutation(...e){this.mutations.push(...e)}onCharacterMutation(e){const t=e.target,n=this.characterDataMutationMap.get(t);n?n.data=e.data:this.removedNodes.has(t)||(this.characterDataMutationMap.set(t,e),this.mutations.push(e))}merge(){const e=new Set;return this.mutations.filter((t=>{if(this.removedNodes.has(t.target)||e.has(t.target))return!1;if(t.type===VMutationType.RemoveNode){let n;if(n="number"==typeof t.data?t.data:t.data.id,this.removedNodes.has(n)&&e.has(n))return!1}else if(t.type===VMutationType.AddNode&&this.removedNodes.has(t.data.node.id))return this.visitIgnoreNode(t.data.node,e),!1;return!0}))}visitIgnoreNode(e,t){var n;t.add(e.id),null==(n=e.children)||n.forEach((e=>{this.visitIgnoreNode(e,t)}))}isNewAddedNode(e){return this.nodes.has(e)}}class ObserverContext extends EventEmitter{constructor(e){super(),d(this,"callback"),d(this,"_map",new Node2IdMap),d(this,"_nodeObservers",new Map),d(this,"_documentObserver"),d(this,"_globalEventObserver"),d(this,"optimizer",new MutationOptimizer(this)),this.callback=e,this._documentObserver=new DocumentObserver(this.callback),this._globalEventObserver=new GlobalEventObserver(this.callback)}get documentObserver(){return this._documentObserver}get eventsObserver(){return this._globalEventObserver}get nodes(){return this._map}getNodeId(e){return this._map.getNodeId(e)}reset(){this.disconnectAll(),this._map.reset()}registerNodeObserver(e){this._nodeObservers.set(e.nodeName,e)}onNodeRemove(e,t){try{const t=this._nodeObservers.get(e.nodeName);t&&t.disconnect(e)}catch(n){}}onNodeCapture(e,t){const n=this._nodeObservers.get(e.nodeName);try{n&&n.observe(this,e,t)}catch(l){console.error(l)}}disconnectAll(){this._nodeObservers.forEach((e=>{e.disconnectAll()}))}}const STYLE_SHEET_INTERCEPTOR_FLAG=Symbol.for("bytereplay.StyleSheetInterceptor"),RuleSheetMethodEncodes={insertRule:0,deleteRule:1,replace:2,replaceSync:3,addRule:4,removeRule:5},RuleSheetMethodDecodes={0:"insertRule",1:"deleteRule",2:"replace",3:"replaceSync",4:"addRule",5:"removeRule"},ce=class e{constructor(e,t){d(this,"host"),d(this,"callback"),d(this,"_context"),this.host=e,this.callback=t}observe(e,t){if(this._context||(this._context=e),void 0!==t[STYLE_SHEET_INTERCEPTOR_FLAG])return;const n=this._nextSheetId(),l=Object.getPrototypeOf(t),i=Object.getOwnPropertyDescriptors(l);Object.keys(i).forEach((e=>{const l=Reflect.get(t,e);"function"!=typeof l||"CSSStyleSheet"===l.name||Object.defineProperty(t,e,{value:(...l)=>{const s=i[e].value;if("function"==typeof s){const t=RuleSheetMethodEncodes[e];if(void 0!==t&&this._context){const e=this._context.nodes.getNodeId(this.host,!1);e&&this.callback({eventType:TrackerEventType.HTMLMutations,data:[{type:VMutationType.StyleSheetRule,target:e,data:[t,l],sheetId:n}]})}}return Reflect.apply(s,t,l)}})})),t[STYLE_SHEET_INTERCEPTOR_FLAG]=n}captureRules(e){const t=e.cssRules,n=[];if(t)for(let l=0;l<t.length;l++)n.push([RuleSheetMethodEncodes.insertRule,[t[l].cssText,l]]);return n}static getSheetId(e){return e[STYLE_SHEET_INTERCEPTOR_FLAG]}static setSheetId(e,t){e[STYLE_SHEET_INTERCEPTOR_FLAG]=t}_nextSheetId(){return++e._sheetId}disconnect(e){this._context=void 0}disconnectAll(){this._context=void 0}};d(ce,"_sheetId",0);let StyleSheetObserver=ce;const AdoptedStyleSheetsInterceptor=Symbol("bytereplay.adoptedStyleSheets");class ShadowRootObserver{constructor(e){d(this,"callback"),d(this,"mutationObservers",new WeakMap),d(this,"styleSheetObservers",new WeakMap),d(this,"_context"),d(this,"_handleAdoptedStyleSheetsChange",((e,t)=>{const n=this._context;if(!n)return;const l={sheets:[],rules:{}},i=n.nodes.getNodeId(e,!1);i&&(t.forEach((t=>{let i=StyleSheetObserver.getSheetId(t);if(void 0!==i)return void l.sheets.push(i);const s=this.styleSheetObservers.get(e);if(!s)return;s.observe(n,t),i=StyleSheetObserver.getSheetId(t),l.sheets.push(i);const c=s.captureRules(t);l.rules[i]=c})),this.callback({eventType:TrackerEventType.HTMLMutations,data:[{type:VMutationType.StyleSheetAdopted,target:i,data:l}]}))})),d(this,"_handleMutationObserver",(e=>{if(!this._context)return;const t=captureMutations(e,this._context);this.callback({eventType:TrackerEventType.HTMLMutations,data:t})})),this.callback=e}get nodeName(){return"#document-fragment"}observe(e,t,n){this._context||(this._context=e);const l=new MutationObserver(this._handleMutationObserver);l.observe(t,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),this.mutationObservers.set(t,l),n.extra={styleSheets:this._observerAdoptedStyleSheets(e,t)},e.eventsObserver.observe(e,t)}_observerAdoptedStyleSheets(e,t){const n=new StyleSheetObserver(t,this.callback);this.styleSheetObservers.set(t,n),this._watchAdoptedStyleSheetsChange(t);const l=t.adoptedStyleSheets,i={sheets:[],rules:{}};if(0===l.length)return i;for(let s=0;s<l.length;s++){const t=l[s];n.observe(e,t);const c=StyleSheetObserver.getSheetId(t);if(void 0===c)continue;const o=n.captureRules(t);i.sheets.push(c),i.rules[c]=o}return i}_watchAdoptedStyleSheetsChange(e){if(e[AdoptedStyleSheetsInterceptor])return;const t=Object.getPrototypeOf(e),n=Object.getOwnPropertyDescriptor(t,"adoptedStyleSheets"),l=this;Object.defineProperty(e,"adoptedStyleSheets",{configurable:null==n?void 0:n.configurable,enumerable:null==n?void 0:n.enumerable,get(){var e;return null==(e=null==n?void 0:n.get)?void 0:e.call(this)},set(t){var i;const s=null==(i=null==n?void 0:n.set)?void 0:i.call(this,t);try{l._handleAdoptedStyleSheetsChange(e,t)}catch(c){}return s}})}disconnect(e){var t;null==(t=this._context)||t.eventsObserver.disconnect(e),this._context=void 0;const n=this.mutationObservers.get(e);null==n||n.disconnect();const l=this.styleSheetObservers.get(e),i=e.adoptedStyleSheets;for(let s=0;s<i.length;s++){const e=i[s];null==l||l.disconnect(e)}}disconnectAll(){this._context=void 0,this.mutationObservers=new WeakMap,this.styleSheetObservers=new WeakMap}}class StyleElementObserver{constructor(e){d(this,"callback"),d(this,"observers",new WeakMap),this.callback=e}get nodeName(){return"STYLE"}observe(e,t,n){if(""===t.textContent&&t.sheet){const l=new StyleSheetObserver(t,this.callback),i=l.captureRules(t.sheet);n.extra={commands:i},l.observe(e,t.sheet),this.observers.set(t,l)}else n.extra={}}disconnect(e){const t=this.observers.get(e);e.sheet&&(null==t||t.disconnect(e.sheet))}disconnectAll(){this.observers=new WeakMap}}function takeSnapshot(e,t){const{token:n,safety:l,data:i}=t,s={};return n&&(s.Authorization=n),e.post(l?"snapshot/safe/take":"snapshot/take",i,s)}class ScreenshotRenderer{constructor(){d(this,"_env"),d(this,"_apiClient")}render(e,t){return V(this,null,(function*(){const n=JSON.stringify(e),l=(new TextEncoder).encode(n),i=new Blob([l]),s=t,{token:c,environment:o,safety:a}=s,r=le(s,["token","environment","safety"]),d=createFormData();return d.append("snapshot",i),d.append("options",JSON.stringify(r)),takeSnapshot(this.getAPIClient(o),{token:c,safety:a,data:d})}))}getAPIClient(e){return this._env?(this._env.baseURL=null==e?void 0:e.baseURL,this._env.type=null==e?void 0:e.type):this._env=new Environment(e),this._apiClient||(this._apiClient=new APIClient(this._env)),this._apiClient}}class SnapshotCapturer extends EventEmitter{constructor(e){var t,n;super(),d(this,"options"),d(this,"context"),d(this,"_handleEventObserver",(e=>{this.emit("event",e)})),this.options=e,this.context=new ObserverContext(this._handleEventObserver),null!=(t=this.options)&&t.canvas&&(globalThis.Path2D?this.registerNodeObserver(CanvasElementObserver,isObject$1(this.options.canvas)?this.options.canvas:void 0):console.warn("canvas not supported in this runtime.")),null!=(n=this.options)&&n.image&&this.registerNodeObserver(ImageElementObserver,this.options.image),this.registerNodeObserver(StyleElementObserver),this.registerNodeObserver(ShadowRootObserver)}get nodes(){return this.context.nodes}getNodeId(e){return this.nodes.getNodeId(e,!1)}reset(){this.context.reset()}registerNodeObserver(e,...t){const n=Reflect.construct(e,[...t,this._handleEventObserver]);this.context.registerNodeObserver(n)}start(){this.context.documentObserver.observe(this.context,document),this.context.eventsObserver.observe(this.context,window)}stop(){this.context.documentObserver.disconnect(document),this.context.eventsObserver.disconnect(window),this.reset()}captureSnapshot(){return this.context.documentObserver.capture(this.context)}captureMutations(e){return captureMutations(e,this.context)}captureEvent(e){return captureEvent(e,this.context)}screenshot(e){return V(this,null,(function*(){const t=this.captureSnapshot();return yield(new ScreenshotRenderer).render(t,e)}))}}var RenderMode;!function(e){e.VanillaDOM="VanillaDOM",e.VirtualDOM="VirtualDOM"}(RenderMode||(RenderMode={}));const B=class e{constructor(){d(this,"tag","CANVAS")}static registerPlayer(t,n,l,i){const s={player:new CanvasPlayer({canvas:l}),order:i},c=e.players.get(`${t}/${n}`);c?c.order<s.order&&e.players.set(`${t}/${n}`,s):e.players.set(`${t}/${n}`,s)}static resolvePlayer(t,n,l){const i=e.players.get(`${t}/${n}`);if(i&&i.order<=l)return i.player}static removePlayer(t,n){e.players.delete(`${t}/${n}`)}static resetPlayer(t){const n=e.players.keys();Array.from(n).forEach((n=>{n.startsWith(t)&&e.players.delete(n)}))}onRender(t,n){var l,i,s;const c=null==(l=n.extra)?void 0:l.image;if(!c)return;const o=this.getPerformOrder(t);if(t.isVanilla()){const l=t.getNode(n.id),i=l.getContext("2d");t.addWaiting(new Promise((e=>{const t=new Image;t.onload=()=>{null==i||i.drawImage(t,0,0),e({element:l,failed:!1,timeout:!1})},t.onerror=()=>{e({element:l,failed:!0,timeout:!1})},t.src=c}))),e.registerPlayer(t.snapshotId,n.id,l,o)}else{const l=new OffscreenCanvas(parseFloat((null==(i=n.attrs)?void 0:i.width)||"300")||300,parseFloat((null==(s=n.attrs)?void 0:s.height)||"150")||150);e.registerPlayer(t.snapshotId,n.id,l,o)}}onRemove(t,n){e.removePlayer(t.snapshotId,n)}performEvent(t,n){if(n.eventType===TrackerEventType.HTMLCanvas){const{target:l,data:i}=n.data,s=this.getPerformOrder(t),c=e.resolvePlayer(t.snapshotId,l,s);c&&c.execute(i)}}onReset(t){e.resetPlayer(t.snapshotId)}onCapture(t,n){if(t.isVirtual()){const l=t.getNode(n);if(l&&l.tag===this.tag){const i=this.getPerformOrder(t),s=e.resolvePlayer(t.snapshotId,n,i);s&&t.addWaiting(new Promise(((e,t)=>{s.snapshot().then((t=>{l.extra={image:t},e({element:void 0,failed:!1,timeout:!1})})).catch((()=>{t({element:void 0,failed:!0,timeout:!1})}))})))}}}getPerformOrder(e){return e.mode===RenderMode.VanillaDOM?2:e.isIncremental?0:1}};d(B,"players",new Map);let CanvasElementRenderer=B;class IFrameElementRenderer{constructor(){d(this,"tag","IFRAME")}onRender(e,t){}onRemove(e,t){}performEvent(e,t){if(t.eventType===TrackerEventType.HTMLIFrame)if(e.isVanilla()){const n=e.getNode(t.data.target);n&&n.dispatchEvent(buildIFrameEvent(t.data.action))}else{const{target:n,action:l}=t.data,i=e.getNode(n);if(!i)throw new RenderingError(`Node with ID '${n}' not found.`);const s=i.extra||{state:IFrameState.Loaded};switch(l.type){case IFrameActionType.Load:s.state=IFrameState.Loaded,s.recordings=void 0;break;case IFrameActionType.Unload:s.state=IFrameState.Loading,s.recordings=void 0;break;case IFrameActionType.StartRecording:s.state=IFrameState.Recording,s.recordings=M(v({},s.recordings),{[l.data.parentId]:l.data.recording});break;case IFrameActionType.StopRecording:s.state=IFrameState.Loaded,s.recordings&&delete s.recordings[l.data.parentId]}i.extra=s}}}class ImageElementRenderer{constructor(e){d(this,"options"),this.options=e}get tag(){return"IMAGE"}onRender(e,t,n){var l,i;if(e.isVanilla()){const e=n,s=t.extra;null!=(l=this.options)&&l.onError&&"failed"===(null==s?void 0:s.status)&&this.options.onError(e),null!=(i=this.options)&&i.onLoad&&"loaded"===(null==s?void 0:s.status)&&this.options.onLoad(e)}}onRemove(e,t){}performEvent(e,t){var n,l;if(t.eventType!==TrackerEventType.HTMLImage)return;const{target:i,data:s}=t.data;if(e.isVanilla()){const t=e.getNode(i);null!=(n=this.options)&&n.onError&&"failed"===(null==s?void 0:s.status)&&this.options.onError(t),null!=(l=this.options)&&l.onLoad&&"loaded"===s.status&&this.options.onLoad(t)}else{const t=e.getNode(i);if(!t)return;t.extra=M(v({},(null==t?void 0:t.extra)||{}),{status:s.status})}}}class RenderContext{constructor(e){d(this,"mode"),d(this,"_isIncremental",!1),d(this,"_snapshotId"),d(this,"_map",new Id2NodeMap),d(this,"_waitList",new PromiseList),d(this,"_deferredTaskQueue",new DeferredTaskQueue),d(this,"_nodeRenderers",new Map),this.mode=e}get nodes(){return this._map}get snapshotId(){return this._snapshotId?this._snapshotId:"-"}get isIncremental(){return this._isIncremental}setSnapshotId(e){this._snapshotId=e}setIncremental(e){this._isIncremental=e}setNodes(e){this._map=e}getNode(e){return this._map.getNode(e)}registerNodeRenderer(e){this._nodeRenderers.set(e.tag,e)}onNodeRender(e,t){const n=this._nodeRenderers.get(e.tag);try{n&&n.onRender(this,e,t)}catch(l){console.error(l)}}onNodeRemove(e){const t=this.nodes.getNode(e);if(!t)return;let n;n=this.isVanilla()?this._nodeRenderers.get(t.tagName):this._nodeRenderers.get(t.tag);try{n&&n.onRemove(this,e)}catch(l){console.error(l)}}onPatch(e,t,n){if("attrs"===e)Reflect.set(t,e,Object.assign({},t[e],n[e]));else if("extra"===e){const e=this._nodeRenderers.get(t.tag);e&&e.onPatchExtra&&e.onPatchExtra(t,n)}}performEvent(e){this._nodeRenderers.forEach((t=>{t.performEvent(this,e)}))}addWaiting(e){this._waitList.add(e)}deferTask(e){this._deferredTaskQueue.enqueue(e)}waitAsyncTask(){return V(this,null,(function*(){yield this._waitList.all(),yield this._deferredTaskQueue.executeAll()}))}capture(){var e;for(const t of this._map.keys())for(const n of this._nodeRenderers.values())null==(e=n.onCapture)||e.call(n,this,t)}reset(){this._snapshotId&&this._nodeRenderers.forEach((e=>{var t;null==(t=e.onReset)||t.call(e,this)})),this._map.reset(),this._waitList.clear(),this._deferredTaskQueue.clear()}isVanilla(){return this.mode===RenderMode.VanillaDOM}isVirtual(){return this.mode===RenderMode.VirtualDOM}}function lazyLoad(e,t=0){return new Promise((n=>{setTimeout((()=>{const t=e();n(t)}),t)}))}class StyleElementRenderer{get tag(){return"STYLE"}onRender(e,t){var n;if(e.isVanilla()){const l=e.getNode(t.id);if(l&&isHTMLElement(l)&&isHTMLStyleElement(l)){const i=t;null!=(n=i.extra)&&n.commands&&e.addWaiting(new Promise((e=>{setTimeout((()=>{var t;if(!l.sheet)return void e({failed:!1,timeout:!1,element:l});const n=l.sheet,s=null==(t=i.extra)?void 0:t.commands;null==s||s.forEach((e=>{performStyleRuleSheet(n,e)})),e({failed:!1,timeout:!1,element:l})}),0)})))}}}onPatchExtra(e,t){var n,l,i;const s=e.extra;"commands"in s&&null!=(n=s.commands)&&n.length&&(s.commands=[...null!=(i=null==(l=t.extra)?void 0:l.commands)?i:[],...s.commands])}onRemove(e,t){}performEvent(e,t){t.eventType===TrackerEventType.HTMLMutations&&t.data.forEach((t=>{var n;if(t.type===VMutationType.StyleSheetRule)if(e.isVanilla()){const n=e.getNode(t.target);if(!n)return;isHTMLElement(n)&&isHTMLStyleElement(n)&&n.sheet&&performStyleRuleSheet(n.sheet,t.data)}else if(e.isVirtual()){const l=e.getNode(t.target);if(!l)return;const i=l;i.extra||(i.extra={commands:[]}),null==(n=i.extra.commands)||n.push(t.data)}}))}}function performStyleRuleSheet(e,t){const n=RuleSheetMethodDecodes[t[0]];if(!n)return;const l=Reflect.get(e,n);try{Reflect.apply(l,e,t[1])}catch(i){console.warn(i)}}class ShadowRootRenderer{get tag(){return"#document-fragment"}onRender(e,t,n){const l=t.extra,i=l.styleSheets.sheets;if(e.isVanilla()){const t=n;t.__styles={},e.addWaiting(new Promise((e=>{setTimeout((()=>{const n=[];for(let e=0;e<i.length;e++){const s=i[e],c=l.styleSheets.rules[s],o=this._createHostedStyleSheet(t,c);StyleSheetObserver.setSheetId(o,s),n.push(o),t.__styles[s]=o}t.adoptedStyleSheets=[...t.adoptedStyleSheets,...n],e({failed:!1,timeout:!1,element:t})}),0)})))}}onPatchExtra(e,t){const{sheets:n,rules:l}=t.extra.styleSheets,i={styleSheets:{sheets:[...n],rules:Object.keys(l).reduce(((e,t)=>M(v({},e),{[t]:[...l[Number(t)]]})),{})}},s=e.extra.styleSheets;Object.keys(s.rules).forEach((e=>{const t=i.styleSheets.rules[Number(e)];t?t.push(...s.rules[Number(e)]):(i.styleSheets.rules[Number(e)]=[...s.rules[Number(e)]],i.styleSheets.sheets.push(Number(e)))})),e.extra=i}performEvent(e,t){t.eventType===TrackerEventType.HTMLMutations&&t.data.forEach((t=>{t.type===VMutationType.StyleSheetRule?this._performStyleSheetRuleChange(e,t):t.type===VMutationType.StyleSheetAdopted&&this._performStyleSheetAdoptedChange(e,t)}))}_createHostedStyleSheet(e,t){var n;const l=null==(n=e.host.ownerDocument)?void 0:n.defaultView;let i;return i=l?new l.CSSStyleSheet:new CSSStyleSheet,null==t||t.forEach((e=>{performStyleRuleSheet(i,e)})),i}_performStyleSheetRuleChange(e,t){var n;if(e.isVanilla()){const l=e.getNode(t.target);if(!l||!(l instanceof ShadowRoot)||!t.sheetId)return;const i=null==(n=l.__styles)?void 0:n[t.sheetId];i&&performStyleRuleSheet(i,t.data)}else if(e.isVirtual()){const n=e.getNode(t.target);if(!n||n.tag!==this.tag||!t.sheetId)return;let l=n.extra;if(l||(l={styleSheets:{sheets:[],rules:{}}},n.extra=l),l&&l.styleSheets.rules){const e=l.styleSheets.rules[t.sheetId];e?e.push(t.data):(l.styleSheets.rules[t.sheetId]=[t.data],l.styleSheets.sheets.push(t.sheetId))}}}_performStyleSheetAdoptedChange(e,t){if(e.isVanilla()){const n=e.getNode(t.target);if(!n||!(n instanceof ShadowRoot))return;e.addWaiting(lazyLoad((()=>{const e=n,{sheets:l,rules:i}=t.data,s=l.map((t=>{let n=e.__styles[t];return n||(n=this._createHostedStyleSheet(e,i[t])),n}));return e.adoptedStyleSheets=s,{failed:!1,timeout:!1,element:e}})))}else if(e.isVirtual()){const n=e.getNode(t.target);if(!n||n.tag!==this.tag)return;const{sheets:l,rules:i}=t.data,s=n.extra,c=s.styleSheets.rules;s.styleSheets.rules=l.reduce(((e,t)=>M(v({},e),{[t]:c[t]||i[t]})),{}),s.styleSheets.sheets=l}}onRemove(e,t){}}class AbstractSnapshotRenderer extends EventEmitter{constructor(e,t){super(),d(this,"context"),d(this,"_suspended",!0),d(this,"_needRebuildId2NodeMap",!1),this.context=new RenderContext(e),this.registerNodeRenderer(StyleElementRenderer),this.registerNodeRenderer(IFrameElementRenderer),this.registerNodeRenderer(CanvasElementRenderer),this.registerNodeRenderer(ImageElementRenderer,null==t?void 0:t.image),this.registerNodeRenderer(ShadowRootRenderer),this.context.nodes.on("nodeAdded",((e,t)=>{this.emit("nodeAdded",e,t)})),this.context.nodes.on("nodeRemoved",((e,t)=>{this.emit("nodeRemoved",e,t)})),this.context.nodes.on("nodeReset",(()=>{this.emit("nodeReset")})),setInterval((()=>{this._needRebuildId2NodeMap=!0}),6e4)}get suspended(){return this._suspended}getNode(e){return this.context.nodes.getNode(e)}reset(){this.context.reset()}suspend(){this._suspended=!0}resume(){this._suspended=!1}registerNodeRenderer(e,...t){const n=Reflect.construct(e,[...t]);this.context.registerNodeRenderer(n)}render(e){return V(this,null,(function*(){if(1!==e.version)throw new UnsupportedError(`Unsupported snapshot version ${e.version}.`);this.context.setSnapshotId(e.id),this.reset();const t=this.suspended;this.suspend(),this.renderWindow(e.window),this.renderDocument(e.document),t||this.resume()}))}performEvent(e){return V(this,null,(function*(){try{switch(e.eventType){case TrackerEventType.HTMLSnapshot:return void(yield this.render(e.data));case TrackerEventType.HTMLMutations:this.performMutations(e.data);break;case TrackerEventType.HTMLNavigation:this.performNavigation(e.data);break;case TrackerEventType.HTMLScroll:this.performScroll(e.data);break;case TrackerEventType.HTMLFocus:this.performFocus(e.data);break;case TrackerEventType.HTMLBlur:this.performBlur(e.data);break;case TrackerEventType.HTMLValueChange:this.performValueChange(e.data);break;case TrackerEventType.HTMLSelectionChange:this.performSelectionChange(e.data);break;case TrackerEventType.HTMLResize:this.performResize(e.data)}this.context.performEvent(e),yield this.performPostRendering()}catch(t){console.error(t)}if(this._needRebuildId2NodeMap){const e=new Id2NodeMap;this.rebuildNodes(e),this.context.setNodes(e),this._needRebuildId2NodeMap=!1}}))}performMutations(e){for(const n of e)try{this.performMutation(n)}catch(t){console.error(t)}}performMutation(e){switch(e.type){case VMutationType.AddNode:this.performAddNodeMutation(e);break;case VMutationType.ChangeAttributes:this.performChangeAttributeMutation(e);break;case VMutationType.RemoveNode:try{this.performRemoveNodeMutation(e)}catch(t){}break;case VMutationType.CharacterData:this.performCharacterDataMutation(e);break;case VMutationType.Document:this.performDocumentMutation(e)}}performPostRendering(){return V(this,null,(function*(){}))}performChangeAttributeMutation(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Node with ID '${e.target}' not found.`);this.applyAttrs(e.data,t)}performScroll(e){const t=this.getNode(e.target);t&&this.applyScrolling(e.scroll,t)}performFocus(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Node with ID '${e.target}' not found.`);this.applyFocus(t)}performBlur(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Node with ID '${e.target}' not found.`);this.applyBlur(t)}performValueChange(e){const t=this.getNode(e.target);t&&("string"==typeof e.value?this.applyValue(e.value,t):this.applyCheckedState(e.value,t))}performSelectionChange(e){this.applySelection(e)}performResize(e){this.applySize(e.size)}}class VirtualSnapshotRenderer extends AbstractSnapshotRenderer{constructor(e){super(RenderMode.VirtualDOM,e),d(this,"_contentWindow"),d(this,"_contentDocument"),this._createNewContent()}get contentWindow(){return this._contentWindow}get contentDocument(){return this._contentDocument}get size(){return this.contentWindow.size}get documentTitle(){return this.contentDocument.title}get documentURL(){return this.contentWindow.location}get documentBaseURI(){return this.contentDocument.baseURI}getNode(e){return this.context.nodes.getNode(e)}reset(){super.reset(),this._createNewContent()}captureSnapshot(){return V(this,null,(function*(){const e={version:1,window:this.contentWindow,document:this._contentDocument,id:this.context.snapshotId};return this.context.capture(),yield this.context.waitAsyncTask(),deepClone(e)}))}mergeIncrementalSnapshot(e,t){let n=deepClone(e);return t.forEach((e=>{const t=new Map;this.visitVElement(n.document.root,t),n=this.patchIncrementalSnapshot(n,deepClone(e),t)})),n}visitVElement(e,t){var n;t.set(e.id,e),null==(n=e.children)||n.forEach((e=>{this.visitVElement(e,t)}))}patchVElement(e,t){var n;const l=t.get(e.id);if(l){const i=l,{children:s,shadowRoot:c,id:o,type:a,tag:r,extra:d}=i,h=le(i,["children","shadowRoot","id","type","tag","extra"]);["id","type","tag",...Object.keys(h),"extra"].forEach((t=>{const n=t;void 0===e[n]?Reflect.set(e,n,l[n]):this.context.onPatch(n,e,l)})),isVParentNode(e)&&(null==(n=e.children)||n.forEach((e=>{this.patchVElement(e,t)}))),c&&(e.shadowRoot=this.patchVElement(c,t))}return e}patchIncrementalSnapshot(e,t,n){const l=this.patchVElement(t.document.root,n);e.window=v(v({},e.window),t.window);const{visibilityState:i}=t.document;return e.document.root=l,i&&(e.document.visibilityState=i),e}_createNewContent(){this._contentWindow={location:"about:blank",size:[0,0]},this._contentDocument={type:VNodeType.DocumentNode,id:1,baseURI:"about:blank",title:"",root:{id:2,parentId:1,tag:"HTML",type:VNodeType.ElementNode},visibilityState:"hidden"}}renderWindow(e){this._contentWindow=deepClone(e)}renderDocument(e){this._contentDocument=deepClone(e),this.renderNode(this._contentDocument.root,!1)}renderNode(e,t=!0){const n=t?deepClone(e):e;return this.context.nodes.addNode(e.id,n),this.context.onNodeRender(e,n),isVElement(n)&&this._renderElementNode(n),isVParentNode(n)&&this._renderChildren(n),n}_renderElementNode(e){e.shadowRoot&&this.renderNode(e.shadowRoot,!1)}_renderChildren(e){if(e.children)for(const t of e.children)this.renderNode(t,!1)}performNavigation(e){this._contentWindow.location=e.to,this.emit("navigate",e)}performAddNodeMutation(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Target with ID '${e.target}' not found.`);const n=this.renderNode(e.data.node);let l,i;t.children||(t.children=[]),e.data.before&&(l=this.getNode(e.data.before)),l&&-1!==(i=t.children.findIndex((e=>e.id===(null==l?void 0:l.id))))?t.children.splice(i,0,n):t.children.push(n)}performRemoveNodeMutation(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Node with ID '${e.target}' not found.`);let n,l=[];"object"==typeof e.data?(n=e.data.id,l=e.data.children):n=e.data;const i=this.getNode(n);if(!i)throw new RenderingError(`Node with ID '${n}' not found.`);if(t.children){const e=t.children.findIndex((e=>e.id===i.id));-1!==e&&t.children.splice(e,1)}l.forEach((e=>{this.context.onNodeRemove(e),this.context.nodes.removeNode(e)})),this.context.onNodeRemove(n),this.context.nodes.removeNode(n)}performCharacterDataMutation(e){const t=this.getNode(e.target);if(!t)throw new RenderingError(`Node with ID '${e.target}' not found.`);null!==e.data?t.text=e.data:delete t.text}performDocumentMutation(e){e.data.visibilityState&&(this.contentDocument.visibilityState=e.data.visibilityState)}applyAttrs(e,t){for(const[n,l]of Object.entries(e))null!==l?(t.attrs||(t.attrs={}),t.attrs[n]=l):t.attrs&&delete t.attrs[n]}applyScrolling(e,t){t.scroll=[...e]}applyValue(e,t){t.value=e}applyCheckedState(e,t){t.checked=e}applySize(e,t=!0){this.contentWindow.size=[...e],t&&this.emit("resize")}applyBlur(){}applyFocus(){}applySelection(){}rebuildNodes(e){e.addNode(this._contentDocument.root.id,this._contentDocument),this._rebuildNode(e,this._contentDocument.root)}_rebuildNode(e,t){var n;e.addNode(t.id,t),isVParentNode(t)&&(null==(n=t.children)||n.forEach((t=>this._rebuildNode(e,t)))),isVElement(t)&&t.shadowRoot&&this._rebuildNode(e,t.shadowRoot)}}class IncrementalSnapshotRenderer extends VirtualSnapshotRenderer{constructor(e){super(e),d(this,"_changedWindow"),d(this,"_changedDocument"),d(this,"_changedCount",0),this.context.setIncremental(!0),this._initIncremental()}get size(){return this._changedWindow.size||super.size}get documentTitle(){return this._changedDocument.title||super.documentTitle}get documentURL(){return this._changedWindow.location||super.documentURL}get documentBaseURI(){return this._changedDocument.baseURI||super.documentBaseURI}reset(){super.reset(),this._initIncremental()}_initIncremental(){this._changedWindow={},this._changedDocument={},this._changedCount=0}getIncrementalPercent(){return this._changedCount/this.context.nodes.size()}renderWindow(e){super.renderWindow(e)}renderDocument(e){super.renderDocument(e),this._changedDocument.root=this.renderNode(e.root,!1)}captureIncrementalSnapshot(){return V(this,null,(function*(){const e={version:1,window:this._changedWindow,document:this._changedDocument,id:this.context.snapshotId};this.context.capture(),yield this.context.waitAsyncTask();const t=deepClone(e);return this._initIncremental(),this.context.reset(),this._changedDocument.root=this.renderNode(e.document.root,!1),t}))}renderNode(e,t=!0){const{id:n,type:l}=e,i=t?deepClone(e):{id:n,type:l};return isVParentNode(e)&&(i.children=this.__renderChildren(e,t)),isVElement(e)&&e.shadowRoot&&(i.shadowRoot=this.renderNode(e.shadowRoot,t)),this.context.nodes.addNode(e.id,i),i}__renderChildren(e,t=!0){if(e.children)return e.children.map((e=>this.renderNode(e,t)))}performAddNodeMutation(e){super.performAddNodeMutation(e),this._changedCount++}performNavigation(e){this._changedWindow.location=e.to}applyAttrs(e,t){for(const[n,l]of Object.entries(e))t.attrs||(t.attrs={}),t.attrs[n]=l}applySize(e,t){this._changedWindow.size=e,t&&this.emit("resize")}rebuildNodes(e){null!=this._changedDocument.id&&e.addNode(this._changedDocument.root.id,this._changedDocument),this._rebuildNode(e,this._changedDocument.root)}}const BRIDGING_TOPIC="bytereplay.bridging";function isEnvelop(e){return"object"==typeof e&&!!e&&"topic"in e&&e.topic===BRIDGING_TOPIC}var InternalMessageType=(e=>(e.Handshake="internal.handshake",e.Stopped="internal.stopped",e.Connected="internal.connected",e.Disconnected="internal.disconnected",e))(InternalMessageType||{});const GLOBAL_BRIDGE_SYMBOL="__bytereplay_bridge__";class GlobalAccessor{get global(){return globalThis[GLOBAL_BRIDGE_SYMBOL]}}function hasByteReplayBridge(e){return null!=e[GLOBAL_BRIDGE_SYMBOL]}const bridge=new GlobalAccessor,proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=e=>"object"==typeof e&&null!==e||"function"==typeof e,proxyTransferHandler={canHandle:e=>isObject(e)&&e[proxyMarker],serialize(e){const{port1:t,port2:n}=new MessageChannel;return expose(e,t),[n,[n]]},deserialize(e){return e.start(),wrap(e)}},throwTransferHandler={canHandle:e=>isObject(e)&&throwMarker in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(e,t){for(const n of e)if(t===n||"*"===n||n instanceof RegExp&&n.test(t))return!0;return!1}function expose(e,t=globalThis,n=["*"]){t.addEventListener("message",(function l(i){if(!i||!i.data)return;if(!isAllowedOrigin(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:s,type:c,path:o}=Object.assign({path:[]},i.data),a=(i.data.argumentList||[]).map(fromWireValue);let r;try{const t=o.slice(0,-1).reduce(((e,t)=>e[t]),e),n=o.reduce(((e,t)=>e[t]),e);switch(c){case"GET":r=n;break;case"SET":t[o.slice(-1)[0]]=fromWireValue(i.data.value),r=!0;break;case"APPLY":r=n.apply(t,a);break;case"CONSTRUCT":r=proxy(new n(...a));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;expose(e,n),r=transfer(t,[t])}break;case"RELEASE":r=void 0;break;default:return}}catch(d){r={value:d,[throwMarker]:0}}Promise.resolve(r).catch((e=>({value:e,[throwMarker]:0}))).then((n=>{const[i,o]=toWireValue(n);t.postMessage(Object.assign(Object.assign({},i),{id:s}),o),"RELEASE"===c&&(t.removeEventListener("message",l),closeEndPoint(t),finalizer in e&&"function"==typeof e[finalizer]&&e[finalizer]())})).catch((e=>{const[n,l]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});t.postMessage(Object.assign(Object.assign({},n),{id:s}),l)}))})),t.start&&t.start()}function isMessagePort(e){return"MessagePort"===e.constructor.name}function closeEndPoint(e){isMessagePort(e)&&e.close()}function wrap(e,t){return createProxy(e,[],t)}function throwIfProxyReleased(e){if(e)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(e){return requestResponseMessage(e,{type:"RELEASE"}).then((()=>{closeEndPoint(e)}))}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(proxyCounter.get(e)||0)-1;proxyCounter.set(e,t),0===t&&releaseEndpoint(e)}));function registerProxy(e,t){const n=(proxyCounter.get(t)||0)+1;proxyCounter.set(t,n),proxyFinalizers&&proxyFinalizers.register(e,t,e)}function unregisterProxy(e){proxyFinalizers&&proxyFinalizers.unregister(e)}function createProxy(e,t=[],n=function(){}){let l=!1;const i=new Proxy(n,{get(n,s){if(throwIfProxyReleased(l),s===releaseProxy)return()=>{unregisterProxy(i),releaseEndpoint(e),l=!0};if("then"===s){if(0===t.length)return{then:()=>i};const n=requestResponseMessage(e,{type:"GET",path:t.map((e=>e.toString()))}).then(fromWireValue);return n.then.bind(n)}return createProxy(e,[...t,s])},set(n,i,s){throwIfProxyReleased(l);const[c,o]=toWireValue(s);return requestResponseMessage(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:c},o).then(fromWireValue)},apply(n,i,s){throwIfProxyReleased(l);const c=t[t.length-1];if(c===createEndpoint)return requestResponseMessage(e,{type:"ENDPOINT"}).then(fromWireValue);if("bind"===c)return createProxy(e,t.slice(0,-1));const[o,a]=processArguments(s);return requestResponseMessage(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:o},a).then(fromWireValue)},construct(n,i){throwIfProxyReleased(l);const[s,c]=processArguments(i);return requestResponseMessage(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},c).then(fromWireValue)}});return registerProxy(i,e),i}function myFlat(e){return Array.prototype.concat.apply([],e)}function processArguments(e){const t=e.map(toWireValue);return[t.map((e=>e[0])),myFlat(t.map((e=>e[1])))]}const transferCache=new WeakMap;function transfer(e,t){return transferCache.set(e,t),e}function proxy(e){return Object.assign(e,{[proxyMarker]:!0})}function toWireValue(e){for(const[t,n]of transferHandlers)if(n.canHandle(e)){const[l,i]=n.serialize(e);return[{type:"HANDLER",name:t,value:l},i]}return[{type:"RAW",value:e},transferCache.get(e)||[]]}function fromWireValue(e){switch(e.type){case"HANDLER":return transferHandlers.get(e.name).deserialize(e.value);case"RAW":return e.value}}function requestResponseMessage(e,t,n){return new Promise((l=>{const i=generateUUID();e.addEventListener("message",(function t(n){!n.data||!n.data.id||n.data.id!==i||(e.removeEventListener("message",t),l(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),n)}))}function generateUUID(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}class WorkerBridgeFlow extends AbstractFlow{constructor(e){super(),this.worker=e}handleInput(e){this._postFrame(e),this.output(e)}_postFrame(e){const t={topic:BRIDGING_TOPIC,contentType:"bytereplay.core.Frame",content:e};try{this.worker.postMessage(t)}catch(n){console.error(`post frame(${e.trackType}, ${e.event.eventType}) to worker error.`,n)}}}const ONE_PIXEL_TRANSPARENT="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function createFrameFromEvent(e,t,n){return{time:n,trackType:e,event:t}}function getMousePosition(e){const[t,n]=e.eventType===TrackerEventType.MouseDown||e.eventType===TrackerEventType.MouseMove||e.eventType===TrackerEventType.MouseUp||e.eventType===TrackerEventType.MouseClick?e.data:e.data[0];return[t,n]}function getMouseTargetId(e){return(e.eventType===TrackerEventType.MouseDown||e.eventType===TrackerEventType.MouseMove||e.eventType===TrackerEventType.MouseUp||e.eventType===TrackerEventType.MouseClick?e.data:e.data[0])[3]}function getMouseTargetContext(e){return(e.eventType===TrackerEventType.MouseDown||e.eventType===TrackerEventType.MouseMove||e.eventType===TrackerEventType.MouseUp||e.eventType===TrackerEventType.MouseClick?e.data:e.data[0])[4]}class ObservableTracker{constructor(e,t){d(this,"_isActive",!1),d(this,"_output",null),this.trackType=e,this.context=t}get isActive(){return this._isActive}get output(){return this._output||(this._output=this.createOutput()),this._output}activate(){this.setActive(!0),this.onActivate()}deactivate(){this.setActive(!1),this.onDeactivate()}onActivate(){}onDeactivate(){}setActive(e){this._isActive=e}}class AbstractTracker extends ObservableTracker{track(e){if(this.isActive){const t=createFrameFromEvent(this.trackType,e,now());this.output.next(t)}}createOutput(){return new Subject}}const ae=class e extends AbstractTracker{constructor(e,t){super(TrackType.Console,e),d(this,"_options"),d(this,"_eventTypesMapping"),d(this,"_vanillaMethods",new Map),d(this,"_hookedMethods",new Map),d(this,"_handleConsole",((e,...t)=>{this._eventTypesMapping&&this.track({eventType:this._eventTypesMapping[e],data:this._postProcess(t)})})),this._options=t}activate(){super.activate();const e=this._getAvailableMethodNames();this._eventTypesMapping=this._generateEventTypesMapping(e);for(const t of e)this._hook(t,this._handleConsole)}deactivate(){super.deactivate();const e=this._getAvailableMethodNames();for(const t of e)this._unhook(t);this._eventTypesMapping=void 0,this._vanillaMethods.clear(),this._hookedMethods.clear()}_hook(e,t){if(!this._vanillaMethods.has(e)){const n=window.console[e];this._vanillaMethods.set(e,n),window.console[e]=function(...l){t(e,...l),n.apply(this,l)},this._hookedMethods.set(e,window.console[e])}}_unhook(e){this._vanillaMethods.has(e)&&window.console[e]===this._hookedMethods.get(e)&&(window.console[e]=this._vanillaMethods.get(e))}_generateEventTypesMapping(e){const t={};for(const n of e)t[n]=TrackerEventType[`Console${n[0].toUpperCase()}${n.slice(1)}`];return t}_postProcess(e){return e.map((e=>{var t;try{return stringify(e,null==(t=this._options)?void 0:t.stringifyOptions)}catch(n){return"[Can't stringify]"}}))}_getAvailableMethodNames(){var t,n;return window.console?(null!=(n=null==(t=this._options)?void 0:t.levels)?n:e.CONSOLE_METHODS).filter((e=>isFunction$1(window.console[e]))):[]}};d(ae,"CONSOLE_METHODS",["error","log"]);let ConsoleTracker=ae;class CustomTracker extends AbstractTracker{constructor(e,t){super(checkCustomTrackType(e),t)}track(e){checkCustomTrackType(e.eventType),super.track(e)}}class ErrorTracker extends AbstractTracker{constructor(e){super(TrackType.Error,e),d(this,"_sequentialId",0),d(this,"_handleError",(e=>{var t,n;const l=this._nextId(),i=window.location.href;if(e instanceof ErrorEvent){const{message:t}=e;if(/^script error\.?$/i.test(t))this.track({eventType:TrackerEventType.ERROR_SCRIPT,data:{id:l,message:t,page:i}});else{const n={},{error:s}=e;s&&s.stack&&(n.stack=s.stack),this.track({eventType:TrackerEventType.ERROR_RUNTIME,data:v({id:l,message:t,source:e.filename,lineno:e.lineno,colno:e.colno,page:i},n)})}}else{const s={id:l,message:"Resource Not Found."},c=e.target;c&&(s.page=null!=(t=c.baseURI)?t:i,s.source=null!=(n=c.src)?n:c.href),this.track({eventType:TrackerEventType.ERROR_NOTFOUND,data:s})}})),d(this,"_handleRejection",(e=>{const t="Uncaught (in promise) Error",n={id:this._nextId(),message:`${t}.`,page:window.location.href},{reason:l}=e;l&&(isString(l)?n.message=l:(l.message&&(n.message=`${t}: ${l.message}`),l.stack&&(n.stack=l.stack))),this.track({eventType:TrackerEventType.ERROR_PROMISEREJECTION,data:n})}))}activate(){super.activate(),window.addEventListener("error",this._handleError,!0),window.addEventListener("unhandledrejection",this._handleRejection,!0)}deactivate(){super.deactivate(),window.removeEventListener("error",this._handleError,!0),window.removeEventListener("unhandledrejection",this._handleRejection,!0)}_nextId(){return++this._sequentialId}}class IFrameObserver{constructor(e){var t,n,l;d(this,"_iFrames",new WeakMap),d(this,"_contexts",new WeakMap),this.callback=e,null==(t=bridge.global)||t.iframe.on("recordingStarted",((e,t)=>{const n=this._iFrames.get(t);n&&this._handleAction(n,{type:IFrameActionType.StartRecording,data:e})})),null==(n=bridge.global)||n.iframe.on("recordingStopped",((e,t)=>{const n=this._iFrames.get(t);n&&this._handleAction(n,{type:IFrameActionType.StopRecording,data:e})})),null==(l=bridge.global)||l.iframe.on("unload",(e=>{const t=this._iFrames.get(e);t&&this._handleAction(t,{type:IFrameActionType.Unload,data:{}})}))}get nodeName(){return"IFRAME"}observe(e,t,n){var l;const i=t.contentWindow;if(i){const n=null==t.contentDocument;this._iFrames.set(i,t),this._contexts.set(t,e);let c="";if(n)try{c=new URL(t.src).origin}catch(s){}else c=location.origin;null==(l=bridge.global)||l.iframe.connect(i,{isCrossOrigin:n,origin:c}),t.addEventListener("load",(()=>{this.observe(e,t,{}),this._handleAction(t,{type:IFrameActionType.Load,data:{}})}),{once:!0})}n.extra={state:IFrameState.Loaded}}disconnect(e){e.contentWindow&&(this._iFrames.delete(e.contentWindow),this._contexts.delete(e))}disconnectAll(){this._iFrames=new WeakMap,this._contexts=new WeakMap}_handleAction(e,t){const n=this._contexts.get(e),l=null==n?void 0:n.nodes.getNodeId(e);l&&this.callback({eventType:TrackerEventType.HTMLIFrame,data:{target:l,action:t}})}}class NavigationObserver{constructor(e,t){d(this,"prevUrl"),d(this,"_navigationHandler"),d(this,"_idleTimer"),d(this,"_watch",(()=>{this.prevUrl!==location.href&&(this.callback({eventType:TrackerEventType.HTMLNavigation,data:{from:this.prevUrl||"",to:location.href,type:"unknown"}}),this.prevUrl=location.href)})),this.context=e,this.callback=t}start(){if("navigation"in globalThis){const e=e=>{this.callback({eventType:TrackerEventType.HTMLNavigation,data:{from:e.target.currentEntry.url,to:e.destination.url,type:e.navigationType}})};globalThis.navigation.addEventListener("navigate",e)}else this.prevUrl=location.href,this._idleTimer=this._nextTick()}_nextTick(){return setInterval(this._watch,1e3)}stop(){"navigation"in globalThis&&this._navigationHandler?globalThis.navigation.removeEventListener("navigate",this._navigationHandler):void 0!==this._idleTimer&&clearInterval(this._idleTimer)}}class HTMLTracker extends AbstractTracker{constructor(e,t){super(TrackType.HTML,e),d(this,"_snapshotCapturer"),d(this,"_navigationObserver"),d(this,"_handleTrackEvent",(e=>{this.track(e)})),this._snapshotCapturer=new SnapshotCapturer(t),null!=t&&t.navigation&&(this._navigationObserver=new NavigationObserver(e,(e=>{this.track(e)}))),null!=t&&t.iframe&&this._snapshotCapturer.registerNodeObserver(IFrameObserver)}get snapshotCapturer(){return this._snapshotCapturer}activate(){var e;super.activate(),this._snapshotCapturer.on("event",this._handleTrackEvent),this._snapshotCapturer.start(),null==(e=this._navigationObserver)||e.start()}deactivate(){var e;super.deactivate(),this._snapshotCapturer.off("event",this._handleTrackEvent),this._snapshotCapturer.stop(),null==(e=this._navigationObserver)||e.stop()}getNodeId(e){return this._snapshotCapturer.getNodeId(e)}}class KeyboardTracker extends AbstractTracker{constructor(e){super(TrackType.Keyboard,e),d(this,"_ignoredKeys",{Alt:!0,Shift:!0,Control:!0,Meta:!0}),d(this,"_allowedInputTypes",{button:!0,checkbox:!0,color:!0,file:!0,hidden:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}),d(this,"_handleKeyDown",(e=>{const{key:t,target:n}=e;this._ignoredKeys[t]||this.track({eventType:TrackerEventType.KeyDown,data:[t,e.code,e.altKey,e.ctrlKey,e.metaKey,e.shiftKey,this.context.getNodeId(n)]})}))}activate(){super.activate(),document.addEventListener("keydown",this._handleKeyDown,!0)}deactivate(){super.deactivate(),document.removeEventListener("keydown",this._handleKeyDown,!0)}}class RecordingError extends RuntimeError{constructor(e,t){super(e,t),this.name="bytereplay.recorder.RecordingError"}}class TrackingError extends RecordingError{constructor(e,t){super(e,t),this.name="bytereplay.recorder.TrackingError"}}const TRACKED_TEXT_CONTENT_ELEMENTS={BUTTON:!0,A:!0,SPAN:!0,LABEL:!0,INPUT:!0,SELECT:!0,TH:!0,TD:!0,SUMMARY:!0,DETAILS:!0};class MouseTracker extends AbstractTracker{constructor(e,t){var n,l;super(TrackType.Mouse,e),d(this,"_samplingInterval"),d(this,"_maxTextLength"),d(this,"_samplingDistance",2),d(this,"_lastMoveTime",0),d(this,"_lastMovePosition"),d(this,"_mouseTargetId"),d(this,"_mouseTargetContext"),d(this,"_isTouching",!1),d(this,"_handleMouseMove",(e=>{this._isTouching||(0===this._lastMoveTime||calculateElapsedTime(this._lastMoveTime)>this._samplingInterval)&&(null==this._lastMovePosition||calculateManhattanDistance(e,this._lastMovePosition)>this._samplingDistance)&&(this._lastMoveTime=now(),null==this._lastMovePosition?this._lastMovePosition=[e.x,e.y]:(this._lastMovePosition[0]=e.x,this._lastMovePosition[1]=e.y),this.track(this._convertMouseEvent2TrackerEvent(e)))})),d(this,"_handleMouseDown",(e=>{if(this._isTouching)return;this._lastMoveTime=0,this._lastMovePosition=void 0;const t=e.target;this._mouseTargetId=this.context.getNodeId(t),this._mouseTargetContext=this._getTargetContext(t),this.track(this._convertMouseEvent2TrackerEvent(e,this._mouseTargetId,this._mouseTargetContext))})),d(this,"_handleMouseUp",(e=>{this._isTouching||(this.track(this._convertMouseEvent2TrackerEvent(e,this._mouseTargetId,this._mouseTargetContext)),this._reset())})),d(this,"_handleMouseClick",(e=>{const t=e.target;this.track(this._convertMouseEvent2TrackerEvent(e,this.context.getNodeId(t),this._getTargetContext(t)))})),d(this,"_handleTouchStart",(e=>{this._isTouching=!0,this._lastMoveTime=0;const t=this._gatherTouches(e.touches);t.length>0&&this.track({eventType:TrackerEventType.TouchStart,data:t})})),d(this,"_handleTouchMove",(e=>{if(0===this._lastMoveTime||calculateElapsedTime(this._lastMoveTime)>this._samplingInterval){this._lastMoveTime=now();const t=this._gatherTouches(e.touches,!1,!1);t.length>0&&this.track({eventType:TrackerEventType.TouchMove,data:t})}})),d(this,"_handleTouchEnd",(e=>{setTimeout((()=>this._isTouching=!1),20);const t=this._gatherTouches(e.changedTouches);t.length>0&&this.track({eventType:TrackerEventType.TouchEnd,data:t})})),d(this,"_handleTouchCancel",(e=>{setTimeout((()=>this._isTouching=!1),20);const t=this._gatherTouches(e.changedTouches);t.length>0&&this.track({eventType:TrackerEventType.TouchCancel,data:t})})),this._samplingInterval=Math.floor(1e3/(null!=(n=null==t?void 0:t.samplingRate)?n:8)*1e3)/1e3,this._maxTextLength=null!=(l=null==t?void 0:t.maxTextLength)?l:100,this._maxTextLength>199&&console.warn(`The option "maxTextLength" is set too high (${this._maxTextLength}), which may reduce recording performance.`)}activate(){super.activate(),this._reset(),window.addEventListener("touchstart",this._handleTouchStart,!0),window.addEventListener("touchmove",this._handleTouchMove,!0),window.addEventListener("touchend",this._handleTouchEnd,!0),window.addEventListener("touchcancel",this._handleTouchCancel,!0),window.addEventListener("mousemove",this._handleMouseMove,!0),window.addEventListener("mousedown",this._handleMouseDown,!0),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("click",this._handleMouseClick,!0)}deactivate(){super.deactivate(),this._reset(),window.removeEventListener("touchstart",this._handleTouchStart,!0),window.removeEventListener("touchmove",this._handleTouchMove,!0),window.removeEventListener("touchend",this._handleTouchEnd,!0),window.removeEventListener("touchcancel",this._handleTouchCancel,!0),window.removeEventListener("mousemove",this._handleMouseMove,!0),window.removeEventListener("mousedown",this._handleMouseDown,!0),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("click",this._handleMouseClick,!0)}_convertMouseEvent2TrackerEvent(e,t,n){const l=[e.clientX,e.clientY,e.buttons];return null!=t&&null!=n?l.push(t,n):null!=t?l.push(t):null!=n&&(l[4]=n),{eventType:_getEventType(e),data:l}}_gatherTouches(e,t=!0,n=!0){const l=[];for(let i=0;i<e.length;i++){const s=e[i],c=[Math.round(s.clientX),Math.round(s.clientY),s.identifier];if(t){const e=this.context.getNodeId(s.target);null!=e&&c.push(e)}if(n){const e=this._getTargetContext(s.target);null!=e&&(c[4]=e)}l.push(c)}return l}_getTargetContext(e){var t;if(null!=e&&isHTMLElement(e)){const n={tagName:e.tagName};if(TRACKED_TEXT_CONTENT_ELEMENTS[n.tagName]){const l=null!=(t=e.textContent)?t:void 0;null!=l&&(n.textContent=l.length>this._maxTextLength?l.slice(0,this._maxTextLength)+"...":l)}return n}}_reset(){this._lastMoveTime=0,this._lastMovePosition=void 0,this._mouseTargetId=void 0,this._mouseTargetContext=void 0,this._isTouching=!1}}function _getEventType(e){switch(e.type){case"mousemove":return TrackerEventType.MouseMove;case"mousedown":return TrackerEventType.MouseDown;case"mouseup":return TrackerEventType.MouseUp;case"click":return TrackerEventType.MouseClick;default:throw new TrackingError(`Unknown mouse event type: ${e.type}`)}}function calculateElapsedTime(e){return now()-e}function calculateManhattanDistance(e,t){return Math.abs(e.x-t[0])+Math.abs(e.y-t[1])}const F=class e extends AbstractTracker{constructor(e,t){super(TrackType.Network,e),d(this,"_options"),d(this,"_sequentialId",0),d(this,"_vanillaMethods",new Map),d(this,"_hookedMethods",new Map),d(this,"_xhrContexts",new WeakMap),d(this,"_handleXHRSend",((e,t)=>{if(e){const n=M(v({},e.request),{body:this._options.captureRequestBody?this._parseBody(t):null});n.url=this._parseURL(n.url),this.track({eventType:TrackerEventType.NETWORK_SEND,data:n})}})),d(this,"_handleXHRAbort",(e=>{const t=this._xhrContexts.get(e.target);t&&(t.eventType=TrackerEventType.NETWORK_ABORT)})),d(this,"_handleXHRError",(e=>{const t=this._xhrContexts.get(e.target);t&&(t.eventType=TrackerEventType.NETWORK_ERROR)})),d(this,"_handleXHRTimeout",(e=>{const t=e.target,n=this._xhrContexts.get(t);if(n){this._xhrContexts.delete(t);const e=v({},n.response);e.url=this._parseURL(e.url),this.track({eventType:TrackerEventType.NETWORK_TIMEOUT,data:e})}})),d(this,"_handleXHRLoad",(e=>{const t=this._xhrContexts.get(e.target);t&&(t.eventType=TrackerEventType.NETWORK_DONE)})),d(this,"_handleXHRLoadEnd",(e=>{const t=e.target,n=this._xhrContexts.get(t);if(n){this._xhrContexts.delete(t);const e=M(v({},n.response),{url:t.responseURL,headers:parseHeaders(t.getAllResponseHeaders()),status:t.status,statusText:t.statusText,type:t.responseType});this._options.captureResponseBody&&(e.body=""===t.responseType||"text"===t.responseType||"json"===t.responseType?t.response:t.response&&t.response.toString()),e.url=this._parseURL(e.url),this.track({eventType:n.eventType,data:e})}})),this._options=v({captureResponseBody:!1,captureRequestBody:!0,captureRequestURLQuery:!0,disableDataMasking:!1,disableBuiltInDataMasks:!1,dataMasks:[],maskingLevel:DataMaskingLevel.BALANCE},t)}activate(){super.activate(),this._hookXHR(),this._hookFetch()}deactivate(){super.deactivate(),this._unhookXHR(),this._unhookFetch()}_hookXHR(){const t=this._options.xhr?this._options.xhr.prototype:XMLHttpRequest?XMLHttpRequest.prototype:void 0;if(t){const n=e.XHR_METHODS.filter((e=>isFunction$1(t[e])));for(const e of n)this._hookXHRMethod(t,e)}}_unhookXHR(){const t=this._options.xhr?this._options.xhr.prototype:XMLHttpRequest?XMLHttpRequest.prototype:void 0;if(t){const n=e.XHR_METHODS.filter((e=>isFunction$1(t[e])));for(const e of n)this._unhook(t,e);this._xhrContexts=new WeakMap}}_hookXHRMethod(t,n){if(!this._vanillaMethods.has(n)){const l=t[n];this._vanillaMethods.set(n,l);const i=this;t[n]=function(...t){var s,c;if(n===e.XHR_OPEN){const e=i._nextId(),[n,l,s,c,o]=t,a={eventType:TrackerEventType.NETWORK_SEND,request:{id:e,type:"xhr",method:n,url:String(l)},response:{id:e}};null!=s&&(a.request.async=s),null!=c&&(a.request.user=c),null!=o&&(a.request.password=o),i._xhrContexts.set(this,a)}else if(n===e.XHR_SEND){const e=i._xhrContexts.get(this);e&&null!=(c=(s=i._options).shouldIgnoreRequest)&&c.call(s,e.request)?i._xhrContexts.delete(this):(this.removeEventListener&&(this.removeEventListener("abort",i._handleXHRAbort),this.removeEventListener("error",i._handleXHRError),this.removeEventListener("timeout",i._handleXHRTimeout),this.removeEventListener("load",i._handleXHRLoad),this.removeEventListener("loadend",i._handleXHRLoadEnd)),this.addEventListener("abort",i._handleXHRAbort),this.addEventListener("error",i._handleXHRError),this.addEventListener("timeout",i._handleXHRTimeout),this.addEventListener("load",i._handleXHRLoad),this.addEventListener("loadend",i._handleXHRLoadEnd),i._handleXHRSend(e,t[0]))}else if(n===e.XHR_SET_REQUEST_HEADER){const e=i._xhrContexts.get(this);if(e){const[n,l]=t;null==e.request.headers&&(e.request.headers={});const i=e.request.headers;null==i[n]?i[n]=l:i[n]=`${i[n]}, ${l}`}}l.apply(this,t)},this._hookedMethods.set(n,t[n])}}_hookFetch(){var t;const n=null!=(t=this._options.fetchable)?t:window;if(caniuse.fetch(n)&&!this._vanillaMethods.has(e.FETCH_API)){const t=this,l=n[e.FETCH_API];this._vanillaMethods.set(e.FETCH_API,l),n[e.FETCH_API]=function(e,n){var i,s;if(null!=n&&n[FETCH_FLAG])return l.call(this,e,n);const c=t._nextId(),o={request:{id:c,type:"fetch",method:"GET",url:""},response:{id:c}};return isString(e)?o.request.url=e:isFetchRequest(e)&&(t._options.captureRequestBody&&(o.request.body=t._parseBody(e.body)),o.request.method=e.method,o.request.url=e.url,o.request.cache=e.cache,o.request.credentials=e.credentials,o.request.headers=parseHeaders(e.headers),o.request.integrity=e.integrity,o.request.keepalive=e.keepalive,o.request.mode=e.mode,o.request.redirect=e.redirect,o.request.referrer=e.referrer,o.request.referrerPolicy=e.referrerPolicy),null!=(s=(i=t._options).shouldIgnoreRequest)&&s.call(i,o.request)?l.call(this,e,n):(null!=n&&(null!=n.body&&t._options.captureRequestBody&&(o.request.body=t._parseBody(n.body)),null!=n.cache&&(o.request.cache=n.cache),null!=n.credentials&&(o.request.credentials=n.credentials),null!=n.integrity&&(o.request.integrity=n.integrity),null!=n.keepalive&&(o.request.keepalive=n.keepalive),null!=n.method&&(o.request.method=n.method),null!=n.mode&&(o.request.mode=n.mode),null!=n.redirect&&(o.request.redirect=n.redirect),null!=n.referrer&&(o.request.referrer=n.referrer),null!=n.referrerPolicy&&(o.request.referrerPolicy=n.referrerPolicy),null!=n.headers&&(o.request.headers=v(v({},o.request.headers),parseHeaders(n.headers)))),t._handleFetchEvent(o,TrackerEventType.NETWORK_SEND),l.call(this,e,n).then((e=>V(this,null,(function*(){return t._handleFetchResponse(o,e),e})))).catch((e=>{throw t._handleFetchEvent(o,TrackerEventType.NETWORK_ERROR),e})))},n[e.FETCH_API].toString=function(){return"function fetch() { [native code] }"},this._hookedMethods.set(e.FETCH_API,n[e.FETCH_API])}}_unhookFetch(){var t;const n=null!=(t=this._options.fetchable)?t:window;this._unhook(n,e.FETCH_API)}_unhook(e,t){e&&this._vanillaMethods.has(t)&&this._hookedMethods.has(t)&&e[t]===this._hookedMethods.get(t)&&(e[t]=this._vanillaMethods.get(t),this._vanillaMethods.delete(t),this._hookedMethods.delete(t))}_handleFetchResponse(e,t){return V(this,null,(function*(){var n,l,i,s;if(e.response.ok=t.ok,e.response.url=t.url,e.response.redirected=t.redirected,e.response.status=t.status,e.response.statusText=t.statusText,e.response.type=t.type,e.response.headers=parseHeaders(t.headers),this._options.captureResponseBody)try{const o=t.clone(),a=null==(l=null==(n=t.headers)?void 0:n.get("Content-Type"))?void 0:l.toLowerCase();let r;try{if(includes(a,"text/plain"))r=yield o.text();else if(includes(a,"application/json"))r=yield o.json();else if(includes(a,"application/octet-stream")){const e=yield o.arrayBuffer();r=(new TextDecoder).decode(e)}else r=null==(i=o.body)?void 0:i.toString()}catch(c){r=null==(s=o.body)?void 0:s.toString()}e.response.body=r}catch(o){}this._handleFetchEvent(e,TrackerEventType.NETWORK_DONE)}))}_handleFetchEvent(e,t){let n;n=t===TrackerEventType.NETWORK_SEND?v({},e.request):v({},e.response),n.url=this._parseURL(n.url),this.track({eventType:t,data:n})}_parseURL(e){try{if(!this._options.captureRequestURLQuery&&isString(e)){const t=new URL(e);return t.search="",t.toString()}}catch(t){}return null!=e?e:""}_parseBody(e){return isFormData(e)?flattenFormData(e):e instanceof ReadableStream?"ReadableStream":e}_nextId(){return++this._sequentialId}};d(F,"FETCH_API","fetch"),d(F,"XHR_OPEN","open"),d(F,"XHR_SEND","send"),d(F,"XHR_SET_REQUEST_HEADER","setRequestHeader"),d(F,"XHR_METHODS",[F.XHR_OPEN,F.XHR_SEND,F.XHR_SET_REQUEST_HEADER]);let NetworkTracker=F;const ENTRY_TYPE_LONGTASK="longtask",ENTRY_TYPE_NAVIGATION="navigation",ENTRY_TYPE_RESOURCE="resource";class PerformanceTracker extends AbstractTracker{constructor(e,t){var n;super(TrackType.Performance,e),d(this,"_performanceObserver"),d(this,"_config"),d(this,"_handlePerformance",(e=>{this._traceLongTaskEntries(e.getEntriesByType(ENTRY_TYPE_LONGTASK)),this._traceNavigationEntries(e.getEntriesByType(ENTRY_TYPE_NAVIGATION)),this._traceResourceEntries(e.getEntriesByType(ENTRY_TYPE_RESOURCE))})),d(this,"_traceLongTaskEntries",(e=>{const t=[];for(const n of e){const e={entryType:n.entryType,name:n.name,startTime:convertDOMHighResTimeStamp2AbsoluteTime(n.startTime),duration:roundToTwoDecimals(n.duration)};this._config.shouldIgnoreTiming(e)||t.push(e)}t.length>0&&this.track({eventType:TrackerEventType.PERFORMANCE_LONG_TASK,data:t})})),d(this,"_traceResourceEntries",(e=>{if(e.length>0){const t=[];for(const n of e){const e=this._createResourceTiming(n);this._config.shouldIgnoreTiming(e)||t.push(e)}t.length>0&&this.track({eventType:TrackerEventType.PERFORMANCE_RESOURCE,data:t})}})),d(this,"_traceNavigationEntries",(e=>{if(e.length>0){const t=[];for(const n of e){const e=this._createNavigationTiming(n);this._config.shouldIgnoreTiming(e)||t.push(e)}t.length>0&&this.track({eventType:TrackerEventType.PERFORMANCE_NAVIGATION,data:t})}})),d(this,"_createResourceTiming",(e=>{var t;const n={entryType:e.entryType,name:e.name,startTime:convertDOMHighResTimeStamp2AbsoluteTime(e.startTime),duration:roundToTwoDecimals(e.duration),initiatorType:e.initiatorType,nextHopProtocol:e.nextHopProtocol,serverTiming:(null!=(t=e.serverTiming)?t:[]).map((e=>({name:e.name,duration:roundToTwoDecimals(e.duration),description:e.description}))),stats:{total:roundToTwoDecimals(e.duration)}};if(null!=e.deliveryType&&(n.deliveryType=e.deliveryType),null!=e.notRestoredReasons&&(n.notRestoredReasons=e.notRestoredReasons),null!=e.renderBlockingStatus&&(n.renderBlockingStatus=e.renderBlockingStatus),null!=e.responseStatus&&(n.responseStatus=e.responseStatus),isValidNumber(e.redirectStart)&&(n.redirectStart=convertDOMHighResTimeStamp2AbsoluteTime(e.redirectStart)),isValidNumber(e.redirectEnd)&&(n.redirectEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.redirectEnd)),isValidNumber(e.workerStart)&&(n.workerStart=convertDOMHighResTimeStamp2AbsoluteTime(e.workerStart)),isValidNumber(e.fetchStart)&&(n.fetchStart=convertDOMHighResTimeStamp2AbsoluteTime(e.fetchStart)),isValidNumber(e.domainLookupStart)&&(n.domainLookupStart=convertDOMHighResTimeStamp2AbsoluteTime(e.domainLookupStart)),isValidNumber(e.domainLookupEnd)&&(n.domainLookupEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.domainLookupEnd)),isValidNumber(e.connectStart)&&(n.connectStart=convertDOMHighResTimeStamp2AbsoluteTime(e.connectStart)),isValidNumber(e.secureConnectionStart)&&(n.secureConnectionStart=convertDOMHighResTimeStamp2AbsoluteTime(e.secureConnectionStart)),isValidNumber(e.connectEnd)&&(n.connectEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.connectEnd)),isValidNumber(e.requestStart)&&(n.requestStart=convertDOMHighResTimeStamp2AbsoluteTime(e.requestStart)),isValidNumber(e.firstInterimResponseStart)&&(n.firstInterimResponseStart=convertDOMHighResTimeStamp2AbsoluteTime(e.firstInterimResponseStart)),isValidNumber(e.responseStart)&&(n.responseStart=convertDOMHighResTimeStamp2AbsoluteTime(e.responseStart)),isValidNumber(e.responseEnd)&&(n.responseEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.responseEnd)),isValidNumber(e.redirectEnd)&&isValidNumber(e.redirectStart)&&(n.stats.redirect=roundToTwoDecimals(e.redirectEnd-e.redirectStart)),isValidNumber(e.domainLookupStart)&&isValidNumber(e.workerStart)&&(n.stats.serviceWorker=roundToTwoDecimals(e.domainLookupStart-e.workerStart)),isValidNumber(e.domainLookupEnd)&&isValidNumber(e.domainLookupStart)&&(n.stats.dns=roundToTwoDecimals(e.domainLookupEnd-e.domainLookupStart)),isValidNumber(e.connectEnd)&&isValidNumber(e.connectStart)&&(n.stats.tcp=roundToTwoDecimals(e.connectEnd-e.connectStart)),isValidNumber(e.responseEnd)&&isValidNumber(e.responseStart)&&(n.stats.contentDownload=roundToTwoDecimals(e.responseEnd-e.responseStart)),isValidNumber(e.responseStart)&&(n.stats.ttfb=roundToTwoDecimals(e.responseStart-e.startTime)),null!=e.serverTiming&&e.serverTiming.length>0){const t=Math.max(...e.serverTiming.map((e=>e.duration)));n.stats.server=roundToTwoDecimals(t),isValidNumber(e.responseStart)&&(n.stats.client=roundToTwoDecimals(e.responseStart-e.startTime-t))}return n})),d(this,"_createNavigationTiming",(e=>{const t=M(v({},this._createResourceTiming(e)),{entryType:e.entryType,type:e.type,redirectCount:e.redirectCount});return isValidNumber(e.unloadEventStart)&&(t.unloadEventStart=convertDOMHighResTimeStamp2AbsoluteTime(e.unloadEventStart)),isValidNumber(e.unloadEventEnd)&&(t.unloadEventEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.unloadEventEnd)),isValidNumber(e.domInteractive)&&(t.domInteractive=convertDOMHighResTimeStamp2AbsoluteTime(e.domInteractive)),isValidNumber(e.domContentLoadedEventStart)&&(t.domContentLoadedEventStart=convertDOMHighResTimeStamp2AbsoluteTime(e.domContentLoadedEventStart)),isValidNumber(e.domContentLoadedEventEnd)&&(t.domContentLoadedEventEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.domContentLoadedEventEnd)),isValidNumber(e.domComplete)&&(t.domComplete=convertDOMHighResTimeStamp2AbsoluteTime(e.domComplete)),isValidNumber(e.loadEventStart)&&(t.loadEventStart=convertDOMHighResTimeStamp2AbsoluteTime(e.loadEventStart)),isValidNumber(e.loadEventEnd)&&(t.loadEventEnd=convertDOMHighResTimeStamp2AbsoluteTime(e.loadEventEnd)),isValidNumber(e.unloadEventEnd)&&isValidNumber(e.unloadEventStart)&&(t.stats.unload=roundToTwoDecimals(e.unloadEventEnd-e.unloadEventStart)),isValidNumber(e.domComplete)&&isValidNumber(e.domInteractive)&&(t.stats.domProcessing=roundToTwoDecimals(e.domComplete-e.domInteractive)),isValidNumber(e.loadEventEnd)&&isValidNumber(e.loadEventStart)&&(t.stats.load=roundToTwoDecimals(e.loadEventEnd-e.loadEventStart)),t}));const l=null==t?void 0:t.buffered;this._config={buffered:!0===l||!1===l?{navigation:l,resource:l}:v({navigation:!0,resource:!1},l),shouldIgnoreTiming:null!=(n=null==t?void 0:t.shouldIgnoreTiming)?n:defaultShouldIgnoreTiming}}activate(){super.activate(),caniuse.performanceObserver()&&(this._performanceObserver=new PerformanceObserver(this._handlePerformance),this._performanceObserver.observe({type:ENTRY_TYPE_LONGTASK}),this._performanceObserver.observe({type:ENTRY_TYPE_NAVIGATION,buffered:this._config.buffered.navigation}),this._performanceObserver.observe({type:ENTRY_TYPE_RESOURCE,buffered:this._config.buffered.resource}))}deactivate(){var e;super.deactivate(),null==(e=this._performanceObserver)||e.disconnect(),this._performanceObserver=void 0}}function defaultShouldIgnoreTiming(){return!1}function isValidNumber(e){return null!=e&&e>0}function roundToTwoDecimals(e){return Math.round(100*e)/100}class TrackerContext{constructor(){d(this,"_snapshotCapturer",null)}get snapshotCapturer(){return this._snapshotCapturer}set snapshotCapturer(e){this._snapshotCapturer=e}getNodeId(e){var t;return null==(t=this.snapshotCapturer)?void 0:t.getNodeId(e)}}function normalizeTrackType(e){return isString(e)?TrackType[e]:e}function normalizeTrackTypes(e){const t=null==e?void 0:e.map((e=>normalizeTrackType(e))).filter((e=>!!e));return t&&t.length>0?t:[TrackType.HTML,TrackType.Mouse]}function serialize(e){var t,n,l,i,s,c,o,a;const r=clone(e),d={};return"function"==typeof(null==(n=null==(t=r.html)?void 0:t.image)?void 0:n.captureAttributes)&&(d["options.html.image.captureAttributes"]=String(r.html.image.captureAttributes),null==(i=null==(l=r.html)?void 0:l.image)||delete i.captureAttributes),null!=(s=r.network)&&s.xhr&&delete r.network.xhr,null!=(c=r.network)&&c.fetchable&&delete r.network.fetchable,null!=(o=r.network)&&o.shouldIgnoreRequest&&delete r.network.shouldIgnoreRequest,null!=(a=r.performance)&&a.shouldIgnoreTiming&&delete r.performance.shouldIgnoreTiming,r.worker&&delete r.worker,M(v({},r),{fns:d})}function deserialize(e){return v({},e)}function clone(e){if(isPlainObject(e)){const t={};for(const n of Object.keys(e))t[n]=clone(e[n]);return t}return e}class AbstractRecorder extends EventEmitter{constructor(e,t){super(),d(this,"context",new TrackerContext),d(this,"trackers",[]),d(this,"options"),d(this,"_trackTypes"),d(this,"_recordingManager",null),d(this,"_trackerSource",null),d(this,"_initialHandler"),d(this,"_initialTasks",[]),d(this,"_watchRecordingStop",(e=>V(this,null,(function*(){var t;null==(t=bridge.global)||t.stopRecording(e),0===(yield this.recordingManager.getCurrentRecordingCount())&&this._stopTracking(),this.emit("stopRecording",e)})))),d(this,"_watchRecordingDump",(e=>V(this,null,(function*(){var t;null==(t=bridge.global)||t.dumpRecording(e),this.emit("dumpRecording",e)})))),d(this,"_watchRecordingFrame",(e=>{this.emit("frame",e)})),d(this,"_handleBeforeUnload",(()=>V(this,null,(function*(){this.options.cache&&(yield this.isRecording())&&this.recordingManager.cacheRecordings()})))),this.mode=e;const n=normalizeTrackTypes(null==t?void 0:t.trackers);this.options=M(v({},t),{trackers:n}),this._trackTypes=n}static get version(){return version}get recordingManager(){return null==this._recordingManager&&(this._recordingManager=this.createRecordingManager()),this._recordingManager}get trackerSource(){return this._trackerSource}addInitialTask(e){this._initialTasks.push(e)}getManager(){return this._recordingManager}getTracker(e){let t;t=isString(e)?TrackType[e]:e;const n=this.trackers.find((e=>e.trackType===t));if(!n)throw new Error("Unknown track type or not enabled");return n}registerTracker(e){const t=Reflect.construct(e,[this.context]);if(t.trackType<=1e3)throw new Error("Custom tracker type must be greater than 1000");this.trackers.push(t),this._trackTypes.push(t.trackType)}startRecording(e){return V(this,null,(function*(){var t,n;yield this._initialize();const l=yield this.recordingManager.createRecordingContext(v({clientTime:(new Date).toISOString(),startTime:now(),environment:this.getEnvironment(),mode:RecordingMode.Streaming,trackers:this._trackTypes},e));return(null!=(t=this.options.html)&&t.iframe||"iframe"===e.refType)&&(bridge.global&&bridge.global.setRecorder(this),null==(n=bridge.global)||n.startRecording(e,l.recording)),this._startTracking(),this.emit("startRecording",l.recording),l}))}getEnvironment(){return getEnvironmentMeta()}dumpRecording(e,t){return V(this,null,(function*(){return yield this.recordingManager.dumpRecording(e,t)}))}stopRecording(e){return V(this,null,(function*(){yield this.recordingManager.stopRecordingContext(e)}))}isRecording(){return V(this,null,(function*(){return(yield this.recordingManager.getCurrentRecordingCount())>0}))}_initialize(){return this._initialHandler||(this._initialHandler=Promise.all([new Promise((e=>{this._initTrackers(),this.onInit(),this._trackerSource=merge(...this.trackers.map((e=>e.output))),e()})),this._waitUntilPageLoaded(),...this._initialTasks])),this._initialHandler}_waitUntilPageLoaded(){return document&&"complete"!==document.readyState?new Promise((e=>{document.addEventListener("readystatechange",(()=>{if("complete"===document.readyState)return e()}))})):Promise.resolve()}_initTrackers(){if(includes(this._trackTypes,TrackType.HTML)){const e=new HTMLTracker(this.context,this.options.html);this.context.snapshotCapturer=e.snapshotCapturer,this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Mouse)){const e=new MouseTracker(this.context,this.options.mouse);this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Keyboard)){const e=new KeyboardTracker(this.context);this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Console)){const e=new ConsoleTracker(this.context,this.options.console);this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Error)){const e=new ErrorTracker(this.context);this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Network)){const e=new NetworkTracker(this.context,this.options.network);this.trackers.push(e)}if(includes(this._trackTypes,TrackType.Performance)){const e=new PerformanceTracker(this.context,this.options.performance);this.trackers.push(e)}}onInit(){}_startTracking(){this._subscribeRawEvents();for(const e of this.trackers)e.isActive||e.activate();this._resumeRecordings()}_stopTracking(){this._unsubscribeRawEvents();for(const e of this.trackers)e.deactivate()}_subscribeRawEvents(){window.addEventListener("beforeunload",this._handleBeforeUnload,!0)}_unsubscribeRawEvents(){window.removeEventListener("beforeunload",this._handleBeforeUnload,!0)}_resumeRecordings(){this.options.autoUploadingCache&&setTimeout((()=>{this.recordingManager.uploadRecordingCaches()}),1e3)}}class RecordingContext{constructor(e,t,n){var l,i;d(this,"manager"),d(this,"_id"),d(this,"_recording"),d(this,"_startTime"),d(this,"_offsetTime"),d(this,"_trackers"),d(this,"_transmitter"),d(this,"_events",new EventEmitter),this.options=n,this.manager=e,this._recording=t,this._id=t.id,this._startTime=null!=(l=n.startTime)?l:now(),this._trackers=n.trackers,this._offsetTime=this.getOffsetTime(this._startTime);const s=null==(i=n.transport)?void 0:i.strategies.find((e=>e.mode===n.mode&&"channelType"in e));this._transmitter={strategy:s}}get id(){return this._id}get recording(){return this._recording}get baseURL(){return this.manager.env.baseURL}get env(){return this.manager.env}get startTime(){return this._startTime}get offsetTime(){return this._offsetTime}get now(){return now()+this._offsetTime}get transmitter(){return this._transmitter}get trackers(){return this._trackers}dumpRecording(e){return this.manager.dumpRecording(this._id,e)}cacheRecordings(){return this.manager.cacheRecordings()}stopRecording(){return this.manager.stopRecordingContext(this._id)}toString(){return JSON.stringify(this._recording)}emit(e,...t){return this._events.emit(e,...t)}on(e,t){this._events.on(e,t,{})}once(e,t){this._events.once(e,t,{})}off(e,t){this._events.off(e,t,{})}addListener(e,t){this._events.addListener(e,t,{})}removeListener(e,t){this._events.removeListener(e,t,{})}getOffsetTime(e){return e-now()}}class BlackboxRecordingContext extends RecordingContext{constructor(e,t,n){var l;super(e,t,n),d(this,"_dumpConfig");const i=null==(l=n.transport)?void 0:l.strategies.find((e=>"blackbox-record-dump"===e.name));this._dumpConfig=i?null==i?void 0:i.config:{id:generateUUID$1(),token:n.token}}get dumpConfig(){return this._dumpConfig}set dumpConfig(e){this._dumpConfig=e}dumpRecording(e){return V(this,null,(function*(){const t=yield Xe(BlackboxRecordingContext.prototype,this,"dumpRecording").call(this,e);return this.emit("dumped",t.id,this.dumpConfig),t.id}))}getDumpConfig(){return V(this,null,(function*(){return Promise.resolve(this.dumpConfig)}))}}var TransferPosition=(e=>(e.Worker="worker",e.Main="main",e))(TransferPosition||{});class RecordingContextTransferHandler{constructor(e){this.position=e}canHandle(e){return e instanceof RecordingContext}serialize(e){const{port1:t,port2:n}=new MessageChannel;if(e instanceof RecordingContext){const n={id:e.id,startTime:e.startTime,recording:e.recording,transmitter:e.transmitter,baseURL:e.baseURL,trackers:e.trackers};e instanceof BlackboxRecordingContext&&(n.dumpConfig=e.dumpConfig),t.postMessage({type:"RecordingContextManifest",value:{id:generateUUID$1(),staticProperties:n,exposeMethods:["on","once","off","stopRecording","cacheRecordings","dumpRecording","getDumpConfig","addListener","removeListener"]}})}return expose(e,t),[n,[n]]}deserialize(e){let t;const n=new Set,l=new Set,i=new Set,s=wrap(e),c=new Proxy(s,{get(e,s,c){const o=s;if(!t)throw new Error("RecordingContext manifest not found from worker");if(n.has(o))return t.staticProperties[o];if("toString"===o)return()=>JSON.stringify(null==t?void 0:t.staticProperties.recording);const a=Reflect.get(e,s,c);return l.has(o)?(...t)=>{const n=t.map((e=>{if("function"==typeof e){const t=proxy(e);return i.add(t),t}return e}));return Reflect.apply(a,e,[...n])}:"then"===s||s===releaseProxy?a:void 0}});return new Promise((i=>{const s=c=>{"object"==typeof c.data&&"RecordingContextManifest"===c.data.type&&(t=c.data.value,Object.keys(t.staticProperties).forEach((e=>{n.add(e)})),t.exposeMethods.forEach((e=>{l.add(e)})),i(),e.removeEventListener("message",s))};e.addEventListener("message",s,!0),e.start()})).then((()=>(c.once("stopped",(()=>{try{s[releaseProxy](),i.forEach((e=>{"function"==typeof e[releaseProxy]&&e[releaseProxy]()})),i.clear(),l.clear()}catch(e){console.error(e)}})),c)))}}function createRecordingManagerFromWorker(e){return wrap(e)}transferHandlers.set("RecordingContext",new RecordingContextTransferHandler(TransferPosition.Main));var RecorderMode=(e=>(e.Standard="standard",e.Multithreaded="multithreaded",e))(RecorderMode||{});const encodedJs="dmFyIGdlPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSx5ZT1PYmplY3QuZGVmaW5lUHJvcGVydGllczt2YXIgdmU9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnM7dmFyIHJlPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMsYmU9T2JqZWN0LmdldFByb3RvdHlwZU9mLGRlPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksZmU9T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZSxUZT1SZWZsZWN0LmdldDt2YXIgYWU9TWF0aC5wb3csb2U9KEEsTyxQKT0+TyBpbiBBP2dlKEEsTyx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6UH0pOkFbT109UCxOPShBLE8pPT57Zm9yKHZhciBQIGluIE98fChPPXt9KSlkZS5jYWxsKE8sUCkmJm9lKEEsUCxPW1BdKTtpZihyZSlmb3IodmFyIFAgb2YgcmUoTykpZmUuY2FsbChPLFApJiZvZShBLFAsT1tQXSk7cmV0dXJuIEF9LFE9KEEsTyk9PnllKEEsdmUoTykpO3ZhciBjZT0oQSxPKT0+e3ZhciBQPXt9O2Zvcih2YXIgayBpbiBBKWRlLmNhbGwoQSxrKSYmTy5pbmRleE9mKGspPDAmJihQW2tdPUFba10pO2lmKEEhPW51bGwmJnJlKWZvcih2YXIgayBvZiByZShBKSlPLmluZGV4T2Yoayk8MCYmZmUuY2FsbChBLGspJiYoUFtrXT1BW2tdKTtyZXR1cm4gUH07dmFyIGY9KEEsTyxQKT0+KG9lKEEsdHlwZW9mIE8hPSJzeW1ib2wiP08rIiI6TyxQKSxQKTt2YXIgcGU9KEEsTyxQKT0+VGUoYmUoQSksUCxPKTt2YXIgYj0oQSxPLFApPT5uZXcgUHJvbWlzZSgoayxyKT0+e3ZhciB0PXM9Pnt0cnl7bihQLm5leHQocykpfWNhdGNoKG8pe3Iobyl9fSxlPXM9Pnt0cnl7bihQLnRocm93KHMpKX1jYXRjaChvKXtyKG8pfX0sbj1zPT5zLmRvbmU/ayhzLnZhbHVlKTpQcm9taXNlLnJlc29sdmUocy52YWx1ZSkudGhlbih0LGUpO24oKFA9UC5hcHBseShBLE8pKS5uZXh0KCkpfSksbmU9ZnVuY3Rpb24oQSxPKXt0aGlzWzBdPUEsdGhpc1sxXT1PfSxtZT0oQSxPLFApPT57dmFyIGs9KGUsbixzLG8pPT57dHJ5e3ZhciBhPVBbZV0obiksYz0obj1hLnZhbHVlKWluc3RhbmNlb2YgbmUsbD1hLmRvbmU7UHJvbWlzZS5yZXNvbHZlKGM/blswXTpuKS50aGVuKHU9PmM/ayhlPT09InJldHVybiI/ZToibmV4dCIsblsxXT97ZG9uZTp1LmRvbmUsdmFsdWU6dS52YWx1ZX06dSxzLG8pOnMoe3ZhbHVlOnUsZG9uZTpsfSkpLmNhdGNoKHU9PmsoInRocm93Iix1LHMsbykpfWNhdGNoKHUpe28odSl9fSxyPWU9PnRbZV09bj0+bmV3IFByb21pc2UoKHMsbyk9PmsoZSxuLHMsbykpLHQ9e307cmV0dXJuIFA9UC5hcHBseShBLE8pLHRbU3ltYm9sLmFzeW5jSXRlcmF0b3JdPSgpPT50LHIoIm5leHQiKSxyKCJ0aHJvdyIpLHIoInJldHVybiIpLHR9OyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgY29tbW9uanNHbG9iYWw9dHlwZW9mIGdsb2JhbFRoaXMhPSJ1bmRlZmluZWQiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdyE9InVuZGVmaW5lZCI/d2luZG93OnR5cGVvZiBnbG9iYWwhPSJ1bmRlZmluZWQiP2dsb2JhbDp0eXBlb2Ygc2VsZiE9InVuZGVmaW5lZCI/c2VsZjp7fTtmdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyhyKXtyZXR1cm4gciYmci5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwociwiZGVmYXVsdCIpP3IuZGVmYXVsdDpyfXZhciBjaGVjayQxPWZ1bmN0aW9uKHIpe3JldHVybiByJiZyLk1hdGg9PT1NYXRoJiZyfSxnbG9iYWxUaGlzXzE9Y2hlY2skMSh0eXBlb2YgZ2xvYmFsVGhpcz09Im9iamVjdCImJmdsb2JhbFRoaXMpfHxjaGVjayQxKHR5cGVvZiB3aW5kb3c9PSJvYmplY3QiJiZ3aW5kb3cpfHxjaGVjayQxKHR5cGVvZiBzZWxmPT0ib2JqZWN0IiYmc2VsZil8fGNoZWNrJDEodHlwZW9mIGNvbW1vbmpzR2xvYmFsPT0ib2JqZWN0IiYmY29tbW9uanNHbG9iYWwpfHxjaGVjayQxKHR5cGVvZiBjb21tb25qc0dsb2JhbD09Im9iamVjdCImJmNvbW1vbmpzR2xvYmFsKXx8ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKXx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSxvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I9e30sZmFpbHMkOD1mdW5jdGlvbihyKXt0cnl7cmV0dXJuISFyKCl9Y2F0Y2godCl7cmV0dXJuITB9fSxmYWlscyQ3PWZhaWxzJDgsZGVzY3JpcHRvcnM9IWZhaWxzJDcoZnVuY3Rpb24oKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LDEse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pWzFdIT09N30pLGZhaWxzJDY9ZmFpbHMkOCxmdW5jdGlvbkJpbmROYXRpdmU9IWZhaWxzJDYoZnVuY3Rpb24oKXt2YXIgcj1mdW5jdGlvbigpe30uYmluZCgpO3JldHVybiB0eXBlb2YgciE9ImZ1bmN0aW9uInx8ci5oYXNPd25Qcm9wZXJ0eSgicHJvdG90eXBlIil9KSxOQVRJVkVfQklORCQxPWZ1bmN0aW9uQmluZE5hdGl2ZSxjYWxsJDQ9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsZnVuY3Rpb25DYWxsPU5BVElWRV9CSU5EJDE/Y2FsbCQ0LmJpbmQoY2FsbCQ0KTpmdW5jdGlvbigpe3JldHVybiBjYWxsJDQuYXBwbHkoY2FsbCQ0LGFyZ3VtZW50cyl9LG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlPXt9LCRwcm9wZXJ0eUlzRW51bWVyYWJsZT17fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSxnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLE5BU0hPUk5fQlVHPWdldE93blByb3BlcnR5RGVzY3JpcHRvciQxJiYhJHByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoezE6Mn0sMSk7b2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGUuZj1OQVNIT1JOX0JVRz9mdW5jdGlvbih0KXt2YXIgZT1nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMSh0aGlzLHQpO3JldHVybiEhZSYmZS5lbnVtZXJhYmxlfTokcHJvcGVydHlJc0VudW1lcmFibGU7dmFyIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQyPWZ1bmN0aW9uKHIsdCl7cmV0dXJue2VudW1lcmFibGU6IShyJjEpLGNvbmZpZ3VyYWJsZTohKHImMiksd3JpdGFibGU6IShyJjQpLHZhbHVlOnR9fSxOQVRJVkVfQklORD1mdW5jdGlvbkJpbmROYXRpdmUsRnVuY3Rpb25Qcm90b3R5cGUkMT1GdW5jdGlvbi5wcm90b3R5cGUsY2FsbCQzPUZ1bmN0aW9uUHJvdG90eXBlJDEuY2FsbCx1bmN1cnJ5VGhpc1dpdGhCaW5kPU5BVElWRV9CSU5EJiZGdW5jdGlvblByb3RvdHlwZSQxLmJpbmQuYmluZChjYWxsJDMsY2FsbCQzKSxmdW5jdGlvblVuY3VycnlUaGlzPU5BVElWRV9CSU5EP3VuY3VycnlUaGlzV2l0aEJpbmQ6ZnVuY3Rpb24ocil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGNhbGwkMy5hcHBseShyLGFyZ3VtZW50cyl9fSx1bmN1cnJ5VGhpcyQ4PWZ1bmN0aW9uVW5jdXJyeVRoaXMsdG9TdHJpbmckMj11bmN1cnJ5VGhpcyQ4KHt9LnRvU3RyaW5nKSxzdHJpbmdTbGljZSQxPXVuY3VycnlUaGlzJDgoIiIuc2xpY2UpLGNsYXNzb2ZSYXc9ZnVuY3Rpb24ocil7cmV0dXJuIHN0cmluZ1NsaWNlJDEodG9TdHJpbmckMihyKSw4LC0xKX0sdW5jdXJyeVRoaXMkNz1mdW5jdGlvblVuY3VycnlUaGlzLGZhaWxzJDU9ZmFpbHMkOCxjbGFzc29mPWNsYXNzb2ZSYXcsJE9iamVjdCQyPU9iamVjdCxzcGxpdD11bmN1cnJ5VGhpcyQ3KCIiLnNwbGl0KSxpbmRleGVkT2JqZWN0PWZhaWxzJDUoZnVuY3Rpb24oKXtyZXR1cm4hJE9iamVjdCQyKCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KT9mdW5jdGlvbihyKXtyZXR1cm4gY2xhc3NvZihyKT09PSJTdHJpbmciP3NwbGl0KHIsIiIpOiRPYmplY3QkMihyKX06JE9iamVjdCQyLGlzTnVsbE9yVW5kZWZpbmVkJDI9ZnVuY3Rpb24ocil7cmV0dXJuIHI9PW51bGx9LGlzTnVsbE9yVW5kZWZpbmVkJDE9aXNOdWxsT3JVbmRlZmluZWQkMiwkVHlwZUVycm9yJDU9VHlwZUVycm9yLHJlcXVpcmVPYmplY3RDb2VyY2libGUkMj1mdW5jdGlvbihyKXtpZihpc051bGxPclVuZGVmaW5lZCQxKHIpKXRocm93IG5ldyAkVHlwZUVycm9yJDUoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIrcik7cmV0dXJuIHJ9LEluZGV4ZWRPYmplY3Q9aW5kZXhlZE9iamVjdCxyZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDE9cmVxdWlyZU9iamVjdENvZXJjaWJsZSQyLHRvSW5kZXhlZE9iamVjdCQzPWZ1bmN0aW9uKHIpe3JldHVybiBJbmRleGVkT2JqZWN0KHJlcXVpcmVPYmplY3RDb2VyY2libGUkMShyKSl9LGRvY3VtZW50QWxsPXR5cGVvZiBkb2N1bWVudD09Im9iamVjdCImJmRvY3VtZW50LmFsbCxpc0NhbGxhYmxlJGE9dHlwZW9mIGRvY3VtZW50QWxsPT0idW5kZWZpbmVkIiYmZG9jdW1lbnRBbGwhPT12b2lkIDA/ZnVuY3Rpb24ocil7cmV0dXJuIHR5cGVvZiByPT0iZnVuY3Rpb24ifHxyPT09ZG9jdW1lbnRBbGx9OmZ1bmN0aW9uKHIpe3JldHVybiB0eXBlb2Ygcj09ImZ1bmN0aW9uIn0saXNDYWxsYWJsZSQ5PWlzQ2FsbGFibGUkYSxpc09iamVjdCQ2PWZ1bmN0aW9uKHIpe3JldHVybiB0eXBlb2Ygcj09Im9iamVjdCI/ciE9PW51bGw6aXNDYWxsYWJsZSQ5KHIpfSxnbG9iYWxUaGlzJGM9Z2xvYmFsVGhpc18xLGlzQ2FsbGFibGUkOD1pc0NhbGxhYmxlJGEsYUZ1bmN0aW9uPWZ1bmN0aW9uKHIpe3JldHVybiBpc0NhbGxhYmxlJDgocik/cjp2b2lkIDB9LGdldEJ1aWx0SW4kMj1mdW5jdGlvbihyLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/YUZ1bmN0aW9uKGdsb2JhbFRoaXMkY1tyXSk6Z2xvYmFsVGhpcyRjW3JdJiZnbG9iYWxUaGlzJGNbcl1bdF19LHVuY3VycnlUaGlzJDY9ZnVuY3Rpb25VbmN1cnJ5VGhpcyxvYmplY3RJc1Byb3RvdHlwZU9mPXVuY3VycnlUaGlzJDYoe30uaXNQcm90b3R5cGVPZiksZ2xvYmFsVGhpcyRiPWdsb2JhbFRoaXNfMSxuYXZpZ2F0b3I9Z2xvYmFsVGhpcyRiLm5hdmlnYXRvcix1c2VyQWdlbnQkMT1uYXZpZ2F0b3ImJm5hdmlnYXRvci51c2VyQWdlbnQsZW52aXJvbm1lbnRVc2VyQWdlbnQ9dXNlckFnZW50JDE/U3RyaW5nKHVzZXJBZ2VudCQxKToiIixnbG9iYWxUaGlzJGE9Z2xvYmFsVGhpc18xLHVzZXJBZ2VudD1lbnZpcm9ubWVudFVzZXJBZ2VudCxwcm9jZXNzJDE9Z2xvYmFsVGhpcyRhLnByb2Nlc3MsRGVubz1nbG9iYWxUaGlzJGEuRGVubyx2ZXJzaW9ucz1wcm9jZXNzJDEmJnByb2Nlc3MkMS52ZXJzaW9uc3x8RGVubyYmRGVuby52ZXJzaW9uLHY4PXZlcnNpb25zJiZ2ZXJzaW9ucy52OCxtYXRjaCx2ZXJzaW9uO3Y4JiYobWF0Y2g9djguc3BsaXQoIi4iKSx2ZXJzaW9uPW1hdGNoWzBdPjAmJm1hdGNoWzBdPDQ/MTorKG1hdGNoWzBdK21hdGNoWzFdKSksIXZlcnNpb24mJnVzZXJBZ2VudCYmKG1hdGNoPXVzZXJBZ2VudC5tYXRjaCgvRWRnZVwvKFxkKykvKSwoIW1hdGNofHxtYXRjaFsxXT49NzQpJiYobWF0Y2g9dXNlckFnZW50Lm1hdGNoKC9DaHJvbWVcLyhcZCspLyksbWF0Y2gmJih2ZXJzaW9uPSttYXRjaFsxXSkpKTt2YXIgZW52aXJvbm1lbnRWOFZlcnNpb249dmVyc2lvbixWOF9WRVJTSU9OPWVudmlyb25tZW50VjhWZXJzaW9uLGZhaWxzJDQ9ZmFpbHMkOCxnbG9iYWxUaGlzJDk9Z2xvYmFsVGhpc18xLCRTdHJpbmckMz1nbG9iYWxUaGlzJDkuU3RyaW5nLHN5bWJvbENvbnN0cnVjdG9yRGV0ZWN0aW9uPSEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyYmIWZhaWxzJDQoZnVuY3Rpb24oKXt2YXIgcj1TeW1ib2woInN5bWJvbCBkZXRlY3Rpb24iKTtyZXR1cm4hJFN0cmluZyQzKHIpfHwhKE9iamVjdChyKWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZWOF9WRVJTSU9OJiZWOF9WRVJTSU9OPDQxfSksTkFUSVZFX1NZTUJPTCQxPXN5bWJvbENvbnN0cnVjdG9yRGV0ZWN0aW9uLHVzZVN5bWJvbEFzVWlkPU5BVElWRV9TWU1CT0wkMSYmIVN5bWJvbC5zaGFtJiZ0eXBlb2YgU3ltYm9sLml0ZXJhdG9yPT0ic3ltYm9sIixnZXRCdWlsdEluJDE9Z2V0QnVpbHRJbiQyLGlzQ2FsbGFibGUkNz1pc0NhbGxhYmxlJGEsaXNQcm90b3R5cGVPZj1vYmplY3RJc1Byb3RvdHlwZU9mLFVTRV9TWU1CT0xfQVNfVUlEJDE9dXNlU3ltYm9sQXNVaWQsJE9iamVjdCQxPU9iamVjdCxpc1N5bWJvbCQyPVVTRV9TWU1CT0xfQVNfVUlEJDE/ZnVuY3Rpb24ocil7cmV0dXJuIHR5cGVvZiByPT0ic3ltYm9sIn06ZnVuY3Rpb24ocil7dmFyIHQ9Z2V0QnVpbHRJbiQxKCJTeW1ib2wiKTtyZXR1cm4gaXNDYWxsYWJsZSQ3KHQpJiZpc1Byb3RvdHlwZU9mKHQucHJvdG90eXBlLCRPYmplY3QkMShyKSl9LCRTdHJpbmckMj1TdHJpbmcsdHJ5VG9TdHJpbmckMT1mdW5jdGlvbihyKXt0cnl7cmV0dXJuICRTdHJpbmckMihyKX1jYXRjaCh0KXtyZXR1cm4iT2JqZWN0In19LGlzQ2FsbGFibGUkNj1pc0NhbGxhYmxlJGEsdHJ5VG9TdHJpbmc9dHJ5VG9TdHJpbmckMSwkVHlwZUVycm9yJDQ9VHlwZUVycm9yLGFDYWxsYWJsZSQxPWZ1bmN0aW9uKHIpe2lmKGlzQ2FsbGFibGUkNihyKSlyZXR1cm4gcjt0aHJvdyBuZXcgJFR5cGVFcnJvciQ0KHRyeVRvU3RyaW5nKHIpKyIgaXMgbm90IGEgZnVuY3Rpb24iKX0sYUNhbGxhYmxlPWFDYWxsYWJsZSQxLGlzTnVsbE9yVW5kZWZpbmVkPWlzTnVsbE9yVW5kZWZpbmVkJDIsZ2V0TWV0aG9kJDI9ZnVuY3Rpb24ocix0KXt2YXIgZT1yW3RdO3JldHVybiBpc051bGxPclVuZGVmaW5lZChlKT92b2lkIDA6YUNhbGxhYmxlKGUpfSxjYWxsJDI9ZnVuY3Rpb25DYWxsLGlzQ2FsbGFibGUkNT1pc0NhbGxhYmxlJGEsaXNPYmplY3QkNT1pc09iamVjdCQ2LCRUeXBlRXJyb3IkMz1UeXBlRXJyb3Isb3JkaW5hcnlUb1ByaW1pdGl2ZSQxPWZ1bmN0aW9uKHIsdCl7dmFyIGUsbjtpZih0PT09InN0cmluZyImJmlzQ2FsbGFibGUkNShlPXIudG9TdHJpbmcpJiYhaXNPYmplY3QkNShuPWNhbGwkMihlLHIpKXx8aXNDYWxsYWJsZSQ1KGU9ci52YWx1ZU9mKSYmIWlzT2JqZWN0JDUobj1jYWxsJDIoZSxyKSl8fHQhPT0ic3RyaW5nIiYmaXNDYWxsYWJsZSQ1KGU9ci50b1N0cmluZykmJiFpc09iamVjdCQ1KG49Y2FsbCQyKGUscikpKXJldHVybiBuO3Rocm93IG5ldyAkVHlwZUVycm9yJDMoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfSxzaGFyZWRTdG9yZT17ZXhwb3J0czp7fX0sZ2xvYmFsVGhpcyQ4PWdsb2JhbFRoaXNfMSxkZWZpbmVQcm9wZXJ0eSQxPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxkZWZpbmVHbG9iYWxQcm9wZXJ0eSQzPWZ1bmN0aW9uKHIsdCl7dHJ5e2RlZmluZVByb3BlcnR5JDEoZ2xvYmFsVGhpcyQ4LHIse3ZhbHVlOnQsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSl9Y2F0Y2goZSl7Z2xvYmFsVGhpcyQ4W3JdPXR9cmV0dXJuIHR9LGdsb2JhbFRoaXMkNz1nbG9iYWxUaGlzXzEsZGVmaW5lR2xvYmFsUHJvcGVydHkkMj1kZWZpbmVHbG9iYWxQcm9wZXJ0eSQzLFNIQVJFRD0iX19jb3JlLWpzX3NoYXJlZF9fIixzdG9yZSQzPXNoYXJlZFN0b3JlLmV4cG9ydHM9Z2xvYmFsVGhpcyQ3W1NIQVJFRF18fGRlZmluZUdsb2JhbFByb3BlcnR5JDIoU0hBUkVELHt9KTsoc3RvcmUkMy52ZXJzaW9uc3x8KHN0b3JlJDMudmVyc2lvbnM9W10pKS5wdXNoKHt2ZXJzaW9uOiIzLjM4LjEiLG1vZGU6Imdsb2JhbCIsY29weXJpZ2h0OiLCqSAyMDE0LTIwMjQgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkiLGxpY2Vuc2U6Imh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2Jsb2IvdjMuMzguMS9MSUNFTlNFIixzb3VyY2U6Imh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzIn0pO3ZhciBzaGFyZWRTdG9yZUV4cG9ydHM9c2hhcmVkU3RvcmUuZXhwb3J0cyxzdG9yZSQyPXNoYXJlZFN0b3JlRXhwb3J0cyxzaGFyZWQkMz1mdW5jdGlvbihyLHQpe3JldHVybiBzdG9yZSQyW3JdfHwoc3RvcmUkMltyXT10fHx7fSl9LHJlcXVpcmVPYmplY3RDb2VyY2libGU9cmVxdWlyZU9iamVjdENvZXJjaWJsZSQyLCRPYmplY3Q9T2JqZWN0LHRvT2JqZWN0JDE9ZnVuY3Rpb24ocil7cmV0dXJuICRPYmplY3QocmVxdWlyZU9iamVjdENvZXJjaWJsZShyKSl9LHVuY3VycnlUaGlzJDU9ZnVuY3Rpb25VbmN1cnJ5VGhpcyx0b09iamVjdD10b09iamVjdCQxLGhhc093blByb3BlcnR5PXVuY3VycnlUaGlzJDUoe30uaGFzT3duUHJvcGVydHkpLGhhc093blByb3BlcnR5XzE9T2JqZWN0Lmhhc093bnx8ZnVuY3Rpb24odCxlKXtyZXR1cm4gaGFzT3duUHJvcGVydHkodG9PYmplY3QodCksZSl9LHVuY3VycnlUaGlzJDQ9ZnVuY3Rpb25VbmN1cnJ5VGhpcyxpZD0wLHBvc3RmaXg9TWF0aC5yYW5kb20oKSx0b1N0cmluZyQxPXVuY3VycnlUaGlzJDQoMSAudG9TdHJpbmcpLHVpZCQyPWZ1bmN0aW9uKHIpe3JldHVybiJTeW1ib2woIisocj09PXZvaWQgMD8iIjpyKSsiKV8iK3RvU3RyaW5nJDEoKytpZCtwb3N0Zml4LDM2KX0sZ2xvYmFsVGhpcyQ2PWdsb2JhbFRoaXNfMSxzaGFyZWQkMj1zaGFyZWQkMyxoYXNPd24kNj1oYXNPd25Qcm9wZXJ0eV8xLHVpZCQxPXVpZCQyLE5BVElWRV9TWU1CT0w9c3ltYm9sQ29uc3RydWN0b3JEZXRlY3Rpb24sVVNFX1NZTUJPTF9BU19VSUQ9dXNlU3ltYm9sQXNVaWQsU3ltYm9sJDE9Z2xvYmFsVGhpcyQ2LlN5bWJvbCxXZWxsS25vd25TeW1ib2xzU3RvcmU9c2hhcmVkJDIoIndrcyIpLGNyZWF0ZVdlbGxLbm93blN5bWJvbD1VU0VfU1lNQk9MX0FTX1VJRD9TeW1ib2wkMS5mb3J8fFN5bWJvbCQxOlN5bWJvbCQxJiZTeW1ib2wkMS53aXRob3V0U2V0dGVyfHx1aWQkMSx3ZWxsS25vd25TeW1ib2wkMT1mdW5jdGlvbihyKXtyZXR1cm4gaGFzT3duJDYoV2VsbEtub3duU3ltYm9sc1N0b3JlLHIpfHwoV2VsbEtub3duU3ltYm9sc1N0b3JlW3JdPU5BVElWRV9TWU1CT0wmJmhhc093biQ2KFN5bWJvbCQxLHIpP1N5bWJvbCQxW3JdOmNyZWF0ZVdlbGxLbm93blN5bWJvbCgiU3ltYm9sLiIrcikpLFdlbGxLbm93blN5bWJvbHNTdG9yZVtyXX0sY2FsbCQxPWZ1bmN0aW9uQ2FsbCxpc09iamVjdCQ0PWlzT2JqZWN0JDYsaXNTeW1ib2wkMT1pc1N5bWJvbCQyLGdldE1ldGhvZCQxPWdldE1ldGhvZCQyLG9yZGluYXJ5VG9QcmltaXRpdmU9b3JkaW5hcnlUb1ByaW1pdGl2ZSQxLHdlbGxLbm93blN5bWJvbD13ZWxsS25vd25TeW1ib2wkMSwkVHlwZUVycm9yJDI9VHlwZUVycm9yLFRPX1BSSU1JVElWRT13ZWxsS25vd25TeW1ib2woInRvUHJpbWl0aXZlIiksdG9QcmltaXRpdmUkMT1mdW5jdGlvbihyLHQpe2lmKCFpc09iamVjdCQ0KHIpfHxpc1N5bWJvbCQxKHIpKXJldHVybiByO3ZhciBlPWdldE1ldGhvZCQxKHIsVE9fUFJJTUlUSVZFKSxuO2lmKGUpe2lmKHQ9PT12b2lkIDAmJih0PSJkZWZhdWx0Iiksbj1jYWxsJDEoZSxyLHQpLCFpc09iamVjdCQ0KG4pfHxpc1N5bWJvbCQxKG4pKXJldHVybiBuO3Rocm93IG5ldyAkVHlwZUVycm9yJDIoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfXJldHVybiB0PT09dm9pZCAwJiYodD0ibnVtYmVyIiksb3JkaW5hcnlUb1ByaW1pdGl2ZShyLHQpfSx0b1ByaW1pdGl2ZT10b1ByaW1pdGl2ZSQxLGlzU3ltYm9sPWlzU3ltYm9sJDIsdG9Qcm9wZXJ0eUtleSQyPWZ1bmN0aW9uKHIpe3ZhciB0PXRvUHJpbWl0aXZlKHIsInN0cmluZyIpO3JldHVybiBpc1N5bWJvbCh0KT90OnQrIiJ9LGdsb2JhbFRoaXMkNT1nbG9iYWxUaGlzXzEsaXNPYmplY3QkMz1pc09iamVjdCQ2LGRvY3VtZW50JDE9Z2xvYmFsVGhpcyQ1LmRvY3VtZW50LEVYSVNUUyQxPWlzT2JqZWN0JDMoZG9jdW1lbnQkMSkmJmlzT2JqZWN0JDMoZG9jdW1lbnQkMS5jcmVhdGVFbGVtZW50KSxkb2N1bWVudENyZWF0ZUVsZW1lbnQ9ZnVuY3Rpb24ocil7cmV0dXJuIEVYSVNUUyQxP2RvY3VtZW50JDEuY3JlYXRlRWxlbWVudChyKTp7fX0sREVTQ1JJUFRPUlMkNj1kZXNjcmlwdG9ycyxmYWlscyQzPWZhaWxzJDgsY3JlYXRlRWxlbWVudD1kb2N1bWVudENyZWF0ZUVsZW1lbnQsaWU4RG9tRGVmaW5lPSFERVNDUklQVE9SUyQ2JiYhZmFpbHMkMyhmdW5jdGlvbigpe3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3JlYXRlRWxlbWVudCgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hIT09N30pLERFU0NSSVBUT1JTJDU9ZGVzY3JpcHRvcnMsY2FsbD1mdW5jdGlvbkNhbGwscHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGU9b2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGUsY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDE9Y3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIsdG9JbmRleGVkT2JqZWN0JDI9dG9JbmRleGVkT2JqZWN0JDMsdG9Qcm9wZXJ0eUtleSQxPXRvUHJvcGVydHlLZXkkMixoYXNPd24kNT1oYXNPd25Qcm9wZXJ0eV8xLElFOF9ET01fREVGSU5FJDE9aWU4RG9tRGVmaW5lLCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO29iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvci5mPURFU0NSSVBUT1JTJDU/JGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxOmZ1bmN0aW9uKHQsZSl7aWYodD10b0luZGV4ZWRPYmplY3QkMih0KSxlPXRvUHJvcGVydHlLZXkkMShlKSxJRThfRE9NX0RFRklORSQxKXRyeXtyZXR1cm4gJGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxKHQsZSl9Y2F0Y2gobil7fWlmKGhhc093biQ1KHQsZSkpcmV0dXJuIGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQxKCFjYWxsKHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmYsdCxlKSx0W2VdKX07dmFyIG9iamVjdERlZmluZVByb3BlcnR5PXt9LERFU0NSSVBUT1JTJDQ9ZGVzY3JpcHRvcnMsZmFpbHMkMj1mYWlscyQ4LHY4UHJvdG90eXBlRGVmaW5lQnVnPURFU0NSSVBUT1JTJDQmJmZhaWxzJDIoZnVuY3Rpb24oKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGZ1bmN0aW9uKCl7fSwicHJvdG90eXBlIix7dmFsdWU6NDIsd3JpdGFibGU6ITF9KS5wcm90b3R5cGUhPT00Mn0pLGlzT2JqZWN0JDI9aXNPYmplY3QkNiwkU3RyaW5nJDE9U3RyaW5nLCRUeXBlRXJyb3IkMT1UeXBlRXJyb3IsYW5PYmplY3QkMj1mdW5jdGlvbihyKXtpZihpc09iamVjdCQyKHIpKXJldHVybiByO3Rocm93IG5ldyAkVHlwZUVycm9yJDEoJFN0cmluZyQxKHIpKyIgaXMgbm90IGFuIG9iamVjdCIpfSxERVNDUklQVE9SUyQzPWRlc2NyaXB0b3JzLElFOF9ET01fREVGSU5FPWllOERvbURlZmluZSxWOF9QUk9UT1RZUEVfREVGSU5FX0JVRz12OFByb3RvdHlwZURlZmluZUJ1Zyxhbk9iamVjdCQxPWFuT2JqZWN0JDIsdG9Qcm9wZXJ0eUtleT10b1Byb3BlcnR5S2V5JDIsJFR5cGVFcnJvcj1UeXBlRXJyb3IsJGRlZmluZVByb3BlcnR5PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSwkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsRU5VTUVSQUJMRT0iZW51bWVyYWJsZSIsQ09ORklHVVJBQkxFJDE9ImNvbmZpZ3VyYWJsZSIsV1JJVEFCTEU9IndyaXRhYmxlIjtvYmplY3REZWZpbmVQcm9wZXJ0eS5mPURFU0NSSVBUT1JTJDM/VjhfUFJPVE9UWVBFX0RFRklORV9CVUc/ZnVuY3Rpb24odCxlLG4pe2lmKGFuT2JqZWN0JDEodCksZT10b1Byb3BlcnR5S2V5KGUpLGFuT2JqZWN0JDEobiksdHlwZW9mIHQ9PSJmdW5jdGlvbiImJmU9PT0icHJvdG90eXBlIiYmInZhbHVlImluIG4mJldSSVRBQkxFIGluIG4mJiFuW1dSSVRBQkxFXSl7dmFyIHM9JGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LGUpO3MmJnNbV1JJVEFCTEVdJiYodFtlXT1uLnZhbHVlLG49e2NvbmZpZ3VyYWJsZTpDT05GSUdVUkFCTEUkMSBpbiBuP25bQ09ORklHVVJBQkxFJDFdOnNbQ09ORklHVVJBQkxFJDFdLGVudW1lcmFibGU6RU5VTUVSQUJMRSBpbiBuP25bRU5VTUVSQUJMRV06c1tFTlVNRVJBQkxFXSx3cml0YWJsZTohMX0pfXJldHVybiAkZGVmaW5lUHJvcGVydHkodCxlLG4pfTokZGVmaW5lUHJvcGVydHk6ZnVuY3Rpb24odCxlLG4pe2lmKGFuT2JqZWN0JDEodCksZT10b1Byb3BlcnR5S2V5KGUpLGFuT2JqZWN0JDEobiksSUU4X0RPTV9ERUZJTkUpdHJ5e3JldHVybiAkZGVmaW5lUHJvcGVydHkodCxlLG4pfWNhdGNoKHMpe31pZigiZ2V0ImluIG58fCJzZXQiaW4gbil0aHJvdyBuZXcgJFR5cGVFcnJvcigiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTtyZXR1cm4idmFsdWUiaW4gbiYmKHRbZV09bi52YWx1ZSksdH07dmFyIERFU0NSSVBUT1JTJDI9ZGVzY3JpcHRvcnMsZGVmaW5lUHJvcGVydHlNb2R1bGUkMj1vYmplY3REZWZpbmVQcm9wZXJ0eSxjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3I9Y3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIsY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDI9REVTQ1JJUFRPUlMkMj9mdW5jdGlvbihyLHQsZSl7cmV0dXJuIGRlZmluZVByb3BlcnR5TW9kdWxlJDIuZihyLHQsY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDEsZSkpfTpmdW5jdGlvbihyLHQsZSl7cmV0dXJuIHJbdF09ZSxyfSxtYWtlQnVpbHRJbiQyPXtleHBvcnRzOnt9fSxERVNDUklQVE9SUyQxPWRlc2NyaXB0b3JzLGhhc093biQ0PWhhc093blByb3BlcnR5XzEsRnVuY3Rpb25Qcm90b3R5cGU9RnVuY3Rpb24ucHJvdG90eXBlLGdldERlc2NyaXB0b3I9REVTQ1JJUFRPUlMkMSYmT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixFWElTVFM9aGFzT3duJDQoRnVuY3Rpb25Qcm90b3R5cGUsIm5hbWUiKSxQUk9QRVI9RVhJU1RTJiZmdW5jdGlvbigpe30ubmFtZT09PSJzb21ldGhpbmciLENPTkZJR1VSQUJMRT1FWElTVFMmJighREVTQ1JJUFRPUlMkMXx8REVTQ1JJUFRPUlMkMSYmZ2V0RGVzY3JpcHRvcihGdW5jdGlvblByb3RvdHlwZSwibmFtZSIpLmNvbmZpZ3VyYWJsZSksZnVuY3Rpb25OYW1lPXtFWElTVFMsUFJPUEVSLENPTkZJR1VSQUJMRX0sdW5jdXJyeVRoaXMkMz1mdW5jdGlvblVuY3VycnlUaGlzLGlzQ2FsbGFibGUkND1pc0NhbGxhYmxlJGEsc3RvcmUkMT1zaGFyZWRTdG9yZUV4cG9ydHMsZnVuY3Rpb25Ub1N0cmluZz11bmN1cnJ5VGhpcyQzKEZ1bmN0aW9uLnRvU3RyaW5nKTtpc0NhbGxhYmxlJDQoc3RvcmUkMS5pbnNwZWN0U291cmNlKXx8KHN0b3JlJDEuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbihyKXtyZXR1cm4gZnVuY3Rpb25Ub1N0cmluZyhyKX0pO3ZhciBpbnNwZWN0U291cmNlJDE9c3RvcmUkMS5pbnNwZWN0U291cmNlLGdsb2JhbFRoaXMkND1nbG9iYWxUaGlzXzEsaXNDYWxsYWJsZSQzPWlzQ2FsbGFibGUkYSxXZWFrTWFwJDI9Z2xvYmFsVGhpcyQ0LldlYWtNYXAsd2Vha01hcEJhc2ljRGV0ZWN0aW9uPWlzQ2FsbGFibGUkMyhXZWFrTWFwJDIpJiYvbmF0aXZlIGNvZGUvLnRlc3QoU3RyaW5nKFdlYWtNYXAkMikpLHNoYXJlZCQxPXNoYXJlZCQzLHVpZD11aWQkMixrZXlzJDE9c2hhcmVkJDEoImtleXMiKSxzaGFyZWRLZXkkMT1mdW5jdGlvbihyKXtyZXR1cm4ga2V5cyQxW3JdfHwoa2V5cyQxW3JdPXVpZChyKSl9LGhpZGRlbktleXMkMz17fSxOQVRJVkVfV0VBS19NQVA9d2Vha01hcEJhc2ljRGV0ZWN0aW9uLGdsb2JhbFRoaXMkMz1nbG9iYWxUaGlzXzEsaXNPYmplY3QkMT1pc09iamVjdCQ2LGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQxPWNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQyLGhhc093biQzPWhhc093blByb3BlcnR5XzEsc2hhcmVkPXNoYXJlZFN0b3JlRXhwb3J0cyxzaGFyZWRLZXk9c2hhcmVkS2V5JDEsaGlkZGVuS2V5cyQyPWhpZGRlbktleXMkMyxPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRD0iT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLFR5cGVFcnJvciQxPWdsb2JhbFRoaXMkMy5UeXBlRXJyb3IsV2Vha01hcCQxPWdsb2JhbFRoaXMkMy5XZWFrTWFwLHNldCxnZXQkMSxoYXMsZW5mb3JjZT1mdW5jdGlvbihyKXtyZXR1cm4gaGFzKHIpP2dldCQxKHIpOnNldChyLHt9KX0sZ2V0dGVyRm9yPWZ1bmN0aW9uKHIpe3JldHVybiBmdW5jdGlvbih0KXt2YXIgZTtpZighaXNPYmplY3QkMSh0KXx8KGU9Z2V0JDEodCkpLnR5cGUhPT1yKXRocm93IG5ldyBUeXBlRXJyb3IkMSgiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiK3IrIiByZXF1aXJlZCIpO3JldHVybiBlfX07aWYoTkFUSVZFX1dFQUtfTUFQfHxzaGFyZWQuc3RhdGUpe3ZhciBzdG9yZT1zaGFyZWQuc3RhdGV8fChzaGFyZWQuc3RhdGU9bmV3IFdlYWtNYXAkMSk7c3RvcmUuZ2V0PXN0b3JlLmdldCxzdG9yZS5oYXM9c3RvcmUuaGFzLHN0b3JlLnNldD1zdG9yZS5zZXQsc2V0PWZ1bmN0aW9uKHIsdCl7aWYoc3RvcmUuaGFzKHIpKXRocm93IG5ldyBUeXBlRXJyb3IkMShPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCk7cmV0dXJuIHQuZmFjYWRlPXIsc3RvcmUuc2V0KHIsdCksdH0sZ2V0JDE9ZnVuY3Rpb24ocil7cmV0dXJuIHN0b3JlLmdldChyKXx8e319LGhhcz1mdW5jdGlvbihyKXtyZXR1cm4gc3RvcmUuaGFzKHIpfX1lbHNle3ZhciBTVEFURT1zaGFyZWRLZXkoInN0YXRlIik7aGlkZGVuS2V5cyQyW1NUQVRFXT0hMCxzZXQ9ZnVuY3Rpb24ocix0KXtpZihoYXNPd24kMyhyLFNUQVRFKSl0aHJvdyBuZXcgVHlwZUVycm9yJDEoT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQpO3JldHVybiB0LmZhY2FkZT1yLGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQxKHIsU1RBVEUsdCksdH0sZ2V0JDE9ZnVuY3Rpb24ocil7cmV0dXJuIGhhc093biQzKHIsU1RBVEUpP3JbU1RBVEVdOnt9fSxoYXM9ZnVuY3Rpb24ocil7cmV0dXJuIGhhc093biQzKHIsU1RBVEUpfX12YXIgaW50ZXJuYWxTdGF0ZT17c2V0LGdldDpnZXQkMSxoYXMsZW5mb3JjZSxnZXR0ZXJGb3J9LHVuY3VycnlUaGlzJDI9ZnVuY3Rpb25VbmN1cnJ5VGhpcyxmYWlscyQxPWZhaWxzJDgsaXNDYWxsYWJsZSQyPWlzQ2FsbGFibGUkYSxoYXNPd24kMj1oYXNPd25Qcm9wZXJ0eV8xLERFU0NSSVBUT1JTPWRlc2NyaXB0b3JzLENPTkZJR1VSQUJMRV9GVU5DVElPTl9OQU1FPWZ1bmN0aW9uTmFtZS5DT05GSUdVUkFCTEUsaW5zcGVjdFNvdXJjZT1pbnNwZWN0U291cmNlJDEsSW50ZXJuYWxTdGF0ZU1vZHVsZT1pbnRlcm5hbFN0YXRlLGVuZm9yY2VJbnRlcm5hbFN0YXRlPUludGVybmFsU3RhdGVNb2R1bGUuZW5mb3JjZSxnZXRJbnRlcm5hbFN0YXRlPUludGVybmFsU3RhdGVNb2R1bGUuZ2V0LCRTdHJpbmc9U3RyaW5nLGRlZmluZVByb3BlcnR5PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxzdHJpbmdTbGljZT11bmN1cnJ5VGhpcyQyKCIiLnNsaWNlKSxyZXBsYWNlPXVuY3VycnlUaGlzJDIoIiIucmVwbGFjZSksam9pbj11bmN1cnJ5VGhpcyQyKFtdLmpvaW4pLENPTkZJR1VSQUJMRV9MRU5HVEg9REVTQ1JJUFRPUlMmJiFmYWlscyQxKGZ1bmN0aW9uKCl7cmV0dXJuIGRlZmluZVByb3BlcnR5KGZ1bmN0aW9uKCl7fSwibGVuZ3RoIix7dmFsdWU6OH0pLmxlbmd0aCE9PTh9KSxURU1QTEFURT1TdHJpbmcoU3RyaW5nKS5zcGxpdCgiU3RyaW5nIiksbWFrZUJ1aWx0SW4kMT1tYWtlQnVpbHRJbiQyLmV4cG9ydHM9ZnVuY3Rpb24ocix0LGUpe3N0cmluZ1NsaWNlKCRTdHJpbmcodCksMCw3KT09PSJTeW1ib2woIiYmKHQ9IlsiK3JlcGxhY2UoJFN0cmluZyh0KSwvXlN5bWJvbFwoKFteKV0qKVwpLiokLywiJDEiKSsiXSIpLGUmJmUuZ2V0dGVyJiYodD0iZ2V0ICIrdCksZSYmZS5zZXR0ZXImJih0PSJzZXQgIit0KSwoIWhhc093biQyKHIsIm5hbWUiKXx8Q09ORklHVVJBQkxFX0ZVTkNUSU9OX05BTUUmJnIubmFtZSE9PXQpJiYoREVTQ1JJUFRPUlM/ZGVmaW5lUHJvcGVydHkociwibmFtZSIse3ZhbHVlOnQsY29uZmlndXJhYmxlOiEwfSk6ci5uYW1lPXQpLENPTkZJR1VSQUJMRV9MRU5HVEgmJmUmJmhhc093biQyKGUsImFyaXR5IikmJnIubGVuZ3RoIT09ZS5hcml0eSYmZGVmaW5lUHJvcGVydHkociwibGVuZ3RoIix7dmFsdWU6ZS5hcml0eX0pO3RyeXtlJiZoYXNPd24kMihlLCJjb25zdHJ1Y3RvciIpJiZlLmNvbnN0cnVjdG9yP0RFU0NSSVBUT1JTJiZkZWZpbmVQcm9wZXJ0eShyLCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pOnIucHJvdG90eXBlJiYoci5wcm90b3R5cGU9dm9pZCAwKX1jYXRjaChzKXt9dmFyIG49ZW5mb3JjZUludGVybmFsU3RhdGUocik7cmV0dXJuIGhhc093biQyKG4sInNvdXJjZSIpfHwobi5zb3VyY2U9am9pbihURU1QTEFURSx0eXBlb2YgdD09InN0cmluZyI/dDoiIikpLHJ9O0Z1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZz1tYWtlQnVpbHRJbiQxKGZ1bmN0aW9uKCl7cmV0dXJuIGlzQ2FsbGFibGUkMih0aGlzKSYmZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKS5zb3VyY2V8fGluc3BlY3RTb3VyY2UodGhpcyl9LCJ0b1N0cmluZyIpO3ZhciBtYWtlQnVpbHRJbkV4cG9ydHM9bWFrZUJ1aWx0SW4kMi5leHBvcnRzLGlzQ2FsbGFibGUkMT1pc0NhbGxhYmxlJGEsZGVmaW5lUHJvcGVydHlNb2R1bGUkMT1vYmplY3REZWZpbmVQcm9wZXJ0eSxtYWtlQnVpbHRJbj1tYWtlQnVpbHRJbkV4cG9ydHMsZGVmaW5lR2xvYmFsUHJvcGVydHkkMT1kZWZpbmVHbG9iYWxQcm9wZXJ0eSQzLGRlZmluZUJ1aWx0SW4kMT1mdW5jdGlvbihyLHQsZSxuKXtufHwobj17fSk7dmFyIHM9bi5lbnVtZXJhYmxlLG89bi5uYW1lIT09dm9pZCAwP24ubmFtZTp0O2lmKGlzQ2FsbGFibGUkMShlKSYmbWFrZUJ1aWx0SW4oZSxvLG4pLG4uZ2xvYmFsKXM/clt0XT1lOmRlZmluZUdsb2JhbFByb3BlcnR5JDEodCxlKTtlbHNle3RyeXtuLnVuc2FmZT9yW3RdJiYocz0hMCk6ZGVsZXRlIHJbdF19Y2F0Y2goYSl7fXM/clt0XT1lOmRlZmluZVByb3BlcnR5TW9kdWxlJDEuZihyLHQse3ZhbHVlOmUsZW51bWVyYWJsZTohMSxjb25maWd1cmFibGU6IW4ubm9uQ29uZmlndXJhYmxlLHdyaXRhYmxlOiFuLm5vbldyaXRhYmxlfSl9cmV0dXJuIHJ9LG9iamVjdEdldE93blByb3BlcnR5TmFtZXM9e30sY2VpbD1NYXRoLmNlaWwsZmxvb3I9TWF0aC5mbG9vcixtYXRoVHJ1bmM9TWF0aC50cnVuY3x8ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuKGU+MD9mbG9vcjpjZWlsKShlKX0sdHJ1bmM9bWF0aFRydW5jLHRvSW50ZWdlck9ySW5maW5pdHkkMj1mdW5jdGlvbihyKXt2YXIgdD0rcjtyZXR1cm4gdCE9PXR8fHQ9PT0wPzA6dHJ1bmModCl9LHRvSW50ZWdlck9ySW5maW5pdHkkMT10b0ludGVnZXJPckluZmluaXR5JDIsbWF4PU1hdGgubWF4LG1pbiQxPU1hdGgubWluLHRvQWJzb2x1dGVJbmRleCQxPWZ1bmN0aW9uKHIsdCl7dmFyIGU9dG9JbnRlZ2VyT3JJbmZpbml0eSQxKHIpO3JldHVybiBlPDA/bWF4KGUrdCwwKTptaW4kMShlLHQpfSx0b0ludGVnZXJPckluZmluaXR5PXRvSW50ZWdlck9ySW5maW5pdHkkMixtaW49TWF0aC5taW4sdG9MZW5ndGgkMT1mdW5jdGlvbihyKXt2YXIgdD10b0ludGVnZXJPckluZmluaXR5KHIpO3JldHVybiB0PjA/bWluKHQsOTAwNzE5OTI1NDc0MDk5MSk6MH0sdG9MZW5ndGg9dG9MZW5ndGgkMSxsZW5ndGhPZkFycmF5TGlrZSQxPWZ1bmN0aW9uKHIpe3JldHVybiB0b0xlbmd0aChyLmxlbmd0aCl9LHRvSW5kZXhlZE9iamVjdCQxPXRvSW5kZXhlZE9iamVjdCQzLHRvQWJzb2x1dGVJbmRleD10b0Fic29sdXRlSW5kZXgkMSxsZW5ndGhPZkFycmF5TGlrZT1sZW5ndGhPZkFycmF5TGlrZSQxLGNyZWF0ZU1ldGhvZD1mdW5jdGlvbihyKXtyZXR1cm4gZnVuY3Rpb24odCxlLG4pe3ZhciBzPXRvSW5kZXhlZE9iamVjdCQxKHQpLG89bGVuZ3RoT2ZBcnJheUxpa2Uocyk7aWYobz09PTApcmV0dXJuIXImJi0xO3ZhciBhPXRvQWJzb2x1dGVJbmRleChuLG8pLGM7aWYociYmZSE9PWUpe2Zvcig7bz5hOylpZihjPXNbYSsrXSxjIT09YylyZXR1cm4hMH1lbHNlIGZvcig7bz5hO2ErKylpZigocnx8YSBpbiBzKSYmc1thXT09PWUpcmV0dXJuIHJ8fGF8fDA7cmV0dXJuIXImJi0xfX0sYXJyYXlJbmNsdWRlcz17aW5jbHVkZXM6Y3JlYXRlTWV0aG9kKCEwKSxpbmRleE9mOmNyZWF0ZU1ldGhvZCghMSl9LHVuY3VycnlUaGlzJDE9ZnVuY3Rpb25VbmN1cnJ5VGhpcyxoYXNPd24kMT1oYXNPd25Qcm9wZXJ0eV8xLHRvSW5kZXhlZE9iamVjdD10b0luZGV4ZWRPYmplY3QkMyxpbmRleE9mPWFycmF5SW5jbHVkZXMuaW5kZXhPZixoaWRkZW5LZXlzJDE9aGlkZGVuS2V5cyQzLHB1c2g9dW5jdXJyeVRoaXMkMShbXS5wdXNoKSxvYmplY3RLZXlzSW50ZXJuYWw9ZnVuY3Rpb24ocix0KXt2YXIgZT10b0luZGV4ZWRPYmplY3Qociksbj0wLHM9W10sbztmb3IobyBpbiBlKSFoYXNPd24kMShoaWRkZW5LZXlzJDEsbykmJmhhc093biQxKGUsbykmJnB1c2gocyxvKTtmb3IoO3QubGVuZ3RoPm47KWhhc093biQxKGUsbz10W24rK10pJiYofmluZGV4T2YocyxvKXx8cHVzaChzLG8pKTtyZXR1cm4gc30sZW51bUJ1Z0tleXMkMT1bImNvbnN0cnVjdG9yIiwiaGFzT3duUHJvcGVydHkiLCJpc1Byb3RvdHlwZU9mIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJ0b0xvY2FsZVN0cmluZyIsInRvU3RyaW5nIiwidmFsdWVPZiJdLGludGVybmFsT2JqZWN0S2V5cz1vYmplY3RLZXlzSW50ZXJuYWwsZW51bUJ1Z0tleXM9ZW51bUJ1Z0tleXMkMSxoaWRkZW5LZXlzPWVudW1CdWdLZXlzLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIik7b2JqZWN0R2V0T3duUHJvcGVydHlOYW1lcy5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzfHxmdW5jdGlvbih0KXtyZXR1cm4gaW50ZXJuYWxPYmplY3RLZXlzKHQsaGlkZGVuS2V5cyl9O3ZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHM9e307b2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzLmY9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczt2YXIgZ2V0QnVpbHRJbj1nZXRCdWlsdEluJDIsdW5jdXJyeVRoaXM9ZnVuY3Rpb25VbmN1cnJ5VGhpcyxnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlPW9iamVjdEdldE93blByb3BlcnR5TmFtZXMsZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlPW9iamVjdEdldE93blByb3BlcnR5U3ltYm9scyxhbk9iamVjdD1hbk9iamVjdCQyLGNvbmNhdD11bmN1cnJ5VGhpcyhbXS5jb25jYXQpLG93bktleXMkMT1nZXRCdWlsdEluKCJSZWZsZWN0Iiwib3duS2V5cyIpfHxmdW5jdGlvbih0KXt2YXIgZT1nZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlLmYoYW5PYmplY3QodCkpLG49Z2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlLmY7cmV0dXJuIG4/Y29uY2F0KGUsbih0KSk6ZX0saGFzT3duPWhhc093blByb3BlcnR5XzEsb3duS2V5cz1vd25LZXlzJDEsZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlPW9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvcixkZWZpbmVQcm9wZXJ0eU1vZHVsZT1vYmplY3REZWZpbmVQcm9wZXJ0eSxjb3B5Q29uc3RydWN0b3JQcm9wZXJ0aWVzJDE9ZnVuY3Rpb24ocix0LGUpe2Zvcih2YXIgbj1vd25LZXlzKHQpLHM9ZGVmaW5lUHJvcGVydHlNb2R1bGUuZixvPWdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mLGE9MDthPG4ubGVuZ3RoO2ErKyl7dmFyIGM9blthXTshaGFzT3duKHIsYykmJiEoZSYmaGFzT3duKGUsYykpJiZzKHIsYyxvKHQsYykpfX0sZmFpbHM9ZmFpbHMkOCxpc0NhbGxhYmxlPWlzQ2FsbGFibGUkYSxyZXBsYWNlbWVudD0vI3xcLnByb3RvdHlwZVwuLyxpc0ZvcmNlZCQxPWZ1bmN0aW9uKHIsdCl7dmFyIGU9ZGF0YVtub3JtYWxpemUocildO3JldHVybiBlPT09UE9MWUZJTEw/ITA6ZT09PU5BVElWRT8hMTppc0NhbGxhYmxlKHQpP2ZhaWxzKHQpOiEhdH0sbm9ybWFsaXplPWlzRm9yY2VkJDEubm9ybWFsaXplPWZ1bmN0aW9uKHIpe3JldHVybiBTdHJpbmcocikucmVwbGFjZShyZXBsYWNlbWVudCwiLiIpLnRvTG93ZXJDYXNlKCl9LGRhdGE9aXNGb3JjZWQkMS5kYXRhPXt9LE5BVElWRT1pc0ZvcmNlZCQxLk5BVElWRT0iTiIsUE9MWUZJTEw9aXNGb3JjZWQkMS5QT0xZRklMTD0iUCIsaXNGb3JjZWRfMT1pc0ZvcmNlZCQxLGdsb2JhbFRoaXMkMj1nbG9iYWxUaGlzXzEsZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yPW9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvci5mLGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eT1jcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMixkZWZpbmVCdWlsdEluPWRlZmluZUJ1aWx0SW4kMSxkZWZpbmVHbG9iYWxQcm9wZXJ0eT1kZWZpbmVHbG9iYWxQcm9wZXJ0eSQzLGNvcHlDb25zdHJ1Y3RvclByb3BlcnRpZXM9Y29weUNvbnN0cnVjdG9yUHJvcGVydGllcyQxLGlzRm9yY2VkPWlzRm9yY2VkXzEsX2V4cG9ydD1mdW5jdGlvbihyLHQpe3ZhciBlPXIudGFyZ2V0LG49ci5nbG9iYWwscz1yLnN0YXQsbyxhLGMsbCx1LGg7aWYobj9hPWdsb2JhbFRoaXMkMjpzP2E9Z2xvYmFsVGhpcyQyW2VdfHxkZWZpbmVHbG9iYWxQcm9wZXJ0eShlLHt9KTphPWdsb2JhbFRoaXMkMltlXSYmZ2xvYmFsVGhpcyQyW2VdLnByb3RvdHlwZSxhKWZvcihjIGluIHQpe2lmKHU9dFtjXSxyLmRvbnRDYWxsR2V0U2V0PyhoPWdldE93blByb3BlcnR5RGVzY3JpcHRvcihhLGMpLGw9aCYmaC52YWx1ZSk6bD1hW2NdLG89aXNGb3JjZWQobj9jOmUrKHM/Ii4iOiIjIikrYyxyLmZvcmNlZCksIW8mJmwhPT12b2lkIDApe2lmKHR5cGVvZiB1PT10eXBlb2YgbCljb250aW51ZTtjb3B5Q29uc3RydWN0b3JQcm9wZXJ0aWVzKHUsbCl9KHIuc2hhbXx8bCYmbC5zaGFtKSYmY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KHUsInNoYW0iLCEwKSxkZWZpbmVCdWlsdEluKGEsYyx1LHIpfX0sJD1fZXhwb3J0LGdsb2JhbFRoaXMkMT1nbG9iYWxUaGlzXzE7JCh7Z2xvYmFsOiEwLGZvcmNlZDpnbG9iYWxUaGlzJDEuZ2xvYmFsVGhpcyE9PWdsb2JhbFRoaXMkMX0se2dsb2JhbFRoaXM6Z2xvYmFsVGhpcyQxfSk7LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjAKICovY29uc3QgcHJveHlNYXJrZXI9U3ltYm9sKCJDb21saW5rLnByb3h5IiksY3JlYXRlRW5kcG9pbnQ9U3ltYm9sKCJDb21saW5rLmVuZHBvaW50IikscmVsZWFzZVByb3h5PVN5bWJvbCgiQ29tbGluay5yZWxlYXNlUHJveHkiKSxmaW5hbGl6ZXI9U3ltYm9sKCJDb21saW5rLmZpbmFsaXplciIpLHRocm93TWFya2VyPVN5bWJvbCgiQ29tbGluay50aHJvd24iKSxpc09iamVjdD1yPT50eXBlb2Ygcj09Im9iamVjdCImJnIhPT1udWxsfHx0eXBlb2Ygcj09ImZ1bmN0aW9uIixwcm94eVRyYW5zZmVySGFuZGxlcj17Y2FuSGFuZGxlOnI9PmlzT2JqZWN0KHIpJiZyW3Byb3h5TWFya2VyXSxzZXJpYWxpemUocil7Y29uc3R7cG9ydDE6dCxwb3J0MjplfT1uZXcgTWVzc2FnZUNoYW5uZWw7cmV0dXJuIGV4cG9zZShyLHQpLFtlLFtlXV19LGRlc2VyaWFsaXplKHIpe3JldHVybiByLnN0YXJ0KCksd3JhcCQxKHIpfX0sdGhyb3dUcmFuc2ZlckhhbmRsZXI9e2NhbkhhbmRsZTpyPT5pc09iamVjdChyKSYmdGhyb3dNYXJrZXIgaW4gcixzZXJpYWxpemUoe3ZhbHVlOnJ9KXtsZXQgdDtyZXR1cm4gciBpbnN0YW5jZW9mIEVycm9yP3Q9e2lzRXJyb3I6ITAsdmFsdWU6e21lc3NhZ2U6ci5tZXNzYWdlLG5hbWU6ci5uYW1lLHN0YWNrOnIuc3RhY2t9fTp0PXtpc0Vycm9yOiExLHZhbHVlOnJ9LFt0LFtdXX0sZGVzZXJpYWxpemUocil7dGhyb3cgci5pc0Vycm9yP09iamVjdC5hc3NpZ24obmV3IEVycm9yKHIudmFsdWUubWVzc2FnZSksci52YWx1ZSk6ci52YWx1ZX19LHRyYW5zZmVySGFuZGxlcnM9bmV3IE1hcChbWyJwcm94eSIscHJveHlUcmFuc2ZlckhhbmRsZXJdLFsidGhyb3ciLHRocm93VHJhbnNmZXJIYW5kbGVyXV0pO2Z1bmN0aW9uIGlzQWxsb3dlZE9yaWdpbihyLHQpe2Zvcihjb25zdCBlIG9mIHIpaWYodD09PWV8fGU9PT0iKiJ8fGUgaW5zdGFuY2VvZiBSZWdFeHAmJmUudGVzdCh0KSlyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiBleHBvc2Uocix0PWdsb2JhbFRoaXMsZT1bIioiXSl7dC5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbiBuKHMpe2lmKCFzfHwhcy5kYXRhKXJldHVybjtpZighaXNBbGxvd2VkT3JpZ2luKGUscy5vcmlnaW4pKXtjb25zb2xlLndhcm4oYEludmFsaWQgb3JpZ2luICcke3Mub3JpZ2lufScgZm9yIGNvbWxpbmsgcHJveHlgKTtyZXR1cm59Y29uc3R7aWQ6byx0eXBlOmEscGF0aDpjfT1PYmplY3QuYXNzaWduKHtwYXRoOltdfSxzLmRhdGEpLGw9KHMuZGF0YS5hcmd1bWVudExpc3R8fFtdKS5tYXAoZnJvbVdpcmVWYWx1ZSk7bGV0IHU7dHJ5e2NvbnN0IGg9Yy5zbGljZSgwLC0xKS5yZWR1Y2UoKG0sdik9Pm1bdl0scikscD1jLnJlZHVjZSgobSx2KT0+bVt2XSxyKTtzd2l0Y2goYSl7Y2FzZSJHRVQiOnU9cDticmVhaztjYXNlIlNFVCI6aFtjLnNsaWNlKC0xKVswXV09ZnJvbVdpcmVWYWx1ZShzLmRhdGEudmFsdWUpLHU9ITA7YnJlYWs7Y2FzZSJBUFBMWSI6dT1wLmFwcGx5KGgsbCk7YnJlYWs7Y2FzZSJDT05TVFJVQ1QiOntjb25zdCBtPW5ldyBwKC4uLmwpO3U9cHJveHkobSl9YnJlYWs7Y2FzZSJFTkRQT0lOVCI6e2NvbnN0e3BvcnQxOm0scG9ydDI6dn09bmV3IE1lc3NhZ2VDaGFubmVsO2V4cG9zZShyLHYpLHU9dHJhbnNmZXIobSxbbV0pfWJyZWFrO2Nhc2UiUkVMRUFTRSI6dT12b2lkIDA7YnJlYWs7ZGVmYXVsdDpyZXR1cm59fWNhdGNoKGgpe3U9e3ZhbHVlOmgsW3Rocm93TWFya2VyXTowfX1Qcm9taXNlLnJlc29sdmUodSkuY2F0Y2goaD0+KHt2YWx1ZTpoLFt0aHJvd01hcmtlcl06MH0pKS50aGVuKGg9Pntjb25zdFtwLG1dPXRvV2lyZVZhbHVlKGgpO3QucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHApLHtpZDpvfSksbSksYT09PSJSRUxFQVNFIiYmKHQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsbiksY2xvc2VFbmRQb2ludCh0KSxmaW5hbGl6ZXIgaW4gciYmdHlwZW9mIHJbZmluYWxpemVyXT09ImZ1bmN0aW9uIiYmcltmaW5hbGl6ZXJdKCkpfSkuY2F0Y2goaD0+e2NvbnN0W3AsbV09dG9XaXJlVmFsdWUoe3ZhbHVlOm5ldyBUeXBlRXJyb3IoIlVuc2VyaWFsaXphYmxlIHJldHVybiB2YWx1ZSIpLFt0aHJvd01hcmtlcl06MH0pO3QucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHApLHtpZDpvfSksbSl9KX0pLHQuc3RhcnQmJnQuc3RhcnQoKX1mdW5jdGlvbiBpc01lc3NhZ2VQb3J0KHIpe3JldHVybiByLmNvbnN0cnVjdG9yLm5hbWU9PT0iTWVzc2FnZVBvcnQifWZ1bmN0aW9uIGNsb3NlRW5kUG9pbnQocil7aXNNZXNzYWdlUG9ydChyKSYmci5jbG9zZSgpfWZ1bmN0aW9uIHdyYXAkMShyLHQpe3JldHVybiBjcmVhdGVQcm94eShyLFtdLHQpfWZ1bmN0aW9uIHRocm93SWZQcm94eVJlbGVhc2VkKHIpe2lmKHIpdGhyb3cgbmV3IEVycm9yKCJQcm94eSBoYXMgYmVlbiByZWxlYXNlZCBhbmQgaXMgbm90IHVzZWFibGUiKX1mdW5jdGlvbiByZWxlYXNlRW5kcG9pbnQocil7cmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2Uocix7dHlwZToiUkVMRUFTRSJ9KS50aGVuKCgpPT57Y2xvc2VFbmRQb2ludChyKX0pfWNvbnN0IHByb3h5Q291bnRlcj1uZXcgV2Vha01hcCxwcm94eUZpbmFsaXplcnM9IkZpbmFsaXphdGlvblJlZ2lzdHJ5ImluIGdsb2JhbFRoaXMmJm5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeShyPT57Y29uc3QgdD0ocHJveHlDb3VudGVyLmdldChyKXx8MCktMTtwcm94eUNvdW50ZXIuc2V0KHIsdCksdD09PTAmJnJlbGVhc2VFbmRwb2ludChyKX0pO2Z1bmN0aW9uIHJlZ2lzdGVyUHJveHkocix0KXtjb25zdCBlPShwcm94eUNvdW50ZXIuZ2V0KHQpfHwwKSsxO3Byb3h5Q291bnRlci5zZXQodCxlKSxwcm94eUZpbmFsaXplcnMmJnByb3h5RmluYWxpemVycy5yZWdpc3RlcihyLHQscil9ZnVuY3Rpb24gdW5yZWdpc3RlclByb3h5KHIpe3Byb3h5RmluYWxpemVycyYmcHJveHlGaW5hbGl6ZXJzLnVucmVnaXN0ZXIocil9ZnVuY3Rpb24gY3JlYXRlUHJveHkocix0PVtdLGU9ZnVuY3Rpb24oKXt9KXtsZXQgbj0hMTtjb25zdCBzPW5ldyBQcm94eShlLHtnZXQobyxhKXtpZih0aHJvd0lmUHJveHlSZWxlYXNlZChuKSxhPT09cmVsZWFzZVByb3h5KXJldHVybigpPT57dW5yZWdpc3RlclByb3h5KHMpLHJlbGVhc2VFbmRwb2ludChyKSxuPSEwfTtpZihhPT09InRoZW4iKXtpZih0Lmxlbmd0aD09PTApcmV0dXJue3RoZW46KCk9PnN9O2NvbnN0IGM9cmVxdWVzdFJlc3BvbnNlTWVzc2FnZShyLHt0eXBlOiJHRVQiLHBhdGg6dC5tYXAobD0+bC50b1N0cmluZygpKX0pLnRoZW4oZnJvbVdpcmVWYWx1ZSk7cmV0dXJuIGMudGhlbi5iaW5kKGMpfXJldHVybiBjcmVhdGVQcm94eShyLFsuLi50LGFdKX0sc2V0KG8sYSxjKXt0aHJvd0lmUHJveHlSZWxlYXNlZChuKTtjb25zdFtsLHVdPXRvV2lyZVZhbHVlKGMpO3JldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKHIse3R5cGU6IlNFVCIscGF0aDpbLi4udCxhXS5tYXAoaD0+aC50b1N0cmluZygpKSx2YWx1ZTpsfSx1KS50aGVuKGZyb21XaXJlVmFsdWUpfSxhcHBseShvLGEsYyl7dGhyb3dJZlByb3h5UmVsZWFzZWQobik7Y29uc3QgbD10W3QubGVuZ3RoLTFdO2lmKGw9PT1jcmVhdGVFbmRwb2ludClyZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShyLHt0eXBlOiJFTkRQT0lOVCJ9KS50aGVuKGZyb21XaXJlVmFsdWUpO2lmKGw9PT0iYmluZCIpcmV0dXJuIGNyZWF0ZVByb3h5KHIsdC5zbGljZSgwLC0xKSk7Y29uc3RbdSxoXT1wcm9jZXNzQXJndW1lbnRzKGMpO3JldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKHIse3R5cGU6IkFQUExZIixwYXRoOnQubWFwKHA9PnAudG9TdHJpbmcoKSksYXJndW1lbnRMaXN0OnV9LGgpLnRoZW4oZnJvbVdpcmVWYWx1ZSl9LGNvbnN0cnVjdChvLGEpe3Rocm93SWZQcm94eVJlbGVhc2VkKG4pO2NvbnN0W2MsbF09cHJvY2Vzc0FyZ3VtZW50cyhhKTtyZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShyLHt0eXBlOiJDT05TVFJVQ1QiLHBhdGg6dC5tYXAodT0+dS50b1N0cmluZygpKSxhcmd1bWVudExpc3Q6Y30sbCkudGhlbihmcm9tV2lyZVZhbHVlKX19KTtyZXR1cm4gcmVnaXN0ZXJQcm94eShzLHIpLHN9ZnVuY3Rpb24gbXlGbGF0KHIpe3JldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLHIpfWZ1bmN0aW9uIHByb2Nlc3NBcmd1bWVudHMocil7Y29uc3QgdD1yLm1hcCh0b1dpcmVWYWx1ZSk7cmV0dXJuW3QubWFwKGU9PmVbMF0pLG15RmxhdCh0Lm1hcChlPT5lWzFdKSldfWNvbnN0IHRyYW5zZmVyQ2FjaGU9bmV3IFdlYWtNYXA7ZnVuY3Rpb24gdHJhbnNmZXIocix0KXtyZXR1cm4gdHJhbnNmZXJDYWNoZS5zZXQocix0KSxyfWZ1bmN0aW9uIHByb3h5KHIpe3JldHVybiBPYmplY3QuYXNzaWduKHIse1twcm94eU1hcmtlcl06ITB9KX1mdW5jdGlvbiB0b1dpcmVWYWx1ZShyKXtmb3IoY29uc3RbdCxlXW9mIHRyYW5zZmVySGFuZGxlcnMpaWYoZS5jYW5IYW5kbGUocikpe2NvbnN0W24sc109ZS5zZXJpYWxpemUocik7cmV0dXJuW3t0eXBlOiJIQU5ETEVSIixuYW1lOnQsdmFsdWU6bn0sc119cmV0dXJuW3t0eXBlOiJSQVciLHZhbHVlOnJ9LHRyYW5zZmVyQ2FjaGUuZ2V0KHIpfHxbXV19ZnVuY3Rpb24gZnJvbVdpcmVWYWx1ZShyKXtzd2l0Y2goci50eXBlKXtjYXNlIkhBTkRMRVIiOnJldHVybiB0cmFuc2ZlckhhbmRsZXJzLmdldChyLm5hbWUpLmRlc2VyaWFsaXplKHIudmFsdWUpO2Nhc2UiUkFXIjpyZXR1cm4gci52YWx1ZX19ZnVuY3Rpb24gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShyLHQsZSl7cmV0dXJuIG5ldyBQcm9taXNlKG49Pntjb25zdCBzPWdlbmVyYXRlVVVJRCQxKCk7ci5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbiBvKGEpeyFhLmRhdGF8fCFhLmRhdGEuaWR8fGEuZGF0YS5pZCE9PXN8fChyLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLG8pLG4oYS5kYXRhKSl9KSxyLnN0YXJ0JiZyLnN0YXJ0KCksci5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHtpZDpzfSx0KSxlKX0pfWZ1bmN0aW9uIGdlbmVyYXRlVVVJRCQxKCl7cmV0dXJuIG5ldyBBcnJheSg0KS5maWxsKDApLm1hcCgoKT0+TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKk51bWJlci5NQVhfU0FGRV9JTlRFR0VSKS50b1N0cmluZygxNikpLmpvaW4oIi0iKX12YXIgZXh0ZW5kU3RhdGljcz1mdW5jdGlvbihyLHQpe3JldHVybiBleHRlbmRTdGF0aWNzPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbihlLG4pe2UuX19wcm90b19fPW59fHxmdW5jdGlvbihlLG4pe2Zvcih2YXIgcyBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLHMpJiYoZVtzXT1uW3NdKX0sZXh0ZW5kU3RhdGljcyhyLHQpfTtmdW5jdGlvbiBfX2V4dGVuZHMocix0KXtpZih0eXBlb2YgdCE9ImZ1bmN0aW9uIiYmdCE9PW51bGwpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSAiK1N0cmluZyh0KSsiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGwiKTtleHRlbmRTdGF0aWNzKHIsdCk7ZnVuY3Rpb24gZSgpe3RoaXMuY29uc3RydWN0b3I9cn1yLnByb3RvdHlwZT10PT09bnVsbD9PYmplY3QuY3JlYXRlKHQpOihlLnByb3RvdHlwZT10LnByb3RvdHlwZSxuZXcgZSl9ZnVuY3Rpb24gX19hd2FpdGVyKHIsdCxlLG4pe2Z1bmN0aW9uIHMobyl7cmV0dXJuIG8gaW5zdGFuY2VvZiBlP286bmV3IGUoZnVuY3Rpb24oYSl7YShvKX0pfXJldHVybiBuZXcoZXx8KGU9UHJvbWlzZSkpKGZ1bmN0aW9uKG8sYSl7ZnVuY3Rpb24gYyhoKXt0cnl7dShuLm5leHQoaCkpfWNhdGNoKHApe2EocCl9fWZ1bmN0aW9uIGwoaCl7dHJ5e3Uobi50aHJvdyhoKSl9Y2F0Y2gocCl7YShwKX19ZnVuY3Rpb24gdShoKXtoLmRvbmU/byhoLnZhbHVlKTpzKGgudmFsdWUpLnRoZW4oYyxsKX11KChuPW4uYXBwbHkocix0fHxbXSkpLm5leHQoKSl9KX1mdW5jdGlvbiBfX2dlbmVyYXRvcihyLHQpe3ZhciBlPXtsYWJlbDowLHNlbnQ6ZnVuY3Rpb24oKXtpZihvWzBdJjEpdGhyb3cgb1sxXTtyZXR1cm4gb1sxXX0sdHJ5czpbXSxvcHM6W119LG4scyxvLGE7cmV0dXJuIGE9e25leHQ6YygwKSx0aHJvdzpjKDEpLHJldHVybjpjKDIpfSx0eXBlb2YgU3ltYm9sPT0iZnVuY3Rpb24iJiYoYVtTeW1ib2wuaXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSxhO2Z1bmN0aW9uIGModSl7cmV0dXJuIGZ1bmN0aW9uKGgpe3JldHVybiBsKFt1LGhdKX19ZnVuY3Rpb24gbCh1KXtpZihuKXRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTtmb3IoO2EmJihhPTAsdVswXSYmKGU9MCkpLGU7KXRyeXtpZihuPTEscyYmKG89dVswXSYyP3MucmV0dXJuOnVbMF0/cy50aHJvd3x8KChvPXMucmV0dXJuKSYmby5jYWxsKHMpLDApOnMubmV4dCkmJiEobz1vLmNhbGwocyx1WzFdKSkuZG9uZSlyZXR1cm4gbztzd2l0Y2gocz0wLG8mJih1PVt1WzBdJjIsby52YWx1ZV0pLHVbMF0pe2Nhc2UgMDpjYXNlIDE6bz11O2JyZWFrO2Nhc2UgNDpyZXR1cm4gZS5sYWJlbCsrLHt2YWx1ZTp1WzFdLGRvbmU6ITF9O2Nhc2UgNTplLmxhYmVsKysscz11WzFdLHU9WzBdO2NvbnRpbnVlO2Nhc2UgNzp1PWUub3BzLnBvcCgpLGUudHJ5cy5wb3AoKTtjb250aW51ZTtkZWZhdWx0OmlmKG89ZS50cnlzLCEobz1vLmxlbmd0aD4wJiZvW28ubGVuZ3RoLTFdKSYmKHVbMF09PT02fHx1WzBdPT09Mikpe2U9MDtjb250aW51ZX1pZih1WzBdPT09MyYmKCFvfHx1WzFdPm9bMF0mJnVbMV08b1szXSkpe2UubGFiZWw9dVsxXTticmVha31pZih1WzBdPT09NiYmZS5sYWJlbDxvWzFdKXtlLmxhYmVsPW9bMV0sbz11O2JyZWFrfWlmKG8mJmUubGFiZWw8b1syXSl7ZS5sYWJlbD1vWzJdLGUub3BzLnB1c2godSk7YnJlYWt9b1syXSYmZS5vcHMucG9wKCksZS50cnlzLnBvcCgpO2NvbnRpbnVlfXU9dC5jYWxsKHIsZSl9Y2F0Y2goaCl7dT1bNixoXSxzPTB9ZmluYWxseXtuPW89MH1pZih1WzBdJjUpdGhyb3cgdVsxXTtyZXR1cm57dmFsdWU6dVswXT91WzFdOnZvaWQgMCxkb25lOiEwfX19ZnVuY3Rpb24gX192YWx1ZXMocil7dmFyIHQ9dHlwZW9mIFN5bWJvbD09ImZ1bmN0aW9uIiYmU3ltYm9sLml0ZXJhdG9yLGU9dCYmclt0XSxuPTA7aWYoZSlyZXR1cm4gZS5jYWxsKHIpO2lmKHImJnR5cGVvZiByLmxlbmd0aD09Im51bWJlciIpcmV0dXJue25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4gciYmbj49ci5sZW5ndGgmJihyPXZvaWQgMCkse3ZhbHVlOnImJnJbbisrXSxkb25lOiFyfX19O3Rocm93IG5ldyBUeXBlRXJyb3IodD8iT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iOiJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIil9ZnVuY3Rpb24gX19yZWFkKHIsdCl7dmFyIGU9dHlwZW9mIFN5bWJvbD09ImZ1bmN0aW9uIiYmcltTeW1ib2wuaXRlcmF0b3JdO2lmKCFlKXJldHVybiByO3ZhciBuPWUuY2FsbChyKSxzLG89W10sYTt0cnl7Zm9yKDsodD09PXZvaWQgMHx8dC0tID4wKSYmIShzPW4ubmV4dCgpKS5kb25lOylvLnB1c2gocy52YWx1ZSl9Y2F0Y2goYyl7YT17ZXJyb3I6Y319ZmluYWxseXt0cnl7cyYmIXMuZG9uZSYmKGU9bi5yZXR1cm4pJiZlLmNhbGwobil9ZmluYWxseXtpZihhKXRocm93IGEuZXJyb3J9fXJldHVybiBvfWZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkocix0LGUpe2lmKGV8fGFyZ3VtZW50cy5sZW5ndGg9PT0yKWZvcih2YXIgbj0wLHM9dC5sZW5ndGgsbztuPHM7bisrKShvfHwhKG4gaW4gdCkpJiYob3x8KG89QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodCwwLG4pKSxvW25dPXRbbl0pO3JldHVybiByLmNvbmNhdChvfHxBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0KSl9ZnVuY3Rpb24gX19hd2FpdChyKXtyZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQ/KHRoaXMudj1yLHRoaXMpOm5ldyBfX2F3YWl0KHIpfWZ1bmN0aW9uIF9fYXN5bmNHZW5lcmF0b3Iocix0LGUpe2lmKCFTeW1ib2wuYXN5bmNJdGVyYXRvcil0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTt2YXIgbj1lLmFwcGx5KHIsdHx8W10pLHMsbz1bXTtyZXR1cm4gcz17fSxhKCJuZXh0IiksYSgidGhyb3ciKSxhKCJyZXR1cm4iKSxzW1N5bWJvbC5hc3luY0l0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxzO2Z1bmN0aW9uIGEobSl7blttXSYmKHNbbV09ZnVuY3Rpb24odil7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHcsVCl7by5wdXNoKFttLHYsdyxUXSk+MXx8YyhtLHYpfSl9KX1mdW5jdGlvbiBjKG0sdil7dHJ5e2woblttXSh2KSl9Y2F0Y2godyl7cChvWzBdWzNdLHcpfX1mdW5jdGlvbiBsKG0pe20udmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0P1Byb21pc2UucmVzb2x2ZShtLnZhbHVlLnYpLnRoZW4odSxoKTpwKG9bMF1bMl0sbSl9ZnVuY3Rpb24gdShtKXtjKCJuZXh0IixtKX1mdW5jdGlvbiBoKG0pe2MoInRocm93IixtKX1mdW5jdGlvbiBwKG0sdil7bSh2KSxvLnNoaWZ0KCksby5sZW5ndGgmJmMob1swXVswXSxvWzBdWzFdKX19ZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhyKXtpZighU3ltYm9sLmFzeW5jSXRlcmF0b3IpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7dmFyIHQ9cltTeW1ib2wuYXN5bmNJdGVyYXRvcl0sZTtyZXR1cm4gdD90LmNhbGwocik6KHI9dHlwZW9mIF9fdmFsdWVzPT0iZnVuY3Rpb24iP19fdmFsdWVzKHIpOnJbU3ltYm9sLml0ZXJhdG9yXSgpLGU9e30sbigibmV4dCIpLG4oInRocm93IiksbigicmV0dXJuIiksZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sZSk7ZnVuY3Rpb24gbihvKXtlW29dPXJbb10mJmZ1bmN0aW9uKGEpe3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGwpe2E9cltvXShhKSxzKGMsbCxhLmRvbmUsYS52YWx1ZSl9KX19ZnVuY3Rpb24gcyhvLGEsYyxsKXtQcm9taXNlLnJlc29sdmUobCkudGhlbihmdW5jdGlvbih1KXtvKHt2YWx1ZTp1LGRvbmU6Y30pfSxhKX19dHlwZW9mIFN1cHByZXNzZWRFcnJvcj09ImZ1bmN0aW9uIiYmU3VwcHJlc3NlZEVycm9yO2Z1bmN0aW9uIGlzRnVuY3Rpb24kMShyKXtyZXR1cm4gdHlwZW9mIHI9PSJmdW5jdGlvbiJ9ZnVuY3Rpb24gY3JlYXRlRXJyb3JDbGFzcyhyKXt2YXIgdD1mdW5jdGlvbihuKXtFcnJvci5jYWxsKG4pLG4uc3RhY2s9bmV3IEVycm9yKCkuc3RhY2t9LGU9cih0KTtyZXR1cm4gZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpLGUucHJvdG90eXBlLmNvbnN0cnVjdG9yPWUsZX12YXIgVW5zdWJzY3JpcHRpb25FcnJvcj1jcmVhdGVFcnJvckNsYXNzKGZ1bmN0aW9uKHIpe3JldHVybiBmdW5jdGlvbihlKXtyKHRoaXMpLHRoaXMubWVzc2FnZT1lP2UubGVuZ3RoK2AgZXJyb3JzIG9jY3VycmVkIGR1cmluZyB1bnN1YnNjcmlwdGlvbjoKYCtlLm1hcChmdW5jdGlvbihuLHMpe3JldHVybiBzKzErIikgIituLnRvU3RyaW5nKCl9KS5qb2luKGAKICBgKToiIix0aGlzLm5hbWU9IlVuc3Vic2NyaXB0aW9uRXJyb3IiLHRoaXMuZXJyb3JzPWV9fSk7ZnVuY3Rpb24gYXJyUmVtb3ZlKHIsdCl7aWYocil7dmFyIGU9ci5pbmRleE9mKHQpOzA8PWUmJnIuc3BsaWNlKGUsMSl9fXZhciBTdWJzY3JpcHRpb249ZnVuY3Rpb24oKXtmdW5jdGlvbiByKHQpe3RoaXMuaW5pdGlhbFRlYXJkb3duPXQsdGhpcy5jbG9zZWQ9ITEsdGhpcy5fcGFyZW50YWdlPW51bGwsdGhpcy5fZmluYWxpemVycz1udWxsfXJldHVybiByLnByb3RvdHlwZS51bnN1YnNjcmliZT1mdW5jdGlvbigpe3ZhciB0LGUsbixzLG87aWYoIXRoaXMuY2xvc2VkKXt0aGlzLmNsb3NlZD0hMDt2YXIgYT10aGlzLl9wYXJlbnRhZ2U7aWYoYSlpZih0aGlzLl9wYXJlbnRhZ2U9bnVsbCxBcnJheS5pc0FycmF5KGEpKXRyeXtmb3IodmFyIGM9X192YWx1ZXMoYSksbD1jLm5leHQoKTshbC5kb25lO2w9Yy5uZXh0KCkpe3ZhciB1PWwudmFsdWU7dS5yZW1vdmUodGhpcyl9fWNhdGNoKFQpe3Q9e2Vycm9yOlR9fWZpbmFsbHl7dHJ5e2wmJiFsLmRvbmUmJihlPWMucmV0dXJuKSYmZS5jYWxsKGMpfWZpbmFsbHl7aWYodCl0aHJvdyB0LmVycm9yfX1lbHNlIGEucmVtb3ZlKHRoaXMpO3ZhciBoPXRoaXMuaW5pdGlhbFRlYXJkb3duO2lmKGlzRnVuY3Rpb24kMShoKSl0cnl7aCgpfWNhdGNoKFQpe289VCBpbnN0YW5jZW9mIFVuc3Vic2NyaXB0aW9uRXJyb3I/VC5lcnJvcnM6W1RdfXZhciBwPXRoaXMuX2ZpbmFsaXplcnM7aWYocCl7dGhpcy5fZmluYWxpemVycz1udWxsO3RyeXtmb3IodmFyIG09X192YWx1ZXMocCksdj1tLm5leHQoKTshdi5kb25lO3Y9bS5uZXh0KCkpe3ZhciB3PXYudmFsdWU7dHJ5e2V4ZWNGaW5hbGl6ZXIodyl9Y2F0Y2goVCl7bz1vIT1udWxsP286W10sVCBpbnN0YW5jZW9mIFVuc3Vic2NyaXB0aW9uRXJyb3I/bz1fX3NwcmVhZEFycmF5KF9fc3ByZWFkQXJyYXkoW10sX19yZWFkKG8pKSxfX3JlYWQoVC5lcnJvcnMpKTpvLnB1c2goVCl9fX1jYXRjaChUKXtuPXtlcnJvcjpUfX1maW5hbGx5e3RyeXt2JiYhdi5kb25lJiYocz1tLnJldHVybikmJnMuY2FsbChtKX1maW5hbGx5e2lmKG4pdGhyb3cgbi5lcnJvcn19fWlmKG8pdGhyb3cgbmV3IFVuc3Vic2NyaXB0aW9uRXJyb3Iobyl9fSxyLnByb3RvdHlwZS5hZGQ9ZnVuY3Rpb24odCl7dmFyIGU7aWYodCYmdCE9PXRoaXMpaWYodGhpcy5jbG9zZWQpZXhlY0ZpbmFsaXplcih0KTtlbHNle2lmKHQgaW5zdGFuY2VvZiByKXtpZih0LmNsb3NlZHx8dC5faGFzUGFyZW50KHRoaXMpKXJldHVybjt0Ll9hZGRQYXJlbnQodGhpcyl9KHRoaXMuX2ZpbmFsaXplcnM9KGU9dGhpcy5fZmluYWxpemVycykhPT1udWxsJiZlIT09dm9pZCAwP2U6W10pLnB1c2godCl9fSxyLnByb3RvdHlwZS5faGFzUGFyZW50PWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3BhcmVudGFnZTtyZXR1cm4gZT09PXR8fEFycmF5LmlzQXJyYXkoZSkmJmUuaW5jbHVkZXModCl9LHIucHJvdG90eXBlLl9hZGRQYXJlbnQ9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fcGFyZW50YWdlO3RoaXMuX3BhcmVudGFnZT1BcnJheS5pc0FycmF5KGUpPyhlLnB1c2godCksZSk6ZT9bZSx0XTp0fSxyLnByb3RvdHlwZS5fcmVtb3ZlUGFyZW50PWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3BhcmVudGFnZTtlPT09dD90aGlzLl9wYXJlbnRhZ2U9bnVsbDpBcnJheS5pc0FycmF5KGUpJiZhcnJSZW1vdmUoZSx0KX0sci5wcm90b3R5cGUucmVtb3ZlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2ZpbmFsaXplcnM7ZSYmYXJyUmVtb3ZlKGUsdCksdCBpbnN0YW5jZW9mIHImJnQuX3JlbW92ZVBhcmVudCh0aGlzKX0sci5FTVBUWT1mdW5jdGlvbigpe3ZhciB0PW5ldyByO3JldHVybiB0LmNsb3NlZD0hMCx0fSgpLHJ9KCksRU1QVFlfU1VCU0NSSVBUSU9OPVN1YnNjcmlwdGlvbi5FTVBUWTtmdW5jdGlvbiBpc1N1YnNjcmlwdGlvbihyKXtyZXR1cm4gciBpbnN0YW5jZW9mIFN1YnNjcmlwdGlvbnx8ciYmImNsb3NlZCJpbiByJiZpc0Z1bmN0aW9uJDEoci5yZW1vdmUpJiZpc0Z1bmN0aW9uJDEoci5hZGQpJiZpc0Z1bmN0aW9uJDEoci51bnN1YnNjcmliZSl9ZnVuY3Rpb24gZXhlY0ZpbmFsaXplcihyKXtpc0Z1bmN0aW9uJDEocik/cigpOnIudW5zdWJzY3JpYmUoKX12YXIgY29uZmlnPXtvblVuaGFuZGxlZEVycm9yOm51bGwsb25TdG9wcGVkTm90aWZpY2F0aW9uOm51bGwsUHJvbWlzZTp2b2lkIDAsdXNlRGVwcmVjYXRlZFN5bmNocm9ub3VzRXJyb3JIYW5kbGluZzohMSx1c2VEZXByZWNhdGVkTmV4dENvbnRleHQ6ITF9LHRpbWVvdXRQcm92aWRlcj17c2V0VGltZW91dDpmdW5jdGlvbihyLHQpe2Zvcih2YXIgZT1bXSxuPTI7bjxhcmd1bWVudHMubGVuZ3RoO24rKyllW24tMl09YXJndW1lbnRzW25dO3ZhciBzPXRpbWVvdXRQcm92aWRlci5kZWxlZ2F0ZTtyZXR1cm4gcyE9bnVsbCYmcy5zZXRUaW1lb3V0P3Muc2V0VGltZW91dC5hcHBseShzLF9fc3ByZWFkQXJyYXkoW3IsdF0sX19yZWFkKGUpKSk6c2V0VGltZW91dC5hcHBseSh2b2lkIDAsX19zcHJlYWRBcnJheShbcix0XSxfX3JlYWQoZSkpKX0sY2xlYXJUaW1lb3V0OmZ1bmN0aW9uKHIpe3ZhciB0PXRpbWVvdXRQcm92aWRlci5kZWxlZ2F0ZTtyZXR1cm4oKHQ9PW51bGw/dm9pZCAwOnQuY2xlYXJUaW1lb3V0KXx8Y2xlYXJUaW1lb3V0KShyKX0sZGVsZWdhdGU6dm9pZCAwfTtmdW5jdGlvbiByZXBvcnRVbmhhbmRsZWRFcnJvcihyKXt0aW1lb3V0UHJvdmlkZXIuc2V0VGltZW91dChmdW5jdGlvbigpe3Rocm93IHJ9KX1mdW5jdGlvbiBub29wKCl7fWZ1bmN0aW9uIGVycm9yQ29udGV4dChyKXtyKCl9dmFyIFN1YnNjcmliZXI9ZnVuY3Rpb24ocil7X19leHRlbmRzKHQscik7ZnVuY3Rpb24gdChlKXt2YXIgbj1yLmNhbGwodGhpcyl8fHRoaXM7cmV0dXJuIG4uaXNTdG9wcGVkPSExLGU/KG4uZGVzdGluYXRpb249ZSxpc1N1YnNjcmlwdGlvbihlKSYmZS5hZGQobikpOm4uZGVzdGluYXRpb249RU1QVFlfT0JTRVJWRVIsbn1yZXR1cm4gdC5jcmVhdGU9ZnVuY3Rpb24oZSxuLHMpe3JldHVybiBuZXcgU2FmZVN1YnNjcmliZXIoZSxuLHMpfSx0LnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKGUpe3RoaXMuaXNTdG9wcGVkfHx0aGlzLl9uZXh0KGUpfSx0LnByb3RvdHlwZS5lcnJvcj1mdW5jdGlvbihlKXt0aGlzLmlzU3RvcHBlZHx8KHRoaXMuaXNTdG9wcGVkPSEwLHRoaXMuX2Vycm9yKGUpKX0sdC5wcm90b3R5cGUuY29tcGxldGU9ZnVuY3Rpb24oKXt0aGlzLmlzU3RvcHBlZHx8KHRoaXMuaXNTdG9wcGVkPSEwLHRoaXMuX2NvbXBsZXRlKCkpfSx0LnByb3RvdHlwZS51bnN1YnNjcmliZT1mdW5jdGlvbigpe3RoaXMuY2xvc2VkfHwodGhpcy5pc1N0b3BwZWQ9ITAsci5wcm90b3R5cGUudW5zdWJzY3JpYmUuY2FsbCh0aGlzKSx0aGlzLmRlc3RpbmF0aW9uPW51bGwpfSx0LnByb3RvdHlwZS5fbmV4dD1mdW5jdGlvbihlKXt0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSl9LHQucHJvdG90eXBlLl9lcnJvcj1mdW5jdGlvbihlKXt0cnl7dGhpcy5kZXN0aW5hdGlvbi5lcnJvcihlKX1maW5hbGx5e3RoaXMudW5zdWJzY3JpYmUoKX19LHQucHJvdG90eXBlLl9jb21wbGV0ZT1mdW5jdGlvbigpe3RyeXt0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCl9ZmluYWxseXt0aGlzLnVuc3Vic2NyaWJlKCl9fSx0fShTdWJzY3JpcHRpb24pLF9iaW5kPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kO2Z1bmN0aW9uIGJpbmQocix0KXtyZXR1cm4gX2JpbmQuY2FsbChyLHQpfXZhciBDb25zdW1lck9ic2VydmVyPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gcih0KXt0aGlzLnBhcnRpYWxPYnNlcnZlcj10fXJldHVybiByLnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMucGFydGlhbE9ic2VydmVyO2lmKGUubmV4dCl0cnl7ZS5uZXh0KHQpfWNhdGNoKG4pe2hhbmRsZVVuaGFuZGxlZEVycm9yKG4pfX0sci5wcm90b3R5cGUuZXJyb3I9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5wYXJ0aWFsT2JzZXJ2ZXI7aWYoZS5lcnJvcil0cnl7ZS5lcnJvcih0KX1jYXRjaChuKXtoYW5kbGVVbmhhbmRsZWRFcnJvcihuKX1lbHNlIGhhbmRsZVVuaGFuZGxlZEVycm9yKHQpfSxyLnByb3RvdHlwZS5jb21wbGV0ZT1mdW5jdGlvbigpe3ZhciB0PXRoaXMucGFydGlhbE9ic2VydmVyO2lmKHQuY29tcGxldGUpdHJ5e3QuY29tcGxldGUoKX1jYXRjaChlKXtoYW5kbGVVbmhhbmRsZWRFcnJvcihlKX19LHJ9KCksU2FmZVN1YnNjcmliZXI9ZnVuY3Rpb24ocil7X19leHRlbmRzKHQscik7ZnVuY3Rpb24gdChlLG4scyl7dmFyIG89ci5jYWxsKHRoaXMpfHx0aGlzLGE7aWYoaXNGdW5jdGlvbiQxKGUpfHwhZSlhPXtuZXh0OmUhPW51bGw/ZTp2b2lkIDAsZXJyb3I6biE9bnVsbD9uOnZvaWQgMCxjb21wbGV0ZTpzIT1udWxsP3M6dm9pZCAwfTtlbHNle3ZhciBjO28mJmNvbmZpZy51c2VEZXByZWNhdGVkTmV4dENvbnRleHQ/KGM9T2JqZWN0LmNyZWF0ZShlKSxjLnVuc3Vic2NyaWJlPWZ1bmN0aW9uKCl7cmV0dXJuIG8udW5zdWJzY3JpYmUoKX0sYT17bmV4dDplLm5leHQmJmJpbmQoZS5uZXh0LGMpLGVycm9yOmUuZXJyb3ImJmJpbmQoZS5lcnJvcixjKSxjb21wbGV0ZTplLmNvbXBsZXRlJiZiaW5kKGUuY29tcGxldGUsYyl9KTphPWV9cmV0dXJuIG8uZGVzdGluYXRpb249bmV3IENvbnN1bWVyT2JzZXJ2ZXIoYSksb31yZXR1cm4gdH0oU3Vic2NyaWJlcik7ZnVuY3Rpb24gaGFuZGxlVW5oYW5kbGVkRXJyb3Iocil7cmVwb3J0VW5oYW5kbGVkRXJyb3Iocil9ZnVuY3Rpb24gZGVmYXVsdEVycm9ySGFuZGxlcihyKXt0aHJvdyByfXZhciBFTVBUWV9PQlNFUlZFUj17Y2xvc2VkOiEwLG5leHQ6bm9vcCxlcnJvcjpkZWZhdWx0RXJyb3JIYW5kbGVyLGNvbXBsZXRlOm5vb3B9LG9ic2VydmFibGU9ZnVuY3Rpb24oKXtyZXR1cm4gdHlwZW9mIFN5bWJvbD09ImZ1bmN0aW9uIiYmU3ltYm9sLm9ic2VydmFibGV8fCJAQG9ic2VydmFibGUifSgpO2Z1bmN0aW9uIGlkZW50aXR5KHIpe3JldHVybiByfWZ1bmN0aW9uIHBpcGVGcm9tQXJyYXkocil7cmV0dXJuIHIubGVuZ3RoPT09MD9pZGVudGl0eTpyLmxlbmd0aD09PTE/clswXTpmdW5jdGlvbihlKXtyZXR1cm4gci5yZWR1Y2UoZnVuY3Rpb24obixzKXtyZXR1cm4gcyhuKX0sZSl9fXZhciBPYnNlcnZhYmxlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gcih0KXt0JiYodGhpcy5fc3Vic2NyaWJlPXQpfXJldHVybiByLnByb3RvdHlwZS5saWZ0PWZ1bmN0aW9uKHQpe3ZhciBlPW5ldyByO3JldHVybiBlLnNvdXJjZT10aGlzLGUub3BlcmF0b3I9dCxlfSxyLnByb3RvdHlwZS5zdWJzY3JpYmU9ZnVuY3Rpb24odCxlLG4pe3ZhciBzPXRoaXMsbz1pc1N1YnNjcmliZXIodCk/dDpuZXcgU2FmZVN1YnNjcmliZXIodCxlLG4pO3JldHVybiBlcnJvckNvbnRleHQoZnVuY3Rpb24oKXt2YXIgYT1zLGM9YS5vcGVyYXRvcixsPWEuc291cmNlO28uYWRkKGM/Yy5jYWxsKG8sbCk6bD9zLl9zdWJzY3JpYmUobyk6cy5fdHJ5U3Vic2NyaWJlKG8pKX0pLG99LHIucHJvdG90eXBlLl90cnlTdWJzY3JpYmU9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiB0aGlzLl9zdWJzY3JpYmUodCl9Y2F0Y2goZSl7dC5lcnJvcihlKX19LHIucHJvdG90eXBlLmZvckVhY2g9ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzO3JldHVybiBlPWdldFByb21pc2VDdG9yKGUpLG5ldyBlKGZ1bmN0aW9uKHMsbyl7dmFyIGE9bmV3IFNhZmVTdWJzY3JpYmVyKHtuZXh0OmZ1bmN0aW9uKGMpe3RyeXt0KGMpfWNhdGNoKGwpe28obCksYS51bnN1YnNjcmliZSgpfX0sZXJyb3I6byxjb21wbGV0ZTpzfSk7bi5zdWJzY3JpYmUoYSl9KX0sci5wcm90b3R5cGUuX3N1YnNjcmliZT1mdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4oZT10aGlzLnNvdXJjZSk9PT1udWxsfHxlPT09dm9pZCAwP3ZvaWQgMDplLnN1YnNjcmliZSh0KX0sci5wcm90b3R5cGVbb2JzZXJ2YWJsZV09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sci5wcm90b3R5cGUucGlwZT1mdW5jdGlvbigpe2Zvcih2YXIgdD1bXSxlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl0W2VdPWFyZ3VtZW50c1tlXTtyZXR1cm4gcGlwZUZyb21BcnJheSh0KSh0aGlzKX0sci5wcm90b3R5cGUudG9Qcm9taXNlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXM7cmV0dXJuIHQ9Z2V0UHJvbWlzZUN0b3IodCksbmV3IHQoZnVuY3Rpb24obixzKXt2YXIgbztlLnN1YnNjcmliZShmdW5jdGlvbihhKXtyZXR1cm4gbz1hfSxmdW5jdGlvbihhKXtyZXR1cm4gcyhhKX0sZnVuY3Rpb24oKXtyZXR1cm4gbihvKX0pfSl9LHIuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgcih0KX0scn0oKTtmdW5jdGlvbiBnZXRQcm9taXNlQ3RvcihyKXt2YXIgdDtyZXR1cm4odD1yIT1udWxsP3I6Y29uZmlnLlByb21pc2UpIT09bnVsbCYmdCE9PXZvaWQgMD90OlByb21pc2V9ZnVuY3Rpb24gaXNPYnNlcnZlcihyKXtyZXR1cm4gciYmaXNGdW5jdGlvbiQxKHIubmV4dCkmJmlzRnVuY3Rpb24kMShyLmVycm9yKSYmaXNGdW5jdGlvbiQxKHIuY29tcGxldGUpfWZ1bmN0aW9uIGlzU3Vic2NyaWJlcihyKXtyZXR1cm4gciYmciBpbnN0YW5jZW9mIFN1YnNjcmliZXJ8fGlzT2JzZXJ2ZXIocikmJmlzU3Vic2NyaXB0aW9uKHIpfWZ1bmN0aW9uIGhhc0xpZnQocil7cmV0dXJuIGlzRnVuY3Rpb24kMShyPT1udWxsP3ZvaWQgMDpyLmxpZnQpfWZ1bmN0aW9uIG9wZXJhdGUocil7cmV0dXJuIGZ1bmN0aW9uKHQpe2lmKGhhc0xpZnQodCkpcmV0dXJuIHQubGlmdChmdW5jdGlvbihlKXt0cnl7cmV0dXJuIHIoZSx0aGlzKX1jYXRjaChuKXt0aGlzLmVycm9yKG4pfX0pO3Rocm93IG5ldyBUeXBlRXJyb3IoIlVuYWJsZSB0byBsaWZ0IHVua25vd24gT2JzZXJ2YWJsZSB0eXBlIil9fWZ1bmN0aW9uIGNyZWF0ZU9wZXJhdG9yU3Vic2NyaWJlcihyLHQsZSxuLHMpe3JldHVybiBuZXcgT3BlcmF0b3JTdWJzY3JpYmVyKHIsdCxlLG4scyl9dmFyIE9wZXJhdG9yU3Vic2NyaWJlcj1mdW5jdGlvbihyKXtfX2V4dGVuZHModCxyKTtmdW5jdGlvbiB0KGUsbixzLG8sYSxjKXt2YXIgbD1yLmNhbGwodGhpcyxlKXx8dGhpcztyZXR1cm4gbC5vbkZpbmFsaXplPWEsbC5zaG91bGRVbnN1YnNjcmliZT1jLGwuX25leHQ9bj9mdW5jdGlvbih1KXt0cnl7bih1KX1jYXRjaChoKXtlLmVycm9yKGgpfX06ci5wcm90b3R5cGUuX25leHQsbC5fZXJyb3I9bz9mdW5jdGlvbih1KXt0cnl7byh1KX1jYXRjaChoKXtlLmVycm9yKGgpfWZpbmFsbHl7dGhpcy51bnN1YnNjcmliZSgpfX06ci5wcm90b3R5cGUuX2Vycm9yLGwuX2NvbXBsZXRlPXM/ZnVuY3Rpb24oKXt0cnl7cygpfWNhdGNoKHUpe2UuZXJyb3IodSl9ZmluYWxseXt0aGlzLnVuc3Vic2NyaWJlKCl9fTpyLnByb3RvdHlwZS5fY29tcGxldGUsbH1yZXR1cm4gdC5wcm90b3R5cGUudW5zdWJzY3JpYmU9ZnVuY3Rpb24oKXt2YXIgZTtpZighdGhpcy5zaG91bGRVbnN1YnNjcmliZXx8dGhpcy5zaG91bGRVbnN1YnNjcmliZSgpKXt2YXIgbj10aGlzLmNsb3NlZDtyLnByb3RvdHlwZS51bnN1YnNjcmliZS5jYWxsKHRoaXMpLCFuJiYoKGU9dGhpcy5vbkZpbmFsaXplKT09PW51bGx8fGU9PT12b2lkIDB8fGUuY2FsbCh0aGlzKSl9fSx0fShTdWJzY3JpYmVyKSxPYmplY3RVbnN1YnNjcmliZWRFcnJvcj1jcmVhdGVFcnJvckNsYXNzKGZ1bmN0aW9uKHIpe3JldHVybiBmdW5jdGlvbigpe3IodGhpcyksdGhpcy5uYW1lPSJPYmplY3RVbnN1YnNjcmliZWRFcnJvciIsdGhpcy5tZXNzYWdlPSJvYmplY3QgdW5zdWJzY3JpYmVkIn19KSxTdWJqZWN0PWZ1bmN0aW9uKHIpe19fZXh0ZW5kcyh0LHIpO2Z1bmN0aW9uIHQoKXt2YXIgZT1yLmNhbGwodGhpcyl8fHRoaXM7cmV0dXJuIGUuY2xvc2VkPSExLGUuY3VycmVudE9ic2VydmVycz1udWxsLGUub2JzZXJ2ZXJzPVtdLGUuaXNTdG9wcGVkPSExLGUuaGFzRXJyb3I9ITEsZS50aHJvd25FcnJvcj1udWxsLGV9cmV0dXJuIHQucHJvdG90eXBlLmxpZnQ9ZnVuY3Rpb24oZSl7dmFyIG49bmV3IEFub255bW91c1N1YmplY3QodGhpcyx0aGlzKTtyZXR1cm4gbi5vcGVyYXRvcj1lLG59LHQucHJvdG90eXBlLl90aHJvd0lmQ2xvc2VkPWZ1bmN0aW9uKCl7aWYodGhpcy5jbG9zZWQpdGhyb3cgbmV3IE9iamVjdFVuc3Vic2NyaWJlZEVycm9yfSx0LnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7ZXJyb3JDb250ZXh0KGZ1bmN0aW9uKCl7dmFyIHMsbztpZihuLl90aHJvd0lmQ2xvc2VkKCksIW4uaXNTdG9wcGVkKXtuLmN1cnJlbnRPYnNlcnZlcnN8fChuLmN1cnJlbnRPYnNlcnZlcnM9QXJyYXkuZnJvbShuLm9ic2VydmVycykpO3RyeXtmb3IodmFyIGE9X192YWx1ZXMobi5jdXJyZW50T2JzZXJ2ZXJzKSxjPWEubmV4dCgpOyFjLmRvbmU7Yz1hLm5leHQoKSl7dmFyIGw9Yy52YWx1ZTtsLm5leHQoZSl9fWNhdGNoKHUpe3M9e2Vycm9yOnV9fWZpbmFsbHl7dHJ5e2MmJiFjLmRvbmUmJihvPWEucmV0dXJuKSYmby5jYWxsKGEpfWZpbmFsbHl7aWYocyl0aHJvdyBzLmVycm9yfX19fSl9LHQucHJvdG90eXBlLmVycm9yPWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7ZXJyb3JDb250ZXh0KGZ1bmN0aW9uKCl7aWYobi5fdGhyb3dJZkNsb3NlZCgpLCFuLmlzU3RvcHBlZCl7bi5oYXNFcnJvcj1uLmlzU3RvcHBlZD0hMCxuLnRocm93bkVycm9yPWU7Zm9yKHZhciBzPW4ub2JzZXJ2ZXJzO3MubGVuZ3RoOylzLnNoaWZ0KCkuZXJyb3IoZSl9fSl9LHQucHJvdG90eXBlLmNvbXBsZXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcztlcnJvckNvbnRleHQoZnVuY3Rpb24oKXtpZihlLl90aHJvd0lmQ2xvc2VkKCksIWUuaXNTdG9wcGVkKXtlLmlzU3RvcHBlZD0hMDtmb3IodmFyIG49ZS5vYnNlcnZlcnM7bi5sZW5ndGg7KW4uc2hpZnQoKS5jb21wbGV0ZSgpfX0pfSx0LnByb3RvdHlwZS51bnN1YnNjcmliZT1mdW5jdGlvbigpe3RoaXMuaXNTdG9wcGVkPXRoaXMuY2xvc2VkPSEwLHRoaXMub2JzZXJ2ZXJzPXRoaXMuY3VycmVudE9ic2VydmVycz1udWxsfSxPYmplY3QuZGVmaW5lUHJvcGVydHkodC5wcm90b3R5cGUsIm9ic2VydmVkIix7Z2V0OmZ1bmN0aW9uKCl7dmFyIGU7cmV0dXJuKChlPXRoaXMub2JzZXJ2ZXJzKT09PW51bGx8fGU9PT12b2lkIDA/dm9pZCAwOmUubGVuZ3RoKT4wfSxlbnVtZXJhYmxlOiExLGNvbmZpZ3VyYWJsZTohMH0pLHQucHJvdG90eXBlLl90cnlTdWJzY3JpYmU9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX3Rocm93SWZDbG9zZWQoKSxyLnByb3RvdHlwZS5fdHJ5U3Vic2NyaWJlLmNhbGwodGhpcyxlKX0sdC5wcm90b3R5cGUuX3N1YnNjcmliZT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fdGhyb3dJZkNsb3NlZCgpLHRoaXMuX2NoZWNrRmluYWxpemVkU3RhdHVzZXMoZSksdGhpcy5faW5uZXJTdWJzY3JpYmUoZSl9LHQucHJvdG90eXBlLl9pbm5lclN1YnNjcmliZT1mdW5jdGlvbihlKXt2YXIgbj10aGlzLHM9dGhpcyxvPXMuaGFzRXJyb3IsYT1zLmlzU3RvcHBlZCxjPXMub2JzZXJ2ZXJzO3JldHVybiBvfHxhP0VNUFRZX1NVQlNDUklQVElPTjoodGhpcy5jdXJyZW50T2JzZXJ2ZXJzPW51bGwsYy5wdXNoKGUpLG5ldyBTdWJzY3JpcHRpb24oZnVuY3Rpb24oKXtuLmN1cnJlbnRPYnNlcnZlcnM9bnVsbCxhcnJSZW1vdmUoYyxlKX0pKX0sdC5wcm90b3R5cGUuX2NoZWNrRmluYWxpemVkU3RhdHVzZXM9ZnVuY3Rpb24oZSl7dmFyIG49dGhpcyxzPW4uaGFzRXJyb3Isbz1uLnRocm93bkVycm9yLGE9bi5pc1N0b3BwZWQ7cz9lLmVycm9yKG8pOmEmJmUuY29tcGxldGUoKX0sdC5wcm90b3R5cGUuYXNPYnNlcnZhYmxlPWZ1bmN0aW9uKCl7dmFyIGU9bmV3IE9ic2VydmFibGU7cmV0dXJuIGUuc291cmNlPXRoaXMsZX0sdC5jcmVhdGU9ZnVuY3Rpb24oZSxuKXtyZXR1cm4gbmV3IEFub255bW91c1N1YmplY3QoZSxuKX0sdH0oT2JzZXJ2YWJsZSksQW5vbnltb3VzU3ViamVjdD1mdW5jdGlvbihyKXtfX2V4dGVuZHModCxyKTtmdW5jdGlvbiB0KGUsbil7dmFyIHM9ci5jYWxsKHRoaXMpfHx0aGlzO3JldHVybiBzLmRlc3RpbmF0aW9uPWUscy5zb3VyY2U9bixzfXJldHVybiB0LnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKGUpe3ZhciBuLHM7KHM9KG49dGhpcy5kZXN0aW5hdGlvbik9PT1udWxsfHxuPT09dm9pZCAwP3ZvaWQgMDpuLm5leHQpPT09bnVsbHx8cz09PXZvaWQgMHx8cy5jYWxsKG4sZSl9LHQucHJvdG90eXBlLmVycm9yPWZ1bmN0aW9uKGUpe3ZhciBuLHM7KHM9KG49dGhpcy5kZXN0aW5hdGlvbik9PT1udWxsfHxuPT09dm9pZCAwP3ZvaWQgMDpuLmVycm9yKT09PW51bGx8fHM9PT12b2lkIDB8fHMuY2FsbChuLGUpfSx0LnByb3RvdHlwZS5jb21wbGV0ZT1mdW5jdGlvbigpe3ZhciBlLG47KG49KGU9dGhpcy5kZXN0aW5hdGlvbik9PT1udWxsfHxlPT09dm9pZCAwP3ZvaWQgMDplLmNvbXBsZXRlKT09PW51bGx8fG49PT12b2lkIDB8fG4uY2FsbChlKX0sdC5wcm90b3R5cGUuX3N1YnNjcmliZT1mdW5jdGlvbihlKXt2YXIgbixzO3JldHVybihzPShuPXRoaXMuc291cmNlKT09PW51bGx8fG49PT12b2lkIDA/dm9pZCAwOm4uc3Vic2NyaWJlKGUpKSE9PW51bGwmJnMhPT12b2lkIDA/czpFTVBUWV9TVUJTQ1JJUFRJT059LHR9KFN1YmplY3QpLGlzQXJyYXlMaWtlPWZ1bmN0aW9uKHIpe3JldHVybiByJiZ0eXBlb2Ygci5sZW5ndGg9PSJudW1iZXIiJiZ0eXBlb2YgciE9ImZ1bmN0aW9uIn07ZnVuY3Rpb24gaXNQcm9taXNlKHIpe3JldHVybiBpc0Z1bmN0aW9uJDEocj09bnVsbD92b2lkIDA6ci50aGVuKX1mdW5jdGlvbiBpc0ludGVyb3BPYnNlcnZhYmxlKHIpe3JldHVybiBpc0Z1bmN0aW9uJDEocltvYnNlcnZhYmxlXSl9ZnVuY3Rpb24gaXNBc3luY0l0ZXJhYmxlKHIpe3JldHVybiBTeW1ib2wuYXN5bmNJdGVyYXRvciYmaXNGdW5jdGlvbiQxKHI9PW51bGw/dm9pZCAwOnJbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKX1mdW5jdGlvbiBjcmVhdGVJbnZhbGlkT2JzZXJ2YWJsZVR5cGVFcnJvcihyKXtyZXR1cm4gbmV3IFR5cGVFcnJvcigiWW91IHByb3ZpZGVkICIrKHIhPT1udWxsJiZ0eXBlb2Ygcj09Im9iamVjdCI/ImFuIGludmFsaWQgb2JqZWN0IjoiJyIrcisiJyIpKyIgd2hlcmUgYSBzdHJlYW0gd2FzIGV4cGVjdGVkLiBZb3UgY2FuIHByb3ZpZGUgYW4gT2JzZXJ2YWJsZSwgUHJvbWlzZSwgUmVhZGFibGVTdHJlYW0sIEFycmF5LCBBc3luY0l0ZXJhYmxlLCBvciBJdGVyYWJsZS4iKX1mdW5jdGlvbiBnZXRTeW1ib2xJdGVyYXRvcigpe3JldHVybiB0eXBlb2YgU3ltYm9sIT0iZnVuY3Rpb24ifHwhU3ltYm9sLml0ZXJhdG9yPyJAQGl0ZXJhdG9yIjpTeW1ib2wuaXRlcmF0b3J9dmFyIGl0ZXJhdG9yPWdldFN5bWJvbEl0ZXJhdG9yKCk7ZnVuY3Rpb24gaXNJdGVyYWJsZShyKXtyZXR1cm4gaXNGdW5jdGlvbiQxKHI9PW51bGw/dm9pZCAwOnJbaXRlcmF0b3JdKX1mdW5jdGlvbiByZWFkYWJsZVN0cmVhbUxpa2VUb0FzeW5jR2VuZXJhdG9yKHIpe3JldHVybiBfX2FzeW5jR2VuZXJhdG9yKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKCl7dmFyIGUsbixzLG87cmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsZnVuY3Rpb24oYSl7c3dpdGNoKGEubGFiZWwpe2Nhc2UgMDplPXIuZ2V0UmVhZGVyKCksYS5sYWJlbD0xO2Nhc2UgMTphLnRyeXMucHVzaChbMSwsOSwxMF0pLGEubGFiZWw9MjtjYXNlIDI6cmV0dXJuWzQsX19hd2FpdChlLnJlYWQoKSldO2Nhc2UgMzpyZXR1cm4gbj1hLnNlbnQoKSxzPW4udmFsdWUsbz1uLmRvbmUsbz9bNCxfX2F3YWl0KHZvaWQgMCldOlszLDVdO2Nhc2UgNDpyZXR1cm5bMixhLnNlbnQoKV07Y2FzZSA1OnJldHVybls0LF9fYXdhaXQocyldO2Nhc2UgNjpyZXR1cm5bNCxhLnNlbnQoKV07Y2FzZSA3OnJldHVybiBhLnNlbnQoKSxbMywyXTtjYXNlIDg6cmV0dXJuWzMsMTBdO2Nhc2UgOTpyZXR1cm4gZS5yZWxlYXNlTG9jaygpLFs3XTtjYXNlIDEwOnJldHVyblsyXX19KX0pfWZ1bmN0aW9uIGlzUmVhZGFibGVTdHJlYW1MaWtlKHIpe3JldHVybiBpc0Z1bmN0aW9uJDEocj09bnVsbD92b2lkIDA6ci5nZXRSZWFkZXIpfWZ1bmN0aW9uIGlubmVyRnJvbShyKXtpZihyIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSlyZXR1cm4gcjtpZihyIT1udWxsKXtpZihpc0ludGVyb3BPYnNlcnZhYmxlKHIpKXJldHVybiBmcm9tSW50ZXJvcE9ic2VydmFibGUocik7aWYoaXNBcnJheUxpa2UocikpcmV0dXJuIGZyb21BcnJheUxpa2Uocik7aWYoaXNQcm9taXNlKHIpKXJldHVybiBmcm9tUHJvbWlzZShyKTtpZihpc0FzeW5jSXRlcmFibGUocikpcmV0dXJuIGZyb21Bc3luY0l0ZXJhYmxlKHIpO2lmKGlzSXRlcmFibGUocikpcmV0dXJuIGZyb21JdGVyYWJsZShyKTtpZihpc1JlYWRhYmxlU3RyZWFtTGlrZShyKSlyZXR1cm4gZnJvbVJlYWRhYmxlU3RyZWFtTGlrZShyKX10aHJvdyBjcmVhdGVJbnZhbGlkT2JzZXJ2YWJsZVR5cGVFcnJvcihyKX1mdW5jdGlvbiBmcm9tSW50ZXJvcE9ic2VydmFibGUocil7cmV0dXJuIG5ldyBPYnNlcnZhYmxlKGZ1bmN0aW9uKHQpe3ZhciBlPXJbb2JzZXJ2YWJsZV0oKTtpZihpc0Z1bmN0aW9uJDEoZS5zdWJzY3JpYmUpKXJldHVybiBlLnN1YnNjcmliZSh0KTt0aHJvdyBuZXcgVHlwZUVycm9yKCJQcm92aWRlZCBvYmplY3QgZG9lcyBub3QgY29ycmVjdGx5IGltcGxlbWVudCBTeW1ib2wub2JzZXJ2YWJsZSIpfSl9ZnVuY3Rpb24gZnJvbUFycmF5TGlrZShyKXtyZXR1cm4gbmV3IE9ic2VydmFibGUoZnVuY3Rpb24odCl7Zm9yKHZhciBlPTA7ZTxyLmxlbmd0aCYmIXQuY2xvc2VkO2UrKyl0Lm5leHQocltlXSk7dC5jb21wbGV0ZSgpfSl9ZnVuY3Rpb24gZnJvbVByb21pc2Uocil7cmV0dXJuIG5ldyBPYnNlcnZhYmxlKGZ1bmN0aW9uKHQpe3IudGhlbihmdW5jdGlvbihlKXt0LmNsb3NlZHx8KHQubmV4dChlKSx0LmNvbXBsZXRlKCkpfSxmdW5jdGlvbihlKXtyZXR1cm4gdC5lcnJvcihlKX0pLnRoZW4obnVsbCxyZXBvcnRVbmhhbmRsZWRFcnJvcil9KX1mdW5jdGlvbiBmcm9tSXRlcmFibGUocil7cmV0dXJuIG5ldyBPYnNlcnZhYmxlKGZ1bmN0aW9uKHQpe3ZhciBlLG47dHJ5e2Zvcih2YXIgcz1fX3ZhbHVlcyhyKSxvPXMubmV4dCgpOyFvLmRvbmU7bz1zLm5leHQoKSl7dmFyIGE9by52YWx1ZTtpZih0Lm5leHQoYSksdC5jbG9zZWQpcmV0dXJufX1jYXRjaChjKXtlPXtlcnJvcjpjfX1maW5hbGx5e3RyeXtvJiYhby5kb25lJiYobj1zLnJldHVybikmJm4uY2FsbChzKX1maW5hbGx5e2lmKGUpdGhyb3cgZS5lcnJvcn19dC5jb21wbGV0ZSgpfSl9ZnVuY3Rpb24gZnJvbUFzeW5jSXRlcmFibGUocil7cmV0dXJuIG5ldyBPYnNlcnZhYmxlKGZ1bmN0aW9uKHQpe3Byb2Nlc3Mocix0KS5jYXRjaChmdW5jdGlvbihlKXtyZXR1cm4gdC5lcnJvcihlKX0pfSl9ZnVuY3Rpb24gZnJvbVJlYWRhYmxlU3RyZWFtTGlrZShyKXtyZXR1cm4gZnJvbUFzeW5jSXRlcmFibGUocmVhZGFibGVTdHJlYW1MaWtlVG9Bc3luY0dlbmVyYXRvcihyKSl9ZnVuY3Rpb24gcHJvY2VzcyhyLHQpe3ZhciBlLG4scyxvO3JldHVybiBfX2F3YWl0ZXIodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKCl7dmFyIGEsYztyZXR1cm4gX19nZW5lcmF0b3IodGhpcyxmdW5jdGlvbihsKXtzd2l0Y2gobC5sYWJlbCl7Y2FzZSAwOmwudHJ5cy5wdXNoKFswLDUsNiwxMV0pLGU9X19hc3luY1ZhbHVlcyhyKSxsLmxhYmVsPTE7Y2FzZSAxOnJldHVybls0LGUubmV4dCgpXTtjYXNlIDI6aWYobj1sLnNlbnQoKSwhIW4uZG9uZSlyZXR1cm5bMyw0XTtpZihhPW4udmFsdWUsdC5uZXh0KGEpLHQuY2xvc2VkKXJldHVyblsyXTtsLmxhYmVsPTM7Y2FzZSAzOnJldHVyblszLDFdO2Nhc2UgNDpyZXR1cm5bMywxMV07Y2FzZSA1OnJldHVybiBjPWwuc2VudCgpLHM9e2Vycm9yOmN9LFszLDExXTtjYXNlIDY6cmV0dXJuIGwudHJ5cy5wdXNoKFs2LCw5LDEwXSksbiYmIW4uZG9uZSYmKG89ZS5yZXR1cm4pP1s0LG8uY2FsbChlKV06WzMsOF07Y2FzZSA3Omwuc2VudCgpLGwubGFiZWw9ODtjYXNlIDg6cmV0dXJuWzMsMTBdO2Nhc2UgOTppZihzKXRocm93IHMuZXJyb3I7cmV0dXJuWzddO2Nhc2UgMTA6cmV0dXJuWzddO2Nhc2UgMTE6cmV0dXJuIHQuY29tcGxldGUoKSxbMl19fSl9KX1mdW5jdGlvbiBleGVjdXRlU2NoZWR1bGUocix0LGUsbixzKXtuPT09dm9pZCAwJiYobj0wKSxzPT09dm9pZCAwJiYocz0hMSk7dmFyIG89dC5zY2hlZHVsZShmdW5jdGlvbigpe2UoKSxzP3IuYWRkKHRoaXMuc2NoZWR1bGUobnVsbCxuKSk6dGhpcy51bnN1YnNjcmliZSgpfSxuKTtpZihyLmFkZChvKSwhcylyZXR1cm4gb31mdW5jdGlvbiBtYXAocix0KXtyZXR1cm4gb3BlcmF0ZShmdW5jdGlvbihlLG4pe3ZhciBzPTA7ZS5zdWJzY3JpYmUoY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyKG4sZnVuY3Rpb24obyl7bi5uZXh0KHIuY2FsbCh0LG8scysrKSl9KSl9KX12YXIgaXNBcnJheT1BcnJheS5pc0FycmF5O2Z1bmN0aW9uIGNhbGxPckFwcGx5KHIsdCl7cmV0dXJuIGlzQXJyYXkodCk/ci5hcHBseSh2b2lkIDAsX19zcHJlYWRBcnJheShbXSxfX3JlYWQodCkpKTpyKHQpfWZ1bmN0aW9uIG1hcE9uZU9yTWFueUFyZ3Mocil7cmV0dXJuIG1hcChmdW5jdGlvbih0KXtyZXR1cm4gY2FsbE9yQXBwbHkocix0KX0pfWZ1bmN0aW9uIG1lcmdlSW50ZXJuYWxzKHIsdCxlLG4scyxvLGEsYyl7dmFyIGw9W10sdT0wLGg9MCxwPSExLG09ZnVuY3Rpb24oKXtwJiYhbC5sZW5ndGgmJiF1JiZ0LmNvbXBsZXRlKCl9LHY9ZnVuY3Rpb24oVCl7cmV0dXJuIHU8bj93KFQpOmwucHVzaChUKX0sdz1mdW5jdGlvbihUKXtvJiZ0Lm5leHQoVCksdSsrO3ZhciBTPSExO2lubmVyRnJvbShlKFQsaCsrKSkuc3Vic2NyaWJlKGNyZWF0ZU9wZXJhdG9yU3Vic2NyaWJlcih0LGZ1bmN0aW9uKEMpe3M9PW51bGx8fHMoQyksbz92KEMpOnQubmV4dChDKX0sZnVuY3Rpb24oKXtTPSEwfSx2b2lkIDAsZnVuY3Rpb24oKXtpZihTKXRyeXt1LS07Zm9yKHZhciBDPWZ1bmN0aW9uKCl7dmFyIE09bC5zaGlmdCgpO2E/ZXhlY3V0ZVNjaGVkdWxlKHQsYSxmdW5jdGlvbigpe3JldHVybiB3KE0pfSk6dyhNKX07bC5sZW5ndGgmJnU8bjspQygpO20oKX1jYXRjaChNKXt0LmVycm9yKE0pfX0pKX07cmV0dXJuIHIuc3Vic2NyaWJlKGNyZWF0ZU9wZXJhdG9yU3Vic2NyaWJlcih0LHYsZnVuY3Rpb24oKXtwPSEwLG0oKX0pKSxmdW5jdGlvbigpe2M9PW51bGx8fGMoKX19ZnVuY3Rpb24gbWVyZ2VNYXAocix0LGUpe3JldHVybiBlPT09dm9pZCAwJiYoZT0xLzApLGlzRnVuY3Rpb24kMSh0KT9tZXJnZU1hcChmdW5jdGlvbihuLHMpe3JldHVybiBtYXAoZnVuY3Rpb24obyxhKXtyZXR1cm4gdChuLG8scyxhKX0pKGlubmVyRnJvbShyKG4scykpKX0sZSk6KHR5cGVvZiB0PT0ibnVtYmVyIiYmKGU9dCksb3BlcmF0ZShmdW5jdGlvbihuLHMpe3JldHVybiBtZXJnZUludGVybmFscyhuLHMscixlKX0pKX12YXIgbm9kZUV2ZW50RW1pdHRlck1ldGhvZHM9WyJhZGRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIl0sZXZlbnRUYXJnZXRNZXRob2RzPVsiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiXSxqcXVlcnlNZXRob2RzPVsib24iLCJvZmYiXTtmdW5jdGlvbiBmcm9tRXZlbnQocix0LGUsbil7aWYoaXNGdW5jdGlvbiQxKGUpJiYobj1lLGU9dm9pZCAwKSxuKXJldHVybiBmcm9tRXZlbnQocix0LGUpLnBpcGUobWFwT25lT3JNYW55QXJncyhuKSk7dmFyIHM9X19yZWFkKGlzRXZlbnRUYXJnZXQocik/ZXZlbnRUYXJnZXRNZXRob2RzLm1hcChmdW5jdGlvbihjKXtyZXR1cm4gZnVuY3Rpb24obCl7cmV0dXJuIHJbY10odCxsLGUpfX0pOmlzTm9kZVN0eWxlRXZlbnRFbWl0dGVyKHIpP25vZGVFdmVudEVtaXR0ZXJNZXRob2RzLm1hcCh0b0NvbW1vbkhhbmRsZXJSZWdpc3RyeShyLHQpKTppc0pRdWVyeVN0eWxlRXZlbnRFbWl0dGVyKHIpP2pxdWVyeU1ldGhvZHMubWFwKHRvQ29tbW9uSGFuZGxlclJlZ2lzdHJ5KHIsdCkpOltdLDIpLG89c1swXSxhPXNbMV07aWYoIW8mJmlzQXJyYXlMaWtlKHIpKXJldHVybiBtZXJnZU1hcChmdW5jdGlvbihjKXtyZXR1cm4gZnJvbUV2ZW50KGMsdCxlKX0pKGlubmVyRnJvbShyKSk7aWYoIW8pdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBldmVudCB0YXJnZXQiKTtyZXR1cm4gbmV3IE9ic2VydmFibGUoZnVuY3Rpb24oYyl7dmFyIGw9ZnVuY3Rpb24oKXtmb3IodmFyIHU9W10saD0wO2g8YXJndW1lbnRzLmxlbmd0aDtoKyspdVtoXT1hcmd1bWVudHNbaF07cmV0dXJuIGMubmV4dCgxPHUubGVuZ3RoP3U6dVswXSl9O3JldHVybiBvKGwpLGZ1bmN0aW9uKCl7cmV0dXJuIGEobCl9fSl9ZnVuY3Rpb24gdG9Db21tb25IYW5kbGVyUmVnaXN0cnkocix0KXtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiByW2VdKHQsbil9fX1mdW5jdGlvbiBpc05vZGVTdHlsZUV2ZW50RW1pdHRlcihyKXtyZXR1cm4gaXNGdW5jdGlvbiQxKHIuYWRkTGlzdGVuZXIpJiZpc0Z1bmN0aW9uJDEoci5yZW1vdmVMaXN0ZW5lcil9ZnVuY3Rpb24gaXNKUXVlcnlTdHlsZUV2ZW50RW1pdHRlcihyKXtyZXR1cm4gaXNGdW5jdGlvbiQxKHIub24pJiZpc0Z1bmN0aW9uJDEoci5vZmYpfWZ1bmN0aW9uIGlzRXZlbnRUYXJnZXQocil7cmV0dXJuIGlzRnVuY3Rpb24kMShyLmFkZEV2ZW50TGlzdGVuZXIpJiZpc0Z1bmN0aW9uJDEoci5yZW1vdmVFdmVudExpc3RlbmVyKX1mdW5jdGlvbiBmaWx0ZXIocix0KXtyZXR1cm4gb3BlcmF0ZShmdW5jdGlvbihlLG4pe3ZhciBzPTA7ZS5zdWJzY3JpYmUoY3JlYXRlT3BlcmF0b3JTdWJzY3JpYmVyKG4sZnVuY3Rpb24obyl7cmV0dXJuIHIuY2FsbCh0LG8scysrKSYmbi5uZXh0KG8pfSkpfSl9ZnVuY3Rpb24gc2hhcmUocil7cj09PXZvaWQgMCYmKHI9e30pO3ZhciB0PXIuY29ubmVjdG9yLGU9dD09PXZvaWQgMD9mdW5jdGlvbigpe3JldHVybiBuZXcgU3ViamVjdH06dCxuPXIucmVzZXRPbkVycm9yLHM9bj09PXZvaWQgMD8hMDpuLG89ci5yZXNldE9uQ29tcGxldGUsYT1vPT09dm9pZCAwPyEwOm8sYz1yLnJlc2V0T25SZWZDb3VudFplcm8sbD1jPT09dm9pZCAwPyEwOmM7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBoLHAsbSx2PTAsdz0hMSxUPSExLFM9ZnVuY3Rpb24oKXtwPT1udWxsfHxwLnVuc3Vic2NyaWJlKCkscD12b2lkIDB9LEM9ZnVuY3Rpb24oKXtTKCksaD1tPXZvaWQgMCx3PVQ9ITF9LE09ZnVuY3Rpb24oKXt2YXIgUj1oO0MoKSxSPT1udWxsfHxSLnVuc3Vic2NyaWJlKCl9O3JldHVybiBvcGVyYXRlKGZ1bmN0aW9uKFIsail7disrLCFUJiYhdyYmUygpO3ZhciBMPW09bSE9bnVsbD9tOmUoKTtqLmFkZChmdW5jdGlvbigpe3YtLSx2PT09MCYmIVQmJiF3JiYocD1oYW5kbGVSZXNldChNLGwpKX0pLEwuc3Vic2NyaWJlKGopLCFoJiZ2PjAmJihoPW5ldyBTYWZlU3Vic2NyaWJlcih7bmV4dDpmdW5jdGlvbihXKXtyZXR1cm4gTC5uZXh0KFcpfSxlcnJvcjpmdW5jdGlvbihXKXtUPSEwLFMoKSxwPWhhbmRsZVJlc2V0KEMscyxXKSxMLmVycm9yKFcpfSxjb21wbGV0ZTpmdW5jdGlvbigpe3c9ITAsUygpLHA9aGFuZGxlUmVzZXQoQyxhKSxMLmNvbXBsZXRlKCl9fSksaW5uZXJGcm9tKFIpLnN1YnNjcmliZShoKSl9KSh1KX19ZnVuY3Rpb24gaGFuZGxlUmVzZXQocix0KXtmb3IodmFyIGU9W10sbj0yO248YXJndW1lbnRzLmxlbmd0aDtuKyspZVtuLTJdPWFyZ3VtZW50c1tuXTtpZih0PT09ITApe3IoKTtyZXR1cm59aWYodCE9PSExKXt2YXIgcz1uZXcgU2FmZVN1YnNjcmliZXIoe25leHQ6ZnVuY3Rpb24oKXtzLnVuc3Vic2NyaWJlKCkscigpfX0pO3JldHVybiBpbm5lckZyb20odC5hcHBseSh2b2lkIDAsX19zcHJlYWRBcnJheShbXSxfX3JlYWQoZSkpKSkuc3Vic2NyaWJlKHMpfX1mdW5jdGlvbiB0YXAocix0LGUpe3ZhciBuPWlzRnVuY3Rpb24kMShyKXx8dHx8ZT97bmV4dDpyLGVycm9yOnQsY29tcGxldGU6ZX06cjtyZXR1cm4gbj9vcGVyYXRlKGZ1bmN0aW9uKHMsbyl7dmFyIGE7KGE9bi5zdWJzY3JpYmUpPT09bnVsbHx8YT09PXZvaWQgMHx8YS5jYWxsKG4pO3ZhciBjPSEwO3Muc3Vic2NyaWJlKGNyZWF0ZU9wZXJhdG9yU3Vic2NyaWJlcihvLGZ1bmN0aW9uKGwpe3ZhciB1Oyh1PW4ubmV4dCk9PT1udWxsfHx1PT09dm9pZCAwfHx1LmNhbGwobixsKSxvLm5leHQobCl9LGZ1bmN0aW9uKCl7dmFyIGw7Yz0hMSwobD1uLmNvbXBsZXRlKT09PW51bGx8fGw9PT12b2lkIDB8fGwuY2FsbChuKSxvLmNvbXBsZXRlKCl9LGZ1bmN0aW9uKGwpe3ZhciB1O2M9ITEsKHU9bi5lcnJvcik9PT1udWxsfHx1PT09dm9pZCAwfHx1LmNhbGwobixsKSxvLmVycm9yKGwpfSxmdW5jdGlvbigpe3ZhciBsLHU7YyYmKChsPW4udW5zdWJzY3JpYmUpPT09bnVsbHx8bD09PXZvaWQgMHx8bC5jYWxsKG4pKSwodT1uLmZpbmFsaXplKT09PW51bGx8fHU9PT12b2lkIDB8fHUuY2FsbChuKX0pKX0pOmlkZW50aXR5fWNvbnN0IEJSSURHSU5HX1RPUElDPSJieXRlcmVwbGF5LmJyaWRnaW5nIjtmdW5jdGlvbiB3b3JrZXJCcmlkZ2UoKXtyZXR1cm4gZnJvbUV2ZW50KGdsb2JhbFRoaXMsIm1lc3NhZ2UiKS5waXBlKG1hcChyPT57Y29uc3QgZT1yLmRhdGE7aWYodHlwZW9mIGU9PSJvYmplY3QiJiZlLnRvcGljPT09QlJJREdJTkdfVE9QSUMpe2NvbnN0IG49ZTtpZihuLmNvbnRlbnRUeXBlPT09ImJ5dGVyZXBsYXkuY29yZS5GcmFtZSIpcmV0dXJuIG4uY29udGVudH1yZXR1cm4gbnVsbH0pLGZpbHRlcihyPT5yIT09bnVsbCkpfWNsYXNzIFJ1bnRpbWVFcnJvciBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGUsbil7dmFyIHM7c3VwZXIoZSxuKTtmKHRoaXMsImxvY2FsaXplZE1lc3NhZ2UiKTt0aGlzLm5hbWU9ImJ5dGVyZXBsYXkuY29yZS5SdW50aW1lRXJyb3IiLHRoaXMubG9jYWxpemVkTWVzc2FnZT0ocz1uPT1udWxsP3ZvaWQgMDpuLmxvY2FsaXplZE1lc3NhZ2UpIT1udWxsP3M6ZX19Y2xhc3MgU2VydmVyRXJyb3IgZXh0ZW5kcyBSdW50aW1lRXJyb3J7Y29uc3RydWN0b3IoZSxuKXtzdXBlcihlLG4pO2YodGhpcywiX2NvZGUiKTt0aGlzLm5hbWU9ImJ5dGVyZXBsYXkuY29yZS5TZXJ2ZXJFcnJvciIsdGhpcy5fY29kZT1uPT1udWxsP3ZvaWQgMDpuLmNvZGV9Z2V0IGNvZGUoKXtyZXR1cm4gdGhpcy5fY29kZX19Y2xhc3MgVW5zdXBwb3J0ZWRFcnJvciBleHRlbmRzIFJ1bnRpbWVFcnJvcntjb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5uYW1lPSJieXRlcmVwbGF5LmNvcmUuVW5zdXBwb3J0ZWRFcnJvciJ9fS8qISBmb3JtZGF0YS1wb2x5ZmlsbC4gTUlUIExpY2Vuc2UuIEppbW15IFc/cnRpbmcgPGh0dHBzOi8vamltbXkud2FydGluZy5zZS9vcGVuc291cmNlPiAqLyhmdW5jdGlvbigpe3ZhciByO2Z1bmN0aW9uIHQoZCl7dmFyIF89MDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gXzxkLmxlbmd0aD97ZG9uZTohMSx2YWx1ZTpkW18rK119Ontkb25lOiEwfX19dmFyIGU9dHlwZW9mIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzPT0iZnVuY3Rpb24iP09iamVjdC5kZWZpbmVQcm9wZXJ0eTpmdW5jdGlvbihkLF8sZyl7cmV0dXJuIGQ9PUFycmF5LnByb3RvdHlwZXx8ZD09T2JqZWN0LnByb3RvdHlwZXx8KGRbX109Zy52YWx1ZSksZH07ZnVuY3Rpb24gbihkKXtkPVt0eXBlb2YgZ2xvYmFsVGhpcz09Im9iamVjdCImJmdsb2JhbFRoaXMsZCx0eXBlb2Ygd2luZG93PT0ib2JqZWN0IiYmd2luZG93LHR5cGVvZiBzZWxmPT0ib2JqZWN0IiYmc2VsZix0eXBlb2YgY29tbW9uanNHbG9iYWw9PSJvYmplY3QiJiZjb21tb25qc0dsb2JhbF07Zm9yKHZhciBfPTA7XzxkLmxlbmd0aDsrK18pe3ZhciBnPWRbX107aWYoZyYmZy5NYXRoPT1NYXRoKXJldHVybiBnfXRocm93IEVycm9yKCJDYW5ub3QgZmluZCBnbG9iYWwgb2JqZWN0Iil9dmFyIHM9bih0aGlzKTtmdW5jdGlvbiBvKGQsXyl7aWYoXyllOnt2YXIgZz1zO2Q9ZC5zcGxpdCgiLiIpO2Zvcih2YXIgeT0wO3k8ZC5sZW5ndGgtMTt5Kyspe3ZhciBFPWRbeV07aWYoIShFIGluIGcpKWJyZWFrIGU7Zz1nW0VdfWQ9ZFtkLmxlbmd0aC0xXSx5PWdbZF0sXz1fKHkpLF8hPXkmJl8hPW51bGwmJmUoZyxkLHtjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6X30pfX1vKCJTeW1ib2wiLGZ1bmN0aW9uKGQpe2Z1bmN0aW9uIF8oQil7aWYodGhpcyBpbnN0YW5jZW9mIF8pdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yIik7cmV0dXJuIG5ldyBnKHkrKEJ8fCIiKSsiXyIrRSsrLEIpfWZ1bmN0aW9uIGcoQixZKXt0aGlzLkE9QixlKHRoaXMsImRlc2NyaXB0aW9uIix7Y29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOll9KX1pZihkKXJldHVybiBkO2cucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuQX07dmFyIHk9ImpzY29tcF9zeW1ib2xfIisoMWU5Kk1hdGgucmFuZG9tKCk+Pj4wKSsiXyIsRT0wO3JldHVybiBffSksbygiU3ltYm9sLml0ZXJhdG9yIixmdW5jdGlvbihkKXtpZihkKXJldHVybiBkO2Q9U3ltYm9sKCJTeW1ib2wuaXRlcmF0b3IiKTtmb3IodmFyIF89IkFycmF5IEludDhBcnJheSBVaW50OEFycmF5IFVpbnQ4Q2xhbXBlZEFycmF5IEludDE2QXJyYXkgVWludDE2QXJyYXkgSW50MzJBcnJheSBVaW50MzJBcnJheSBGbG9hdDMyQXJyYXkgRmxvYXQ2NEFycmF5Ii5zcGxpdCgiICIpLGc9MDtnPF8ubGVuZ3RoO2crKyl7dmFyIHk9c1tfW2ddXTt0eXBlb2YgeT09ImZ1bmN0aW9uIiYmdHlwZW9mIHkucHJvdG90eXBlW2RdIT0iZnVuY3Rpb24iJiZlKHkucHJvdG90eXBlLGQse2NvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTpmdW5jdGlvbigpe3JldHVybiBhKHQodGhpcykpfX0pfXJldHVybiBkfSk7ZnVuY3Rpb24gYShkKXtyZXR1cm4gZD17bmV4dDpkfSxkW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sZH1mdW5jdGlvbiBjKGQpe3ZhciBfPXR5cGVvZiBTeW1ib2whPSJ1bmRlZmluZWQiJiZTeW1ib2wuaXRlcmF0b3ImJmRbU3ltYm9sLml0ZXJhdG9yXTtyZXR1cm4gXz9fLmNhbGwoZCk6e25leHQ6dChkKX19dmFyIGw7aWYodHlwZW9mIE9iamVjdC5zZXRQcm90b3R5cGVPZj09ImZ1bmN0aW9uIilsPU9iamVjdC5zZXRQcm90b3R5cGVPZjtlbHNle3ZhciB1O2U6e3ZhciBoPXthOiEwfSxwPXt9O3RyeXtwLl9fcHJvdG9fXz1oLHU9cC5hO2JyZWFrIGV9Y2F0Y2goZCl7fXU9ITF9bD11P2Z1bmN0aW9uKGQsXyl7aWYoZC5fX3Byb3RvX189XyxkLl9fcHJvdG9fXyE9PV8pdGhyb3cgbmV3IFR5cGVFcnJvcihkKyIgaXMgbm90IGV4dGVuc2libGUiKTtyZXR1cm4gZH06bnVsbH12YXIgbT1sO2Z1bmN0aW9uIHYoKXt0aGlzLm09ITEsdGhpcy5qPW51bGwsdGhpcy52PXZvaWQgMCx0aGlzLmg9MSx0aGlzLnU9dGhpcy5DPTAsdGhpcy5sPW51bGx9ZnVuY3Rpb24gdyhkKXtpZihkLm0pdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2QubT0hMH12LnByb3RvdHlwZS5vPWZ1bmN0aW9uKGQpe3RoaXMudj1kfSx2LnByb3RvdHlwZS5zPWZ1bmN0aW9uKGQpe3RoaXMubD17RDpkLEY6ITB9LHRoaXMuaD10aGlzLkN8fHRoaXMudX0sdi5wcm90b3R5cGUucmV0dXJuPWZ1bmN0aW9uKGQpe3RoaXMubD17cmV0dXJuOmR9LHRoaXMuaD10aGlzLnV9O2Z1bmN0aW9uIFQoZCxfKXtyZXR1cm4gZC5oPTMse3ZhbHVlOl99fWZ1bmN0aW9uIFMoZCl7dGhpcy5nPW5ldyB2LHRoaXMuRz1kfVMucHJvdG90eXBlLm89ZnVuY3Rpb24oZCl7cmV0dXJuIHcodGhpcy5nKSx0aGlzLmcuaj9NKHRoaXMsdGhpcy5nLmoubmV4dCxkLHRoaXMuZy5vKToodGhpcy5nLm8oZCksUih0aGlzKSl9O2Z1bmN0aW9uIEMoZCxfKXt3KGQuZyk7dmFyIGc9ZC5nLmo7cmV0dXJuIGc/TShkLCJyZXR1cm4iaW4gZz9nLnJldHVybjpmdW5jdGlvbih5KXtyZXR1cm57dmFsdWU6eSxkb25lOiEwfX0sXyxkLmcucmV0dXJuKTooZC5nLnJldHVybihfKSxSKGQpKX1TLnByb3RvdHlwZS5zPWZ1bmN0aW9uKGQpe3JldHVybiB3KHRoaXMuZyksdGhpcy5nLmo/TSh0aGlzLHRoaXMuZy5qLnRocm93LGQsdGhpcy5nLm8pOih0aGlzLmcucyhkKSxSKHRoaXMpKX07ZnVuY3Rpb24gTShkLF8sZyx5KXt0cnl7dmFyIEU9Xy5jYWxsKGQuZy5qLGcpO2lmKCEoRSBpbnN0YW5jZW9mIE9iamVjdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiSXRlcmF0b3IgcmVzdWx0ICIrRSsiIGlzIG5vdCBhbiBvYmplY3QiKTtpZighRS5kb25lKXJldHVybiBkLmcubT0hMSxFO3ZhciBCPUUudmFsdWV9Y2F0Y2goWSl7cmV0dXJuIGQuZy5qPW51bGwsZC5nLnMoWSksUihkKX1yZXR1cm4gZC5nLmo9bnVsbCx5LmNhbGwoZC5nLEIpLFIoZCl9ZnVuY3Rpb24gUihkKXtmb3IoO2QuZy5oOyl0cnl7dmFyIF89ZC5HKGQuZyk7aWYoXylyZXR1cm4gZC5nLm09ITEse3ZhbHVlOl8udmFsdWUsZG9uZTohMX19Y2F0Y2goZyl7ZC5nLnY9dm9pZCAwLGQuZy5zKGcpfWlmKGQuZy5tPSExLGQuZy5sKXtpZihfPWQuZy5sLGQuZy5sPW51bGwsXy5GKXRocm93IF8uRDtyZXR1cm57dmFsdWU6Xy5yZXR1cm4sZG9uZTohMH19cmV0dXJue3ZhbHVlOnZvaWQgMCxkb25lOiEwfX1mdW5jdGlvbiBqKGQpe3RoaXMubmV4dD1mdW5jdGlvbihfKXtyZXR1cm4gZC5vKF8pfSx0aGlzLnRocm93PWZ1bmN0aW9uKF8pe3JldHVybiBkLnMoXyl9LHRoaXMucmV0dXJuPWZ1bmN0aW9uKF8pe3JldHVybiBDKGQsXyl9LHRoaXNbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfX1mdW5jdGlvbiBMKGQsXyl7cmV0dXJuIF89bmV3IGoobmV3IFMoXykpLG0mJmQucHJvdG90eXBlJiZtKF8sZC5wcm90b3R5cGUpLF99ZnVuY3Rpb24gVyhkLF8pe2QgaW5zdGFuY2VvZiBTdHJpbmcmJihkKz0iIik7dmFyIGc9MCx5PSExLEU9e25leHQ6ZnVuY3Rpb24oKXtpZigheSYmZzxkLmxlbmd0aCl7dmFyIEI9ZysrO3JldHVybnt2YWx1ZTpfKEIsZFtCXSksZG9uZTohMX19cmV0dXJuIHk9ITAse2RvbmU6ITAsdmFsdWU6dm9pZCAwfX19O3JldHVybiBFW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gRX0sRX1pZihvKCJBcnJheS5wcm90b3R5cGUuZW50cmllcyIsZnVuY3Rpb24oZCl7cmV0dXJuIGR8fGZ1bmN0aW9uKCl7cmV0dXJuIFcodGhpcyxmdW5jdGlvbihfLGcpe3JldHVybltfLGddfSl9fSksdHlwZW9mIEJsb2IhPSJ1bmRlZmluZWQiJiYodHlwZW9mIEZvcm1EYXRhPT0idW5kZWZpbmVkInx8IUZvcm1EYXRhLnByb3RvdHlwZS5rZXlzKSl7dmFyIEg9ZnVuY3Rpb24oZCxfKXtmb3IodmFyIGc9MDtnPGQubGVuZ3RoO2crKylfKGRbZ10pfSxEPWZ1bmN0aW9uKGQpe3JldHVybiBkLnJlcGxhY2UoL1xyP1xufFxyL2csYFxyCmApfSxJPWZ1bmN0aW9uKGQsXyxnKXtyZXR1cm4gXyBpbnN0YW5jZW9mIEJsb2I/KGc9ZyE9PXZvaWQgMD9nKyIiOnR5cGVvZiBfLm5hbWU9PSJzdHJpbmciP18ubmFtZToiYmxvYiIsKF8ubmFtZSE9PWd8fE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChfKT09PSJbb2JqZWN0IEJsb2JdIikmJihfPW5ldyBGaWxlKFtfXSxnKSksW1N0cmluZyhkKSxfXSk6W1N0cmluZyhkKSxTdHJpbmcoXyldfSx6PWZ1bmN0aW9uKGQsXyl7aWYoZC5sZW5ndGg8Xyl0aHJvdyBuZXcgVHlwZUVycm9yKF8rIiBhcmd1bWVudCByZXF1aXJlZCwgYnV0IG9ubHkgIitkLmxlbmd0aCsiIHByZXNlbnQuIil9LFU9dHlwZW9mIGdsb2JhbFRoaXM9PSJvYmplY3QiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdz09Im9iamVjdCI/d2luZG93OnR5cGVvZiBzZWxmPT0ib2JqZWN0Ij9zZWxmOnRoaXMsSz1VLkZvcm1EYXRhLGVlPVUuWE1MSHR0cFJlcXVlc3QmJlUuWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLnNlbmQsSj1VLlJlcXVlc3QmJlUuZmV0Y2gsWj1VLm5hdmlnYXRvciYmVS5uYXZpZ2F0b3Iuc2VuZEJlYWNvbixWPVUuRWxlbWVudCYmVS5FbGVtZW50LnByb3RvdHlwZSxGPVUuU3ltYm9sJiZTeW1ib2wudG9TdHJpbmdUYWc7RiYmKEJsb2IucHJvdG90eXBlW0ZdfHwoQmxvYi5wcm90b3R5cGVbRl09IkJsb2IiKSwiRmlsZSJpbiBVJiYhRmlsZS5wcm90b3R5cGVbRl0mJihGaWxlLnByb3RvdHlwZVtGXT0iRmlsZSIpKTt0cnl7bmV3IEZpbGUoW10sIiIpfWNhdGNoKGQpe1UuRmlsZT1mdW5jdGlvbihfLGcseSl7cmV0dXJuIF89bmV3IEJsb2IoXyx5fHx7fSksT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoXyx7bmFtZTp7dmFsdWU6Z30sbGFzdE1vZGlmaWVkOnt2YWx1ZTorKHkmJnkubGFzdE1vZGlmaWVkIT09dm9pZCAwP25ldyBEYXRlKHkubGFzdE1vZGlmaWVkKTpuZXcgRGF0ZSl9LHRvU3RyaW5nOnt2YWx1ZTpmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEZpbGVdIn19fSksRiYmT2JqZWN0LmRlZmluZVByb3BlcnR5KF8sRix7dmFsdWU6IkZpbGUifSksX319dmFyIHE9ZnVuY3Rpb24oZCl7cmV0dXJuIGQucmVwbGFjZSgvXG4vZywiJTBBIikucmVwbGFjZSgvXHIvZywiJTBEIikucmVwbGFjZSgvIi9nLCIlMjIiKX0sRz1mdW5jdGlvbihkKXt0aGlzLmk9W107dmFyIF89dGhpcztkJiZIKGQuZWxlbWVudHMsZnVuY3Rpb24oZyl7aWYoZy5uYW1lJiYhZy5kaXNhYmxlZCYmZy50eXBlIT09InN1Ym1pdCImJmcudHlwZSE9PSJidXR0b24iJiYhZy5tYXRjaGVzKCJmb3JtIGZpZWxkc2V0W2Rpc2FibGVkXSAqIikpaWYoZy50eXBlPT09ImZpbGUiKXt2YXIgeT1nLmZpbGVzJiZnLmZpbGVzLmxlbmd0aD9nLmZpbGVzOltuZXcgRmlsZShbXSwiIix7dHlwZToiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIn0pXTtIKHksZnVuY3Rpb24oRSl7Xy5hcHBlbmQoZy5uYW1lLEUpfSl9ZWxzZSBnLnR5cGU9PT0ic2VsZWN0LW11bHRpcGxlInx8Zy50eXBlPT09InNlbGVjdC1vbmUiP0goZy5vcHRpb25zLGZ1bmN0aW9uKEUpeyFFLmRpc2FibGVkJiZFLnNlbGVjdGVkJiZfLmFwcGVuZChnLm5hbWUsRS52YWx1ZSl9KTpnLnR5cGU9PT0iY2hlY2tib3gifHxnLnR5cGU9PT0icmFkaW8iP2cuY2hlY2tlZCYmXy5hcHBlbmQoZy5uYW1lLGcudmFsdWUpOih5PWcudHlwZT09PSJ0ZXh0YXJlYSI/RChnLnZhbHVlKTpnLnZhbHVlLF8uYXBwZW5kKGcubmFtZSx5KSl9KX07aWYocj1HLnByb3RvdHlwZSxyLmFwcGVuZD1mdW5jdGlvbihkLF8sZyl7eihhcmd1bWVudHMsMiksdGhpcy5pLnB1c2goSShkLF8sZykpfSxyLmRlbGV0ZT1mdW5jdGlvbihkKXt6KGFyZ3VtZW50cywxKTt2YXIgXz1bXTtkPVN0cmluZyhkKSxIKHRoaXMuaSxmdW5jdGlvbihnKXtnWzBdIT09ZCYmXy5wdXNoKGcpfSksdGhpcy5pPV99LHIuZW50cmllcz1mdW5jdGlvbiBkKCl7dmFyIF8sZz10aGlzO3JldHVybiBMKGQsZnVuY3Rpb24oeSl7aWYoeS5oPT0xJiYoXz0wKSx5LmghPTMpcmV0dXJuIF88Zy5pLmxlbmd0aD95PVQoeSxnLmlbX10pOih5Lmg9MCx5PXZvaWQgMCkseTtfKysseS5oPTJ9KX0sci5mb3JFYWNoPWZ1bmN0aW9uKGQsXyl7eihhcmd1bWVudHMsMSk7Zm9yKHZhciBnPWModGhpcykseT1nLm5leHQoKTsheS5kb25lO3k9Zy5uZXh0KCkpe3ZhciBFPWMoeS52YWx1ZSk7eT1FLm5leHQoKS52YWx1ZSxFPUUubmV4dCgpLnZhbHVlLGQuY2FsbChfLEUseSx0aGlzKX19LHIuZ2V0PWZ1bmN0aW9uKGQpe3ooYXJndW1lbnRzLDEpO3ZhciBfPXRoaXMuaTtkPVN0cmluZyhkKTtmb3IodmFyIGc9MDtnPF8ubGVuZ3RoO2crKylpZihfW2ddWzBdPT09ZClyZXR1cm4gX1tnXVsxXTtyZXR1cm4gbnVsbH0sci5nZXRBbGw9ZnVuY3Rpb24oZCl7eihhcmd1bWVudHMsMSk7dmFyIF89W107cmV0dXJuIGQ9U3RyaW5nKGQpLEgodGhpcy5pLGZ1bmN0aW9uKGcpe2dbMF09PT1kJiZfLnB1c2goZ1sxXSl9KSxffSxyLmhhcz1mdW5jdGlvbihkKXt6KGFyZ3VtZW50cywxKSxkPVN0cmluZyhkKTtmb3IodmFyIF89MDtfPHRoaXMuaS5sZW5ndGg7XysrKWlmKHRoaXMuaVtfXVswXT09PWQpcmV0dXJuITA7cmV0dXJuITF9LHIua2V5cz1mdW5jdGlvbiBkKCl7dmFyIF89dGhpcyxnLHksRSxCLFk7cmV0dXJuIEwoZCxmdW5jdGlvbihYKXtpZihYLmg9PTEmJihnPWMoXykseT1nLm5leHQoKSksWC5oIT0zKXtpZih5LmRvbmUpe1guaD0wO3JldHVybn1yZXR1cm4gRT15LnZhbHVlLEI9YyhFKSxZPUIubmV4dCgpLnZhbHVlLFQoWCxZKX15PWcubmV4dCgpLFguaD0yfSl9LHIuc2V0PWZ1bmN0aW9uKGQsXyxnKXt6KGFyZ3VtZW50cywyKSxkPVN0cmluZyhkKTt2YXIgeT1bXSxFPUkoZCxfLGcpLEI9ITA7SCh0aGlzLmksZnVuY3Rpb24oWSl7WVswXT09PWQ/QiYmKEI9IXkucHVzaChFKSk6eS5wdXNoKFkpfSksQiYmeS5wdXNoKEUpLHRoaXMuaT15fSxyLnZhbHVlcz1mdW5jdGlvbiBkKCl7dmFyIF89dGhpcyxnLHksRSxCLFk7cmV0dXJuIEwoZCxmdW5jdGlvbihYKXtpZihYLmg9PTEmJihnPWMoXykseT1nLm5leHQoKSksWC5oIT0zKXtpZih5LmRvbmUpe1guaD0wO3JldHVybn1yZXR1cm4gRT15LnZhbHVlLEI9YyhFKSxCLm5leHQoKSxZPUIubmV4dCgpLnZhbHVlLFQoWCxZKX15PWcubmV4dCgpLFguaD0yfSl9LEcucHJvdG90eXBlLl9hc05hdGl2ZT1mdW5jdGlvbigpe2Zvcih2YXIgZD1uZXcgSyxfPWModGhpcyksZz1fLm5leHQoKTshZy5kb25lO2c9Xy5uZXh0KCkpe3ZhciB5PWMoZy52YWx1ZSk7Zz15Lm5leHQoKS52YWx1ZSx5PXkubmV4dCgpLnZhbHVlLGQuYXBwZW5kKGcseSl9cmV0dXJuIGR9LEcucHJvdG90eXBlLl9ibG9iPWZ1bmN0aW9uKCl7dmFyIGQ9Ii0tLS1mb3JtZGF0YS1wb2x5ZmlsbC0iK01hdGgucmFuZG9tKCksXz1bXSxnPSItLSIrZCtgXHIKQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSJgO3JldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24oeSxFKXtyZXR1cm4gdHlwZW9mIHk9PSJzdHJpbmciP18ucHVzaChnK3EoRChFKSkrKGAiXHIKXHIKYCtEKHkpK2BccgpgKSk6Xy5wdXNoKGcrcShEKEUpKSsoJyI7IGZpbGVuYW1lPSInK3EoeS5uYW1lKStgIlxyCkNvbnRlbnQtVHlwZTogYCsoeS50eXBlfHwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIikrYFxyClxyCmApLHksYFxyCmApfSksXy5wdXNoKCItLSIrZCsiLS0iKSxuZXcgQmxvYihfLHt0eXBlOiJtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0iK2R9KX0sRy5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVudHJpZXMoKX0sRy5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iW29iamVjdCBGb3JtRGF0YV0ifSxWJiYhVi5tYXRjaGVzJiYoVi5tYXRjaGVzPVYubWF0Y2hlc1NlbGVjdG9yfHxWLm1vek1hdGNoZXNTZWxlY3Rvcnx8Vi5tc01hdGNoZXNTZWxlY3Rvcnx8Vi5vTWF0Y2hlc1NlbGVjdG9yfHxWLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8ZnVuY3Rpb24oZCl7ZD0odGhpcy5kb2N1bWVudHx8dGhpcy5vd25lckRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKGQpO2Zvcih2YXIgXz1kLmxlbmd0aDswPD0tLV8mJmQuaXRlbShfKSE9PXRoaXM7KTtyZXR1cm4tMTxffSksRiYmKEcucHJvdG90eXBlW0ZdPSJGb3JtRGF0YSIpLGVlKXt2YXIgdGU9VS5YTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUuc2V0UmVxdWVzdEhlYWRlcjtVLlhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5zZXRSZXF1ZXN0SGVhZGVyPWZ1bmN0aW9uKGQsXyl7dGUuY2FsbCh0aGlzLGQsXyksZC50b0xvd2VyQ2FzZSgpPT09ImNvbnRlbnQtdHlwZSImJih0aGlzLkI9ITApfSxVLlhNTEh0dHBSZXF1ZXN0LnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKGQpe2QgaW5zdGFuY2VvZiBHPyhkPWQuX2Jsb2IoKSx0aGlzLkJ8fHRoaXMuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIixkLnR5cGUpLGVlLmNhbGwodGhpcyxkKSk6ZWUuY2FsbCh0aGlzLGQpfX1KJiYoVS5mZXRjaD1mdW5jdGlvbihkLF8pe3JldHVybiBfJiZfLmJvZHkmJl8uYm9keSBpbnN0YW5jZW9mIEcmJihfLmJvZHk9Xy5ib2R5Ll9ibG9iKCkpLEouY2FsbCh0aGlzLGQsXyl9KSxaJiYoVS5uYXZpZ2F0b3Iuc2VuZEJlYWNvbj1mdW5jdGlvbihkLF8pe3JldHVybiBfIGluc3RhbmNlb2YgRyYmKF89Xy5fYXNOYXRpdmUoKSksWi5jYWxsKHRoaXMsZCxfKX0pLFUuRm9ybURhdGE9R319KSgpO2Z1bmN0aW9uIGNyZWF0ZUZvcm1EYXRhKCl7cmV0dXJuIG5ldyBGb3JtRGF0YX1mdW5jdGlvbiBpc0Zvcm1EYXRhKHIpe3JldHVybiByIGluc3RhbmNlb2YgRm9ybURhdGF9ZnVuY3Rpb24gaW5jbHVkZXMocix0KXtyZXR1cm4gcj09bnVsbD8hMTpyLmluZGV4T2YodCkhPT0tMX1mdW5jdGlvbiBpc0Z1bmN0aW9uKHIpe3JldHVybiB0eXBlb2Ygcj09ImZ1bmN0aW9uIn1mdW5jdGlvbiBpc1N0cmluZyhyKXtyZXR1cm4gdHlwZW9mIHI9PSJzdHJpbmcifHxyIGluc3RhbmNlb2YgU3RyaW5nfWZ1bmN0aW9uIGlzRW1wdHlTdHJpbmcocil7cmV0dXJuIHIudHJpbSgpPT09IiJ9ZnVuY3Rpb24gcGVyZm9ybWFuY2VPYnNlcnZlcigpe3JldHVybiEhZ2xvYmFsVGhpcy5QZXJmb3JtYW5jZU9ic2VydmVyfWZ1bmN0aW9uIHBlcmZvcm1hbmNlKCl7cmV0dXJuISFnbG9iYWxUaGlzLnBlcmZvcm1hbmNlfWZ1bmN0aW9uIHBlcmZvcm1hbmNlTm93KCl7dmFyIHI7cmV0dXJuIGlzRnVuY3Rpb24oKHI9Z2xvYmFsVGhpcy5wZXJmb3JtYW5jZSk9PW51bGw/dm9pZCAwOnIubm93KX1mdW5jdGlvbiBjb21wcmVzc2lvblN0cmVhbSgpe3JldHVybiBpc0Z1bmN0aW9uKGdsb2JhbFRoaXMuQ29tcHJlc3Npb25TdHJlYW0pfWZ1bmN0aW9uIHN0cnVjdHVyZWRDbG9uZSQxKCl7cmV0dXJuIGlzRnVuY3Rpb24oZ2xvYmFsVGhpcy5zdHJ1Y3R1cmVkQ2xvbmUpfWZ1bmN0aW9uIHdlYldvcmtlcnMoKXtyZXR1cm4hIWdsb2JhbFRoaXMuV29ya2VyfWZ1bmN0aW9uIHdlYlNvY2tldHMoKXtyZXR1cm4hIWdsb2JhbFRoaXMuV2ViU29ja2V0fWZ1bmN0aW9uIGZldGNoJDEocil7dmFyIHQ7cmV0dXJuIGlzRnVuY3Rpb24oKHQ9ciE9bnVsbD9yOmdsb2JhbFRoaXMpPT1udWxsP3ZvaWQgMDp0LmZldGNoKX12YXIgY2l1PU9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGNvbXByZXNzaW9uU3RyZWFtLGZldGNoOmZldGNoJDEscGVyZm9ybWFuY2UscGVyZm9ybWFuY2VOb3cscGVyZm9ybWFuY2VPYnNlcnZlcixzdHJ1Y3R1cmVkQ2xvbmU6c3RydWN0dXJlZENsb25lJDEsd2ViU29ja2V0cyx3ZWJXb3JrZXJzfSk7Y29uc3QgVk9JRD0tMSxQUklNSVRJVkU9MCxBUlJBWT0xLE9CSkVDVD0yLERBVEU9MyxSRUdFWFA9NCxNQVA9NSxTRVQ9NixFUlJPUj03LEJJR0lOVD04LGVudj10eXBlb2Ygc2VsZj09Im9iamVjdCI/c2VsZjpnbG9iYWxUaGlzLGRlc2VyaWFsaXplcj0ocix0KT0+e2NvbnN0IGU9KHMsbyk9PihyLnNldChvLHMpLHMpLG49cz0+e2lmKHIuaGFzKHMpKXJldHVybiByLmdldChzKTtjb25zdFtvLGFdPXRbc107c3dpdGNoKG8pe2Nhc2UgUFJJTUlUSVZFOmNhc2UgVk9JRDpyZXR1cm4gZShhLHMpO2Nhc2UgQVJSQVk6e2NvbnN0IGM9ZShbXSxzKTtmb3IoY29uc3QgbCBvZiBhKWMucHVzaChuKGwpKTtyZXR1cm4gY31jYXNlIE9CSkVDVDp7Y29uc3QgYz1lKHt9LHMpO2Zvcihjb25zdFtsLHVdb2YgYSljW24obCldPW4odSk7cmV0dXJuIGN9Y2FzZSBEQVRFOnJldHVybiBlKG5ldyBEYXRlKGEpLHMpO2Nhc2UgUkVHRVhQOntjb25zdHtzb3VyY2U6YyxmbGFnczpsfT1hO3JldHVybiBlKG5ldyBSZWdFeHAoYyxsKSxzKX1jYXNlIE1BUDp7Y29uc3QgYz1lKG5ldyBNYXAscyk7Zm9yKGNvbnN0W2wsdV1vZiBhKWMuc2V0KG4obCksbih1KSk7cmV0dXJuIGN9Y2FzZSBTRVQ6e2NvbnN0IGM9ZShuZXcgU2V0LHMpO2Zvcihjb25zdCBsIG9mIGEpYy5hZGQobihsKSk7cmV0dXJuIGN9Y2FzZSBFUlJPUjp7Y29uc3R7bmFtZTpjLG1lc3NhZ2U6bH09YTtyZXR1cm4gZShuZXcgZW52W2NdKGwpLHMpfWNhc2UgQklHSU5UOnJldHVybiBlKEJpZ0ludChhKSxzKTtjYXNlIkJpZ0ludCI6cmV0dXJuIGUoT2JqZWN0KEJpZ0ludChhKSkscyl9cmV0dXJuIGUobmV3IGVudltvXShhKSxzKX07cmV0dXJuIG59LGRlc2VyaWFsaXplPXI9PmRlc2VyaWFsaXplcihuZXcgTWFwLHIpKDApLEVNUFRZPSIiLHt0b1N0cmluZ309e30se2tleXN9PU9iamVjdCx0eXBlT2Y9cj0+e2NvbnN0IHQ9dHlwZW9mIHI7aWYodCE9PSJvYmplY3QifHwhcilyZXR1cm5bUFJJTUlUSVZFLHRdO2NvbnN0IGU9dG9TdHJpbmcuY2FsbChyKS5zbGljZSg4LC0xKTtzd2l0Y2goZSl7Y2FzZSJBcnJheSI6cmV0dXJuW0FSUkFZLEVNUFRZXTtjYXNlIk9iamVjdCI6cmV0dXJuW09CSkVDVCxFTVBUWV07Y2FzZSJEYXRlIjpyZXR1cm5bREFURSxFTVBUWV07Y2FzZSJSZWdFeHAiOnJldHVybltSRUdFWFAsRU1QVFldO2Nhc2UiTWFwIjpyZXR1cm5bTUFQLEVNUFRZXTtjYXNlIlNldCI6cmV0dXJuW1NFVCxFTVBUWV19cmV0dXJuIGUuaW5jbHVkZXMoIkFycmF5Iik/W0FSUkFZLGVdOmUuaW5jbHVkZXMoIkVycm9yIik/W0VSUk9SLGVdOltPQkpFQ1QsZV19LHNob3VsZFNraXA9KFtyLHRdKT0+cj09PVBSSU1JVElWRSYmKHQ9PT0iZnVuY3Rpb24ifHx0PT09InN5bWJvbCIpLHNlcmlhbGl6ZXI9KHIsdCxlLG4pPT57Y29uc3Qgcz0oYSxjKT0+e2NvbnN0IGw9bi5wdXNoKGEpLTE7cmV0dXJuIGUuc2V0KGMsbCksbH0sbz1hPT57aWYoZS5oYXMoYSkpcmV0dXJuIGUuZ2V0KGEpO2xldFtjLGxdPXR5cGVPZihhKTtzd2l0Y2goYyl7Y2FzZSBQUklNSVRJVkU6e2xldCBoPWE7c3dpdGNoKGwpe2Nhc2UiYmlnaW50IjpjPUJJR0lOVCxoPWEudG9TdHJpbmcoKTticmVhaztjYXNlImZ1bmN0aW9uIjpjYXNlInN5bWJvbCI6aWYocil0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmFibGUgdG8gc2VyaWFsaXplICIrbCk7aD1udWxsO2JyZWFrO2Nhc2UidW5kZWZpbmVkIjpyZXR1cm4gcyhbVk9JRF0sYSl9cmV0dXJuIHMoW2MsaF0sYSl9Y2FzZSBBUlJBWTp7aWYobClyZXR1cm4gcyhbbCxbLi4uYV1dLGEpO2NvbnN0IGg9W10scD1zKFtjLGhdLGEpO2Zvcihjb25zdCBtIG9mIGEpaC5wdXNoKG8obSkpO3JldHVybiBwfWNhc2UgT0JKRUNUOntpZihsKXN3aXRjaChsKXtjYXNlIkJpZ0ludCI6cmV0dXJuIHMoW2wsYS50b1N0cmluZygpXSxhKTtjYXNlIkJvb2xlYW4iOmNhc2UiTnVtYmVyIjpjYXNlIlN0cmluZyI6cmV0dXJuIHMoW2wsYS52YWx1ZU9mKCldLGEpfWlmKHQmJiJ0b0pTT04iaW4gYSlyZXR1cm4gbyhhLnRvSlNPTigpKTtjb25zdCBoPVtdLHA9cyhbYyxoXSxhKTtmb3IoY29uc3QgbSBvZiBrZXlzKGEpKShyfHwhc2hvdWxkU2tpcCh0eXBlT2YoYVttXSkpKSYmaC5wdXNoKFtvKG0pLG8oYVttXSldKTtyZXR1cm4gcH1jYXNlIERBVEU6cmV0dXJuIHMoW2MsYS50b0lTT1N0cmluZygpXSxhKTtjYXNlIFJFR0VYUDp7Y29uc3R7c291cmNlOmgsZmxhZ3M6cH09YTtyZXR1cm4gcyhbYyx7c291cmNlOmgsZmxhZ3M6cH1dLGEpfWNhc2UgTUFQOntjb25zdCBoPVtdLHA9cyhbYyxoXSxhKTtmb3IoY29uc3RbbSx2XW9mIGEpKHJ8fCEoc2hvdWxkU2tpcCh0eXBlT2YobSkpfHxzaG91bGRTa2lwKHR5cGVPZih2KSkpKSYmaC5wdXNoKFtvKG0pLG8odildKTtyZXR1cm4gcH1jYXNlIFNFVDp7Y29uc3QgaD1bXSxwPXMoW2MsaF0sYSk7Zm9yKGNvbnN0IG0gb2YgYSkocnx8IXNob3VsZFNraXAodHlwZU9mKG0pKSkmJmgucHVzaChvKG0pKTtyZXR1cm4gcH19Y29uc3R7bWVzc2FnZTp1fT1hO3JldHVybiBzKFtjLHtuYW1lOmwsbWVzc2FnZTp1fV0sYSl9O3JldHVybiBvfSxzZXJpYWxpemU9KHIse2pzb246dCxsb3NzeTplfT17fSk9Pntjb25zdCBuPVtdO3JldHVybiBzZXJpYWxpemVyKCEodHx8ZSksISF0LG5ldyBNYXAsbikociksbn07dmFyIF9zdHJ1Y3R1cmVkQ2xvbmU9dHlwZW9mIHN0cnVjdHVyZWRDbG9uZT09ImZ1bmN0aW9uIj8ocix0KT0+dCYmKCJqc29uImluIHR8fCJsb3NzeSJpbiB0KT9kZXNlcmlhbGl6ZShzZXJpYWxpemUocix0KSk6c3RydWN0dXJlZENsb25lKHIpOihyLHQpPT5kZXNlcmlhbGl6ZShzZXJpYWxpemUocix0KSk7Y29uc3QgY2xvbmU9c3RydWN0dXJlZENsb25lJDEoKT9nbG9iYWxUaGlzLnN0cnVjdHVyZWRDbG9uZTpfc3RydWN0dXJlZENsb25lO2Z1bmN0aW9uIGRlZXBDbG9uZShyKXtyZXR1cm4gY2xvbmUocil9dmFyIFZNdXRhdGlvblR5cGU7KGZ1bmN0aW9uKHIpe3Jbci5BZGROb2RlPTFdPSJBZGROb2RlIixyW3IuUmVtb3ZlTm9kZT0yXT0iUmVtb3ZlTm9kZSIscltyLkNoYW5nZUF0dHJpYnV0ZXM9M109IkNoYW5nZUF0dHJpYnV0ZXMiLHJbci5DaGFyYWN0ZXJEYXRhPTRdPSJDaGFyYWN0ZXJEYXRhIixyW3IuRG9jdW1lbnQ9MTBdPSJEb2N1bWVudCIscltyLlN0eWxlU2hlZXRSdWxlPTIwXT0iU3R5bGVTaGVldFJ1bGUiLHJbci5TdHlsZVNoZWV0QWRvcHRlZD0yMV09IlN0eWxlU2hlZXRBZG9wdGVkIn0pKFZNdXRhdGlvblR5cGV8fChWTXV0YXRpb25UeXBlPXt9KSk7dmFyIFZOb2RlVHlwZTsoZnVuY3Rpb24ocil7cltyLkVsZW1lbnROb2RlPTFdPSJFbGVtZW50Tm9kZSIscltyLlRleHROb2RlPTNdPSJUZXh0Tm9kZSIscltyLkNvbW1lbnROb2RlPThdPSJDb21tZW50Tm9kZSIscltyLkRvY3VtZW50Tm9kZT05XT0iRG9jdW1lbnROb2RlIixyW3IuSFRNTE5vZGU9MTBdPSJIVE1MTm9kZSIscltyLkRvY3VtZW50RnJhZ21lbnROb2RlPTExXT0iRG9jdW1lbnRGcmFnbWVudE5vZGUifSkoVk5vZGVUeXBlfHwoVk5vZGVUeXBlPXt9KSk7ZnVuY3Rpb24gaXNIVE1MU3R5bGVFbGVtZW50KHIpe3JldHVybiByLnRhZ05hbWU9PT0iU1RZTEUifWZ1bmN0aW9uIGlzSFRNTEVsZW1lbnQocil7cmV0dXJuIHIubm9kZVR5cGU9PT1Ob2RlLkVMRU1FTlRfTk9ERX1mdW5jdGlvbiBpc1ZQYXJlbnROb2RlKHIpe3JldHVybiJjaGlsZHJlbiJpbiByfWZ1bmN0aW9uIGlzVkVsZW1lbnQocil7cmV0dXJuIHIudHlwZT09PVZOb2RlVHlwZS5FbGVtZW50Tm9kZX1mdW5jdGlvbiBpc1ZTdHlsZUVsZW1lbnQocil7cmV0dXJuIGlzVkVsZW1lbnQocikmJnIudGFnPT09IlNUWUxFIn1mdW5jdGlvbiBpc1ZUZXh0Tm9kZShyKXtyZXR1cm4gci50eXBlPT09Vk5vZGVUeXBlLlRleHROb2RlfWZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpe3JldHVybiB0eXBlb2YgY3J5cHRvLnJhbmRvbVVVSUQ9PSJmdW5jdGlvbiI/Y3J5cHRvLnJhbmRvbVVVSUQoKTooWzFlN10rLTFlMystNGUzKy04ZTMrLTFlMTEpLnJlcGxhY2UoL1swMThdL2cscj0+KHJeY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgxKSlbMF0mMTU+PnIvNCkudG9TdHJpbmcoMTYpKX1jb25zdCBjYW5pdXNlPWNpdTtmdW5jdGlvbiBub3coKXtyZXR1cm4gY2FuaXVzZS5wZXJmb3JtYW5jZU5vdygpP2dsb2JhbFRoaXMucGVyZm9ybWFuY2Uubm93KCk6RGF0ZS5ub3coKX1jb25zdCB0aW1lPXtvZmZzZXQ6MCxub3coKXtyZXR1cm4gbm93KCkrdGltZS5vZmZzZXR9LHN5bmMocil7dGltZS5vZmZzZXQ9ci1ub3coKX19O2NsYXNzIEFQSUVycm9yIGV4dGVuZHMgU2VydmVyRXJyb3J7Y29uc3RydWN0b3IoZSxuLHMsbyl7c3VwZXIoYEVycm9yIG9jY3VycyB3aGVuIGludm9raW5nIEFQSSAiJHtlfSI6ICR7c31gLFEoTih7fSxvIT1udWxsP286e30pLHtjb2RlOm59KSk7Zih0aGlzLCJwYXRoIik7dGhpcy5wYXRoPWUsdGhpcy5uYW1lPSJieXRlcmVwbGF5LmNvcmUuQVBJRXJyb3IifX1jb25zdCBGRVRDSF9GTEFHPSJieXRlcmVwbGF5IjtjbGFzcyBBUElDbGllbnR7Y29uc3RydWN0b3Iocil7Zih0aGlzLCJfZW52Iik7Zih0aGlzLCJfcmVxdWVzdEludGVyY2VwdG9yIik7dGhpcy5fZW52PXJ9Z2V0IGFwaVVSTCgpe3JldHVybmAke3RoaXMuX2Vudi5iYXNlVVJMfSR7dGhpcy5fZW52LmFwaVByZWZpeH1gfWdldCBlbnYoKXtyZXR1cm4gdGhpcy5fZW52fXNldCByZXF1ZXN0SW50ZXJjZXB0b3IodmFsdWUpe2lzU3RyaW5nKHZhbHVlKT90aGlzLl9yZXF1ZXN0SW50ZXJjZXB0b3I9ZXZhbCh2YWx1ZSk6dGhpcy5fcmVxdWVzdEludGVyY2VwdG9yPXZhbHVlfWdldChyLHQsZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9yZXF1ZXN0KCJHRVQiLHIsdCxlKX0pfXBvc3Qocix0LGUpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fcmVxdWVzdCgiUE9TVCIscix0LGUpfSl9X3JlcXVlc3Qocix0LGUsbil7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2xldCBzPXtwYXRoOnQsaGVhZGVyczpufTtpZih0aGlzLl9yZXF1ZXN0SW50ZXJjZXB0b3IpdHJ5e3M9dGhpcy5fcmVxdWVzdEludGVyY2VwdG9yKHQsbil9Y2F0Y2goaCl7fWNvbnN0IG89cj09PSJQT1NUIixhPXRoaXMuX21ha2VVUkwocy5wYXRoKTtpZihyPT09IkdFVCImJmUpe2Zvcihjb25zdFtoLHBdb2YgT2JqZWN0LmVudHJpZXMoZSkpaWYocCE9bnVsbCl7bGV0IG07cCBpbnN0YW5jZW9mIERhdGU/bT1wLnRvSVNPU3RyaW5nKCk6bT1wLnRvU3RyaW5nKCksYS5zZWFyY2hQYXJhbXMuc2V0KGgsbSl9fWNvbnN0IGM9e307bGV0IGw7byYmKGlzRm9ybURhdGEoZSk/bD1lOihsPUpTT04uc3RyaW5naWZ5KGUpLGNbIkNvbnRlbnQtVHlwZSJdPSJhcHBsaWNhdGlvbi9qc29uIikpO2NvbnN0IHU9ZmV0Y2goYS5ocmVmLHttZXRob2Q6cixtb2RlOiJjb3JzIixib2R5OmwsaGVhZGVyczpOKE4oTih7fSxjKSx0aGlzLl9lbnYuaGVhZGVyc3x8e30pLHMuaGVhZGVyc3x8e30pLFtGRVRDSF9GTEFHXTohMH0pO3JldHVybiB0aGlzLl9kZWFsV2l0aFJlc3BvbnNlKHMucGF0aCx1KX0pfV9kZWFsV2l0aFJlc3BvbnNlKHIsdCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2xldCBlO3RyeXtlPXlpZWxkIHR9Y2F0Y2gocyl7dGhyb3cgbmV3IFNlcnZlckVycm9yKGBFcnJvciBvY2N1cnMgd2hlbiBpbnZva2luZyBBUEkgIiR7cn0iOiAke3MubWVzc2FnZX1gLHtjYXVzZTpzfSl9bGV0IG47dHJ5e249eWllbGQgZS5qc29uKCl9Y2F0Y2gocyl7dGhyb3cgbmV3IFNlcnZlckVycm9yKGBSZXNwb25zZSBvZiBBUEkgIiR7cn0iIGNhbiBub3QgYmUgcGFyc2VkIGludG8gSlNPTi5gLHtjYXVzZTpzfSl9aWYobi5zdWNjZXNzKXJldHVybiBuLmRhdGE7dGhyb3cgbmV3IEFQSUVycm9yKHIsbi5jb2RlLG4ubWVzc2FnZSl9KX1fbWFrZVVSTChyKXtyZXR1cm4gbmV3IFVSTChyLHRoaXMuYXBpVVJMKX19Y2xhc3MgQWJzdHJhY3RSZWNvcmRpbmdTdG9yYWdle31jb25zdCBpbnN0YW5jZU9mQW55PShyLHQpPT50LnNvbWUoZT0+ciBpbnN0YW5jZW9mIGUpO2xldCBpZGJQcm94eWFibGVUeXBlcyxjdXJzb3JBZHZhbmNlTWV0aG9kcztmdW5jdGlvbiBnZXRJZGJQcm94eWFibGVUeXBlcygpe3JldHVybiBpZGJQcm94eWFibGVUeXBlc3x8KGlkYlByb3h5YWJsZVR5cGVzPVtJREJEYXRhYmFzZSxJREJPYmplY3RTdG9yZSxJREJJbmRleCxJREJDdXJzb3IsSURCVHJhbnNhY3Rpb25dKX1mdW5jdGlvbiBnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpe3JldHVybiBjdXJzb3JBZHZhbmNlTWV0aG9kc3x8KGN1cnNvckFkdmFuY2VNZXRob2RzPVtJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZSxJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlUHJpbWFyeUtleV0pfWNvbnN0IHRyYW5zYWN0aW9uRG9uZU1hcD1uZXcgV2Vha01hcCx0cmFuc2Zvcm1DYWNoZT1uZXcgV2Vha01hcCxyZXZlcnNlVHJhbnNmb3JtQ2FjaGU9bmV3IFdlYWtNYXA7ZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyKXtjb25zdCB0PW5ldyBQcm9taXNlKChlLG4pPT57Y29uc3Qgcz0oKT0+e3IucmVtb3ZlRXZlbnRMaXN0ZW5lcigic3VjY2VzcyIsbyksci5yZW1vdmVFdmVudExpc3RlbmVyKCJlcnJvciIsYSl9LG89KCk9PntlKHdyYXAoci5yZXN1bHQpKSxzKCl9LGE9KCk9PntuKHIuZXJyb3IpLHMoKX07ci5hZGRFdmVudExpc3RlbmVyKCJzdWNjZXNzIixvKSxyLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIixhKX0pO3JldHVybiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KHQsciksdH1mdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24ocil7aWYodHJhbnNhY3Rpb25Eb25lTWFwLmhhcyhyKSlyZXR1cm47Y29uc3QgdD1uZXcgUHJvbWlzZSgoZSxuKT0+e2NvbnN0IHM9KCk9PntyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNvbXBsZXRlIixvKSxyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImVycm9yIixhKSxyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0IixhKX0sbz0oKT0+e2UoKSxzKCl9LGE9KCk9PntuKHIuZXJyb3J8fG5ldyBET01FeGNlcHRpb24oIkFib3J0RXJyb3IiLCJBYm9ydEVycm9yIikpLHMoKX07ci5hZGRFdmVudExpc3RlbmVyKCJjb21wbGV0ZSIsbyksci5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsYSksci5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsYSl9KTt0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHIsdCl9bGV0IGlkYlByb3h5VHJhcHM9e2dldChyLHQsZSl7aWYociBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKXtpZih0PT09ImRvbmUiKXJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHIpO2lmKHQ9PT0ic3RvcmUiKXJldHVybiBlLm9iamVjdFN0b3JlTmFtZXNbMV0/dm9pZCAwOmUub2JqZWN0U3RvcmUoZS5vYmplY3RTdG9yZU5hbWVzWzBdKX1yZXR1cm4gd3JhcChyW3RdKX0sc2V0KHIsdCxlKXtyZXR1cm4gclt0XT1lLCEwfSxoYXMocix0KXtyZXR1cm4gciBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uJiYodD09PSJkb25lInx8dD09PSJzdG9yZSIpPyEwOnQgaW4gcn19O2Z1bmN0aW9uIHJlcGxhY2VUcmFwcyhyKXtpZGJQcm94eVRyYXBzPXIoaWRiUHJveHlUcmFwcyl9ZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKHIpe3JldHVybiBnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpLmluY2x1ZGVzKHIpP2Z1bmN0aW9uKC4uLnQpe3JldHVybiByLmFwcGx5KHVud3JhcCh0aGlzKSx0KSx3cmFwKHRoaXMucmVxdWVzdCl9OmZ1bmN0aW9uKC4uLnQpe3JldHVybiB3cmFwKHIuYXBwbHkodW53cmFwKHRoaXMpLHQpKX19ZnVuY3Rpb24gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZShyKXtyZXR1cm4gdHlwZW9mIHI9PSJmdW5jdGlvbiI/d3JhcEZ1bmN0aW9uKHIpOihyIGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24mJmNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbihyKSxpbnN0YW5jZU9mQW55KHIsZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSk/bmV3IFByb3h5KHIsaWRiUHJveHlUcmFwcyk6cil9ZnVuY3Rpb24gd3JhcChyKXtpZihyIGluc3RhbmNlb2YgSURCUmVxdWVzdClyZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChyKTtpZih0cmFuc2Zvcm1DYWNoZS5oYXMocikpcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldChyKTtjb25zdCB0PXRyYW5zZm9ybUNhY2hhYmxlVmFsdWUocik7cmV0dXJuIHQhPT1yJiYodHJhbnNmb3JtQ2FjaGUuc2V0KHIsdCkscmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldCh0LHIpKSx0fWNvbnN0IHVud3JhcD1yPT5yZXZlcnNlVHJhbnNmb3JtQ2FjaGUuZ2V0KHIpO2Z1bmN0aW9uIG9wZW5EQihyLHQse2Jsb2NrZWQ6ZSx1cGdyYWRlOm4sYmxvY2tpbmc6cyx0ZXJtaW5hdGVkOm99PXt9KXtjb25zdCBhPWluZGV4ZWREQi5vcGVuKHIsdCksYz13cmFwKGEpO3JldHVybiBuJiZhLmFkZEV2ZW50TGlzdGVuZXIoInVwZ3JhZGVuZWVkZWQiLGw9PntuKHdyYXAoYS5yZXN1bHQpLGwub2xkVmVyc2lvbixsLm5ld1ZlcnNpb24sd3JhcChhLnRyYW5zYWN0aW9uKSxsKX0pLGUmJmEuYWRkRXZlbnRMaXN0ZW5lcigiYmxvY2tlZCIsbD0+ZShsLm9sZFZlcnNpb24sbC5uZXdWZXJzaW9uLGwpKSxjLnRoZW4obD0+e28mJmwuYWRkRXZlbnRMaXN0ZW5lcigiY2xvc2UiLCgpPT5vKCkpLHMmJmwuYWRkRXZlbnRMaXN0ZW5lcigidmVyc2lvbmNoYW5nZSIsdT0+cyh1Lm9sZFZlcnNpb24sdS5uZXdWZXJzaW9uLHUpKX0pLmNhdGNoKCgpPT57fSksY31jb25zdCByZWFkTWV0aG9kcz1bImdldCIsImdldEtleSIsImdldEFsbCIsImdldEFsbEtleXMiLCJjb3VudCJdLHdyaXRlTWV0aG9kcz1bInB1dCIsImFkZCIsImRlbGV0ZSIsImNsZWFyIl0sY2FjaGVkTWV0aG9kcz1uZXcgTWFwO2Z1bmN0aW9uIGdldE1ldGhvZChyLHQpe2lmKCEociBpbnN0YW5jZW9mIElEQkRhdGFiYXNlJiYhKHQgaW4gcikmJnR5cGVvZiB0PT0ic3RyaW5nIikpcmV0dXJuO2lmKGNhY2hlZE1ldGhvZHMuZ2V0KHQpKXJldHVybiBjYWNoZWRNZXRob2RzLmdldCh0KTtjb25zdCBlPXQucmVwbGFjZSgvRnJvbUluZGV4JC8sIiIpLG49dCE9PWUscz13cml0ZU1ldGhvZHMuaW5jbHVkZXMoZSk7aWYoIShlIGluKG4/SURCSW5kZXg6SURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSl8fCEoc3x8cmVhZE1ldGhvZHMuaW5jbHVkZXMoZSkpKXJldHVybjtjb25zdCBvPWZ1bmN0aW9uKGEsLi4uYyl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2NvbnN0IGw9dGhpcy50cmFuc2FjdGlvbihhLHM/InJlYWR3cml0ZSI6InJlYWRvbmx5Iik7bGV0IHU9bC5zdG9yZTtyZXR1cm4gbiYmKHU9dS5pbmRleChjLnNoaWZ0KCkpKSwoeWllbGQgUHJvbWlzZS5hbGwoW3VbZV0oLi4uYykscyYmbC5kb25lXSkpWzBdfSl9O3JldHVybiBjYWNoZWRNZXRob2RzLnNldCh0LG8pLG99cmVwbGFjZVRyYXBzKHI9PlEoTih7fSxyKSx7Z2V0Oih0LGUsbik9PmdldE1ldGhvZCh0LGUpfHxyLmdldCh0LGUsbiksaGFzOih0LGUpPT4hIWdldE1ldGhvZCh0LGUpfHxyLmhhcyh0LGUpfSkpO2NvbnN0IGFkdmFuY2VNZXRob2RQcm9wcz1bImNvbnRpbnVlIiwiY29udGludWVQcmltYXJ5S2V5IiwiYWR2YW5jZSJdLG1ldGhvZE1hcD17fSxhZHZhbmNlUmVzdWx0cz1uZXcgV2Vha01hcCxpdHRyUHJveGllZEN1cnNvclRvT3JpZ2luYWxQcm94eT1uZXcgV2Vha01hcCxjdXJzb3JJdGVyYXRvclRyYXBzPXtnZXQocix0KXtpZighYWR2YW5jZU1ldGhvZFByb3BzLmluY2x1ZGVzKHQpKXJldHVybiByW3RdO2xldCBlPW1ldGhvZE1hcFt0XTtyZXR1cm4gZXx8KGU9bWV0aG9kTWFwW3RdPWZ1bmN0aW9uKC4uLm4pe2FkdmFuY2VSZXN1bHRzLnNldCh0aGlzLGl0dHJQcm94aWVkQ3Vyc29yVG9PcmlnaW5hbFByb3h5LmdldCh0aGlzKVt0XSguLi5uKSl9KSxlfX07ZnVuY3Rpb24gaXRlcmF0ZSguLi5yKXtyZXR1cm4gbWUodGhpcyxudWxsLGZ1bmN0aW9uKigpe2xldCB0PXRoaXM7aWYodCBpbnN0YW5jZW9mIElEQkN1cnNvcnx8KHQ9eWllbGQgbmV3IG5lKHQub3BlbkN1cnNvciguLi5yKSkpLCF0KXJldHVybjt0PXQ7Y29uc3QgZT1uZXcgUHJveHkodCxjdXJzb3JJdGVyYXRvclRyYXBzKTtmb3IoaXR0clByb3hpZWRDdXJzb3JUb09yaWdpbmFsUHJveHkuc2V0KGUsdCkscmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChlLHVud3JhcCh0KSk7dDspeWllbGQgZSx0PXlpZWxkIG5ldyBuZShhZHZhbmNlUmVzdWx0cy5nZXQoZSl8fHQuY29udGludWUoKSksYWR2YW5jZVJlc3VsdHMuZGVsZXRlKGUpfSl9ZnVuY3Rpb24gaXNJdGVyYXRvclByb3Aocix0KXtyZXR1cm4gdD09PVN5bWJvbC5hc3luY0l0ZXJhdG9yJiZpbnN0YW5jZU9mQW55KHIsW0lEQkluZGV4LElEQk9iamVjdFN0b3JlLElEQkN1cnNvcl0pfHx0PT09Iml0ZXJhdGUiJiZpbnN0YW5jZU9mQW55KHIsW0lEQkluZGV4LElEQk9iamVjdFN0b3JlXSl9cmVwbGFjZVRyYXBzKHI9PlEoTih7fSxyKSx7Z2V0KHQsZSxuKXtyZXR1cm4gaXNJdGVyYXRvclByb3AodCxlKT9pdGVyYXRlOnIuZ2V0KHQsZSxuKX0saGFzKHQsZSl7cmV0dXJuIGlzSXRlcmF0b3JQcm9wKHQsZSl8fHIuaGFzKHQsZSl9fSkpO2NvbnN0IERBVEFCQVNFX05BTUU9ImJ5dGVyZXBsYXktZGF0YWJhc2UiLFRBQkxFX05BTUU9InJlY29yZGluZ3MiO2NsYXNzIEluZGV4ZWREQlJlY29yZGluZ1N0b3JhZ2UgZXh0ZW5kcyBBYnN0cmFjdFJlY29yZGluZ1N0b3JhZ2V7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpO2YodGhpcywiX2RiIik7Zih0aGlzLCJfb3BlbkxvY2siKX1nZXRSZWNvcmRpbmdzKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybih5aWVsZCB0aGlzLl9nZXREYXRhYmFzZSgpKS5nZXRBbGwoVEFCTEVfTkFNRSl9KX1wdXRSZWNvcmRpbmdzKGUsbil7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKGUubGVuZ3RoPjApe2NvbnN0IGE9KHlpZWxkIHRoaXMuX2dldERhdGFiYXNlKCkpLnRyYW5zYWN0aW9uKFRBQkxFX05BTUUsInJlYWR3cml0ZSIpO2lmKHlpZWxkIFByb21pc2UuYWxsKGUubWFwKGM9PmEuc3RvcmUucHV0KGMpKSksbiE9bnVsbCl7bGV0IGM9KHlpZWxkIGEuc3RvcmUuY291bnQoKSktbjtpZihjPjApe2xldCBsPXlpZWxkIGEuc3RvcmUub3BlbkN1cnNvcigpO2Zvcig7Yz4wJiZsOyljLS0seWllbGQgbC5kZWxldGUoKSxsPXlpZWxkIGwuY29udGludWUoKX19eWllbGQgYS5kb25lfX0pfWRlbGV0ZVJlY29yZGluZ3MoLi4uZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKGUubGVuZ3RoPjApe2NvbnN0IG49ZS5tYXAoYT0+YS5pZCk7bGV0IG89eWllbGQoeWllbGQgdGhpcy5fZ2V0RGF0YWJhc2UoKSkudHJhbnNhY3Rpb24oVEFCTEVfTkFNRSwicmVhZHdyaXRlIikuc3RvcmUub3BlbkN1cnNvcigpO2Zvcig7bzspbi5zb21lKGE9PihvPT1udWxsP3ZvaWQgMDpvLnZhbHVlLmlkKT09PWEpJiYoeWllbGQgby5kZWxldGUoKSxvPXlpZWxkIG8uY29udGludWUoKSl9fSl9X2dldERhdGFiYXNlKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9kYiE9bnVsbD90aGlzLl9kYjoodGhpcy5fb3BlbkxvY2s9PW51bGwmJih0aGlzLl9vcGVuTG9jaz1vcGVuREIoREFUQUJBU0VfTkFNRSwxLHt1cGdyYWRlKGUpe2UuY3JlYXRlT2JqZWN0U3RvcmUoInJlY29yZGluZ3MiLHthdXRvSW5jcmVtZW50OiEwfSl9fSkudGhlbihlPT4odGhpcy5fZGI9ZSxlKSkpLHRoaXMuX29wZW5Mb2NrKX0pfX1jbGFzcyBJbmRleGVkREJSZWNvcmRpbmdTdG9yYWdlUHJvdmlkZXJ7Y29uc3RydWN0b3IoKXtmKHRoaXMsIl9zdG9yYWdlIil9Z2V0U3RvcmFnZSgpe3JldHVybiB0aGlzLl9zdG9yYWdlfHwodGhpcy5fc3RvcmFnZT1uZXcgSW5kZXhlZERCUmVjb3JkaW5nU3RvcmFnZSksdGhpcy5fc3RvcmFnZX19Y2xhc3MgUXVldWV7Y29uc3RydWN0b3IoKXtmKHRoaXMsIl9xdWV1ZSIsW10pfWdldCBsZW5ndGgoKXtyZXR1cm4gdGhpcy5fcXVldWUubGVuZ3RofWNsZWFyKCl7dGhpcy5fcXVldWUubGVuZ3RoPTB9ZGVxdWV1ZSgpe3JldHVybiB0aGlzLl9xdWV1ZS5zaGlmdCgpfWR1bXAoKXtjb25zdCB0PXRoaXMudG9BcnJheSgpO3JldHVybiB0aGlzLl9xdWV1ZS5zcGxpY2UoMCx0Lmxlbmd0aCksdH1lbnF1ZXVlKC4uLnQpe3JldHVybiB0aGlzLl9xdWV1ZS5wdXNoKC4uLnQpfWZpbmQodCxlKXtyZXR1cm4gdGhpcy5fcXVldWUuZmluZCh0LGUpfWZpbmRJbmRleCh0LGUpe3JldHVybiB0aGlzLl9xdWV1ZS5maW5kSW5kZXgodCxlKX1mb3JFYWNoKHQsZSl7dGhpcy5fcXVldWUuZm9yRWFjaCh0LGV8fHRoaXMpfW1hcCh0LGUpe3JldHVybiB0aGlzLl9xdWV1ZS5tYXAodCxlfHx0aGlzKX1wZWVrKCl7cmV0dXJuIHRoaXMuX3F1ZXVlWzBdfXJlbW92ZSh0KXtyZXR1cm4gdGhpcy5fcXVldWUuc3BsaWNlKHQsMSlbMF19c2xpY2UodCxlKXtyZXR1cm4gdGhpcy5fcXVldWUuc2xpY2UodCxlKX10b0FycmF5KCl7cmV0dXJuWy4uLnRoaXMuX3F1ZXVlXX19Y29uc3QgQT1jbGFzcyBBe2NvbnN0cnVjdG9yKHQpe2YodGhpcywiX29wdGlvbnMiKTt0aGlzLl9vcHRpb25zPXRoaXMuX25vcm1hbGl6ZSh0KX1hdHRlbXB0KHQsZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0eXBlb2YgdCE9ImZ1bmN0aW9uIj9Qcm9taXNlLnJlamVjdChuZXcgRXJyb3IoImV4ZWN1dG9yIGlzIG5vdCBmdW5jdGlvbiIpKTp0aGlzLl9hdHRlbXB0KHQsdGhpcy5fbm9ybWFsaXplKGUsdGhpcy5fb3B0aW9ucykpfSl9X2F0dGVtcHQodCxlLG49MSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0KCkuY2F0Y2gocz0+e2lmKGUuc2hvdWxkUmV0cnkmJiFlLnNob3VsZFJldHJ5KHMpKXRocm93IHM7aWYobjxlLnJldHJpZXMpcmV0dXJuIHRoaXMuX2RlbGF5KHRoaXMuX3JhbmRvbVRpbWVvdXQobixlKSkudGhlbigoKT0+dGhpcy5fYXR0ZW1wdCh0LGUsbisxKSk7dGhyb3cgc30pfSl9X25vcm1hbGl6ZSh0LGU9QS5ERUZBVUxUX09QVElPTlMpe2NvbnN0IG49Tih7fSxlKTtpZih0KXtjb25zdHtyZXRyaWVzOnMsaW5pdGlhbFRpbWVvdXQ6byxtYXhUaW1lb3V0OmEscmFuZG9taXplOmN9PXQ7cyE9bnVsbCYmcz49MCYmKG4ucmV0cmllcz1zKSxvIT1udWxsJiZvPj0wJiYobi5pbml0aWFsVGltZW91dD1vKSxhIT1udWxsJiZhPj1uLmluaXRpYWxUaW1lb3V0JiYobi5tYXhUaW1lb3V0PWEpLGMhPW51bGwmJmM+PTEmJmM8PTImJihjPDE/bi5yYW5kb21pemU9MTpjPjI/bi5yYW5kb21pemU9MjpuLnJhbmRvbWl6ZT1jKSx0IT1udWxsJiZ0LnNob3VsZFJldHJ5JiYobi5zaG91bGRSZXRyeT10LnNob3VsZFJldHJ5KX1yZXR1cm4gbn1fZGVsYXkodCl7cmV0dXJuIG5ldyBQcm9taXNlKGU9PntzZXRUaW1lb3V0KCgpPT57ZSgpfSx0KX0pfV9yYW5kb21UaW1lb3V0KHQsZSl7Y29uc3R7cmFuZG9taXplOm4saW5pdGlhbFRpbWVvdXQ6cyxtYXhUaW1lb3V0Om8sZmFjdG9yOmF9PWU7cmV0dXJuIE1hdGgubWluKG4qcyphZShhLHQpLG8pfX07ZihBLCJERUZBVUxUX09QVElPTlMiLHtyZXRyaWVzOjMsaW5pdGlhbFRpbWVvdXQ6MWUzLG1heFRpbWVvdXQ6MS8wLHJhbmRvbWl6ZToxLjUsZmFjdG9yOjEuNSxzaG91bGRSZXRyeTooKT0+ITB9KTtsZXQgUmV0cnk9QTt2YXIgZXZlbnRlbWl0dGVyMz17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKHIpe3ZhciB0PU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksZT0ifiI7ZnVuY3Rpb24gbigpe31PYmplY3QuY3JlYXRlJiYobi5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShudWxsKSxuZXcgbigpLl9fcHJvdG9fX3x8KGU9ITEpKTtmdW5jdGlvbiBzKGwsdSxoKXt0aGlzLmZuPWwsdGhpcy5jb250ZXh0PXUsdGhpcy5vbmNlPWh8fCExfWZ1bmN0aW9uIG8obCx1LGgscCxtKXtpZih0eXBlb2YgaCE9ImZ1bmN0aW9uIil0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgbGlzdGVuZXIgbXVzdCBiZSBhIGZ1bmN0aW9uIik7dmFyIHY9bmV3IHMoaCxwfHxsLG0pLHc9ZT9lK3U6dTtyZXR1cm4gbC5fZXZlbnRzW3ddP2wuX2V2ZW50c1t3XS5mbj9sLl9ldmVudHNbd109W2wuX2V2ZW50c1t3XSx2XTpsLl9ldmVudHNbd10ucHVzaCh2KToobC5fZXZlbnRzW3ddPXYsbC5fZXZlbnRzQ291bnQrKyksbH1mdW5jdGlvbiBhKGwsdSl7LS1sLl9ldmVudHNDb3VudD09PTA/bC5fZXZlbnRzPW5ldyBuOmRlbGV0ZSBsLl9ldmVudHNbdV19ZnVuY3Rpb24gYygpe3RoaXMuX2V2ZW50cz1uZXcgbix0aGlzLl9ldmVudHNDb3VudD0wfWMucHJvdG90eXBlLmV2ZW50TmFtZXM9ZnVuY3Rpb24oKXt2YXIgdT1bXSxoLHA7aWYodGhpcy5fZXZlbnRzQ291bnQ9PT0wKXJldHVybiB1O2ZvcihwIGluIGg9dGhpcy5fZXZlbnRzKXQuY2FsbChoLHApJiZ1LnB1c2goZT9wLnNsaWNlKDEpOnApO3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzP3UuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaCkpOnV9LGMucHJvdG90eXBlLmxpc3RlbmVycz1mdW5jdGlvbih1KXt2YXIgaD1lP2UrdTp1LHA9dGhpcy5fZXZlbnRzW2hdO2lmKCFwKXJldHVybltdO2lmKHAuZm4pcmV0dXJuW3AuZm5dO2Zvcih2YXIgbT0wLHY9cC5sZW5ndGgsdz1uZXcgQXJyYXkodik7bTx2O20rKyl3W21dPXBbbV0uZm47cmV0dXJuIHd9LGMucHJvdG90eXBlLmxpc3RlbmVyQ291bnQ9ZnVuY3Rpb24odSl7dmFyIGg9ZT9lK3U6dSxwPXRoaXMuX2V2ZW50c1toXTtyZXR1cm4gcD9wLmZuPzE6cC5sZW5ndGg6MH0sYy5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbih1LGgscCxtLHYsdyl7dmFyIFQ9ZT9lK3U6dTtpZighdGhpcy5fZXZlbnRzW1RdKXJldHVybiExO3ZhciBTPXRoaXMuX2V2ZW50c1tUXSxDPWFyZ3VtZW50cy5sZW5ndGgsTSxSO2lmKFMuZm4pe3N3aXRjaChTLm9uY2UmJnRoaXMucmVtb3ZlTGlzdGVuZXIodSxTLmZuLHZvaWQgMCwhMCksQyl7Y2FzZSAxOnJldHVybiBTLmZuLmNhbGwoUy5jb250ZXh0KSwhMDtjYXNlIDI6cmV0dXJuIFMuZm4uY2FsbChTLmNvbnRleHQsaCksITA7Y2FzZSAzOnJldHVybiBTLmZuLmNhbGwoUy5jb250ZXh0LGgscCksITA7Y2FzZSA0OnJldHVybiBTLmZuLmNhbGwoUy5jb250ZXh0LGgscCxtKSwhMDtjYXNlIDU6cmV0dXJuIFMuZm4uY2FsbChTLmNvbnRleHQsaCxwLG0sdiksITA7Y2FzZSA2OnJldHVybiBTLmZuLmNhbGwoUy5jb250ZXh0LGgscCxtLHYsdyksITB9Zm9yKFI9MSxNPW5ldyBBcnJheShDLTEpO1I8QztSKyspTVtSLTFdPWFyZ3VtZW50c1tSXTtTLmZuLmFwcGx5KFMuY29udGV4dCxNKX1lbHNle3ZhciBqPVMubGVuZ3RoLEw7Zm9yKFI9MDtSPGo7UisrKXN3aXRjaChTW1JdLm9uY2UmJnRoaXMucmVtb3ZlTGlzdGVuZXIodSxTW1JdLmZuLHZvaWQgMCwhMCksQyl7Y2FzZSAxOlNbUl0uZm4uY2FsbChTW1JdLmNvbnRleHQpO2JyZWFrO2Nhc2UgMjpTW1JdLmZuLmNhbGwoU1tSXS5jb250ZXh0LGgpO2JyZWFrO2Nhc2UgMzpTW1JdLmZuLmNhbGwoU1tSXS5jb250ZXh0LGgscCk7YnJlYWs7Y2FzZSA0OlNbUl0uZm4uY2FsbChTW1JdLmNvbnRleHQsaCxwLG0pO2JyZWFrO2RlZmF1bHQ6aWYoIU0pZm9yKEw9MSxNPW5ldyBBcnJheShDLTEpO0w8QztMKyspTVtMLTFdPWFyZ3VtZW50c1tMXTtTW1JdLmZuLmFwcGx5KFNbUl0uY29udGV4dCxNKX19cmV0dXJuITB9LGMucHJvdG90eXBlLm9uPWZ1bmN0aW9uKHUsaCxwKXtyZXR1cm4gbyh0aGlzLHUsaCxwLCExKX0sYy5wcm90b3R5cGUub25jZT1mdW5jdGlvbih1LGgscCl7cmV0dXJuIG8odGhpcyx1LGgscCwhMCl9LGMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKHUsaCxwLG0pe3ZhciB2PWU/ZSt1OnU7aWYoIXRoaXMuX2V2ZW50c1t2XSlyZXR1cm4gdGhpcztpZighaClyZXR1cm4gYSh0aGlzLHYpLHRoaXM7dmFyIHc9dGhpcy5fZXZlbnRzW3ZdO2lmKHcuZm4pdy5mbj09PWgmJighbXx8dy5vbmNlKSYmKCFwfHx3LmNvbnRleHQ9PT1wKSYmYSh0aGlzLHYpO2Vsc2V7Zm9yKHZhciBUPTAsUz1bXSxDPXcubGVuZ3RoO1Q8QztUKyspKHdbVF0uZm4hPT1ofHxtJiYhd1tUXS5vbmNlfHxwJiZ3W1RdLmNvbnRleHQhPT1wKSYmUy5wdXNoKHdbVF0pO1MubGVuZ3RoP3RoaXMuX2V2ZW50c1t2XT1TLmxlbmd0aD09PTE/U1swXTpTOmEodGhpcyx2KX1yZXR1cm4gdGhpc30sYy5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzPWZ1bmN0aW9uKHUpe3ZhciBoO3JldHVybiB1PyhoPWU/ZSt1OnUsdGhpcy5fZXZlbnRzW2hdJiZhKHRoaXMsaCkpOih0aGlzLl9ldmVudHM9bmV3IG4sdGhpcy5fZXZlbnRzQ291bnQ9MCksdGhpc30sYy5wcm90b3R5cGUub2ZmPWMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyLGMucHJvdG90eXBlLmFkZExpc3RlbmVyPWMucHJvdG90eXBlLm9uLGMucHJlZml4ZWQ9ZSxjLkV2ZW50RW1pdHRlcj1jLHIuZXhwb3J0cz1jfSkoZXZlbnRlbWl0dGVyMyk7dmFyIGV2ZW50ZW1pdHRlcjNFeHBvcnRzPWV2ZW50ZW1pdHRlcjMuZXhwb3J0cyxFdmVudEVtaXR0ZXI9Z2V0RGVmYXVsdEV4cG9ydEZyb21DanMoZXZlbnRlbWl0dGVyM0V4cG9ydHMpO2NsYXNzIFJvdGF0aW5nUXVldWUgZXh0ZW5kcyBRdWV1ZXtjb25zdHJ1Y3RvcihlKXtzdXBlcigpO2YodGhpcywiX3NpemUiKTtmKHRoaXMsIl9lbWl0dGVyIik7dGhpcy5fc2l6ZT1NYXRoLm1heChlLDEpLHRoaXMuX2VtaXR0ZXI9bmV3IEV2ZW50RW1pdHRlcn1nZXQgaXNGdWxsKCl7cmV0dXJuIHRoaXMuX3NpemU9PT10aGlzLmxlbmd0aH1lbnF1ZXVlKC4uLmUpe2xldCBuPTAscz0hMTtjb25zdCBvPWUubGVuZ3RoLGE9dGhpcy5sZW5ndGgrby10aGlzLl9zaXplO2E+MCYmKHM9ITAsdGhpcy5fcXVldWUuc3BsaWNlKDAsYSkpO2NvbnN0IGM9by10aGlzLl9zaXplO3JldHVybiBjPjA/KHM9ITAsbj1zdXBlci5lbnF1ZXVlKC4uLmUuc2xpY2UoYykpKTpuPXN1cGVyLmVucXVldWUoLi4uZSkscyYmdGhpcy5fZW1pdHRlci5lbWl0KCJyb3RhdGVkIiksbn1vbihlLG4pe3JldHVybiB0aGlzLl9lbWl0dGVyLm9uKGUsbiksdGhpc31vZmYoZSxuKXtyZXR1cm4gdGhpcy5fZW1pdHRlci5vZmYoZSxuKSx0aGlzfX1jb25zdCBEQVRBX01BU0s9ImRhdGEtYnl0ZXJlcGxheS1tYXNrIixEQVRBX01BU0tfRU1QVFk9WyIiLCJ0cnVlIl0sREFUQV9NQVNLX01BUD17aWdub3JlOiJpZ25vcmUiLG5hbWU6Im5hbWUifTtjbGFzcyBBYnN0cmFjdERhdGFNYXNre2NvbnN0cnVjdG9yKHQsZT0iKiIpe2YodGhpcywiX3NlYXJjaENvbmRpdGlvbiIpO2YodGhpcywiX21hc2tpbmdDaGFyYWN0ZXIiKTt0aGlzLl9zZWFyY2hDb25kaXRpb249dCx0aGlzLl9tYXNraW5nQ2hhcmFjdGVyPWV9bWFzayh0KXtyZXR1cm4gdC5yZXBsYWNlKHRoaXMuX3NlYXJjaENvbmRpdGlvbixlPT50aGlzLm1hc2tTdWJzdHJpbmcoZSx0aGlzLl9tYXNraW5nQ2hhcmFjdGVyKSl9fWNsYXNzIENvbWJpbmVkRGF0YU1hc2t7Y29uc3RydWN0b3IoLi4udCl7Zih0aGlzLCJfbWFza3MiKTt0aGlzLl9tYXNrcz10fW1hc2sodCl7cmV0dXJuIHRoaXMuX21hc2tzLnJlZHVjZSgoZSxuKT0+bi5tYXNrKGUpLHQpfX12YXIgRGF0YU1hc2tpbmdMZXZlbDsoZnVuY3Rpb24ocil7ci5CQUxBTkNFPSJCQUxBTkNFIixyLlNUUklDVD0iU1RSSUNUIn0pKERhdGFNYXNraW5nTGV2ZWx8fChEYXRhTWFza2luZ0xldmVsPXt9KSk7Y2xhc3MgQmFua0FjY291bnREYXRhTWFzayBleHRlbmRzIEFic3RyYWN0RGF0YU1hc2t7Y29uc3RydWN0b3IoKXtzdXBlcigvXGJbMS05XSg/OlxkezE4fXxcZHsxN318XGR7MTZ9fFxkezE1fXxcZHsxMX0pXGIvZ20pfW1hc2tTdWJzdHJpbmcodCxlKXtyZXR1cm5gJHt0LnNsaWNlKDAsLTQpLnJlcGxhY2UoL1xTL2csZSl9JHt0LnNsaWNlKC00KX1gfX1jbGFzcyBDaGluZXNlTmFtZURhdGFNYXNrIGV4dGVuZHMgQWJzdHJhY3REYXRhTWFza3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC9bXHU0ZTAwLVx1OWZhNV0rKMK3W1x1NGUwMC1cdTlmYTVdKykqL2dtKX1tYXNrU3Vic3RyaW5nKHQsZSl7Y29uc3Qgbj10Lmxlbmd0aDw9Mz8xOjI7cmV0dXJuYCR7dC5zbGljZSgwLG4pLnJlcGxhY2UoL1xTL2csZSl9JHt0LnNsaWNlKG4pfWB9fWNsYXNzIEVtYWlsRGF0YU1hc2sgZXh0ZW5kcyBBYnN0cmFjdERhdGFNYXNre2NvbnN0cnVjdG9yKCl7c3VwZXIoL1tBLVphLXowLTkuXHU0ZTAwLVx1OWZhNV0rQFthLXpBLVowLTlfLV0rKD86XC5bYS16QS1aMC05Xy1dKykrL2dpbSl9bWFza1N1YnN0cmluZyh0LGUpe2NvbnN0IG49dC5pbmRleE9mKCJAIik7cmV0dXJuYCR7dC5zbGljZSgwLG4pLnNsaWNlKDAsMyl9JHtlLnJlcGVhdCgzKX0ke3Quc2xpY2Uobil9YH19Y2xhc3MgRW5nbGlzaE5hbWVEYXRhTWFzayBleHRlbmRzIEFic3RyYWN0RGF0YU1hc2t7Y29uc3RydWN0b3IoKXtzdXBlcigvKD86W2EtekEtWiddezIsfSA/KSsvZ20pfW1hc2tTdWJzdHJpbmcodCxlKXtjb25zdCBuPXQuaW5kZXhPZigiICIpO3JldHVybiBuPT09LTE/YCR7dC5zbGljZSgwLDEpfSR7dC5zbGljZSgxKS5yZXBsYWNlKC9cUy9nLGUpfWA6YCR7dC5zbGljZSgwLG4pLnJlcGxhY2UoL1xTL2csZSl9JHt0LnNsaWNlKG4pfWB9fWNsYXNzIElEQ2FyZERhdGFNYXNrIGV4dGVuZHMgQWJzdHJhY3REYXRhTWFza3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC8oWzEtOV1cZHs1fSgxOHwxOXwoWzIzXVxkKSlcZHsyfSgoMFsxLTldKXwoMTB8MTF8MTIpKSgoWzAtMl1bMS05XSl8MTB8MjB8MzB8MzEpXGR7M31bMC05WHhdKXwoWzEtOV1cZHs1fVxkezJ9KCgwWzEtOV0pfCgxMHwxMXwxMikpKChbMC0yXVsxLTldKXwxMHwyMHwzMHwzMSlcZHsyfVswLTlYeF0pL2dtKX1tYXNrU3Vic3RyaW5nKHQsZSl7cmV0dXJuYCR7dC5zbGljZSgwLDEpfSR7dC5zbGljZSgxLC0xKS5yZXBsYWNlKC9cUy9nLGUpfSR7dC5zbGljZSgtMSl9YH19Y2xhc3MgSVBBZGRyZXNzRGF0YU1hc2sgZXh0ZW5kcyBBYnN0cmFjdERhdGFNYXNre2NvbnN0cnVjdG9yKCl7c3VwZXIoLygoMjVbMC01XXwyWzAtNF1bMC05XXxbMDFdP1swLTldWzAtOV0/KVwuKXszfSgyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pL2dtKX1tYXNrU3Vic3RyaW5nKHQsZSl7Y29uc3Qgbj10LmluZGV4T2YoIi4iKSsxO3JldHVybmAke3Quc2xpY2UoMCxuKX0ke3Quc2xpY2UobikucmVwbGFjZSgvW14uXS9nLGUpfWB9fWNsYXNzIExpY2Vuc2VQbGF0ZURhdGFNYXNrIGV4dGVuZHMgQWJzdHJhY3REYXRhTWFza3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC8oW+S6rOa0peayqua4neWGgOixq+S6kei+vem7kea5mOealumygeaWsOiLj+a1mei1o+mEguahgueUmOaZi+iSmemZleWQiemXvei0teeypOmdkuiXj+W3neWugeeQvOS9v+mihl1bQS1aXSgoWzAtOV17NX1bREZdKXwoW0RGXShbQS1ISi1OUC1aMC05XSlbMC05XXs0fSkpKXwoW+S6rOa0peayqua4neWGgOixq+S6kei+vem7kea5mOealumygeaWsOiLj+a1mei1o+mEguahgueUmOaZi+iSmemZleWQiemXvei0teeypOmdkuiXj+W3neWugeeQvOS9v+mihl1bQS1aXVtBLUhKLU5QLVowLTldezR9W0EtSEotTlAtWjAtOeaMguWtpuitpua4r+a+s+S9v+mihl0pL2dtKX1tYXNrU3Vic3RyaW5nKHQsZSl7cmV0dXJuYCR7dC5zbGljZSgwLDIpfSR7dC5zbGljZSgyLC0zKS5yZXBsYWNlKC9cUy9nLGUpfSR7dC5zbGljZSgtMyl9YH19Y2xhc3MgTUFDQWRkcmVzc0RhdGFNYXNrIGV4dGVuZHMgQWJzdHJhY3REYXRhTWFza3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC8oKFswLTlBLUZhLWZdezJ9Oil7NX0oWzAtOUEtRmEtZl17Mn0pKXwoKFswLTlBLUZhLWZdezJ9LSl7NX0oWzAtOUEtRmEtZl17Mn0pKS9nbSl9bWFza1N1YnN0cmluZyh0LGUpe2NvbnN0IG49dC5pbmRleE9mKCI6IikrMSxzPXQuaW5kZXhPZigiLSIpKzEsbz1uPT09MD9zOm47cmV0dXJuYCR7dC5zbGljZSgwLG8pfSR7dC5zbGljZShvKS5yZXBsYWNlKC9bXjpdL2csZSl9YH19Y2xhc3MgTW9iaWxlUGhvbmVEYXRhTWFzayBleHRlbmRzIEFic3RyYWN0RGF0YU1hc2t7Y29uc3RydWN0b3IoKXtzdXBlcigvXGIoPzooPzpcKz84Nik/MSg/OjNcZHszfXw1W140XERdXGR7Mn18OFxkezN9fDcoPzpbMC0zNS05XVxkezJ9fDQoPzowXGR8MVswLTJdfDlcZCkpfDlbMC0zNS05XVxkezJ9fDZbMjU2N11cZHsyfXw0KD86KD86MTB8NFswMV0pXGR7M318WzY4XVxkezR9fFs1NzldXGR7Mn0pKVxkezZ9KXwoMD8oPzoxMHwoPzoyfDNbMSw1LDddfDRbMSw1LDddfDVbMSwzLDUsN118N1sxLDMsNSw3LDldfDhbMSwzLDcsOV0pWzAtOV18OTFbMC03LDldfCg/OjQzfDU5fDg1KVsxLTldfDM5WzEtOF18NTRbMyw2XXwoPzo3MDF8NTgwfDM0OXwzMzUpfDU0WzMsNl18NjlbMS0yXXw0NFswLDhdfDQ4WzIsM118NDZbNCw3LDgsOV18NTJbMCwzLDddfDQyWzEsNyw5XXw1NlsxLTZdfDYzWzEtNV18NjZbMC0zLDhdfDcyWzIsNCw4XXw3NFszLTZdfDc2WzAsMiwzLDUsNiw4LDldfDgyWzUtN118ODhbMSwzLDYtOF18OTBbMS0zLDYsOCw5XSlcLT9cZHs3LDh9KVxiL2dtKTtmKHRoaXMsIl9yZWdleENvdW50cnlDb2RlIiwvXlwrPzg2Lyl9bWFza1N1YnN0cmluZyhlLG4pe2xldCBzPSIiLG89ZTtjb25zdCBhPXRoaXMuX3JlZ2V4Q291bnRyeUNvZGUuZXhlYyhlKTtyZXR1cm4gYSYmKHM9YVswXSxvPWUuc2xpY2Uocy5sZW5ndGgpKSxgJHtzfSR7by5zbGljZSgwLDMpfSR7by5zbGljZSgzLC0yKS5yZXBsYWNlKC9cUy9nLG4pfSR7by5zbGljZSgtMil9YH19Y2xhc3MgVGV4dERhdGFNYXNrIGV4dGVuZHMgQWJzdHJhY3REYXRhTWFza3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC9cUysvZ20pfW1hc2tTdWJzdHJpbmcodCxlKXtyZXR1cm4gZS5yZXBlYXQodC5sZW5ndGgpfX1jbGFzcyBWSU5EYXRhTWFzayBleHRlbmRzIEFic3RyYWN0RGF0YU1hc2t7Y29uc3RydWN0b3IoKXtzdXBlcigvXGJbQS1ISi1OUFItWlxkXXsxN31cYi9nbSl9bWFza1N1YnN0cmluZyh0LGUpe3JldHVybmAke3Quc2xpY2UoMCwzKX0ke3Quc2xpY2UoMywtMykucmVwbGFjZSgvXFMvZyxlKX0ke3Quc2xpY2UoLTMpfWB9fWNvbnN0IEFWQUlMQUJMRV9FTlZfVFlQRT1bIkJPRSIsIkRFViIsIlBST0QtSU5URVJOQUwiLCJQUk9ELVBVQkxJQyIsIlBST0QtU0ciLCJQUk9ELVBVQkxJQy1TRyIsIlBST0QtUFVCTElDLVNHLVRUIiwiUFJPRC1WQSIsIlBST0QtUFVCTElDLVZBIiwiUFJPRC1QVUJMSUMtVkEtVFQiLCJQUk9ELVVTLVRUUCIsIlBST0QtUFVCTElDLVVTLVRUUCJdLERFRkFVTFRfRU5WPSJQUk9ELUlOVEVSTkFMIjtsZXQgX2N1cnJlbnRFbnY9REVGQVVMVF9FTlY7ZnVuY3Rpb24gZ2V0KCl7cmV0dXJuIF9jdXJyZW50RW52fWNsYXNzIEVudmlyb25tZW50e2NvbnN0cnVjdG9yKHQpe2YodGhpcywiX2RvbWFpbnMiLFsiYnl0ZWRhbmNlIiwiemlqaWVhcGkiLCJ0aWt0b2stcm93IiwiYnl0ZWludGwiLCJ0aWt0b2stdXN0cyIsInRpa3Rva3ciLCJ0aWt0b2siXSk7Zih0aGlzLCJERUZBVUxUX0VOVl9UWVBFIiwiUFJPRC1JTlRFUk5BTCIpO2YodGhpcywiX3R5cGUiLHRoaXMuREVGQVVMVF9FTlZfVFlQRSk7Zih0aGlzLCJfYmFzZVVSTCIpO2YodGhpcywiX2FwaVByZWZpeCIpO2YodGhpcywiX2hlYWRlcnMiKTt2YXIgZTt0aGlzLmJhc2VVUkw9dD09bnVsbD92b2lkIDA6dC5iYXNlVVJMLHRoaXMudHlwZT0oZT10PT1udWxsP3ZvaWQgMDp0LnR5cGUpIT1udWxsP2U6Z2V0KCksdGhpcy5hcGlQcmVmaXg9dD09bnVsbD92b2lkIDA6dC5hcGlQcmVmaXgsdGhpcy5oZWFkZXJzPXQ9PW51bGw/dm9pZCAwOnQuaGVhZGVyc31zZXQgdHlwZSh0KXtpZih0IT1udWxsKXtjb25zdCBlPXRoaXMucGFyc2UodCk7aWYoZSl7dGhpcy5fdHlwZT1lO3JldHVybn10aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZW52aXJvbm1lbnQgdHlwZSwgaXQgbXVzdCBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzogJHtBVkFJTEFCTEVfRU5WX1RZUEUuam9pbigiLCAiKX0uYCl9fWdldCB0eXBlKCl7cmV0dXJuIHRoaXMuX3R5cGV9c2V0IGJhc2VVUkwodCl7aWYodD09bnVsbHx8aXNFbXB0eVN0cmluZyh0KSl0aGlzLl9iYXNlVVJMPXZvaWQgMDtlbHNlIHRyeXt0aGlzLl9iYXNlVVJMPW5ldyBVUkwodCkuaHJlZn1jYXRjaChlKXt0aHJvdyBuZXcgUnVudGltZUVycm9yKCJJbnZhbGlkIGJhc2UgVVJMOiAiK3QpfX1zZXQgYXBpUHJlZml4KHQpe3QmJih0LnN0YXJ0c1dpdGgoIi8iKSYmKHQ9dC5zbGljZSgxKSksdC5lbmRzV2l0aCgiLyIpfHwodCs9Ii8iKSksdGhpcy5fYXBpUHJlZml4PXQhPW51bGw/dDoiYXBpLyJ9Z2V0IGFwaVByZWZpeCgpe3JldHVybiB0aGlzLl9hcGlQcmVmaXh9c2V0IGhlYWRlcnModCl7dGhpcy5faGVhZGVycz10fWdldCBoZWFkZXJzKCl7cmV0dXJuIHRoaXMuX2hlYWRlcnN9Z2V0IGJhc2VVUkwoKXtyZXR1cm4gdGhpcy5fYmFzZVVSTCE9bnVsbD90aGlzLl9iYXNlVVJMLnN0YXJ0c1dpdGgoIi8vIik/bG9jYXRpb24ucHJvdG9jb2wrIjoiK3RoaXMuX2Jhc2VVUkw6dGhpcy5fYmFzZVVSTDp0aGlzLmlzQk9FKCk/YGh0dHBzOi8vYnl0ZXJlcGxheS1ib2UuJHt0aGlzLl9kb21haW5zWzBdfS5uZXQvYDp0aGlzLmlzRGV2KCk/Imh0dHA6Ly9sb2NhbGhvc3Q6Njc4OS8iOnRoaXMuaXNQcm9kUHVibGljKCk/Imh0dHBzOi8vYnl0ZXJlcGxheS4iK3RoaXMuX2RvbWFpbnNbMV0rIi5jb20vIjp0aGlzLmlzUHJvZFNHKCk/Imh0dHBzOi8vYnl0ZXJlcGxheS1zZy4iK3RoaXMuX2RvbWFpbnNbMl0rIi5uZXQvIjp0aGlzLmlzUHJvZFB1YmxpY1NHKCk/Imh0dHBzOi8vYnl0ZXJlcGxheS1zZy4iK3RoaXMuX2RvbWFpbnNbM10rImFwaS5jb20vIjp0aGlzLmlzUHJvZFZBKCk/Imh0dHBzOi8vYnl0ZXJlcGxheS12YS4iK3RoaXMuX2RvbWFpbnNbMl0rIi5uZXQvIjp0aGlzLmlzUHJvZFB1YmxpY1ZBKCk/Imh0dHBzOi8vYnl0ZXJlcGxheS12YS4iK3RoaXMuX2RvbWFpbnNbM10rImFwaS5jb20vIjp0aGlzLmlzUHJvZFVTX1RUUCgpPyJodHRwczovL2J5dGVyZXBsYXkuIit0aGlzLl9kb21haW5zWzRdKyIubmV0LyI6dGhpcy5pc1Byb2RQdWJsaWNVU19UVFAoKT8iaHR0cHM6Ly9ieXRlcmVwbGF5LiIrdGhpcy5fZG9tYWluc1s1XSsiLnVzLyI6dGhpcy5pc1Byb2RQdWJsaWNTR0ZvclRUKCk/Imh0dHBzOi8vdHNyMTYtbm9ybWFsLWFsaXNnLiIrdGhpcy5fZG9tYWluc1s2XSsiLmNvbS8iOnRoaXMuaXNQcm9kUHVibGljVkFURm9yVFQoKT8iaHR0cHM6Ly90c3IxNi1ub3JtYWwtdXNlYXN0MWEuIit0aGlzLl9kb21haW5zWzZdKyIuY29tLyI6YGh0dHBzOi8vYnl0ZXJlcGxheS4ke3RoaXMuX2RvbWFpbnNbMF19Lm5ldC9gfWdldEZ1bGxVcmwodCxlPSExKXtpZigvXih3c3M/OlwvXC98aHR0cHM/OlwvXC98XC9cLykvLnRlc3QodCkpcmV0dXJuIHQ7Y29uc3Qgbj10aGlzLmJhc2VVUkwucmVwbGFjZSgvXmh0dHBzPzpcL1wvfFwvKyQvZywiIikscz10LnJlcGxhY2UoL15cLysvLCIiKTtyZXR1cm5gJHt0aGlzLl9nZXRQcm90b2NvbChlKX06Ly8ke259LyR7dGhpcy5hcGlQcmVmaXh9JHtzfWB9cGFyc2UodCl7aWYoaXNTdHJpbmcodCkpe2NvbnN0IGU9dC50cmltKCkudG9VcHBlckNhc2UoKTtpZihpbmNsdWRlcyhBVkFJTEFCTEVfRU5WX1RZUEUsZSkpcmV0dXJuIGV9fWlzQk9FKCl7cmV0dXJuIHRoaXMuX3R5cGU9PT0iQk9FIn1pc0Rldigpe3JldHVybiB0aGlzLl90eXBlPT09IkRFViJ9aXNQcm9kSW50ZXJuYWwoKXtyZXR1cm4gdGhpcy5fdHlwZT09PSJQUk9ELUlOVEVSTkFMIn1pc1Byb2RQdWJsaWMoKXtyZXR1cm4gdGhpcy5fdHlwZT09PSJQUk9ELVBVQkxJQyJ9aXNQcm9kU0coKXtyZXR1cm4gdGhpcy5fdHlwZT09PSJQUk9ELVNHIn1pc1Byb2RQdWJsaWNTRygpe3JldHVybiB0aGlzLl90eXBlPT09IlBST0QtUFVCTElDLVNHIn1pc1Byb2RQdWJsaWNTR0ZvclRUKCl7cmV0dXJuIHRoaXMuX3R5cGU9PT0iUFJPRC1QVUJMSUMtU0ctVFQifWlzUHJvZFZBKCl7cmV0dXJuIHRoaXMuX3R5cGU9PT0iUFJPRC1WQSJ9aXNQcm9kUHVibGljVkEoKXtyZXR1cm4gdGhpcy5fdHlwZT09PSJQUk9ELVBVQkxJQy1WQSJ9aXNQcm9kUHVibGljVkFURm9yVFQoKXtyZXR1cm4gdGhpcy5fdHlwZT09PSJQUk9ELVBVQkxJQy1WQS1UVCJ9aXNQcm9kVVNfVFRQKCl7cmV0dXJuIHRoaXMuX3R5cGU9PT0iUFJPRC1VUy1UVFAifWlzUHJvZFB1YmxpY1VTX1RUUCgpe3JldHVybiB0aGlzLnR5cGU9PT0iUFJPRC1QVUJMSUMtVVMtVFRQIn10b09wdGlvbnMoKXtyZXR1cm57dHlwZTp0aGlzLnR5cGUsYmFzZVVSTDp0aGlzLmJhc2VVUkwsYXBpUHJlZml4OnRoaXMuYXBpUHJlZml4LGhlYWRlcnM6dGhpcy5oZWFkZXJzfX1fZ2V0UHJvdG9jb2wodD0hMSl7cmV0dXJuIHRoaXMuYmFzZVVSTC5zdGFydHNXaXRoKCJodHRwOiIpP3Q/IndzIjoiaHR0cCI6dD8id3NzIjoiaHR0cHMifX1jbGFzcyBJT0Vycm9yIGV4dGVuZHMgUnVudGltZUVycm9ye2NvbnN0cnVjdG9yKHQsZSl7c3VwZXIodCxlKSx0aGlzLm5hbWU9ImJ5dGVyZXBsYXkuY29yZS5JT0Vycm9yIn19ZnVuY3Rpb24gY3JlYXRlUmVhZGFibGVTdHJlYW1Gcm9tVWludDhBcnJheShyKXtyZXR1cm4gbmV3IFJlYWRhYmxlU3RyZWFtKHtzdGFydChlKXtyZXR1cm4gZS5lbnF1ZXVlKHIpLGUuY2xvc2UoKSxQcm9taXNlLnJlc29sdmUoKX19KX1mdW5jdGlvbiBtZXJnZVVpbnQ4QXJyYXlzKHIsdCl7Y29uc3QgZT10PT09dm9pZCAwP3IucmVkdWNlKChvLGEpPT5vK2EubGVuZ3RoLDApOnQsbj1uZXcgVWludDhBcnJheShlKTtsZXQgcz0wO2Zvcihjb25zdCBvIG9mIHIpbi5zZXQobyxzKSxzKz1vLmxlbmd0aDtyZXR1cm4gbn1mdW5jdGlvbiByZWFkQWxsRnJvbVN0cmVhbShyKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Y29uc3QgdD1yLmdldFJlYWRlcigpO3JldHVybiByZWFkQWxsRnJvbVJlYWRlcih0KX0pfWZ1bmN0aW9uIHJlYWRBbGxGcm9tUmVhZGVyKHIpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtsZXQgdDtjb25zdCBlPVtdO2Zvcig7ISh0PXlpZWxkIHIucmVhZCgpKS5kb25lOyllLnB1c2godC52YWx1ZSk7cmV0dXJuIG1lcmdlVWludDhBcnJheXMoZSl9KX12YXIgQ29ubmVjdGlvbkNsb3NlUmVhc29uOyhmdW5jdGlvbihyKXtyLkNsb3NlZEJ5Q2xpZW50PSJDbG9zZWRCeUNsaWVudCIsci5DbG9zZWRCeVNlcnZlcj0iQ2xvc2VkQnlTZXJ2ZXIiLHIuSGVhcnRiZWF0VGltZW91dD0iSGVhcnRiZWF0VGltZW91dCIsci5Vbmtub3duPSJ1bmtub3duIn0pKENvbm5lY3Rpb25DbG9zZVJlYXNvbnx8KENvbm5lY3Rpb25DbG9zZVJlYXNvbj17fSkpO2Z1bmN0aW9uIEdldENsb3NlUmVhc29uQnlTZXJ2ZXJDb2RlKHIpe3JldHVybiByPT09MWUzP0Nvbm5lY3Rpb25DbG9zZVJlYXNvbi5DbG9zZWRCeUNsaWVudDpyPT09MzAwMT9Db25uZWN0aW9uQ2xvc2VSZWFzb24uSGVhcnRiZWF0VGltZW91dDpyPj0zZTM/Q29ubmVjdGlvbkNsb3NlUmVhc29uLkNsb3NlZEJ5U2VydmVyOkNvbm5lY3Rpb25DbG9zZVJlYXNvbi5Vbmtub3dufXZhciBIZWFydGJlYXRTaWduYWw7KGZ1bmN0aW9uKHIpe3IuUGluZz0icGluZyIsci5Qb25nPSJwb25nIn0pKEhlYXJ0YmVhdFNpZ25hbHx8KEhlYXJ0YmVhdFNpZ25hbD17fSkpO2NvbnN0IE89Y2xhc3MgTyBleHRlbmRzIEV2ZW50RW1pdHRlcntjb25zdHJ1Y3RvcihlLG4pe3N1cGVyKCk7Zih0aGlzLCJjb25uZWN0aW9uIik7Zih0aGlzLCJfb3B0aW9ucyIpO2YodGhpcywiX3RpbWVyIik7Zih0aGlzLCJfaGFuZGxlTWVzc2FnZSIsZT0+e2U9PT1IZWFydGJlYXRTaWduYWwuUGluZyYmKHRoaXMuX3BvbmcoKSx0aGlzLl9yZXNldFRpbWVvdXQoKSl9KTtmKHRoaXMsIl9oYW5kbGVUaW1lb3V0IiwoKT0+e3RoaXMuc3RvcCgpLHRoaXMuZW1pdCgidGltZW91dCIpfSk7dGhpcy5jb25uZWN0aW9uPWUsdGhpcy5fb3B0aW9ucz1OKE4oe30sTy5ERUZBVUxUX09QVElPTlMpLG4pfXN0YXJ0KCl7dGhpcy5jb25uZWN0aW9uLm9uKCJtZXNzYWdlIix0aGlzLl9oYW5kbGVNZXNzYWdlKSx0aGlzLl9zdGFydFRpbWVvdXQoKX1zdG9wKCl7dGhpcy5fY2xlYXJUaW1lb3V0KCksdGhpcy5jb25uZWN0aW9uLm9mZigibWVzc2FnZSIsdGhpcy5faGFuZGxlTWVzc2FnZSl9X3BvbmcoKXt0aGlzLmNvbm5lY3Rpb24uaXNSZWFkeSYmdGhpcy5jb25uZWN0aW9uLnNlbmQoSGVhcnRiZWF0U2lnbmFsLlBvbmcpfV9zdGFydFRpbWVvdXQoKXt0aGlzLl9yZXNldFRpbWVvdXQoKX1fcmVzZXRUaW1lb3V0KCl7dGhpcy5fY2xlYXJUaW1lb3V0KCksdGhpcy5fdGltZXI9c2V0VGltZW91dCh0aGlzLl9oYW5kbGVUaW1lb3V0LHRoaXMuX29wdGlvbnMudGltZW91dCl9X2NsZWFyVGltZW91dCgpe2NsZWFyVGltZW91dCh0aGlzLl90aW1lciksdGhpcy5fdGltZXI9dm9pZCAwfX07ZihPLCJERUZBVUxUX09QVElPTlMiLHt0aW1lb3V0OjEyZTN9KTtsZXQgSGVhcnRiZWF0PU87Y2xhc3MgTmV0d29ya0Vycm9yIGV4dGVuZHMgUnVudGltZUVycm9ye2NvbnN0cnVjdG9yKHQsZSl7c3VwZXIodCxlKSx0aGlzLm5hbWU9ImJ5dGVyZXBsYXkuY29yZS5OZXR3b3JrRXJyb3IifX12YXIgV2ViU29ja2V0TWVzc2FnZVR5cGU7KGZ1bmN0aW9uKHIpe3Jbci5BQ0s9MF09IkFDSyIscltyLkNodW5rPTFdPSJDaHVuayIscltyLkNvbW1hbmQ9MTBdPSJDb21tYW5kIn0pKFdlYlNvY2tldE1lc3NhZ2VUeXBlfHwoV2ViU29ja2V0TWVzc2FnZVR5cGU9e30pKTtmdW5jdGlvbiBOZXdDb21tYW5kKHIpe3JldHVybnt0eXBlOldlYlNvY2tldE1lc3NhZ2VUeXBlLkNvbW1hbmQsZGF0YTpyfX12YXIgV2ViU29ja2V0Q29ubmVjdGlvbkV2ZW50OyhmdW5jdGlvbihyKXtyLk9wZW49Im9wZW4iLHIuU2VuZD0ic2VuZCIsci5NZXNzYWdlPSJtZXNzYWdlIixyLkNsb3NlZD0iY2xvc2VkIn0pKFdlYlNvY2tldENvbm5lY3Rpb25FdmVudHx8KFdlYlNvY2tldENvbm5lY3Rpb25FdmVudD17fSkpO2NsYXNzIFdlYlNvY2tldENvbm5lY3Rpb257Y29uc3RydWN0b3IodCxlKXtmKHRoaXMsIl91cmwiKTtmKHRoaXMsIl9lbWl0dGVyIik7Zih0aGlzLCJfaGVhcnRiZWF0Iik7Zih0aGlzLCJfcmV0cnkiKTtmKHRoaXMsIl93cyIpO2YodGhpcywiX29wZW5pbmciKTtmKHRoaXMsIl9jbG9zaW5nIik7Zih0aGlzLCJfY2xvc2VSZWFzb24iKTtmKHRoaXMsIl9oYW5kbGVDbG9zZSIsdD0+e3RoaXMuX3Vuc3Vic2NyaWJlKHRoaXMuX3dzKSx0aGlzLl9jbG9zZVJlYXNvbj09PXZvaWQgMCYmKHRoaXMuX2Nsb3NlUmVhc29uPUdldENsb3NlUmVhc29uQnlTZXJ2ZXJDb2RlKHQuY29kZSkpLHRoaXMuX2hlYXJ0YmVhdC5zdG9wKCksdGhpcy5fY2xvc2VSZWFzb249PT1Db25uZWN0aW9uQ2xvc2VSZWFzb24uQ2xvc2VkQnlDbGllbnQ/dGhpcy5fZW1pdHRlci5lbWl0KFdlYlNvY2tldENvbm5lY3Rpb25FdmVudC5DbG9zZWQpOnRoaXMuX2Nsb3NlUmVhc29uPT09Q29ubmVjdGlvbkNsb3NlUmVhc29uLkNsb3NlZEJ5U2VydmVyP3RoaXMuX2VtaXR0ZXIuZW1pdChXZWJTb2NrZXRDb25uZWN0aW9uRXZlbnQuQ2xvc2VkKTp0aGlzLl9yZW9wZW4oKX0pO2YodGhpcywiX2hhbmRsZU1lc3NhZ2UiLHQ9Pntjb25zdHtkYXRhOmV9PXQ7aWYoaXNTdHJpbmcoZSkmJmUhPT1IZWFydGJlYXRTaWduYWwuUG9uZyYmZSE9PUhlYXJ0YmVhdFNpZ25hbC5QaW5nKXRyeXt0aGlzLl9lbWl0dGVyLmVtaXQoV2ViU29ja2V0Q29ubmVjdGlvbkV2ZW50Lk1lc3NhZ2UsSlNPTi5wYXJzZSh0LmRhdGEpKX1jYXRjaChuKXt9ZWxzZSB0aGlzLl9lbWl0dGVyLmVtaXQoV2ViU29ja2V0Q29ubmVjdGlvbkV2ZW50Lk1lc3NhZ2UsZSl9KTtmKHRoaXMsIl9oYW5kbGVIZWFydGJlYXRUaW1lb3V0IiwoKT0+e3RoaXMuX2Nsb3NlUmVhc29uPT09dm9pZCAwJiYodGhpcy5fY2xvc2UoQ29ubmVjdGlvbkNsb3NlUmVhc29uLkhlYXJ0YmVhdFRpbWVvdXQpLHRoaXMuX3Jlb3BlbigpKX0pO3RoaXMuX3VybD10LHRoaXMuX2VtaXR0ZXI9bmV3IEV2ZW50RW1pdHRlcix0aGlzLl9oZWFydGJlYXQ9bmV3IEhlYXJ0YmVhdCh0aGlzLGU9PW51bGw/dm9pZCAwOmUuaGVhcnRiZWF0KSx0aGlzLl9oZWFydGJlYXQub24oInRpbWVvdXQiLHRoaXMuX2hhbmRsZUhlYXJ0YmVhdFRpbWVvdXQpLHRoaXMuX3JldHJ5PW5ldyBSZXRyeShlPT1udWxsP3ZvaWQgMDplLnJldHJ5KX1nZXQgaXNSZWFkeSgpe3ZhciB0O3JldHVybigodD10aGlzLl93cyk9PW51bGw/dm9pZCAwOnQucmVhZHlTdGF0ZSk9PT1XZWJTb2NrZXQuT1BFTn1vbih0LGUsbil7cmV0dXJuIHRoaXMuX2VtaXR0ZXIub24odCxlLG4pLHRoaXN9b2ZmKHQsZSxuKXtyZXR1cm4gdGhpcy5fZW1pdHRlci5vZmYodCxlLG4pLHRoaXN9b3Blbigpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb3BlbmluZ3x8KHRoaXMuX29wZW5pbmc9bmV3IFByb21pc2UoKHQsZSk9Pnt0aGlzLl91bnN1YnNjcmliZSh0aGlzLl93cyksdGhpcy5fd3M9bmV3IFdlYlNvY2tldCh0aGlzLl91cmwpO2NvbnN0IG49KCk9Pnt2YXIgbyxhOyhvPXRoaXMuX3dzKT09bnVsbHx8by5yZW1vdmVFdmVudExpc3RlbmVyKCJvcGVuIixuKSwoYT10aGlzLl93cyk9PW51bGx8fGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xvc2UiLHMpLHRoaXMuX3N1YnNjcmliZSh0aGlzLl93cyksdGhpcy5fZW1pdHRlci5lbWl0KFdlYlNvY2tldENvbm5lY3Rpb25FdmVudC5PcGVuKSx0aGlzLl9oZWFydGJlYXQuc3RhcnQoKSx0aGlzLl9vcGVuaW5nPXZvaWQgMCx0KCl9LHM9KCk9Pnt2YXIgbyxhOyhvPXRoaXMuX3dzKT09bnVsbHx8by5yZW1vdmVFdmVudExpc3RlbmVyKCJvcGVuIixuKSwoYT10aGlzLl93cyk9PW51bGx8fGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xvc2UiLHMpLHRoaXMuX29wZW5pbmc9dm9pZCAwLGUobmV3IE5ldHdvcmtFcnJvcihgRmFpbGVkIHRvIGNvbm5lY3QgdG8gIiR7dGhpcy5fdXJsfSJgKSl9O3RoaXMuX3dzLmFkZEV2ZW50TGlzdGVuZXIoIm9wZW4iLG4pLHRoaXMuX3dzLmFkZEV2ZW50TGlzdGVuZXIoImNsb3NlIixzKSx0aGlzLl93cy5vbmVycm9yPW89Pntjb25zb2xlLmVycm9yKG8pfX0pKSx0aGlzLl9jbG9zZVJlYXNvbj12b2lkIDAsdGhpcy5fb3BlbmluZ30pfXNlbmRDaHVuayh0KXt0aGlzLl9lbWl0dGVyLmVtaXQoV2ViU29ja2V0Q29ubmVjdGlvbkV2ZW50LlNlbmQsdCksdGhpcy5zZW5kKHQuZGF0YSl9c2VuZCh0KXt2YXIgZTt0aGlzLmlzUmVhZHkmJigoZT10aGlzLl93cyk9PW51bGx8fGUuc2VuZCh0KSl9Y2xvc2UoKXtyZXR1cm4gdGhpcy5fY2xvc2UoQ29ubmVjdGlvbkNsb3NlUmVhc29uLkNsb3NlZEJ5Q2xpZW50KX1fc3Vic2NyaWJlKHQpe3Q9PW51bGx8fHQuYWRkRXZlbnRMaXN0ZW5lcigiY2xvc2UiLHRoaXMuX2hhbmRsZUNsb3NlKSx0PT1udWxsfHx0LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLHRoaXMuX2hhbmRsZU1lc3NhZ2UpfV91bnN1YnNjcmliZSh0KXt0PT1udWxsfHx0LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsb3NlIix0aGlzLl9oYW5kbGVDbG9zZSksdD09bnVsbHx8dC5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIix0aGlzLl9oYW5kbGVNZXNzYWdlKX1fY2xvc2UodCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3ZhciBlLG47aWYodGhpcy5fd3MpcmV0dXJuIHRoaXMuX2Nsb3NlUmVhc29uPXQsKChlPXRoaXMuX3dzKT09bnVsbD92b2lkIDA6ZS5yZWFkeVN0YXRlKT09PVdlYlNvY2tldC5DTE9TRUR8fCgobj10aGlzLl93cyk9PW51bGw/dm9pZCAwOm4ucmVhZHlTdGF0ZSk9PT1XZWJTb2NrZXQuQ0xPU0lORz92b2lkIDA6KHRoaXMuX2Nsb3Npbmd8fCh0aGlzLl9jbG9zaW5nPW5ldyBQcm9taXNlKHM9Pnt2YXIgYSxjO2NvbnN0IG89KCk9Pnt2YXIgbDsobD10aGlzLl93cyk9PW51bGx8fGwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xvc2UiLG8pLHRoaXMuX2Nsb3Npbmc9dm9pZCAwLHMoKX07KGE9dGhpcy5fd3MpPT1udWxsfHxhLmFkZEV2ZW50TGlzdGVuZXIoImNsb3NlIixvKSwoYz10aGlzLl93cyk9PW51bGx8fGMuY2xvc2UoMWUzKX0pKSx0aGlzLl9jbG9zaW5nKX0pfV9yZW9wZW4oKXt0aGlzLl9yZXRyeS5hdHRlbXB0KCgpPT50aGlzLm9wZW4oKSkuY2F0Y2godD0+e3RoaXMuX2VtaXR0ZXIuZW1pdChXZWJTb2NrZXRDb25uZWN0aW9uRXZlbnQuQ2xvc2VkLHQpfSl9fWNsYXNzIEFic3RyYWN0Rmxvd3tjb25zdHJ1Y3Rvcigpe2YodGhpcywiX2Rvd25zdHJlYW0iLG5ldyBTdWJqZWN0KTtmKHRoaXMsInBpcGUiLHRoaXMuX2Rvd25zdHJlYW0ucGlwZS5iaW5kKHRoaXMuX2Rvd25zdHJlYW0pKX1vdXRwdXQodCl7dGhpcy5fZG93bnN0cmVhbS5uZXh0KHQpfWFzUGlwZWFibGUoKXtyZXR1cm4gdD0+KHQuc3Vic2NyaWJlKGU9Pnt0aGlzLmhhbmRsZUlucHV0KGUpfSksdGhpcy5fZG93bnN0cmVhbSl9fXZhciBJRnJhbWVBY3Rpb25UeXBlOyhmdW5jdGlvbihyKXtyLlN0YXJ0UmVjb3JkaW5nPSJzdGFydFJlY29yZGluZyIsci5TdG9wUmVjb3JkaW5nPSJzdG9wUmVjb3JkaW5nIixyLlVubG9hZD0idW5sb2FkIixyLkxvYWQ9ImxvYWQifSkoSUZyYW1lQWN0aW9uVHlwZXx8KElGcmFtZUFjdGlvblR5cGU9e30pKTtjb25zdCBJRnJhbWVFdmVudD0iUmVwbGF5SUZyYW1lRXZlbnQiO2Z1bmN0aW9uIGJ1aWxkSUZyYW1lRXZlbnQocil7cmV0dXJuIG5ldyBDdXN0b21FdmVudChJRnJhbWVFdmVudCx7ZGV0YWlsOnJ9KX12YXIgSUZyYW1lU3RhdGU7KGZ1bmN0aW9uKHIpe3IuTG9hZGluZz0ibG9hZGluZyIsci5Mb2FkZWQ9ImxvYWRlZCIsci5SZWNvcmRpbmc9InJlY29yZGluZyJ9KShJRnJhbWVTdGF0ZXx8KElGcmFtZVN0YXRlPXt9KSk7dmFyIFRyYWNrZXJFdmVudFR5cGU7KGZ1bmN0aW9uKHIpe3Jbci5Ob29wPTBdPSJOb29wIixyW3IuSFRNTFNuYXBzaG90PTEwMV09IkhUTUxTbmFwc2hvdCIscltyLkhUTUxNdXRhdGlvbnM9MTAyXT0iSFRNTE11dGF0aW9ucyIscltyLkhUTUxTY3JvbGw9MTAzXT0iSFRNTFNjcm9sbCIscltyLkhUTUxGb2N1cz0xMDRdPSJIVE1MRm9jdXMiLHJbci5IVE1MQmx1cj0xMDVdPSJIVE1MQmx1ciIscltyLkhUTUxWYWx1ZUNoYW5nZT0xMDZdPSJIVE1MVmFsdWVDaGFuZ2UiLHJbci5IVE1MU2VsZWN0aW9uQ2hhbmdlPTEwN109IkhUTUxTZWxlY3Rpb25DaGFuZ2UiLHJbci5IVE1MUmVzaXplPTExMF09IkhUTUxSZXNpemUiLHJbci5IVE1MSW5jcmVtZW50YWxTbmFwc2hvdD0xMTFdPSJIVE1MSW5jcmVtZW50YWxTbmFwc2hvdCIscltyLkhUTUxOYXZpZ2F0aW9uPTExNV09IkhUTUxOYXZpZ2F0aW9uIixyW3IuSFRNTENhbnZhcz0xMjBdPSJIVE1MQ2FudmFzIixyW3IuSFRNTEltYWdlPTEyMl09IkhUTUxJbWFnZSIscltyLkhUTUxJRnJhbWU9MTMwXT0iSFRNTElGcmFtZSIscltyLk1vdXNlTW92ZT0yMDFdPSJNb3VzZU1vdmUiLHJbci5Nb3VzZURvd249MjAyXT0iTW91c2VEb3duIixyW3IuTW91c2VVcD0yMDNdPSJNb3VzZVVwIixyW3IuTW91c2VDbGljaz0yMDRdPSJNb3VzZUNsaWNrIixyW3IuVG91Y2hTdGFydD0yMDVdPSJUb3VjaFN0YXJ0IixyW3IuVG91Y2hNb3ZlPTIwNl09IlRvdWNoTW92ZSIscltyLlRvdWNoRW5kPTIwN109IlRvdWNoRW5kIixyW3IuVG91Y2hDYW5jZWw9MjA4XT0iVG91Y2hDYW5jZWwiLHJbci5LZXlEb3duPTMwMV09IktleURvd24iLHJbci5Db25zb2xlQXNzZXJ0PTQwMV09IkNvbnNvbGVBc3NlcnQiLHJbci5Db25zb2xlRGVidWc9NDAyXT0iQ29uc29sZURlYnVnIixyW3IuQ29uc29sZURpcj00MDNdPSJDb25zb2xlRGlyIixyW3IuQ29uc29sZURpcnhtbD00MDRdPSJDb25zb2xlRGlyeG1sIixyW3IuQ29uc29sZUVycm9yPTQwNV09IkNvbnNvbGVFcnJvciIscltyLkNvbnNvbGVJbmZvPTQwNl09IkNvbnNvbGVJbmZvIixyW3IuQ29uc29sZUxvZz00MDddPSJDb25zb2xlTG9nIixyW3IuQ29uc29sZVRhYmxlPTQwOF09IkNvbnNvbGVUYWJsZSIscltyLkNvbnNvbGVUcmFjZT00MDldPSJDb25zb2xlVHJhY2UiLHJbci5Db25zb2xlV2Fybj00MTBdPSJDb25zb2xlV2FybiIscltyLkVSUk9SX1NDUklQVD01MDFdPSJFUlJPUl9TQ1JJUFQiLHJbci5FUlJPUl9SVU5USU1FPTUwMl09IkVSUk9SX1JVTlRJTUUiLHJbci5FUlJPUl9OT1RGT1VORD01MDNdPSJFUlJPUl9OT1RGT1VORCIscltyLkVSUk9SX1BST01JU0VSRUpFQ1RJT049NTA0XT0iRVJST1JfUFJPTUlTRVJFSkVDVElPTiIscltyLk5FVFdPUktfU0VORD02MDFdPSJORVRXT1JLX1NFTkQiLHJbci5ORVRXT1JLX0RPTkU9NjAyXT0iTkVUV09SS19ET05FIixyW3IuTkVUV09SS19BQk9SVD02MDNdPSJORVRXT1JLX0FCT1JUIixyW3IuTkVUV09SS19FUlJPUj02MDRdPSJORVRXT1JLX0VSUk9SIixyW3IuTkVUV09SS19USU1FT1VUPTYwNV09Ik5FVFdPUktfVElNRU9VVCIscltyLklOU0lHSFRfUkFHRV9DTElDSz03MDFdPSJJTlNJR0hUX1JBR0VfQ0xJQ0siLHJbci5JTlNJR0hUX0RFQURfQ0xJQ0s9NzAyXT0iSU5TSUdIVF9ERUFEX0NMSUNLIixyW3IuSU5TSUdIVF9MT05HX0hPVkVSPTcwM109IklOU0lHSFRfTE9OR19IT1ZFUiIscltyLklOU0lHSFRfRVhDRVNTSVZFX1NDUk9MTElORz03MDRdPSJJTlNJR0hUX0VYQ0VTU0lWRV9TQ1JPTExJTkciLHJbci5QRVJGT1JNQU5DRV9MT05HX1RBU0s9ODAxXT0iUEVSRk9STUFOQ0VfTE9OR19UQVNLIixyW3IuUEVSRk9STUFOQ0VfUkVTT1VSQ0U9ODAyXT0iUEVSRk9STUFOQ0VfUkVTT1VSQ0UiLHJbci5QRVJGT1JNQU5DRV9OQVZJR0FUSU9OPTgwM109IlBFUkZPUk1BTkNFX05BVklHQVRJT04ifSkoVHJhY2tlckV2ZW50VHlwZXx8KFRyYWNrZXJFdmVudFR5cGU9e30pKTt2YXIgVHJhY2tUeXBlOyhmdW5jdGlvbihyKXtyW3IuTm9vcD0wXT0iTm9vcCIscltyLkhUTUw9MTAwXT0iSFRNTCIscltyLk1vdXNlPTIwMF09Ik1vdXNlIixyW3IuS2V5Ym9hcmQ9MzAwXT0iS2V5Ym9hcmQiLHJbci5Db25zb2xlPTQwMF09IkNvbnNvbGUiLHJbci5FcnJvcj01MDBdPSJFcnJvciIscltyLk5ldHdvcms9NjAwXT0iTmV0d29yayIscltyLkluc2lnaHQ9NzAwXT0iSW5zaWdodCIscltyLlBlcmZvcm1hbmNlPTgwMF09IlBlcmZvcm1hbmNlIn0pKFRyYWNrVHlwZXx8KFRyYWNrVHlwZT17fSkpO2Z1bmN0aW9uIGlzQ3VzdG9tVHJhY2tUeXBlKHIpe3JldHVybiByPj0xMDAxJiZyPD0xOTk5fWZ1bmN0aW9uIG5ld05vb3BGcmFtZShyKXtyZXR1cm57dGltZTpyLHRyYWNrVHlwZTpUcmFja1R5cGUuTm9vcCxldmVudDp7ZXZlbnRUeXBlOlRyYWNrZXJFdmVudFR5cGUuTm9vcCxkYXRhOjB9fX12YXIgUmVmVHlwZTsoZnVuY3Rpb24ocil7ci5JRnJhbWU9ImlmcmFtZSIsci5CbGFja2JveD0iYmxhY2tib3giLHIuVHJhbnNhY3Rpb249InRyYW5zYWN0aW9uIn0pKFJlZlR5cGV8fChSZWZUeXBlPXt9KSk7dmFyIFJlY29yZGluZ01vZGU7KGZ1bmN0aW9uKHIpe3IuQmxhY2tib3g9ImJsYWNrYm94IixyLkJsb2NraW5nPSJibG9ja2luZyIsci5Jbk1lbW9yeT0iaW4tbWVtb3J5IixyLkxpdmVTdHJlYW1pbmc9ImxpdmUtc3RyZWFtaW5nIixyLlN0cmVhbWluZz0ic3RyZWFtaW5nIn0pKFJlY29yZGluZ01vZGV8fChSZWNvcmRpbmdNb2RlPXt9KSk7dmFyIFN0cmVhbWluZ0NvbW1hbmRUeXBlOyhmdW5jdGlvbihyKXtyLlJlY29yZGVyU3RvcHBlZD0iUmVjb3JkZXJTdG9wcGVkIixyLlJlY2VpdmVyU3RvcHBlZD0iUmVjZWl2ZXJTdG9wcGVkIixyLlJlY29yZGVyRGlzY29ubmVjdGVkPSJSZWNvcmRlckRpc2Nvbm5lY3RlZCIsci5TeW5jQmxvY2s9IlN5bmNCbG9jayIsci5TeW5jUGFja2V0PSJTeW5jUGFja2V0In0pKFN0cmVhbWluZ0NvbW1hbmRUeXBlfHwoU3RyZWFtaW5nQ29tbWFuZFR5cGU9e30pKTt2YXIgVHJhbnNwb3J0Q2hhbm5lbFR5cGU7KGZ1bmN0aW9uKHIpe3IuV2Vic29ja2V0PSJ3ZWJzb2NrZXQiLHIuUVVJQz0icXVpYyIsci5IVFRQPSJodHRwIn0pKFRyYW5zcG9ydENoYW5uZWxUeXBlfHwoVHJhbnNwb3J0Q2hhbm5lbFR5cGU9e30pKTtmdW5jdGlvbiBjcmVhdGVSZWNvcmRpbmcocix0KXtjb25zdHtpZDplLHRva2VuOm4sbW9kZTpzLGNsaWVudFRpbWU6byxtZXRhOmEsZW52aXJvbm1lbnQ6YyxwYXJlbnQ6bCxyZWZUeXBlOnUsdHJhY2tlcnM6aH09dDtyZXR1cm4gci5wb3N0KGByZWNvcmRpbmcvJHtlIT1udWxsP2U6Z2VuZXJhdGVVVUlEKCl9L2NyZWF0ZWAse21vZGU6cyxjbGllbnRUaW1lOm8sbWV0YTphLGVudmlyb25tZW50OmMscGFyZW50OmwscmVmVHlwZTp1LHRyYWNrZXJzOmh9LG4/e0F1dGhvcml6YXRpb246bn06dm9pZCAwKX1mdW5jdGlvbiBjcmVhdGVCbG9jayhyLHQpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdHt0b2tlbjplLHJlY29yZGluZ0lkOm4sYmxvYjpzLG9mZnNldDpvLGNvdW50OmEsZmlyc3RGcmFtZVRpbWU6YyxsYXN0RnJhbWVUaW1lOmx9PXQsdT1jcmVhdGVGb3JtRGF0YSgpO3UuYXBwZW5kKCJibG9jayIscyksdS5hcHBlbmQoIm9mZnNldCIsYCR7b31gKSx1LmFwcGVuZCgiY291bnQiLGAke2F9YCksdS5hcHBlbmQoImZpcnN0RnJhbWVUaW1lIixgJHtjfWApLHUuYXBwZW5kKCJsYXN0RnJhbWVUaW1lIixgJHtsfWApO2NvbnN0IGg9e307cmV0dXJuIGUmJihoLkF1dGhvcml6YXRpb249ZSksci5wb3N0KGBzdG9yYWdlLyR7bn0vYmxvY2tgLHUsaCl9KX1jb25zdCBCUl9SRUNPUkRJTkdfRFVQTElDQVRFRD0iQlJfUkVDT1JESU5HX0RVUExJQ0FURUQiO2Z1bmN0aW9uIGVuY29kZShyLHQpe2NvbnN0IGU9ci5tYXAobz0+SlNPTi5zdHJpbmdpZnkoW28udGltZS10LG8udHJhY2tUeXBlLG8uZXZlbnQuZXZlbnRUeXBlLG8uZXZlbnQuZGF0YV0pKTtlLnB1c2goIiIpO2NvbnN0IG49ZS5qb2luKGAKYCk7cmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShuKX1jbGFzcyBEZWZhdWx0RW5jb2Rlcntjb25zdHJ1Y3Rvcih0KXt0aGlzLmNvbnRleHQ9dH1lbmNvZGUodCl7cmV0dXJuIGVuY29kZSh0LHRoaXMuY29udGV4dC5zdGFydFRpbWUpfX12YXIgU2lnbmFsVHlwZT0ocj0+KHIuQ29tcGVuc2F0ZVNuYXBzaG90PSJDb21wZW5zYXRlU25hcHNob3QiLHIuQmxvY2tDcmVhdGVkPSJCbG9ja0NyZWF0ZWQiLHIuRnJhbWVJbmRleD0iRnJhbWVJbmRleCIscikpKFNpZ25hbFR5cGV8fHt9KSx1OD1VaW50OEFycmF5LHUxNj1VaW50MTZBcnJheSxpMzI9SW50MzJBcnJheSxmbGViPW5ldyB1OChbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwLDAsMCwwXSksZmRlYj1uZXcgdTgoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTMsMCwwXSksY2xpbT1uZXcgdTgoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxmcmViPWZ1bmN0aW9uKHIsdCl7Zm9yKHZhciBlPW5ldyB1MTYoMzEpLG49MDtuPDMxOysrbillW25dPXQrPTE8PHJbbi0xXTtmb3IodmFyIHM9bmV3IGkzMihlWzMwXSksbj0xO248MzA7KytuKWZvcih2YXIgbz1lW25dO288ZVtuKzFdOysrbylzW29dPW8tZVtuXTw8NXxuO3JldHVybntiOmUscjpzfX0sX2E9ZnJlYihmbGViLDIpLGZsPV9hLmIscmV2Zmw9X2EucjtmbFsyOF09MjU4LHJldmZsWzI1OF09Mjg7Zm9yKHZhciBfYj1mcmViKGZkZWIsMCkscmV2ZmQ9X2IucixyZXY9bmV3IHUxNigzMjc2OCksaT0wO2k8MzI3Njg7KytpKXt2YXIgeD0oaSY0MzY5MCk+PjF8KGkmMjE4NDUpPDwxO3g9KHgmNTI0MjgpPj4yfCh4JjEzMTA3KTw8Mix4PSh4JjYxNjgwKT4+NHwoeCYzODU1KTw8NCxyZXZbaV09KCh4JjY1MjgwKT4+OHwoeCYyNTUpPDw4KT4+MX1mb3IodmFyIGhNYXA9ZnVuY3Rpb24ocix0LGUpe2Zvcih2YXIgbj1yLmxlbmd0aCxzPTAsbz1uZXcgdTE2KHQpO3M8bjsrK3MpcltzXSYmKytvW3Jbc10tMV07dmFyIGE9bmV3IHUxNih0KTtmb3Iocz0xO3M8dDsrK3MpYVtzXT1hW3MtMV0rb1tzLTFdPDwxO3ZhciBjO2lmKGUpe2M9bmV3IHUxNigxPDx0KTt2YXIgbD0xNS10O2ZvcihzPTA7czxuOysrcylpZihyW3NdKWZvcih2YXIgdT1zPDw0fHJbc10saD10LXJbc10scD1hW3Jbc10tMV0rKzw8aCxtPXB8KDE8PGgpLTE7cDw9bTsrK3ApY1tyZXZbcF0+PmxdPXV9ZWxzZSBmb3IoYz1uZXcgdTE2KG4pLHM9MDtzPG47KytzKXJbc10mJihjW3NdPXJldlthW3Jbc10tMV0rK10+PjE1LXJbc10pO3JldHVybiBjfSxmbHQ9bmV3IHU4KDI4OCksaT0wO2k8MTQ0OysraSlmbHRbaV09ODtmb3IodmFyIGk9MTQ0O2k8MjU2OysraSlmbHRbaV09OTtmb3IodmFyIGk9MjU2O2k8MjgwOysraSlmbHRbaV09Nztmb3IodmFyIGk9MjgwO2k8Mjg4OysraSlmbHRbaV09ODtmb3IodmFyIGZkdD1uZXcgdTgoMzIpLGk9MDtpPDMyOysraSlmZHRbaV09NTt2YXIgZmxtPWhNYXAoZmx0LDksMCksZmRtPWhNYXAoZmR0LDUsMCksc2hmdD1mdW5jdGlvbihyKXtyZXR1cm4ocis3KS84fDB9LHNsYz1mdW5jdGlvbihyLHQsZSl7cmV0dXJuKHQ9PW51bGx8fHQ8MCkmJih0PTApLChlPT1udWxsfHxlPnIubGVuZ3RoKSYmKGU9ci5sZW5ndGgpLG5ldyB1OChyLnN1YmFycmF5KHQsZSkpfSx3Yml0cz1mdW5jdGlvbihyLHQsZSl7ZTw8PXQmNzt2YXIgbj10Lzh8MDtyW25dfD1lLHJbbisxXXw9ZT4+OH0sd2JpdHMxNj1mdW5jdGlvbihyLHQsZSl7ZTw8PXQmNzt2YXIgbj10Lzh8MDtyW25dfD1lLHJbbisxXXw9ZT4+OCxyW24rMl18PWU+PjE2fSxoVHJlZT1mdW5jdGlvbihyLHQpe2Zvcih2YXIgZT1bXSxuPTA7bjxyLmxlbmd0aDsrK24pcltuXSYmZS5wdXNoKHtzOm4sZjpyW25dfSk7dmFyIHM9ZS5sZW5ndGgsbz1lLnNsaWNlKCk7aWYoIXMpcmV0dXJue3Q6ZXQsbDowfTtpZihzPT0xKXt2YXIgYT1uZXcgdTgoZVswXS5zKzEpO3JldHVybiBhW2VbMF0uc109MSx7dDphLGw6MX19ZS5zb3J0KGZ1bmN0aW9uKEwsVyl7cmV0dXJuIEwuZi1XLmZ9KSxlLnB1c2goe3M6LTEsZjoyNTAwMX0pO3ZhciBjPWVbMF0sbD1lWzFdLHU9MCxoPTEscD0yO2ZvcihlWzBdPXtzOi0xLGY6Yy5mK2wuZixsOmMscjpsfTtoIT1zLTE7KWM9ZVtlW3VdLmY8ZVtwXS5mP3UrKzpwKytdLGw9ZVt1IT1oJiZlW3VdLmY8ZVtwXS5mP3UrKzpwKytdLGVbaCsrXT17czotMSxmOmMuZitsLmYsbDpjLHI6bH07Zm9yKHZhciBtPW9bMF0ucyxuPTE7bjxzOysrbilvW25dLnM+bSYmKG09b1tuXS5zKTt2YXIgdj1uZXcgdTE2KG0rMSksdz1sbihlW2gtMV0sdiwwKTtpZih3PnQpe3ZhciBuPTAsVD0wLFM9dy10LEM9MTw8Uztmb3Ioby5zb3J0KGZ1bmN0aW9uKFcsSCl7cmV0dXJuIHZbSC5zXS12W1cuc118fFcuZi1ILmZ9KTtuPHM7KytuKXt2YXIgTT1vW25dLnM7aWYodltNXT50KVQrPUMtKDE8PHctdltNXSksdltNXT10O2Vsc2UgYnJlYWt9Zm9yKFQ+Pj1TO1Q+MDspe3ZhciBSPW9bbl0uczt2W1JdPHQ/VC09MTw8dC12W1JdKystMTorK259Zm9yKDtuPj0wJiZUOy0tbil7dmFyIGo9b1tuXS5zO3Zbal09PXQmJigtLXZbal0sKytUKX13PXR9cmV0dXJue3Q6bmV3IHU4KHYpLGw6d319LGxuPWZ1bmN0aW9uKHIsdCxlKXtyZXR1cm4gci5zPT0tMT9NYXRoLm1heChsbihyLmwsdCxlKzEpLGxuKHIucix0LGUrMSkpOnRbci5zXT1lfSxsYz1mdW5jdGlvbihyKXtmb3IodmFyIHQ9ci5sZW5ndGg7dCYmIXJbLS10XTspO2Zvcih2YXIgZT1uZXcgdTE2KCsrdCksbj0wLHM9clswXSxvPTEsYT1mdW5jdGlvbihsKXtlW24rK109bH0sYz0xO2M8PXQ7KytjKWlmKHJbY109PXMmJmMhPXQpKytvO2Vsc2V7aWYoIXMmJm8+Mil7Zm9yKDtvPjEzODtvLT0xMzgpYSgzMjc1NCk7bz4yJiYoYShvPjEwP28tMTE8PDV8Mjg2OTA6by0zPDw1fDEyMzA1KSxvPTApfWVsc2UgaWYobz4zKXtmb3IoYShzKSwtLW87bz42O28tPTYpYSg4MzA0KTtvPjImJihhKG8tMzw8NXw4MjA4KSxvPTApfWZvcig7by0tOylhKHMpO289MSxzPXJbY119cmV0dXJue2M6ZS5zdWJhcnJheSgwLG4pLG46dH19LGNsZW49ZnVuY3Rpb24ocix0KXtmb3IodmFyIGU9MCxuPTA7bjx0Lmxlbmd0aDsrK24pZSs9cltuXSp0W25dO3JldHVybiBlfSx3ZmJsaz1mdW5jdGlvbihyLHQsZSl7dmFyIG49ZS5sZW5ndGgscz1zaGZ0KHQrMik7cltzXT1uJjI1NSxyW3MrMV09bj4+OCxyW3MrMl09cltzXV4yNTUscltzKzNdPXJbcysxXV4yNTU7Zm9yKHZhciBvPTA7bzxuOysrbylyW3Mrbys0XT1lW29dO3JldHVybihzKzQrbikqOH0sd2Jsaz1mdW5jdGlvbihyLHQsZSxuLHMsbyxhLGMsbCx1LGgpe3diaXRzKHQsaCsrLGUpLCsrc1syNTZdO2Zvcih2YXIgcD1oVHJlZShzLDE1KSxtPXAudCx2PXAubCx3PWhUcmVlKG8sMTUpLFQ9dy50LFM9dy5sLEM9bGMobSksTT1DLmMsUj1DLm4saj1sYyhUKSxMPWouYyxXPWoubixIPW5ldyB1MTYoMTkpLEQ9MDtEPE0ubGVuZ3RoOysrRCkrK0hbTVtEXSYzMV07Zm9yKHZhciBEPTA7RDxMLmxlbmd0aDsrK0QpKytIW0xbRF0mMzFdO2Zvcih2YXIgST1oVHJlZShILDcpLHo9SS50LFU9SS5sLEs9MTk7Sz40JiYheltjbGltW0stMV1dOy0tSyk7dmFyIGVlPXUrNTw8MyxKPWNsZW4ocyxmbHQpK2NsZW4obyxmZHQpK2EsWj1jbGVuKHMsbSkrY2xlbihvLFQpK2ErMTQrMypLK2NsZW4oSCx6KSsyKkhbMTZdKzMqSFsxN10rNypIWzE4XTtpZihsPj0wJiZlZTw9SiYmZWU8PVopcmV0dXJuIHdmYmxrKHQsaCxyLnN1YmFycmF5KGwsbCt1KSk7dmFyIFYsRixxLEc7aWYod2JpdHModCxoLDErKFo8SikpLGgrPTIsWjxKKXtWPWhNYXAobSx2LDApLEY9bSxxPWhNYXAoVCxTLDApLEc9VDt2YXIgdGU9aE1hcCh6LFUsMCk7d2JpdHModCxoLFItMjU3KSx3Yml0cyh0LGgrNSxXLTEpLHdiaXRzKHQsaCsxMCxLLTQpLGgrPTE0O2Zvcih2YXIgRD0wO0Q8SzsrK0Qpd2JpdHModCxoKzMqRCx6W2NsaW1bRF1dKTtoKz0zKks7Zm9yKHZhciBkPVtNLExdLF89MDtfPDI7KytfKWZvcih2YXIgZz1kW19dLEQ9MDtEPGcubGVuZ3RoOysrRCl7dmFyIHk9Z1tEXSYzMTt3Yml0cyh0LGgsdGVbeV0pLGgrPXpbeV0seT4xNSYmKHdiaXRzKHQsaCxnW0RdPj41JjEyNyksaCs9Z1tEXT4+MTIpfX1lbHNlIFY9ZmxtLEY9Zmx0LHE9ZmRtLEc9ZmR0O2Zvcih2YXIgRD0wO0Q8YzsrK0Qpe3ZhciBFPW5bRF07aWYoRT4yNTUpe3ZhciB5PUU+PjE4JjMxO3diaXRzMTYodCxoLFZbeSsyNTddKSxoKz1GW3krMjU3XSx5PjcmJih3Yml0cyh0LGgsRT4+MjMmMzEpLGgrPWZsZWJbeV0pO3ZhciBCPUUmMzE7d2JpdHMxNih0LGgscVtCXSksaCs9R1tCXSxCPjMmJih3Yml0czE2KHQsaCxFPj41JjgxOTEpLGgrPWZkZWJbQl0pfWVsc2Ugd2JpdHMxNih0LGgsVltFXSksaCs9RltFXX1yZXR1cm4gd2JpdHMxNih0LGgsVlsyNTZdKSxoK0ZbMjU2XX0sZGVvPW5ldyBpMzIoWzY1NTQwLDEzMTA4MCwxMzEwODgsMTMxMTA0LDI2MjE3NiwxMDQ4NzA0LDEwNDg4MzIsMjExNDU2MCwyMTE3NjMyXSksZXQ9bmV3IHU4KDApLGRmbHQ9ZnVuY3Rpb24ocix0LGUsbixzLG8pe3ZhciBhPW8uenx8ci5sZW5ndGgsYz1uZXcgdTgobithKzUqKDErTWF0aC5jZWlsKGEvN2UzKSkrcyksbD1jLnN1YmFycmF5KG4sYy5sZW5ndGgtcyksdT1vLmwsaD0oby5yfHwwKSY3O2lmKHQpe2gmJihsWzBdPW8ucj4+Myk7Zm9yKHZhciBwPWRlb1t0LTFdLG09cD4+MTMsdj1wJjgxOTEsdz0oMTw8ZSktMSxUPW8ucHx8bmV3IHUxNigzMjc2OCksUz1vLmh8fG5ldyB1MTYodysxKSxDPU1hdGguY2VpbChlLzMpLE09MipDLFI9ZnVuY3Rpb24oaWUpe3JldHVybihyW2llXV5yW2llKzFdPDxDXnJbaWUrMl08PE0pJnd9LGo9bmV3IGkzMigyNWUzKSxMPW5ldyB1MTYoMjg4KSxXPW5ldyB1MTYoMzIpLEg9MCxEPTAsST1vLml8fDAsej0wLFU9by53fHwwLEs9MDtJKzI8YTsrK0kpe3ZhciBlZT1SKEkpLEo9SSYzMjc2NyxaPVNbZWVdO2lmKFRbSl09WixTW2VlXT1KLFU8PUkpe3ZhciBWPWEtSTtpZigoSD43ZTN8fHo+MjQ1NzYpJiYoVj40MjN8fCF1KSl7aD13YmxrKHIsbCwwLGosTCxXLEQseixLLEktSyxoKSx6PUg9RD0wLEs9STtmb3IodmFyIEY9MDtGPDI4NjsrK0YpTFtGXT0wO2Zvcih2YXIgRj0wO0Y8MzA7KytGKVdbRl09MH12YXIgcT0yLEc9MCx0ZT12LGQ9Si1aJjMyNzY3O2lmKFY+MiYmZWU9PVIoSS1kKSlmb3IodmFyIF89TWF0aC5taW4obSxWKS0xLGc9TWF0aC5taW4oMzI3NjcsSSkseT1NYXRoLm1pbigyNTgsVik7ZDw9ZyYmLS10ZSYmSiE9Wjspe2lmKHJbSStxXT09cltJK3EtZF0pe2Zvcih2YXIgRT0wO0U8eSYmcltJK0VdPT1yW0krRS1kXTsrK0UpO2lmKEU+cSl7aWYocT1FLEc9ZCxFPl8pYnJlYWs7Zm9yKHZhciBCPU1hdGgubWluKGQsRS0yKSxZPTAsRj0wO0Y8QjsrK0Ype3ZhciBYPUktZCtGJjMyNzY3LF9lPVRbWF0sbGU9WC1fZSYzMjc2NztsZT5ZJiYoWT1sZSxaPVgpfX19Sj1aLFo9VFtKXSxkKz1KLVomMzI3Njd9aWYoRyl7alt6KytdPTI2ODQzNTQ1NnxyZXZmbFtxXTw8MTh8cmV2ZmRbR107dmFyIHVlPXJldmZsW3FdJjMxLGhlPXJldmZkW0ddJjMxO0QrPWZsZWJbdWVdK2ZkZWJbaGVdLCsrTFsyNTcrdWVdLCsrV1toZV0sVT1JK3EsKytIfWVsc2Ugalt6KytdPXJbSV0sKytMW3JbSV1dfX1mb3IoST1NYXRoLm1heChJLFUpO0k8YTsrK0kpalt6KytdPXJbSV0sKytMW3JbSV1dO2g9d2JsayhyLGwsdSxqLEwsVyxELHosSyxJLUssaCksdXx8KG8ucj1oJjd8bFtoLzh8MF08PDMsaC09NyxvLmg9UyxvLnA9VCxvLmk9SSxvLnc9VSl9ZWxzZXtmb3IodmFyIEk9by53fHwwO0k8YSt1O0krPTY1NTM1KXt2YXIgc2U9SSs2NTUzNTtzZT49YSYmKGxbaC84fDBdPXUsc2U9YSksaD13ZmJsayhsLGgrMSxyLnN1YmFycmF5KEksc2UpKX1vLmk9YX1yZXR1cm4gc2xjKGMsMCxuK3NoZnQoaCkrcyl9LGNyY3Q9ZnVuY3Rpb24oKXtmb3IodmFyIHI9bmV3IEludDMyQXJyYXkoMjU2KSx0PTA7dDwyNTY7Kyt0KXtmb3IodmFyIGU9dCxuPTk7LS1uOyllPShlJjEmJi0zMDY2NzQ5MTIpXmU+Pj4xO3JbdF09ZX1yZXR1cm4gcn0oKSxjcmM9ZnVuY3Rpb24oKXt2YXIgcj0tMTtyZXR1cm57cDpmdW5jdGlvbih0KXtmb3IodmFyIGU9cixuPTA7bjx0Lmxlbmd0aDsrK24pZT1jcmN0W2UmMjU1XnRbbl1dXmU+Pj44O3I9ZX0sZDpmdW5jdGlvbigpe3JldHVybn5yfX19LGRvcHQ9ZnVuY3Rpb24ocix0LGUsbixzKXtpZighcyYmKHM9e2w6MX0sdC5kaWN0aW9uYXJ5KSl7dmFyIG89dC5kaWN0aW9uYXJ5LnN1YmFycmF5KC0zMjc2OCksYT1uZXcgdTgoby5sZW5ndGgrci5sZW5ndGgpO2Euc2V0KG8pLGEuc2V0KHIsby5sZW5ndGgpLHI9YSxzLnc9by5sZW5ndGh9cmV0dXJuIGRmbHQocix0LmxldmVsPT1udWxsPzY6dC5sZXZlbCx0Lm1lbT09bnVsbD9zLmw/TWF0aC5jZWlsKE1hdGgubWF4KDgsTWF0aC5taW4oMTMsTWF0aC5sb2coci5sZW5ndGgpKSkqMS41KToyMDoxMit0Lm1lbSxlLG4scyl9LHdieXRlcz1mdW5jdGlvbihyLHQsZSl7Zm9yKDtlOysrdClyW3RdPWUsZT4+Pj04fSxnemg9ZnVuY3Rpb24ocix0KXt2YXIgZT10LmZpbGVuYW1lO2lmKHJbMF09MzEsclsxXT0xMzksclsyXT04LHJbOF09dC5sZXZlbDwyPzQ6dC5sZXZlbD09OT8yOjAscls5XT0zLHQubXRpbWUhPTAmJndieXRlcyhyLDQsTWF0aC5mbG9vcihuZXcgRGF0ZSh0Lm10aW1lfHxEYXRlLm5vdygpKS8xZTMpKSxlKXtyWzNdPTg7Zm9yKHZhciBuPTA7bjw9ZS5sZW5ndGg7KytuKXJbbisxMF09ZS5jaGFyQ29kZUF0KG4pfX0sZ3pobD1mdW5jdGlvbihyKXtyZXR1cm4gMTArKHIuZmlsZW5hbWU/ci5maWxlbmFtZS5sZW5ndGgrMTowKX07ZnVuY3Rpb24gZ3ppcFN5bmMocix0KXt0fHwodD17fSk7dmFyIGU9Y3JjKCksbj1yLmxlbmd0aDtlLnAocik7dmFyIHM9ZG9wdChyLHQsZ3pobCh0KSw4KSxvPXMubGVuZ3RoO3JldHVybiBnemgocyx0KSx3Ynl0ZXMocyxvLTgsZS5kKCkpLHdieXRlcyhzLG8tNCxuKSxzfXZhciB0ZD10eXBlb2YgVGV4dERlY29kZXIhPSJ1bmRlZmluZWQiJiZuZXcgVGV4dERlY29kZXIsdGRzPTA7dHJ5e3RkLmRlY29kZShldCx7c3RyZWFtOiEwfSksdGRzPTF9Y2F0Y2gocil7fWZ1bmN0aW9uIGd6aXAocil7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKGNhbml1c2UuY29tcHJlc3Npb25TdHJlYW0oKSl0cnl7Y29uc3QgdD1jcmVhdGVSZWFkYWJsZVN0cmVhbUZyb21VaW50OEFycmF5KHIpLGU9bmV3IGdsb2JhbFRoaXMuQ29tcHJlc3Npb25TdHJlYW0oImd6aXAiKSxuPXQucGlwZVRocm91Z2goZSk7cmV0dXJuIHlpZWxkIHJlYWRBbGxGcm9tU3RyZWFtKG4pfWNhdGNoKHQpe31yZXR1cm4gZ3ppcFN5bmMocil9KX1jb25zdCBEZWZhdWx0UGFja2VyQ29uZmlnPXtjb21wcmVzc2lvbjp7bW9kZToiZ3ppcCJ9fTtjbGFzcyBEZWZhdWx0UGFja2VyIGV4dGVuZHMgQWJzdHJhY3RGbG93e2NvbnN0cnVjdG9yKGUpe3N1cGVyKCk7Zih0aGlzLCJfcGFja2V0SWQiLDApO2YodGhpcywiX2ZyYW1lT2Zmc2V0IiwwKTtmKHRoaXMsIl9lbmNvZGVyIik7dGhpcy5jb250ZXh0PWUsdGhpcy5fZW5jb2Rlcj1uZXcgRGVmYXVsdEVuY29kZXIoZSl9aGFuZGxlSW5wdXQoZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKGUubGVuZ3RoPjApe2NvbnN0IG49dGhpcy5lbmNvZGUoZSkscz15aWVsZCB0aGlzLnBhY2sobixlLmxlbmd0aCxlWzBdLnRpbWUsZVtlLmxlbmd0aC0xXS50aW1lKTt0aGlzLm91dHB1dChzKX19KX1lbmNvZGUoZSl7cmV0dXJuIGUuZm9yRWFjaCgobixzKT0+e2lmKG4udHJhY2tUeXBlPT09VHJhY2tUeXBlLkhUTUwmJm4uZXZlbnQuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5IVE1MSW5jcmVtZW50YWxTbmFwc2hvdCl7Y29uc3Qgbz17aWQ6YGZyYW1lLyR7dGhpcy5fZnJhbWVPZmZzZXQrc31gLHRpbWU6bi50aW1lLHR5cGU6ImZyYW1lIixyZWNvcmRpbmdJZDp0aGlzLmNvbnRleHQuaWQsZGF0YTp7dHJhY2tUeXBlOm4udHJhY2tUeXBlLGV2ZW50VHlwZTpuLmV2ZW50LmV2ZW50VHlwZSxvZmZzZXQ6dGhpcy5fZnJhbWVPZmZzZXQrc319O3RoaXMuY29udGV4dC5lbWl0KCJmZWVkYmFjayIse3R5cGU6U2lnbmFsVHlwZS5GcmFtZUluZGV4LGluZGV4Om99KX19KSx0aGlzLl9lbmNvZGVyLmVuY29kZShlKX1wYWNrKGUsbixzLG8pe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXt2YXIgaCxwO2xldCBhPWU7KCgocD0oaD10aGlzLmNvbnRleHQudHJhbnNtaXR0ZXIpPT1udWxsP3ZvaWQgMDpoLnN0cmF0ZWd5KT09bnVsbD92b2lkIDA6cC5wYWNrZXIpfHxEZWZhdWx0UGFja2VyQ29uZmlnKS5jb21wcmVzc2lvbi5tb2RlPT09Imd6aXAiJiYoYT15aWVsZCBnemlwKGUpKTtjb25zdCB1PXtpZDpgJHt0aGlzLmNvbnRleHQucmVjb3JkaW5nLmlkfS8ke3RoaXMuX25leHRQYWNrZXRJZCgpfWAsZnJhbWVSYW5nZTpbdGhpcy5fZnJhbWVPZmZzZXQsbl0sZGF0YTphLGZpcnN0RnJhbWVUaW1lOnMtdGhpcy5jb250ZXh0LnN0YXJ0VGltZSxsYXN0RnJhbWVUaW1lOm8tdGhpcy5jb250ZXh0LnN0YXJ0VGltZX07cmV0dXJuIHRoaXMuX2ZyYW1lT2Zmc2V0Kz1uLHV9KX1fbmV4dFBhY2tldElkKCl7cmV0dXJuIHRoaXMuX3BhY2tldElkKyt9fWZ1bmN0aW9uIHBhY2socix0LGUsbixzLG8pe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdCBhPXlpZWxkIGd6aXAocik7cmV0dXJue2lkOmAke3N9LzBgLGZyYW1lUmFuZ2U6WzAsdF0sZGF0YTphLGZpcnN0RnJhbWVUaW1lOmUtbyxsYXN0RnJhbWVUaW1lOm4tb319KX1jbGFzcyBBYnN0cmFjdFByb2Nlc3NvciBleHRlbmRzIEFic3RyYWN0Rmxvd3tjb25zdHJ1Y3RvcihlLG4pe3N1cGVyKCk7Zih0aGlzLCJfdHJhY2tUeXBlc1RvSGFuZGxlIik7Zih0aGlzLCJfY29udGV4dCIpO2lmKHRoaXMuX2NvbnRleHQ9ZSxuIT1udWxsKXtjb25zdCBzPXt9O0FycmF5LmlzQXJyYXkobik/bi5mb3JFYWNoKG89PntzW29dPSEwfSk6c1tuXT0hMCx0aGlzLl90cmFja1R5cGVzVG9IYW5kbGU9c319aGFuZGxlSW5wdXQoZSl7dGhpcy5fc2hvdWxkSGFuZGxlKGUpP3RoaXMuaGFuZGxlRnJhbWUoZSk6dGhpcy5vdXRwdXQoZSl9X3Nob3VsZEhhbmRsZShlKXtyZXR1cm4gdGhpcy5fdHJhY2tUeXBlc1RvSGFuZGxlPT1udWxsfHx0aGlzLl90cmFja1R5cGVzVG9IYW5kbGVbZS50cmFja1R5cGVdPT09ITB9fWNvbnN0IENUWF9BUEk9WyJhcmMiLCJhcmNUbyIsImJlZ2luUGF0aCIsImJlemllckN1cnZlVG8iLCJjbGVhclJlY3QiLCJjbGlwIiwiY2xvc2VQYXRoIiwiY3JlYXRlQ29uaWNHcmFkaWVudCIsImNyZWF0ZUltYWdlRGF0YSIsImNyZWF0ZUxpbmVhckdyYWRpZW50IiwiY3JlYXRlUGF0dGVybiIsImNyZWF0ZVJhZGlhbEdyYWRpZW50IiwiZHJhd0ZvY3VzSWZOZWVkZWQiLCJkcmF3SW1hZ2UiLCJlbGxpcHNlIiwiZmlsbCIsImZpbGxSZWN0IiwiZmlsbFRleHQiLCJnZXRDb250ZXh0QXR0cmlidXRlcyIsImdldEltYWdlRGF0YSIsImdldExpbmVEYXNoIiwiZ2V0VHJhbnNmb3JtIiwiaXNDb250ZXh0TG9zdCIsImlzUG9pbnRJblBhdGgiLCJpc1BvaW50SW5TdHJva2UiLCJsaW5lVG8iLCJtZWFzdXJlVGV4dCIsIm1vdmVUbyIsInB1dEltYWdlRGF0YSIsInF1YWRyYXRpY0N1cnZlVG8iLCJyZWN0IiwicmVzZXQiLCJyZXNldFRyYW5zZm9ybSIsInJlc3RvcmUiLCJyb3RhdGUiLCJyb3VuZFJlY3QiLCJzYXZlIiwic2NhbGUiLCJzY3JvbGxQYXRoSW50b1ZpZXciLCJzZXRMaW5lRGFzaCIsInNldFRyYW5zZm9ybSIsInN0cm9rZSIsInN0cm9rZVJlY3QiLCJzdHJva2VUZXh0IiwidHJhbnNmb3JtIiwidHJhbnNsYXRlIl0sQ1RYX0FQSV9FTkNPREVSPXtzZXRUcmFuc2Zvcm06MCxsaW5lVG86MSxiZWdpblBhdGg6MixmaWxsOjMsc2V0QXR0cjo0LHN0cm9rZTo1LGNsaXA6NixzYXZlOjcscmVzdG9yZTo4LGZpbGxUZXh0OjksZmlsbFJlY3Q6MTAsYXJjOjExLGFyY1RvOjEyLGJlemllckN1cnZlVG86MTMsY2xlYXJSZWN0OjE0LGNsb3NlUGF0aDoxNSxjcmVhdGVDb25pY0dyYWRpZW50OjE2LGNyZWF0ZUltYWdlRGF0YToxNyxjcmVhdGVMaW5lYXJHcmFkaWVudDoxOCxjcmVhdGVQYXR0ZXJuOjE5LGNyZWF0ZVJhZGlhbEdyYWRpZW50OjIwLGRyYXdGb2N1c0lmTmVlZGVkOjIxLGRyYXdJbWFnZToyMixlbGxpcHNlOjIzLGdldENvbnRleHRBdHRyaWJ1dGVzOjI0LGdldEltYWdlRGF0YToyNSxnZXRMaW5lRGFzaDoyNixnZXRUcmFuc2Zvcm06MjcsaXNDb250ZXh0TG9zdDoyOCxpc1BvaW50SW5QYXRoOjI5LGlzUG9pbnRJblN0cm9rZTozMCxtZWFzdXJlVGV4dDozMSxtb3ZlVG86MzIscHV0SW1hZ2VEYXRhOjMzLHF1YWRyYXRpY0N1cnZlVG86MzQscmVjdDozNSxyZXNldDozNixyZXNldFRyYW5zZm9ybTozNyxyb3RhdGU6Mzgscm91bmRSZWN0OjM5LHNjYWxlOjQwLHNjcm9sbFBhdGhJbnRvVmlldzo0MSxzZXRMaW5lRGFzaDo0MixzdHJva2VSZWN0OjQzLHN0cm9rZVRleHQ6NDQsdHJhbnNmb3JtOjQ1LHRyYW5zbGF0ZTo0NixzbmFwc2hvdDo0N30sQ1RYX0FQSV9ERUNPREVSPU9iamVjdC5rZXlzKENUWF9BUElfRU5DT0RFUiksQ1RYX0FUVFJfRU5DT0RFUj17dGV4dFJlbmRlcmluZzowLGZpbGxTdHlsZToxLHN0cm9rZVN0eWxlOjIsZm9udDozLHRleHRBbGlnbjo0LHdvcmRTcGFjaW5nOjUsbGluZUNhcDo2LGxpbmVEYXNoT2Zmc2V0OjcsbGluZUpvaW46OCxsZXR0ZXJTcGFjaW5nOjksZGlyZWN0aW9uOjEwLGZpbHRlcjoxMSxmb250S2VybmluZzoxMixmb250U3RyZXRjaDoxMyxmb250VmFyaWFudENhcHM6MTQsbGluZVdpZHRoOjE1LGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoxNixpbWFnZVNtb290aGluZ0VuYWJsZWQ6MTcsaW1hZ2VTbW9vdGhpbmdRdWFsaXR5OjE4LG1pdGVyTGltaXQ6MTksc2hhZG93Qmx1cjoyMCxzaGFkb3dDb2xvcjoyMSxzaGFkb3dPZmZzZXRYOjIyLHNoYWRvd09mZnNldFk6MjMsdGV4dEJhc2VsaW5lOjI0LGdsb2JhbEFscGhhOjI1fSxDVFhfQVRUUl9ERUNPREVSPU9iamVjdC5rZXlzKENUWF9BVFRSX0VOQ09ERVIpLExPTkdfU1RSX0FUVFI9W10scGk9TWF0aC5QSSx0YXU9MipwaSxlcHNpbG9uPTFlLTYsdGF1RXBzaWxvbj10YXUtZXBzaWxvbjtmdW5jdGlvbiBhcHBlbmQocil7dGhpcy5fKz1yWzBdO2ZvcihsZXQgdD0xLGU9ci5sZW5ndGg7dDxlOysrdCl0aGlzLl8rPWFyZ3VtZW50c1t0XStyW3RdfWZ1bmN0aW9uIGFwcGVuZFJvdW5kKHIpe2xldCB0PU1hdGguZmxvb3Iocik7aWYoISh0Pj0wKSl0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgZGlnaXRzOiAke3J9YCk7aWYodD4xNSlyZXR1cm4gYXBwZW5kO2NvbnN0IGU9YWUoMTAsdCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3RoaXMuXys9blswXTtmb3IobGV0IHM9MSxvPW4ubGVuZ3RoO3M8bzsrK3MpdGhpcy5fKz1NYXRoLnJvdW5kKGFyZ3VtZW50c1tzXSplKS9lK25bc119fWNsYXNzIFBhdGh7Y29uc3RydWN0b3IodCl7dGhpcy5feDA9dGhpcy5feTA9dGhpcy5feDE9dGhpcy5feTE9bnVsbCx0aGlzLl89IiIsdGhpcy5fYXBwZW5kPXQ9PW51bGw/YXBwZW5kOmFwcGVuZFJvdW5kKHQpfW1vdmVUbyh0LGUpe3RoaXMuX2FwcGVuZGBNJHt0aGlzLl94MD10aGlzLl94MT0rdH0sJHt0aGlzLl95MD10aGlzLl95MT0rZX1gfWNsb3NlUGF0aCgpe3RoaXMuX3gxIT09bnVsbCYmKHRoaXMuX3gxPXRoaXMuX3gwLHRoaXMuX3kxPXRoaXMuX3kwLHRoaXMuX2FwcGVuZGBaYCl9bGluZVRvKHQsZSl7dGhpcy5fYXBwZW5kYEwke3RoaXMuX3gxPSt0fSwke3RoaXMuX3kxPStlfWB9cXVhZHJhdGljQ3VydmVUbyh0LGUsbixzKXt0aGlzLl9hcHBlbmRgUSR7K3R9LCR7K2V9LCR7dGhpcy5feDE9K259LCR7dGhpcy5feTE9K3N9YH1iZXppZXJDdXJ2ZVRvKHQsZSxuLHMsbyxhKXt0aGlzLl9hcHBlbmRgQyR7K3R9LCR7K2V9LCR7K259LCR7K3N9LCR7dGhpcy5feDE9K299LCR7dGhpcy5feTE9K2F9YH1hcmNUbyh0LGUsbixzLG8pe2lmKHQ9K3QsZT0rZSxuPStuLHM9K3Msbz0rbyxvPDApdGhyb3cgbmV3IEVycm9yKGBuZWdhdGl2ZSByYWRpdXM6ICR7b31gKTtsZXQgYT10aGlzLl94MSxjPXRoaXMuX3kxLGw9bi10LHU9cy1lLGg9YS10LHA9Yy1lLG09aCpoK3AqcDtpZih0aGlzLl94MT09PW51bGwpdGhpcy5fYXBwZW5kYE0ke3RoaXMuX3gxPXR9LCR7dGhpcy5feTE9ZX1gO2Vsc2UgaWYobT5lcHNpbG9uKWlmKCEoTWF0aC5hYnMocCpsLXUqaCk+ZXBzaWxvbil8fCFvKXRoaXMuX2FwcGVuZGBMJHt0aGlzLl94MT10fSwke3RoaXMuX3kxPWV9YDtlbHNle2xldCB2PW4tYSx3PXMtYyxUPWwqbCt1KnUsUz12KnYrdyp3LEM9TWF0aC5zcXJ0KFQpLE09TWF0aC5zcXJ0KG0pLFI9bypNYXRoLnRhbigocGktTWF0aC5hY29zKChUK20tUykvKDIqQypNKSkpLzIpLGo9Ui9NLEw9Ui9DO01hdGguYWJzKGotMSk+ZXBzaWxvbiYmdGhpcy5fYXBwZW5kYEwke3QraipofSwke2UraipwfWAsdGhpcy5fYXBwZW5kYEEke299LCR7b30sMCwwLCR7KyhwKnY+aCp3KX0sJHt0aGlzLl94MT10K0wqbH0sJHt0aGlzLl95MT1lK0wqdX1gfX1hcmModCxlLG4scyxvLGEpe2lmKHQ9K3QsZT0rZSxuPStuLGE9ISFhLG48MCl0aHJvdyBuZXcgRXJyb3IoYG5lZ2F0aXZlIHJhZGl1czogJHtufWApO2xldCBjPW4qTWF0aC5jb3MocyksbD1uKk1hdGguc2luKHMpLHU9dCtjLGg9ZStsLHA9MV5hLG09YT9zLW86by1zO3RoaXMuX3gxPT09bnVsbD90aGlzLl9hcHBlbmRgTSR7dX0sJHtofWA6KE1hdGguYWJzKHRoaXMuX3gxLXUpPmVwc2lsb258fE1hdGguYWJzKHRoaXMuX3kxLWgpPmVwc2lsb24pJiZ0aGlzLl9hcHBlbmRgTCR7dX0sJHtofWAsbiYmKG08MCYmKG09bSV0YXUrdGF1KSxtPnRhdUVwc2lsb24/dGhpcy5fYXBwZW5kYEEke259LCR7bn0sMCwxLCR7cH0sJHt0LWN9LCR7ZS1sfUEke259LCR7bn0sMCwxLCR7cH0sJHt0aGlzLl94MT11fSwke3RoaXMuX3kxPWh9YDptPmVwc2lsb24mJnRoaXMuX2FwcGVuZGBBJHtufSwke259LDAsJHsrKG0+PXBpKX0sJHtwfSwke3RoaXMuX3gxPXQrbipNYXRoLmNvcyhvKX0sJHt0aGlzLl95MT1lK24qTWF0aC5zaW4obyl9YCl9cmVjdCh0LGUsbixzKXt0aGlzLl9hcHBlbmRgTSR7dGhpcy5feDA9dGhpcy5feDE9K3R9LCR7dGhpcy5feTA9dGhpcy5feTE9K2V9aCR7bj0rbn12JHsrc31oJHstbn1aYH10b1N0cmluZygpe3JldHVybiB0aGlzLl99fWZ1bmN0aW9uIHBhdGgoKXtyZXR1cm4gbmV3IFBhdGh9cGF0aC5wcm90b3R5cGU9UGF0aC5wcm90b3R5cGU7ZnVuY3Rpb24gVHJhbnNmb3JtKHIsdCxlKXt0aGlzLms9cix0aGlzLng9dCx0aGlzLnk9ZX1UcmFuc2Zvcm0ucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpUcmFuc2Zvcm0sc2NhbGU6ZnVuY3Rpb24ocil7cmV0dXJuIHI9PT0xP3RoaXM6bmV3IFRyYW5zZm9ybSh0aGlzLmsqcix0aGlzLngsdGhpcy55KX0sdHJhbnNsYXRlOmZ1bmN0aW9uKHIsdCl7cmV0dXJuIHI9PT0wJnQ9PT0wP3RoaXM6bmV3IFRyYW5zZm9ybSh0aGlzLmssdGhpcy54K3RoaXMuaypyLHRoaXMueSt0aGlzLmsqdCl9LGFwcGx5OmZ1bmN0aW9uKHIpe3JldHVybltyWzBdKnRoaXMuayt0aGlzLngsclsxXSp0aGlzLmsrdGhpcy55XX0sYXBwbHlYOmZ1bmN0aW9uKHIpe3JldHVybiByKnRoaXMuayt0aGlzLnh9LGFwcGx5WTpmdW5jdGlvbihyKXtyZXR1cm4gcip0aGlzLmsrdGhpcy55fSxpbnZlcnQ6ZnVuY3Rpb24ocil7cmV0dXJuWyhyWzBdLXRoaXMueCkvdGhpcy5rLChyWzFdLXRoaXMueSkvdGhpcy5rXX0saW52ZXJ0WDpmdW5jdGlvbihyKXtyZXR1cm4oci10aGlzLngpL3RoaXMua30saW52ZXJ0WTpmdW5jdGlvbihyKXtyZXR1cm4oci10aGlzLnkpL3RoaXMua30scmVzY2FsZVg6ZnVuY3Rpb24ocil7cmV0dXJuIHIuY29weSgpLmRvbWFpbihyLnJhbmdlKCkubWFwKHRoaXMuaW52ZXJ0WCx0aGlzKS5tYXAoci5pbnZlcnQscikpfSxyZXNjYWxlWTpmdW5jdGlvbihyKXtyZXR1cm4gci5jb3B5KCkuZG9tYWluKHIucmFuZ2UoKS5tYXAodGhpcy5pbnZlcnRZLHRoaXMpLm1hcChyLmludmVydCxyKSl9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuInRyYW5zbGF0ZSgiK3RoaXMueCsiLCIrdGhpcy55KyIpIHNjYWxlKCIrdGhpcy5rKyIpIn19LFRyYW5zZm9ybS5wcm90b3R5cGU7Y29uc3QgY2hlY2s9ZnVuY3Rpb24ocil7cmV0dXJuIHImJnIuTWF0aD09PU1hdGgmJnJ9LEdMT0JBTF9PQko9Y2hlY2sodHlwZW9mIGdsb2JhbFRoaXM9PSJvYmplY3QiJiZnbG9iYWxUaGlzKXx8Y2hlY2sodHlwZW9mIHdpbmRvdz09Im9iamVjdCImJndpbmRvdyl8fGNoZWNrKHR5cGVvZiBzZWxmPT0ib2JqZWN0IiYmc2VsZil8fGNoZWNrKHR5cGVvZiBnbG9iYWw9PSJvYmplY3QiJiZnbG9iYWwpfHxjaGVjayghMSl8fGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCl8fEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7ZnVuY3Rpb24gcHJveHlQYXRoMkQoKXtpZihHTE9CQUxfT0JKLlBhdGgyRCl7Y2xhc3MgciBleHRlbmRzIEdMT0JBTF9PQkouUGF0aDJEe2NvbnN0cnVjdG9yKGUpe3N1cGVyKGUpLHRoaXMucGF0aD1lLHRoaXMuX2QzUGF0aD1wYXRoKCk7Y29uc3Qgbj1PYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykscz1PYmplY3QuZ2V0UHJvdG90eXBlT2Yobiksbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzKSxhPU9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzLl9kM1BhdGgpLGM9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoYSk7cmV0dXJuIE9iamVjdC5rZXlzKG8pLmZvckVhY2gobD0+e09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLGwse3dyaXRhYmxlOiEwLHZhbHVlOiguLi51KT0+KFJlZmxlY3QuYXBwbHkoY1tsXS52YWx1ZSx0aGlzLl9kM1BhdGgsdSksUmVmbGVjdC5hcHBseShvW2xdLnZhbHVlLHRoaXMsdSkpfSl9KSx0aGlzfXRvSlNPTigpe3JldHVybnt0eXBlOiJQYXRoMkQiLHZhbHVlOnRoaXMuX2QzUGF0aC50b1N0cmluZygpfX19cmV0dXJuIHIuQ0FOVkFTX09CU0VSVkVSX1BST1hZRURfUEFUSDJEPSEwLHJ9cmV0dXJuIG51bGx9ZnVuY3Rpb24gaXNQcm94eWVkKHIpe3JldHVybiByIT1udWxsJiZyLkNBTlZBU19PQlNFUlZFUl9QUk9YWUVEX1BBVEgyRD09PSEwfWNsYXNzIFF1aWNrTFJVIGV4dGVuZHMgTWFwe2NvbnN0cnVjdG9yKHQ9e30pe2lmKHN1cGVyKCksISh0Lm1heFNpemUmJnQubWF4U2l6ZT4wKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJgbWF4U2l6ZWAgbXVzdCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMCIpO2lmKHR5cGVvZiB0Lm1heEFnZT09Im51bWJlciImJnQubWF4QWdlPT09MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJgbWF4QWdlYCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwIik7dGhpcy5tYXhTaXplPXQubWF4U2l6ZSx0aGlzLm1heEFnZT10Lm1heEFnZXx8TnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLHRoaXMub25FdmljdGlvbj10Lm9uRXZpY3Rpb24sdGhpcy5jYWNoZT1uZXcgTWFwLHRoaXMub2xkQ2FjaGU9bmV3IE1hcCx0aGlzLl9zaXplPTB9X2VtaXRFdmljdGlvbnModCl7aWYodHlwZW9mIHRoaXMub25FdmljdGlvbj09ImZ1bmN0aW9uIilmb3IoY29uc3RbZSxuXW9mIHQpdGhpcy5vbkV2aWN0aW9uKGUsbi52YWx1ZSl9X2RlbGV0ZUlmRXhwaXJlZCh0LGUpe3JldHVybiB0eXBlb2YgZS5leHBpcnk9PSJudW1iZXIiJiZlLmV4cGlyeTw9RGF0ZS5ub3coKT8odHlwZW9mIHRoaXMub25FdmljdGlvbj09ImZ1bmN0aW9uIiYmdGhpcy5vbkV2aWN0aW9uKHQsZS52YWx1ZSksdGhpcy5kZWxldGUodCkpOiExfV9nZXRPckRlbGV0ZUlmRXhwaXJlZCh0LGUpe2lmKHRoaXMuX2RlbGV0ZUlmRXhwaXJlZCh0LGUpPT09ITEpcmV0dXJuIGUudmFsdWV9X2dldEl0ZW1WYWx1ZSh0LGUpe3JldHVybiBlLmV4cGlyeT90aGlzLl9nZXRPckRlbGV0ZUlmRXhwaXJlZCh0LGUpOmUudmFsdWV9X3BlZWsodCxlKXtjb25zdCBuPWUuZ2V0KHQpO3JldHVybiB0aGlzLl9nZXRJdGVtVmFsdWUodCxuKX1fc2V0KHQsZSl7dGhpcy5jYWNoZS5zZXQodCxlKSx0aGlzLl9zaXplKyssdGhpcy5fc2l6ZT49dGhpcy5tYXhTaXplJiYodGhpcy5fc2l6ZT0wLHRoaXMuX2VtaXRFdmljdGlvbnModGhpcy5vbGRDYWNoZSksdGhpcy5vbGRDYWNoZT10aGlzLmNhY2hlLHRoaXMuY2FjaGU9bmV3IE1hcCl9X21vdmVUb1JlY2VudCh0LGUpe3RoaXMub2xkQ2FjaGUuZGVsZXRlKHQpLHRoaXMuX3NldCh0LGUpfSpfZW50cmllc0FzY2VuZGluZygpe2Zvcihjb25zdCB0IG9mIHRoaXMub2xkQ2FjaGUpe2NvbnN0W2Usbl09dDt0aGlzLmNhY2hlLmhhcyhlKXx8dGhpcy5fZGVsZXRlSWZFeHBpcmVkKGUsbik9PT0hMSYmKHlpZWxkIHQpfWZvcihjb25zdCB0IG9mIHRoaXMuY2FjaGUpe2NvbnN0W2Usbl09dDt0aGlzLl9kZWxldGVJZkV4cGlyZWQoZSxuKT09PSExJiYoeWllbGQgdCl9fWdldCh0KXtpZih0aGlzLmNhY2hlLmhhcyh0KSl7Y29uc3QgZT10aGlzLmNhY2hlLmdldCh0KTtyZXR1cm4gdGhpcy5fZ2V0SXRlbVZhbHVlKHQsZSl9aWYodGhpcy5vbGRDYWNoZS5oYXModCkpe2NvbnN0IGU9dGhpcy5vbGRDYWNoZS5nZXQodCk7aWYodGhpcy5fZGVsZXRlSWZFeHBpcmVkKHQsZSk9PT0hMSlyZXR1cm4gdGhpcy5fbW92ZVRvUmVjZW50KHQsZSksZS52YWx1ZX19c2V0KHQsZSx7bWF4QWdlOm49dGhpcy5tYXhBZ2V9PXt9KXtjb25zdCBzPXR5cGVvZiBuPT0ibnVtYmVyIiYmbiE9PU51bWJlci5QT1NJVElWRV9JTkZJTklUWT9EYXRlLm5vdygpK246dm9pZCAwO3JldHVybiB0aGlzLmNhY2hlLmhhcyh0KT90aGlzLmNhY2hlLnNldCh0LHt2YWx1ZTplLGV4cGlyeTpzfSk6dGhpcy5fc2V0KHQse3ZhbHVlOmUsZXhwaXJ5OnN9KSx0aGlzfWhhcyh0KXtyZXR1cm4gdGhpcy5jYWNoZS5oYXModCk/IXRoaXMuX2RlbGV0ZUlmRXhwaXJlZCh0LHRoaXMuY2FjaGUuZ2V0KHQpKTp0aGlzLm9sZENhY2hlLmhhcyh0KT8hdGhpcy5fZGVsZXRlSWZFeHBpcmVkKHQsdGhpcy5vbGRDYWNoZS5nZXQodCkpOiExfXBlZWsodCl7aWYodGhpcy5jYWNoZS5oYXModCkpcmV0dXJuIHRoaXMuX3BlZWsodCx0aGlzLmNhY2hlKTtpZih0aGlzLm9sZENhY2hlLmhhcyh0KSlyZXR1cm4gdGhpcy5fcGVlayh0LHRoaXMub2xkQ2FjaGUpfWRlbGV0ZSh0KXtjb25zdCBlPXRoaXMuY2FjaGUuZGVsZXRlKHQpO3JldHVybiBlJiZ0aGlzLl9zaXplLS0sdGhpcy5vbGRDYWNoZS5kZWxldGUodCl8fGV9Y2xlYXIoKXt0aGlzLmNhY2hlLmNsZWFyKCksdGhpcy5vbGRDYWNoZS5jbGVhcigpLHRoaXMuX3NpemU9MH1yZXNpemUodCl7aWYoISh0JiZ0PjApKXRocm93IG5ldyBUeXBlRXJyb3IoImBtYXhTaXplYCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwIik7Y29uc3QgZT1bLi4udGhpcy5fZW50cmllc0FzY2VuZGluZygpXSxuPWUubGVuZ3RoLXQ7bjwwPyh0aGlzLmNhY2hlPW5ldyBNYXAoZSksdGhpcy5vbGRDYWNoZT1uZXcgTWFwLHRoaXMuX3NpemU9ZS5sZW5ndGgpOihuPjAmJnRoaXMuX2VtaXRFdmljdGlvbnMoZS5zbGljZSgwLG4pKSx0aGlzLm9sZENhY2hlPW5ldyBNYXAoZS5zbGljZShuKSksdGhpcy5jYWNoZT1uZXcgTWFwLHRoaXMuX3NpemU9MCksdGhpcy5tYXhTaXplPXR9KmtleXMoKXtmb3IoY29uc3RbdF1vZiB0aGlzKXlpZWxkIHR9KnZhbHVlcygpe2Zvcihjb25zdFssdF1vZiB0aGlzKXlpZWxkIHR9KltTeW1ib2wuaXRlcmF0b3JdKCl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5jYWNoZSl7Y29uc3RbZSxuXT10O3RoaXMuX2RlbGV0ZUlmRXhwaXJlZChlLG4pPT09ITEmJih5aWVsZFtlLG4udmFsdWVdKX1mb3IoY29uc3QgdCBvZiB0aGlzLm9sZENhY2hlKXtjb25zdFtlLG5dPXQ7dGhpcy5jYWNoZS5oYXMoZSl8fHRoaXMuX2RlbGV0ZUlmRXhwaXJlZChlLG4pPT09ITEmJih5aWVsZFtlLG4udmFsdWVdKX19KmVudHJpZXNEZXNjZW5kaW5nKCl7bGV0IHQ9Wy4uLnRoaXMuY2FjaGVdO2ZvcihsZXQgZT10Lmxlbmd0aC0xO2U+PTA7LS1lKXtjb25zdCBuPXRbZV0sW3Msb109bjt0aGlzLl9kZWxldGVJZkV4cGlyZWQocyxvKT09PSExJiYoeWllbGRbcyxvLnZhbHVlXSl9dD1bLi4udGhpcy5vbGRDYWNoZV07Zm9yKGxldCBlPXQubGVuZ3RoLTE7ZT49MDstLWUpe2NvbnN0IG49dFtlXSxbcyxvXT1uO3RoaXMuY2FjaGUuaGFzKHMpfHx0aGlzLl9kZWxldGVJZkV4cGlyZWQocyxvKT09PSExJiYoeWllbGRbcyxvLnZhbHVlXSl9fSplbnRyaWVzQXNjZW5kaW5nKCl7Zm9yKGNvbnN0W3QsZV1vZiB0aGlzLl9lbnRyaWVzQXNjZW5kaW5nKCkpeWllbGRbdCxlLnZhbHVlXX1nZXQgc2l6ZSgpe2lmKCF0aGlzLl9zaXplKXJldHVybiB0aGlzLm9sZENhY2hlLnNpemU7bGV0IHQ9MDtmb3IoY29uc3QgZSBvZiB0aGlzLm9sZENhY2hlLmtleXMoKSl0aGlzLmNhY2hlLmhhcyhlKXx8dCsrO3JldHVybiBNYXRoLm1pbih0aGlzLl9zaXplK3QsdGhpcy5tYXhTaXplKX1lbnRyaWVzKCl7cmV0dXJuIHRoaXMuZW50cmllc0FzY2VuZGluZygpfWZvckVhY2godCxlPXRoaXMpe2Zvcihjb25zdFtuLHNdb2YgdGhpcy5lbnRyaWVzQXNjZW5kaW5nKCkpdC5jYWxsKGUscyxuLHRoaXMpfWdldFtTeW1ib2wudG9TdHJpbmdUYWddKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KFsuLi50aGlzLmVudHJpZXNBc2NlbmRpbmcoKV0pfX1jbGFzcyBJbWFnZURlc2VyaWFsaXplcntjb25zdHJ1Y3Rvcigpe3RoaXMuX2ltYWdlQ2FjaGU9bmV3IFF1aWNrTFJVKHttYXhTaXplOjFlMyxtYXhBZ2U6MmU0fSl9ZGVzZXJpYWxpemUodCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKCF0KXJldHVybjtjb25zdCBlPXRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHQpO3JldHVybiBlfHxuZXcgUHJvbWlzZShuPT57Y29uc3Qgcz1uZXcgSW1hZ2U7cy5vbmxvYWQ9KCk9PntuKHMpfSxzLnNyYz10LHRoaXMuX2ltYWdlQ2FjaGUuc2V0KHQscyl9KX0pfX1jb25zdCBkZWZhdWx0SW1hZ2VEZXNlcmlhbGl6ZXI9bmV3IEltYWdlRGVzZXJpYWxpemVyO2Z1bmN0aW9uIHNlcmlhbGl6ZTJETWF0cml4KHIpe2lmKHIpcmV0dXJuW3IuYSxyLmIsci5jLHIuZCxyLmUsci5mXX1mdW5jdGlvbiBkZXNlcmlhbGl6ZTJETWF0cml4KHIpe3JldHVybiBuZXcgRE9NTWF0cml4KHIpfWNsYXNzIERlY29kZXJ7Y29uc3RydWN0b3IodCl7dGhpcy5fc3RyaW5nUmVjb3JkZXI9W107Y29uc3R7Y2FudmFzOmV9PXQ7dGhpcy5fc3RyaW5nUmVjb3JkZXI9W10sdGhpcy5fY2FudmFzPWV9ZGVjb2RlKHQpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdHthcGk6ZSxhcmdzOm59PXQscz1DVFhfQVBJX0RFQ09ERVJbZV0sbz1zPT09InNldEF0dHIiP3lpZWxkIHRoaXMuZGVjb2RlQXR0cihuKTp0aGlzLmRlY29kZUFyZ3Mobik7aWYocz09PSJzdHJva2UiJiZvLmxlbmd0aCYmIWlzUHJveHllZChvWzBdKSl0aHJvdyBuZXcgRXJyb3IoImFyZ3VtZW50IHR5cGUgaW52YWxpZCwgUGF0aDJEIGlzIG5vdCBQcm94eVBhdGgyRCIpO3JldHVybnthcGk6cyxhcmdzOm98fFtdfX0pfWRlY29kZUF0dHIodCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5sZW5ndGgtMTspe2NvbnN0IHM9dFtuXSxvPXRbbisxXTtpZihMT05HX1NUUl9BVFRSLmluY2x1ZGVzKENUWF9BVFRSX0RFQ09ERVJbc10pJiZ0eXBlb2Ygbz09InN0cmluZyJ8fHR5cGVvZiBvPT0ibnVtYmVyIilpZih0eXBlb2Ygbz09Im51bWJlciIpe2NvbnN0IGE9dGhpcy5fc3RyaW5nUmVjb3JkZXJbb107ZS5wdXNoKHtrZXk6Q1RYX0FUVFJfREVDT0RFUltzXSx2YWx1ZTphfSl9ZWxzZSBlLnB1c2goe2tleTpDVFhfQVRUUl9ERUNPREVSW3NdLHZhbHVlOm99KSx0aGlzLl9zdHJpbmdSZWNvcmRlci5wdXNoKG8pO2Vsc2Uobz09bnVsbD92b2lkIDA6by50eXBlKT09PSJQcm94eUxpbmVhckdyYWRpZW50Ij9lLnB1c2goe2tleTpDVFhfQVRUUl9ERUNPREVSW3NdLHZhbHVlOmdldExpbmVhckdyYWRpZW50KG8udmFsdWUsdGhpcy5fY2FudmFzKX0pOihvPT1udWxsP3ZvaWQgMDpvLnR5cGUpPT09IlByb3h5UGF0dGVybiI/ZS5wdXNoKHtrZXk6Q1RYX0FUVFJfREVDT0RFUltzXSx2YWx1ZTp5aWVsZCBnZXRDYW52YXNQYXR0ZXJuKG8udmFsdWUsdGhpcy5fY2FudmFzKX0pOmUucHVzaCh7a2V5OkNUWF9BVFRSX0RFQ09ERVJbc10sdmFsdWU6b30pO24rPTJ9cmV0dXJuIGV9KX1kZWNvZGVBcmdzKHQpe3JldHVybiB0IT1udWxsJiZ0Lm1hcD90Lm1hcChlPT5pc1Byb3h5UGF0aDJEKGUpP25ldyBHTE9CQUxfT0JKLlBhdGgyRChlLnZhbHVlKTplKTp0fX1mdW5jdGlvbiBpc1Byb3h5UGF0aDJEKHIpe3JldHVybihyPT1udWxsP3ZvaWQgMDpyLnR5cGUpPT09IlBhdGgyRCJ9ZnVuY3Rpb24gZ2V0TGluZWFyR3JhZGllbnQocix0KXtjb25zdCBlPXQuZ2V0Q29udGV4dCgiMmQiKTtpZighZSlyZXR1cm4gbnVsbDtjb25zdCBuPXJbMF0scz1lLmNyZWF0ZUxpbmVhckdyYWRpZW50KG5bMF0sblsxXSxuWzJdLG5bM10pO2ZvcihsZXQgbz0xO288ci5sZW5ndGg7bysrKXtjb25zdCBhPXJbb107cy5hZGRDb2xvclN0b3AoYVswXSxhWzFdKX1yZXR1cm4gc31mdW5jdGlvbiBnZXRDYW52YXNQYXR0ZXJuKHIsdCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3ZhciBlLG47Y29uc3Qgcz10LmdldENvbnRleHQoIjJkIik7aWYoIXMpcmV0dXJuIG51bGw7Y29uc3Qgbz0oZT1yWzBdKSE9PW51bGwmJmUhPT12b2lkIDA/ZTpbXSxhPXlpZWxkIGRlZmF1bHRJbWFnZURlc2VyaWFsaXplci5kZXNlcmlhbGl6ZSgobj1vWzBdKT09PW51bGx8fG49PT12b2lkIDA/dm9pZCAwOm4uc3JjKTtpZighYSlyZXR1cm47Y29uc3QgYz1zLmNyZWF0ZVBhdHRlcm4oYSxvWzFdKTtpZihjKWZvcihsZXQgbD0xO2w8ci5sZW5ndGg7bCsrKXtjb25zdCB1PXJbbF07dSYmYy5zZXRUcmFuc2Zvcm0oZGVzZXJpYWxpemUyRE1hdHJpeCh1KSl9cmV0dXJuIGN9KX1jbGFzcyBDYW52YXNQbGF5ZXJ7Y29uc3RydWN0b3IodCl7dGhpcy5fcHJldkFwaT0tMSx0aGlzLl9pbnN0cnVjdGlvbnNRdWV1ZT1bXSx0aGlzLl9leGVjdXRlUHJvbWlzZT1udWxsO2NvbnN0e2NhbnZhczplfT10O3RoaXMuX2NhbnZhcz1lLHRoaXMuX2RlY29kZXI9bmV3IERlY29kZXIoe2NhbnZhczplfSl9Z2V0IGNhbnZhcygpe3JldHVybiB0aGlzLl9jYW52YXN9ZXhlY3V0ZSh0KXt0IT1udWxsJiZ0Lmxlbmd0aCYmKHRoaXMuX2luc3RydWN0aW9uc1F1ZXVlLmxlbmd0aD90aGlzLl9pbnN0cnVjdGlvbnNRdWV1ZS5wdXNoKC4uLnQpOih0aGlzLl9pbnN0cnVjdGlvbnNRdWV1ZS5wdXNoKC4uLnQpLHRoaXMuX2V4ZWN1dGUoKSkpfV9leGVjdXRlKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2Zvcig7dGhpcy5faW5zdHJ1Y3Rpb25zUXVldWUubGVuZ3RoOyl7Y29uc3QgdD10aGlzLl9pbnN0cnVjdGlvbnNRdWV1ZS5zaGlmdCgpO2lmKGlzQVBJKHQpKXtjb25zdCBuPXQ7aWYodGhpcy5faW5zdHJ1Y3Rpb25zUXVldWUubGVuZ3RoPjAmJmlzQXJnKHRoaXMuX2luc3RydWN0aW9uc1F1ZXVlWzBdKSl7Y29uc3Qgbz10aGlzLl9pbnN0cnVjdGlvbnNRdWV1ZS5zaGlmdCgpO3lpZWxkIHRoaXMuZXhlY3V0ZU9uZSh7YXBpOm4sYXJnczpvfSksdGhpcy5fZXhlY3V0ZVByb21pc2U9bnVsbH1lbHNlIHlpZWxkIHRoaXMuZXhlY3V0ZU9uZSh7YXBpOm4sYXJnczpbXX0pLHRoaXMuX2V4ZWN1dGVQcm9taXNlPW51bGw7dGhpcy5fcHJldkFwaT1ufWVsc2UgaXNBcmcodCk/KHlpZWxkIHRoaXMuZXhlY3V0ZU9uZSh7YXBpOnRoaXMuX3ByZXZBcGksYXJnczp0fSksdGhpcy5fZXhlY3V0ZVByb21pc2U9bnVsbCk6Y29uc29sZS5sb2coInN0aCBlcnJvciIpfX0pfWV4ZWN1dGVPbmUodCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9leGVjdXRlUHJvbWlzZT1uZXcgUHJvbWlzZSgoZSxuKT0+Yih0aGlzLG51bGwsZnVuY3Rpb24qKCl7dmFyIHMsbyxhO2NvbnN0IGM9KG89KHM9dGhpcy5fY2FudmFzKT09PW51bGx8fHM9PT12b2lkIDA/dm9pZCAwOnMuZ2V0Q29udGV4dCk9PT1udWxsfHxvPT09dm9pZCAwP3ZvaWQgMDpvLmNhbGwocywiMmQiKTtpZighdGhpcy5fZGVjb2Rlcnx8IXRoaXMuX2NhbnZhc3x8IWMpe24oLTEpO3JldHVybn10cnl7Y29uc3R7YXBpOmwsYXJnczp1fT15aWVsZCB0aGlzLl9kZWNvZGVyLmRlY29kZSh0KTtpZighKGwhPW51bGwmJmwubGVuZ3RoKSljb25zb2xlLmxvZygiaW52YWxpZCBhcGkiKSxlKC0xKTtlbHNlIGlmKGw9PT0ic2V0QXR0ciIpe2ZvcihsZXQgaD0wO2g8dS5sZW5ndGg7aCsrKXtjb25zdHtrZXk6cCx2YWx1ZTptfT11W2hdO2NbcF09bX1lKDEpfWVsc2UgaWYobD09PSJzbmFwc2hvdCIpZGVmYXVsdEltYWdlRGVzZXJpYWxpemVyLmRlc2VyaWFsaXplKHUpLnRoZW4oaD0+e2MuZHJhd0ltYWdlKGgsMCwwKSxlKDEpfSk7ZWxzZSBpZihsPT09ImxpbmVUbyIpe2xldCBoPTA7Zm9yKDtoPHUubGVuZ3RoLTE7KXtjb25zdCBwPXVbaF0sbT11W2grMV07Y1tsXS5hcHBseShjLFtwLG1dKSxoKz0yfWUoMSl9ZWxzZSBsPT09ImRyYXdJbWFnZSImJkFycmF5LmlzQXJyYXkodSkmJighKChhPXVbMF0pPT09bnVsbHx8YT09PXZvaWQgMCkmJmEuc3JjKT9kZWZhdWx0SW1hZ2VEZXNlcmlhbGl6ZXIuZGVzZXJpYWxpemUodVswXS5zcmMpLnRoZW4oaD0+e3VbMF0uX19kcmF3RnVsbFBhZ2UmJmMuY2xlYXJSZWN0KDAsMCx0aGlzLl9jYW52YXMud2lkdGgsdGhpcy5fY2FudmFzLmhlaWdodCksYy5kcmF3SW1hZ2UoaCwuLi51LnNsaWNlKDEpKSxlKDEpfSk6KGNbbF0uYXBwbHkoYyxbLi4udV0pLGUoMSkpfWNhdGNoKGwpe2xvY2FsU3RvcmFnZSYmbG9jYWxTdG9yYWdlLmJ5dGVyZXBsYXlfZGVidWcmJmNvbnNvbGUuZXJyb3IoIltieXRlcmVwbGF5XSBFeGVjdXRlIGNhbnZhcyBjb21tYW5kIGVycm9yIixsLHtpbnN0cnVjdGlvbjp0fSksZSgtMSl9fSkpLHRoaXMuX2V4ZWN1dGVQcm9taXNlfSl9c25hcHNob3QoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7aWYodGhpcy5jYW52YXMgaW5zdGFuY2VvZiBPZmZzY3JlZW5DYW52YXMpe2NvbnN0IHQ9eWllbGQgdGhpcy5jYW52YXMuY29udmVydFRvQmxvYih7dHlwZToiaW1hZ2UvcG5nIixxdWFsaXR5OjF9KTtyZXR1cm4geWllbGQgbmV3IFByb21pc2Uobj0+e2NvbnN0IHM9bmV3IEZpbGVSZWFkZXI7cy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwoKT0+bihzLnJlc3VsdCkpLHMucmVhZEFzRGF0YVVSTCh0KX0pfWVsc2UgcmV0dXJuIHRoaXMuY2FudmFzLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIiwxKX0pfWRlY29kZSh0KXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Y29uc3QgZT1bXTtpZighKHQhPW51bGwmJnQubGVuZ3RoKXx8IXRoaXMuX2RlY29kZXIpcmV0dXJuIGU7Y29uc3Qgbj1bLi4udF07Zm9yKDtuLmxlbmd0aDspe2NvbnN0IHM9bi5zaGlmdCgpO2lmKGlzQVBJKHMpKXtjb25zdCBhPXM7aWYobi5sZW5ndGg+MCYmaXNBcmcoblswXSkpe2NvbnN0IGw9bi5zaGlmdCgpO2UucHVzaCh5aWVsZCB0aGlzLl9kZWNvZGVyLmRlY29kZSh7YXBpOmEsYXJnczpsfSkpfWVsc2UgZS5wdXNoKHlpZWxkIHRoaXMuX2RlY29kZXIuZGVjb2RlKHthcGk6YSxhcmdzOltdfSkpO3RoaXMuX3ByZXZBcGk9YX1lbHNlIGlzQXJnKHMpP2UucHVzaCh5aWVsZCB0aGlzLl9kZWNvZGVyLmRlY29kZSh7YXBpOnRoaXMuX3ByZXZBcGksYXJnczpzfSkpOmNvbnNvbGUubG9nKCJzdGggZXJyb3IiKX1yZXR1cm4gZX0pfX1mdW5jdGlvbiBpc0FQSShyKXtyZXR1cm4gdHlwZW9mIHI9PSJzdHJpbmcifHx0eXBlb2Ygcj09InVuZGVmaW5lZCI/ITE6Q1RYX0FQSV9ERUNPREVSW3JdPT09InNldEF0dHIifHxDVFhfQVBJX0RFQ09ERVJbcl09PT0ic25hcHNob3QifHxDVFhfQVBJLmluY2x1ZGVzKENUWF9BUElfREVDT0RFUltyXSl9ZnVuY3Rpb24gaXNBcmcocil7cmV0dXJuISEodHlwZW9mIHI9PSJvYmplY3QifHx0eXBlb2Ygcj09InN0cmluZyImJnIuc3RhcnRzV2l0aCgiZGF0YToiKSl9Y2xhc3MgSW1hZ2VTZXJpYWxpemVye2NvbnN0cnVjdG9yKCl7dGhpcy5fc2VyaWFsaXplQ2FjaGU9bmV3IFdlYWtNYXAsdGhpcy5fY2FudmFzPW51bGx9c2VyaWFsaXplKHQpe2lmKHQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudClyZXR1cm57dHlwZTp0LmNvbnN0cnVjdG9yLm5hbWUsc3JjOnQudG9EYXRhVVJMKCl9O2lmKHQgaW5zdGFuY2VvZiBPZmZzY3JlZW5DYW52YXMpe2NvbnN0IGU9dC50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKSxuPXRoaXMuX3NlcmlhbGl6ZUNhY2hlLmdldChlKTtpZihuKXJldHVybiBuO2NvbnN0IHM9dC50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKSxvPXt0eXBlOnQuY29uc3RydWN0b3IubmFtZSxzcmM6dGhpcy5fY29udmVydEltYWdlQml0bWFwSW50b0Jhc2U2NChzKX07cmV0dXJuIHRoaXMuX3NlcmlhbGl6ZUNhY2hlLnNldChzLG8pLG99aWYoR0xPQkFMX09CSi5WaWRlb0ZyYW1lJiZ0IGluc3RhbmNlb2YgVmlkZW9GcmFtZSl7Y29uc3QgZT17dHlwZTp0LmNvbnN0cnVjdG9yLm5hbWUsc3JjOnRoaXMuX2NvbnZlcnRWaWRlb0ZyYW1lSW50b0Jhc2U2NCh0KX07cmV0dXJuIHRoaXMuX3NlcmlhbGl6ZUNhY2hlLnNldCh0LGUpLGV9ZWxzZSBpZih0IGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudHx8dCBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnR8fHQgaW5zdGFuY2VvZiBJbWFnZSl7Y29uc3QgZT17dHlwZTp0LmNvbnN0cnVjdG9yLm5hbWUsc3JjOnQuc3JjfTtyZXR1cm4gdGhpcy5fc2VyaWFsaXplQ2FjaGUuc2V0KHQsZSksZX1lbHNlIGlmKHQgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCl7Y29uc3QgZT17dHlwZTp0LmNvbnN0cnVjdG9yLm5hbWUsc3JjOnRoaXMuX2NvbnZlcnRJbWFnZUJpdG1hcEludG9CYXNlNjQodCl9O3JldHVybiB0aGlzLl9zZXJpYWxpemVDYWNoZS5zZXQodCxlKSxlfWVsc2UgaWYodCBpbnN0YW5jZW9mIFNWR0ltYWdlRWxlbWVudCl7Y29uc3QgZT17dHlwZTp0LmNvbnN0cnVjdG9yLm5hbWUsc3JjOnQuaHJlZi5iYXNlVmFsfTtyZXR1cm4gdGhpcy5fc2VyaWFsaXplQ2FjaGUuc2V0KHQsZSksZX19aXNDYW52YXNJbWFnZVNvdXJjZSh0KXtyZXR1cm4gdCBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnR8fHQgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50fHx0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnR8fHQgaW5zdGFuY2VvZiBJbWFnZXx8dCBpbnN0YW5jZW9mIEltYWdlQml0bWFwfHx0IGluc3RhbmNlb2YgT2Zmc2NyZWVuQ2FudmFzfHx0IGluc3RhbmNlb2YgU1ZHSW1hZ2VFbGVtZW50fHxHTE9CQUxfT0JKLlZpZGVvRnJhbWUmJnQgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lfV9jb252ZXJ0SW1hZ2VCaXRtYXBJbnRvQmFzZTY0KHQpe2NvbnN0IGU9dGhpcy5jYW52YXM7cmV0dXJuIGUud2lkdGg9dC53aWR0aCxlLmhlaWdodD10LmhlaWdodCxlLmdldENvbnRleHQoIjJkIikuZHJhd0ltYWdlKHQsMCwwKSxlLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIiwxKX1fY29udmVydFZpZGVvRnJhbWVJbnRvQmFzZTY0KHQpe2NvbnN0IGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7cmV0dXJuIGUud2lkdGg9dC5kaXNwbGF5V2lkdGgsZS5oZWlnaHQ9dC5kaXNwbGF5SGVpZ2h0LGUuZ2V0Q29udGV4dCgiMmQiKS5kcmF3SW1hZ2UodCwwLDApLGUudG9EYXRhVVJMKCJpbWFnZS9wbmciLDEpfWdldCBjYW52YXMoKXtyZXR1cm4gdGhpcy5fY2FudmFzfHwodGhpcy5fY2FudmFzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpKSx0aGlzLl9jYW52YXN9fWNvbnN0IGRlZmF1bHRJbWFnZVNlcmlhbGl6ZXI9bmV3IEltYWdlU2VyaWFsaXplcjtmdW5jdGlvbiBvbmNlKHIpe2xldCB0PSExLGU7cmV0dXJuIGZ1bmN0aW9uKC4uLm4pe3JldHVybiB0fHwodD0hMCxlPXIuYXBwbHkodGhpcyxuKSksZX19Y29uc3QgYm9vdHN0cmFwPW9uY2UoKCk9PntpZihHTE9CQUxfT0JKLkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCl7Y29uc3Qgcj1DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQucHJvdG90eXBlLmNyZWF0ZUxpbmVhckdyYWRpZW50O0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuY3JlYXRlTGluZWFyR3JhZGllbnQ9ZnVuY3Rpb24oLi4uZSl7Y29uc3Qgbj1yLmFwcGx5KHRoaXMsZSkscz1uLmFkZENvbG9yU3RvcDtyZXR1cm4gbi5fdmFsdWVzPVtlXSxuLl90eXBlPSJQcm94eUxpbmVhckdyYWRpZW50IixuLmFkZENvbG9yU3RvcD0oLi4ubyk9PntzLmFwcGx5KG4sbyksbi5fdmFsdWVzLnB1c2gobyl9LG59O2NvbnN0IHQ9Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJELnByb3RvdHlwZS5jcmVhdGVQYXR0ZXJuO2lmKENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuY3JlYXRlUGF0dGVybj1mdW5jdGlvbiguLi5lKXtjb25zdCBuPXQuYXBwbHkodGhpcyxlKTtpZighbilyZXR1cm4gbnVsbDtjb25zdCBzPW4uc2V0VHJhbnNmb3JtO3JldHVybiBuLl90eXBlPSJQcm94eVBhdHRlcm4iLG4uX3ZhbHVlcz1bW2RlZmF1bHRJbWFnZVNlcmlhbGl6ZXIuc2VyaWFsaXplKGVbMF0pLGVbMV1dXSxuLnNldFRyYW5zZm9ybT1vPT57cy5hcHBseShuLFtvXSksbyYmKG4uX3ZhbHVlc1sxXT1zZXJpYWxpemUyRE1hdHJpeChvKSl9LG59LEdMT0JBTF9PQkouUGF0aDJEJiYhaXNQcm94eWVkKEdMT0JBTF9PQkouUGF0aDJEKSl7Y29uc3QgZT1wcm94eVBhdGgyRCgpO2UmJihHTE9CQUxfT0JKLlBhdGgyRD1lKX19fSk7Y2xhc3MgSW1hZ2VCaXRtYXBDb252ZXJ0ZXJ7Y29uc3RydWN0b3IoKXt0aGlzLl9vZmZzY3JlZW5NYXA9bmV3IFF1aWNrTFJVKHttYXhTaXplOjFlMyxtYXhBZ2U6MWUzKjYwKjR9KSx0aGlzLmNsZWFyPSgpPT57dGhpcy5fb2Zmc2NyZWVuTWFwLmNsZWFyKCl9fXRvQmFzZTY0KHQsZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2NvbnN0IG49YCR7dC53aWR0aH14JHt0LmhlaWdodH1gO2xldCBzPXRoaXMuX29mZnNjcmVlbk1hcC5nZXQobik7c3x8KHM9bmV3IE9mZnNjcmVlbkNhbnZhcyh0LndpZHRoLHQuaGVpZ2h0KSx0aGlzLl9vZmZzY3JlZW5NYXAuc2V0KG4scykpO2NvbnN0IG89cy5nZXRDb250ZXh0KCJiaXRtYXByZW5kZXJlciIpO289PW51bGx8fG8udHJhbnNmZXJGcm9tSW1hZ2VCaXRtYXAodCk7Y29uc3QgYT15aWVsZCBzLmNvbnZlcnRUb0Jsb2IoZSk7cmV0dXJuIG5ldyBQcm9taXNlKChjLGwpPT57Y29uc3QgdT1uZXcgRmlsZVJlYWRlcjt1Lm9ubG9hZD0oKT0+e2ModS5yZXN1bHQpfSx1Lm9uZXJyb3I9aD0+e2woaCl9LHUucmVhZEFzRGF0YVVSTChhKX0pfSl9fW5ldyBJbWFnZUJpdG1hcENvbnZlcnRlcixib290c3RyYXAoKTtjbGFzcyBTbmFwc2hvdEVycm9yIGV4dGVuZHMgUnVudGltZUVycm9ye2NvbnN0cnVjdG9yKHQsZSl7c3VwZXIodCxlKSx0aGlzLm5hbWU9IlNuYXBzaG90RXJyb3IifX1jbGFzcyBSZW5kZXJpbmdFcnJvciBleHRlbmRzIFNuYXBzaG90RXJyb3J7Y29uc3RydWN0b3IodCxlKXtzdXBlcih0LGUpLHRoaXMubmFtZT0iUmVuZGVyaW5nRXJyb3IifX1jbGFzcyBEZWZlcnJlZFRhc2tRdWV1ZXtjb25zdHJ1Y3Rvcigpe2YodGhpcywiX3Rhc2tzIixbXSl9ZW5xdWV1ZSh0KXt0aGlzLl90YXNrcy5wdXNoKHQpfWV4ZWN1dGVBbGwoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5fdGFza3MpeWllbGQgdCgpO3RoaXMuY2xlYXIoKX0pfWNsZWFyKCl7dGhpcy5fdGFza3Muc3BsaWNlKDAsdGhpcy5fdGFza3MubGVuZ3RoKX1zaXplKCl7cmV0dXJuIHRoaXMuX3Rhc2tzLmxlbmd0aH19Y2xhc3MgSWQyTm9kZU1hcCBleHRlbmRzIEV2ZW50RW1pdHRlcntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyk7Zih0aGlzLCJfbWFwIixuZXcgTWFwKX1yZXNldCgpe3RoaXMuX21hcC5jbGVhcigpLHRoaXMuZW1pdCgibm9kZVJlc2V0Iil9aGFzKGUpe3JldHVybiB0aGlzLl9tYXAuaGFzKGUpfWdldE5vZGUoZSl7cmV0dXJuIHRoaXMuX21hcC5nZXQoZSl9YWRkTm9kZShlLG4pe3RoaXMuX21hcC5zZXQoZSxuKSxuJiZ0aGlzLmVtaXQoIm5vZGVBZGRlZCIsbixlKX1rZXlzKCl7cmV0dXJuIHRoaXMuX21hcC5rZXlzKCl9c2l6ZSgpe3JldHVybiB0aGlzLl9tYXAuc2l6ZX1yZW1vdmVOb2RlKGUpe2NvbnN0IG49dGhpcy5fbWFwLmdldChlKTt0aGlzLl9tYXAuZGVsZXRlKGUpLG4mJnRoaXMuZW1pdCgibm9kZVJlbW92ZWQiLG4sZSl9fWNsYXNzIFByb21pc2VMaXN0e2NvbnN0cnVjdG9yKCl7Zih0aGlzLCJfcHJvbWlzZXMiLFtdKX1hZGQodCl7dGhpcy5fcHJvbWlzZXMucHVzaCh0KX1hbGwoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7eWllbGQgUHJvbWlzZS5hbGwodGhpcy5fcHJvbWlzZXMpLHRoaXMuY2xlYXIoKX0pfWNsZWFyKCl7dGhpcy5fcHJvbWlzZXMuc3BsaWNlKDAsdGhpcy5fcHJvbWlzZXMubGVuZ3RoKX1zaXplKCl7cmV0dXJuIHRoaXMuX3Byb21pc2VzLmxlbmd0aH19Y29uc3QgU1RZTEVfU0hFRVRfSU5URVJDRVBUT1JfRkxBRz1TeW1ib2wuZm9yKCJieXRlcmVwbGF5LlN0eWxlU2hlZXRJbnRlcmNlcHRvciIpLFJ1bGVTaGVldE1ldGhvZEVuY29kZXM9e2luc2VydFJ1bGU6MCxkZWxldGVSdWxlOjEscmVwbGFjZToyLHJlcGxhY2VTeW5jOjMsYWRkUnVsZTo0LHJlbW92ZVJ1bGU6NX0sUnVsZVNoZWV0TWV0aG9kRGVjb2Rlcz17MDoiaW5zZXJ0UnVsZSIsMToiZGVsZXRlUnVsZSIsMjoicmVwbGFjZSIsMzoicmVwbGFjZVN5bmMiLDQ6ImFkZFJ1bGUiLDU6InJlbW92ZVJ1bGUifSxQPWNsYXNzIFB7Y29uc3RydWN0b3IodCxlKXtmKHRoaXMsImhvc3QiKTtmKHRoaXMsImNhbGxiYWNrIik7Zih0aGlzLCJfY29udGV4dCIpO3RoaXMuaG9zdD10LHRoaXMuY2FsbGJhY2s9ZX1vYnNlcnZlKHQsZSl7aWYodGhpcy5fY29udGV4dHx8KHRoaXMuX2NvbnRleHQ9dCksZVtTVFlMRV9TSEVFVF9JTlRFUkNFUFRPUl9GTEFHXSE9PXZvaWQgMClyZXR1cm47Y29uc3Qgbj10aGlzLl9uZXh0U2hlZXRJZCgpLHM9T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpLG89T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMocyk7T2JqZWN0LmtleXMobykuZm9yRWFjaChhPT57Y29uc3QgYz1SZWZsZWN0LmdldChlLGEpO3R5cGVvZiBjIT0iZnVuY3Rpb24ifHxjLm5hbWU9PT0iQ1NTU3R5bGVTaGVldCJ8fE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGEse3ZhbHVlOiguLi5sKT0+e2NvbnN0IHU9b1thXS52YWx1ZTtpZih0eXBlb2YgdT09ImZ1bmN0aW9uIil7Y29uc3QgaD1SdWxlU2hlZXRNZXRob2RFbmNvZGVzW2FdO2lmKGghPT12b2lkIDAmJnRoaXMuX2NvbnRleHQpe2NvbnN0IHA9dGhpcy5fY29udGV4dC5ub2Rlcy5nZXROb2RlSWQodGhpcy5ob3N0LCExKTtwJiZ0aGlzLmNhbGxiYWNrKHtldmVudFR5cGU6VHJhY2tlckV2ZW50VHlwZS5IVE1MTXV0YXRpb25zLGRhdGE6W3t0eXBlOlZNdXRhdGlvblR5cGUuU3R5bGVTaGVldFJ1bGUsdGFyZ2V0OnAsZGF0YTpbaCxsXSxzaGVldElkOm59XX0pfX1yZXR1cm4gUmVmbGVjdC5hcHBseSh1LGUsbCl9fSl9KSxlW1NUWUxFX1NIRUVUX0lOVEVSQ0VQVE9SX0ZMQUddPW59Y2FwdHVyZVJ1bGVzKHQpe2NvbnN0IGU9dC5jc3NSdWxlcyxuPVtdO2lmKGUpZm9yKGxldCBzPTA7czxlLmxlbmd0aDtzKyspbi5wdXNoKFtSdWxlU2hlZXRNZXRob2RFbmNvZGVzLmluc2VydFJ1bGUsW2Vbc10uY3NzVGV4dCxzXV0pO3JldHVybiBufXN0YXRpYyBnZXRTaGVldElkKHQpe3JldHVybiB0W1NUWUxFX1NIRUVUX0lOVEVSQ0VQVE9SX0ZMQUddfXN0YXRpYyBzZXRTaGVldElkKHQsZSl7dFtTVFlMRV9TSEVFVF9JTlRFUkNFUFRPUl9GTEFHXT1lfV9uZXh0U2hlZXRJZCgpe3JldHVybisrUC5fc2hlZXRJZH1kaXNjb25uZWN0KHQpe3RoaXMuX2NvbnRleHQ9dm9pZCAwfWRpc2Nvbm5lY3RBbGwoKXt0aGlzLl9jb250ZXh0PXZvaWQgMH19O2YoUCwiX3NoZWV0SWQiLDApO2xldCBTdHlsZVNoZWV0T2JzZXJ2ZXI9UDt2YXIgUmVuZGVyTW9kZTsoZnVuY3Rpb24ocil7ci5WYW5pbGxhRE9NPSJWYW5pbGxhRE9NIixyLlZpcnR1YWxET009IlZpcnR1YWxET00ifSkoUmVuZGVyTW9kZXx8KFJlbmRlck1vZGU9e30pKTtjb25zdCBrPWNsYXNzIGt7Y29uc3RydWN0b3IoKXtmKHRoaXMsInRhZyIsIkNBTlZBUyIpfXN0YXRpYyByZWdpc3RlclBsYXllcih0LGUsbixzKXtjb25zdCBvPXtwbGF5ZXI6bmV3IENhbnZhc1BsYXllcih7Y2FudmFzOm59KSxvcmRlcjpzfSxhPWsucGxheWVycy5nZXQoYCR7dH0vJHtlfWApO2E/YS5vcmRlcjxvLm9yZGVyJiZrLnBsYXllcnMuc2V0KGAke3R9LyR7ZX1gLG8pOmsucGxheWVycy5zZXQoYCR7dH0vJHtlfWAsbyl9c3RhdGljIHJlc29sdmVQbGF5ZXIodCxlLG4pe2NvbnN0IHM9ay5wbGF5ZXJzLmdldChgJHt0fS8ke2V9YCk7aWYocyYmcy5vcmRlcjw9bilyZXR1cm4gcy5wbGF5ZXJ9c3RhdGljIHJlbW92ZVBsYXllcih0LGUpe2sucGxheWVycy5kZWxldGUoYCR7dH0vJHtlfWApfXN0YXRpYyByZXNldFBsYXllcih0KXtjb25zdCBlPWsucGxheWVycy5rZXlzKCk7QXJyYXkuZnJvbShlKS5mb3JFYWNoKG49PntuLnN0YXJ0c1dpdGgodCkmJmsucGxheWVycy5kZWxldGUobil9KX1vblJlbmRlcih0LGUpe3ZhciBvLGEsYztjb25zdCBuPShvPWUuZXh0cmEpPT1udWxsP3ZvaWQgMDpvLmltYWdlO2lmKCFuKXJldHVybjtjb25zdCBzPXRoaXMuZ2V0UGVyZm9ybU9yZGVyKHQpO2lmKHQuaXNWYW5pbGxhKCkpe2NvbnN0IGw9dC5nZXROb2RlKGUuaWQpLHU9bC5nZXRDb250ZXh0KCIyZCIpO3QuYWRkV2FpdGluZyhuZXcgUHJvbWlzZShoPT57Y29uc3QgcD1uZXcgSW1hZ2U7cC5vbmxvYWQ9KCk9Pnt1PT1udWxsfHx1LmRyYXdJbWFnZShwLDAsMCksaCh7ZWxlbWVudDpsLGZhaWxlZDohMSx0aW1lb3V0OiExfSl9LHAub25lcnJvcj0oKT0+e2goe2VsZW1lbnQ6bCxmYWlsZWQ6ITAsdGltZW91dDohMX0pfSxwLnNyYz1ufSkpLGsucmVnaXN0ZXJQbGF5ZXIodC5zbmFwc2hvdElkLGUuaWQsbCxzKX1lbHNle2NvbnN0IGw9bmV3IE9mZnNjcmVlbkNhbnZhcyhwYXJzZUZsb2F0KCgoYT1lLmF0dHJzKT09bnVsbD92b2lkIDA6YS53aWR0aCl8fCIzMDAiKXx8MzAwLHBhcnNlRmxvYXQoKChjPWUuYXR0cnMpPT1udWxsP3ZvaWQgMDpjLmhlaWdodCl8fCIxNTAiKXx8MTUwKTtrLnJlZ2lzdGVyUGxheWVyKHQuc25hcHNob3RJZCxlLmlkLGwscyl9fW9uUmVtb3ZlKHQsZSl7ay5yZW1vdmVQbGF5ZXIodC5zbmFwc2hvdElkLGUpfXBlcmZvcm1FdmVudCh0LGUpe2lmKGUuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5IVE1MQ2FudmFzKXtjb25zdHt0YXJnZXQ6bixkYXRhOnN9PWUuZGF0YSxvPXRoaXMuZ2V0UGVyZm9ybU9yZGVyKHQpLGE9ay5yZXNvbHZlUGxheWVyKHQuc25hcHNob3RJZCxuLG8pO2EmJmEuZXhlY3V0ZShzKX19b25SZXNldCh0KXtrLnJlc2V0UGxheWVyKHQuc25hcHNob3RJZCl9b25DYXB0dXJlKHQsZSl7aWYodC5pc1ZpcnR1YWwoKSl7Y29uc3Qgbj10LmdldE5vZGUoZSk7aWYobiYmbi50YWc9PT10aGlzLnRhZyl7Y29uc3Qgcz10aGlzLmdldFBlcmZvcm1PcmRlcih0KSxvPWsucmVzb2x2ZVBsYXllcih0LnNuYXBzaG90SWQsZSxzKTtvJiZ0LmFkZFdhaXRpbmcobmV3IFByb21pc2UoKGEsYyk9PntvLnNuYXBzaG90KCkudGhlbihsPT57bi5leHRyYT17aW1hZ2U6bH0sYSh7ZWxlbWVudDp2b2lkIDAsZmFpbGVkOiExLHRpbWVvdXQ6ITF9KX0pLmNhdGNoKCgpPT57Yyh7ZWxlbWVudDp2b2lkIDAsZmFpbGVkOiEwLHRpbWVvdXQ6ITF9KX0pfSkpfX19Z2V0UGVyZm9ybU9yZGVyKHQpe3JldHVybiB0Lm1vZGU9PT1SZW5kZXJNb2RlLlZhbmlsbGFET00/Mjp0LmlzSW5jcmVtZW50YWw/MDoxfX07ZihrLCJwbGF5ZXJzIixuZXcgTWFwKTtsZXQgQ2FudmFzRWxlbWVudFJlbmRlcmVyPWs7Y2xhc3MgSUZyYW1lRWxlbWVudFJlbmRlcmVye2NvbnN0cnVjdG9yKCl7Zih0aGlzLCJ0YWciLCJJRlJBTUUiKX1vblJlbmRlcih0LGUpe31vblJlbW92ZSh0LGUpe31wZXJmb3JtRXZlbnQodCxlKXtpZihlLmV2ZW50VHlwZT09PVRyYWNrZXJFdmVudFR5cGUuSFRNTElGcmFtZSlpZih0LmlzVmFuaWxsYSgpKXtjb25zdCBuPXQuZ2V0Tm9kZShlLmRhdGEudGFyZ2V0KTtuJiZuLmRpc3BhdGNoRXZlbnQoYnVpbGRJRnJhbWVFdmVudChlLmRhdGEuYWN0aW9uKSl9ZWxzZXtjb25zdHt0YXJnZXQ6bixhY3Rpb246c309ZS5kYXRhLG89dC5nZXROb2RlKG4pO2lmKCFvKXRocm93IG5ldyBSZW5kZXJpbmdFcnJvcihgTm9kZSB3aXRoIElEICcke259JyBub3QgZm91bmQuYCk7Y29uc3QgYT1vLmV4dHJhfHx7c3RhdGU6SUZyYW1lU3RhdGUuTG9hZGVkfTtzd2l0Y2gocy50eXBlKXtjYXNlIElGcmFtZUFjdGlvblR5cGUuTG9hZDphLnN0YXRlPUlGcmFtZVN0YXRlLkxvYWRlZCxhLnJlY29yZGluZ3M9dm9pZCAwO2JyZWFrO2Nhc2UgSUZyYW1lQWN0aW9uVHlwZS5VbmxvYWQ6YS5zdGF0ZT1JRnJhbWVTdGF0ZS5Mb2FkaW5nLGEucmVjb3JkaW5ncz12b2lkIDA7YnJlYWs7Y2FzZSBJRnJhbWVBY3Rpb25UeXBlLlN0YXJ0UmVjb3JkaW5nOmEuc3RhdGU9SUZyYW1lU3RhdGUuUmVjb3JkaW5nLGEucmVjb3JkaW5ncz1RKE4oe30sYS5yZWNvcmRpbmdzKSx7W3MuZGF0YS5wYXJlbnRJZF06cy5kYXRhLnJlY29yZGluZ30pO2JyZWFrO2Nhc2UgSUZyYW1lQWN0aW9uVHlwZS5TdG9wUmVjb3JkaW5nOmEuc3RhdGU9SUZyYW1lU3RhdGUuTG9hZGVkLGEucmVjb3JkaW5ncyYmZGVsZXRlIGEucmVjb3JkaW5nc1tzLmRhdGEucGFyZW50SWRdO2JyZWFrfW8uZXh0cmE9YX19fWNsYXNzIEltYWdlRWxlbWVudFJlbmRlcmVye2NvbnN0cnVjdG9yKHQpe2YodGhpcywib3B0aW9ucyIpO3RoaXMub3B0aW9ucz10fWdldCB0YWcoKXtyZXR1cm4iSU1BR0UifW9uUmVuZGVyKHQsZSxuKXt2YXIgcyxvO2lmKHQuaXNWYW5pbGxhKCkpe2NvbnN0IGE9bixjPWUuZXh0cmE7KHM9dGhpcy5vcHRpb25zKSE9bnVsbCYmcy5vbkVycm9yJiYoYz09bnVsbD92b2lkIDA6Yy5zdGF0dXMpPT09ImZhaWxlZCImJnRoaXMub3B0aW9ucy5vbkVycm9yKGEpLChvPXRoaXMub3B0aW9ucykhPW51bGwmJm8ub25Mb2FkJiYoYz09bnVsbD92b2lkIDA6Yy5zdGF0dXMpPT09ImxvYWRlZCImJnRoaXMub3B0aW9ucy5vbkxvYWQoYSl9fW9uUmVtb3ZlKHQsZSl7fXBlcmZvcm1FdmVudCh0LGUpe3ZhciBvLGE7aWYoZS5ldmVudFR5cGUhPT1UcmFja2VyRXZlbnRUeXBlLkhUTUxJbWFnZSlyZXR1cm47Y29uc3R7dGFyZ2V0Om4sZGF0YTpzfT1lLmRhdGE7aWYodC5pc1ZhbmlsbGEoKSl7Y29uc3QgYz10LmdldE5vZGUobik7KG89dGhpcy5vcHRpb25zKSE9bnVsbCYmby5vbkVycm9yJiYocz09bnVsbD92b2lkIDA6cy5zdGF0dXMpPT09ImZhaWxlZCImJnRoaXMub3B0aW9ucy5vbkVycm9yKGMpLChhPXRoaXMub3B0aW9ucykhPW51bGwmJmEub25Mb2FkJiZzLnN0YXR1cz09PSJsb2FkZWQiJiZ0aGlzLm9wdGlvbnMub25Mb2FkKGMpfWVsc2V7Y29uc3QgYz10LmdldE5vZGUobik7aWYoIWMpcmV0dXJuO2MuZXh0cmE9UShOKHt9LChjPT1udWxsP3ZvaWQgMDpjLmV4dHJhKXx8e30pLHtzdGF0dXM6cy5zdGF0dXN9KX19fWNsYXNzIFJlbmRlckNvbnRleHR7Y29uc3RydWN0b3IodCl7Zih0aGlzLCJtb2RlIik7Zih0aGlzLCJfaXNJbmNyZW1lbnRhbCIsITEpO2YodGhpcywiX3NuYXBzaG90SWQiKTtmKHRoaXMsIl9tYXAiLG5ldyBJZDJOb2RlTWFwKTtmKHRoaXMsIl93YWl0TGlzdCIsbmV3IFByb21pc2VMaXN0KTtmKHRoaXMsIl9kZWZlcnJlZFRhc2tRdWV1ZSIsbmV3IERlZmVycmVkVGFza1F1ZXVlKTtmKHRoaXMsIl9ub2RlUmVuZGVyZXJzIixuZXcgTWFwKTt0aGlzLm1vZGU9dH1nZXQgbm9kZXMoKXtyZXR1cm4gdGhpcy5fbWFwfWdldCBzbmFwc2hvdElkKCl7cmV0dXJuIHRoaXMuX3NuYXBzaG90SWQ/dGhpcy5fc25hcHNob3RJZDoiLSJ9Z2V0IGlzSW5jcmVtZW50YWwoKXtyZXR1cm4gdGhpcy5faXNJbmNyZW1lbnRhbH1zZXRTbmFwc2hvdElkKHQpe3RoaXMuX3NuYXBzaG90SWQ9dH1zZXRJbmNyZW1lbnRhbCh0KXt0aGlzLl9pc0luY3JlbWVudGFsPXR9c2V0Tm9kZXModCl7dGhpcy5fbWFwPXR9Z2V0Tm9kZSh0KXtyZXR1cm4gdGhpcy5fbWFwLmdldE5vZGUodCl9cmVnaXN0ZXJOb2RlUmVuZGVyZXIodCl7dGhpcy5fbm9kZVJlbmRlcmVycy5zZXQodC50YWcsdCl9b25Ob2RlUmVuZGVyKHQsZSl7Y29uc3Qgbj10aGlzLl9ub2RlUmVuZGVyZXJzLmdldCh0LnRhZyk7dHJ5e24mJm4ub25SZW5kZXIodGhpcyx0LGUpfWNhdGNoKHMpe2NvbnNvbGUuZXJyb3Iocyl9fW9uTm9kZVJlbW92ZSh0KXtjb25zdCBlPXRoaXMubm9kZXMuZ2V0Tm9kZSh0KTtpZighZSlyZXR1cm47bGV0IG47dGhpcy5pc1ZhbmlsbGEoKT9uPXRoaXMuX25vZGVSZW5kZXJlcnMuZ2V0KGUudGFnTmFtZSk6bj10aGlzLl9ub2RlUmVuZGVyZXJzLmdldChlLnRhZyk7dHJ5e24mJm4ub25SZW1vdmUodGhpcyx0KX1jYXRjaChzKXtjb25zb2xlLmVycm9yKHMpfX1vblBhdGNoKHQsZSxuKXtpZih0PT09ImF0dHJzIilSZWZsZWN0LnNldChlLHQsT2JqZWN0LmFzc2lnbih7fSxlW3RdLG5bdF0pKTtlbHNlIGlmKHQ9PT0iZXh0cmEiKXtjb25zdCBzPXRoaXMuX25vZGVSZW5kZXJlcnMuZ2V0KGUudGFnKTtzJiZzLm9uUGF0Y2hFeHRyYSYmcy5vblBhdGNoRXh0cmEoZSxuKX19cGVyZm9ybUV2ZW50KHQpe3RoaXMuX25vZGVSZW5kZXJlcnMuZm9yRWFjaChlPT57ZS5wZXJmb3JtRXZlbnQodGhpcyx0KX0pfWFkZFdhaXRpbmcodCl7dGhpcy5fd2FpdExpc3QuYWRkKHQpfWRlZmVyVGFzayh0KXt0aGlzLl9kZWZlcnJlZFRhc2tRdWV1ZS5lbnF1ZXVlKHQpfXdhaXRBc3luY1Rhc2soKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7eWllbGQgdGhpcy5fd2FpdExpc3QuYWxsKCkseWllbGQgdGhpcy5fZGVmZXJyZWRUYXNrUXVldWUuZXhlY3V0ZUFsbCgpfSl9Y2FwdHVyZSgpe3ZhciB0O2Zvcihjb25zdCBlIG9mIHRoaXMuX21hcC5rZXlzKCkpZm9yKGNvbnN0IG4gb2YgdGhpcy5fbm9kZVJlbmRlcmVycy52YWx1ZXMoKSkodD1uLm9uQ2FwdHVyZSk9PW51bGx8fHQuY2FsbChuLHRoaXMsZSl9cmVzZXQoKXt0aGlzLl9zbmFwc2hvdElkJiZ0aGlzLl9ub2RlUmVuZGVyZXJzLmZvckVhY2godD0+e3ZhciBlOyhlPXQub25SZXNldCk9PW51bGx8fGUuY2FsbCh0LHRoaXMpfSksdGhpcy5fbWFwLnJlc2V0KCksdGhpcy5fd2FpdExpc3QuY2xlYXIoKSx0aGlzLl9kZWZlcnJlZFRhc2tRdWV1ZS5jbGVhcigpfWlzVmFuaWxsYSgpe3JldHVybiB0aGlzLm1vZGU9PT1SZW5kZXJNb2RlLlZhbmlsbGFET019aXNWaXJ0dWFsKCl7cmV0dXJuIHRoaXMubW9kZT09PVJlbmRlck1vZGUuVmlydHVhbERPTX19ZnVuY3Rpb24gbGF6eUxvYWQocix0PTApe3JldHVybiBuZXcgUHJvbWlzZShlPT57c2V0VGltZW91dCgoKT0+e2NvbnN0IG49cigpO2Uobil9LHQpfSl9Y2xhc3MgU3R5bGVFbGVtZW50UmVuZGVyZXJ7Z2V0IHRhZygpe3JldHVybiJTVFlMRSJ9b25SZW5kZXIodCxlKXt2YXIgbjtpZih0LmlzVmFuaWxsYSgpKXtjb25zdCBzPXQuZ2V0Tm9kZShlLmlkKTtpZihzJiZpc0hUTUxFbGVtZW50KHMpJiZpc0hUTUxTdHlsZUVsZW1lbnQocykpe2NvbnN0IG89ZTsobj1vLmV4dHJhKSE9bnVsbCYmbi5jb21tYW5kcyYmdC5hZGRXYWl0aW5nKG5ldyBQcm9taXNlKGE9PntzZXRUaW1lb3V0KCgpPT57dmFyIHU7aWYoIXMuc2hlZXQpe2Eoe2ZhaWxlZDohMSx0aW1lb3V0OiExLGVsZW1lbnQ6c30pO3JldHVybn1jb25zdCBjPXMuc2hlZXQsbD0odT1vLmV4dHJhKT09bnVsbD92b2lkIDA6dS5jb21tYW5kcztsPT1udWxsfHxsLmZvckVhY2goaD0+e3BlcmZvcm1TdHlsZVJ1bGVTaGVldChjLGgpfSksYSh7ZmFpbGVkOiExLHRpbWVvdXQ6ITEsZWxlbWVudDpzfSl9LDApfSkpfX19b25QYXRjaEV4dHJhKHQsZSl7dmFyIHMsbyxhO2NvbnN0IG49dC5leHRyYTsiY29tbWFuZHMiaW4gbiYmKChzPW4uY29tbWFuZHMpIT1udWxsJiZzLmxlbmd0aCkmJihuLmNvbW1hbmRzPVsuLi4oYT0obz1lLmV4dHJhKT09bnVsbD92b2lkIDA6by5jb21tYW5kcykhPW51bGw/YTpbXSwuLi5uLmNvbW1hbmRzXSl9b25SZW1vdmUodCxlKXt9cGVyZm9ybUV2ZW50KHQsZSl7ZS5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLkhUTUxNdXRhdGlvbnMmJmUuZGF0YS5mb3JFYWNoKHM9Pnt2YXIgbztpZihzLnR5cGU9PT1WTXV0YXRpb25UeXBlLlN0eWxlU2hlZXRSdWxlKXtpZih0LmlzVmFuaWxsYSgpKXtjb25zdCBhPXQuZ2V0Tm9kZShzLnRhcmdldCk7aWYoIWEpcmV0dXJuO2lzSFRNTEVsZW1lbnQoYSkmJmlzSFRNTFN0eWxlRWxlbWVudChhKSYmYS5zaGVldCYmcGVyZm9ybVN0eWxlUnVsZVNoZWV0KGEuc2hlZXQscy5kYXRhKX1lbHNlIGlmKHQuaXNWaXJ0dWFsKCkpe2NvbnN0IGE9dC5nZXROb2RlKHMudGFyZ2V0KTtpZighYSlyZXR1cm47Y29uc3QgYz1hO2MuZXh0cmF8fChjLmV4dHJhPXtjb21tYW5kczpbXX0pLChvPWMuZXh0cmEuY29tbWFuZHMpPT1udWxsfHxvLnB1c2gocy5kYXRhKX19fSl9fWZ1bmN0aW9uIHBlcmZvcm1TdHlsZVJ1bGVTaGVldChyLHQpe2NvbnN0IGU9UnVsZVNoZWV0TWV0aG9kRGVjb2Rlc1t0WzBdXTtpZighZSlyZXR1cm47Y29uc3Qgbj1SZWZsZWN0LmdldChyLGUpO3RyeXtSZWZsZWN0LmFwcGx5KG4scix0WzFdKX1jYXRjaChzKXtjb25zb2xlLndhcm4ocyl9fWNsYXNzIFNoYWRvd1Jvb3RSZW5kZXJlcntnZXQgdGFnKCl7cmV0dXJuIiNkb2N1bWVudC1mcmFnbWVudCJ9b25SZW5kZXIodCxlLG4pe2NvbnN0IHM9ZS5leHRyYSxvPXMuc3R5bGVTaGVldHMuc2hlZXRzO2lmKHQuaXNWYW5pbGxhKCkpe2NvbnN0IGE9bjthLl9fc3R5bGVzPXt9LHQuYWRkV2FpdGluZyhuZXcgUHJvbWlzZShjPT57c2V0VGltZW91dCgoKT0+e2NvbnN0IGw9W107Zm9yKGxldCB1PTA7dTxvLmxlbmd0aDt1Kyspe2NvbnN0IGg9b1t1XSxwPXMuc3R5bGVTaGVldHMucnVsZXNbaF0sbT10aGlzLl9jcmVhdGVIb3N0ZWRTdHlsZVNoZWV0KGEscCk7U3R5bGVTaGVldE9ic2VydmVyLnNldFNoZWV0SWQobSxoKSxsLnB1c2gobSksYS5fX3N0eWxlc1toXT1tfWEuYWRvcHRlZFN0eWxlU2hlZXRzPVsuLi5hLmFkb3B0ZWRTdHlsZVNoZWV0cywuLi5sXSxjKHtmYWlsZWQ6ITEsdGltZW91dDohMSxlbGVtZW50OmF9KX0sMCl9KSl9fW9uUGF0Y2hFeHRyYSh0LGUpe2NvbnN0e3NoZWV0czpuLHJ1bGVzOnN9PWUuZXh0cmEuc3R5bGVTaGVldHMsbz17c3R5bGVTaGVldHM6e3NoZWV0czpbLi4ubl0scnVsZXM6T2JqZWN0LmtleXMocykucmVkdWNlKChsLHUpPT5RKE4oe30sbCkse1t1XTpbLi4uc1tOdW1iZXIodSldXX0pLHt9KX19LGM9dC5leHRyYS5zdHlsZVNoZWV0cztPYmplY3Qua2V5cyhjLnJ1bGVzKS5mb3JFYWNoKGw9Pntjb25zdCB1PW8uc3R5bGVTaGVldHMucnVsZXNbTnVtYmVyKGwpXTt1P3UucHVzaCguLi5jLnJ1bGVzW051bWJlcihsKV0pOihvLnN0eWxlU2hlZXRzLnJ1bGVzW051bWJlcihsKV09Wy4uLmMucnVsZXNbTnVtYmVyKGwpXV0sby5zdHlsZVNoZWV0cy5zaGVldHMucHVzaChOdW1iZXIobCkpKX0pLHQuZXh0cmE9b31wZXJmb3JtRXZlbnQodCxlKXtlLmV2ZW50VHlwZT09PVRyYWNrZXJFdmVudFR5cGUuSFRNTE11dGF0aW9ucyYmZS5kYXRhLmZvckVhY2gocz0+e3MudHlwZT09PVZNdXRhdGlvblR5cGUuU3R5bGVTaGVldFJ1bGU/dGhpcy5fcGVyZm9ybVN0eWxlU2hlZXRSdWxlQ2hhbmdlKHQscyk6cy50eXBlPT09Vk11dGF0aW9uVHlwZS5TdHlsZVNoZWV0QWRvcHRlZCYmdGhpcy5fcGVyZm9ybVN0eWxlU2hlZXRBZG9wdGVkQ2hhbmdlKHQscyl9KX1fY3JlYXRlSG9zdGVkU3R5bGVTaGVldCh0LGUpe3ZhciBvO2NvbnN0IG49KG89dC5ob3N0Lm93bmVyRG9jdW1lbnQpPT1udWxsP3ZvaWQgMDpvLmRlZmF1bHRWaWV3O2xldCBzO3JldHVybiBuP3M9bmV3IG4uQ1NTU3R5bGVTaGVldDpzPW5ldyBDU1NTdHlsZVNoZWV0LGU9PW51bGx8fGUuZm9yRWFjaChhPT57cGVyZm9ybVN0eWxlUnVsZVNoZWV0KHMsYSl9KSxzfV9wZXJmb3JtU3R5bGVTaGVldFJ1bGVDaGFuZ2UodCxlKXt2YXIgbjtpZih0LmlzVmFuaWxsYSgpKXtjb25zdCBzPXQuZ2V0Tm9kZShlLnRhcmdldCk7aWYoIXN8fCEocyBpbnN0YW5jZW9mIFNoYWRvd1Jvb3QpfHwhZS5zaGVldElkKXJldHVybjtjb25zdCBvPShuPXMuX19zdHlsZXMpPT1udWxsP3ZvaWQgMDpuW2Uuc2hlZXRJZF07byYmcGVyZm9ybVN0eWxlUnVsZVNoZWV0KG8sZS5kYXRhKX1lbHNlIGlmKHQuaXNWaXJ0dWFsKCkpe2NvbnN0IHM9dC5nZXROb2RlKGUudGFyZ2V0KTtpZighKHMmJnMudGFnPT09dGhpcy50YWcpfHwhZS5zaGVldElkKXJldHVybjtsZXQgbz1zLmV4dHJhO2lmKG98fChvPXtzdHlsZVNoZWV0czp7c2hlZXRzOltdLHJ1bGVzOnt9fX0scy5leHRyYT1vKSxvJiZvLnN0eWxlU2hlZXRzLnJ1bGVzKXtjb25zdCBhPW8uc3R5bGVTaGVldHMucnVsZXNbZS5zaGVldElkXTthP2EucHVzaChlLmRhdGEpOihvLnN0eWxlU2hlZXRzLnJ1bGVzW2Uuc2hlZXRJZF09W2UuZGF0YV0sby5zdHlsZVNoZWV0cy5zaGVldHMucHVzaChlLnNoZWV0SWQpKX19fV9wZXJmb3JtU3R5bGVTaGVldEFkb3B0ZWRDaGFuZ2UodCxlKXtpZih0LmlzVmFuaWxsYSgpKXtjb25zdCBuPXQuZ2V0Tm9kZShlLnRhcmdldCk7aWYoIW58fCEobiBpbnN0YW5jZW9mIFNoYWRvd1Jvb3QpKXJldHVybjt0LmFkZFdhaXRpbmcobGF6eUxvYWQoKCk9Pntjb25zdCBzPW4se3NoZWV0czpvLHJ1bGVzOmF9PWUuZGF0YSxjPW8ubWFwKGw9PntsZXQgdT1zLl9fc3R5bGVzW2xdO3JldHVybiB1fHwodT10aGlzLl9jcmVhdGVIb3N0ZWRTdHlsZVNoZWV0KHMsYVtsXSkpLHV9KTtyZXR1cm4gcy5hZG9wdGVkU3R5bGVTaGVldHM9Yyx7ZmFpbGVkOiExLHRpbWVvdXQ6ITEsZWxlbWVudDpzfX0pKX1lbHNlIGlmKHQuaXNWaXJ0dWFsKCkpe2NvbnN0IG49dC5nZXROb2RlKGUudGFyZ2V0KTtpZighbnx8bi50YWchPT10aGlzLnRhZylyZXR1cm47Y29uc3R7c2hlZXRzOnMscnVsZXM6b309ZS5kYXRhLGE9bi5leHRyYSxjPWEuc3R5bGVTaGVldHMucnVsZXM7YS5zdHlsZVNoZWV0cy5ydWxlcz1zLnJlZHVjZSgobCx1KT0+UShOKHt9LGwpLHtbdV06Y1t1XXx8b1t1XX0pLHt9KSxhLnN0eWxlU2hlZXRzLnNoZWV0cz1zfX1vblJlbW92ZSh0LGUpe319Y2xhc3MgQWJzdHJhY3RTbmFwc2hvdFJlbmRlcmVyIGV4dGVuZHMgRXZlbnRFbWl0dGVye2NvbnN0cnVjdG9yKGUsbil7c3VwZXIoKTtmKHRoaXMsImNvbnRleHQiKTtmKHRoaXMsIl9zdXNwZW5kZWQiLCEwKTtmKHRoaXMsIl9uZWVkUmVidWlsZElkMk5vZGVNYXAiLCExKTt0aGlzLmNvbnRleHQ9bmV3IFJlbmRlckNvbnRleHQoZSksdGhpcy5yZWdpc3Rlck5vZGVSZW5kZXJlcihTdHlsZUVsZW1lbnRSZW5kZXJlciksdGhpcy5yZWdpc3Rlck5vZGVSZW5kZXJlcihJRnJhbWVFbGVtZW50UmVuZGVyZXIpLHRoaXMucmVnaXN0ZXJOb2RlUmVuZGVyZXIoQ2FudmFzRWxlbWVudFJlbmRlcmVyKSx0aGlzLnJlZ2lzdGVyTm9kZVJlbmRlcmVyKEltYWdlRWxlbWVudFJlbmRlcmVyLG49PW51bGw/dm9pZCAwOm4uaW1hZ2UpLHRoaXMucmVnaXN0ZXJOb2RlUmVuZGVyZXIoU2hhZG93Um9vdFJlbmRlcmVyKSx0aGlzLmNvbnRleHQubm9kZXMub24oIm5vZGVBZGRlZCIsKHMsbyk9Pnt0aGlzLmVtaXQoIm5vZGVBZGRlZCIscyxvKX0pLHRoaXMuY29udGV4dC5ub2Rlcy5vbigibm9kZVJlbW92ZWQiLChzLG8pPT57dGhpcy5lbWl0KCJub2RlUmVtb3ZlZCIscyxvKX0pLHRoaXMuY29udGV4dC5ub2Rlcy5vbigibm9kZVJlc2V0IiwoKT0+e3RoaXMuZW1pdCgibm9kZVJlc2V0Iil9KSxzZXRJbnRlcnZhbCgoKT0+e3RoaXMuX25lZWRSZWJ1aWxkSWQyTm9kZU1hcD0hMH0sMWUzKjYwKX1nZXQgc3VzcGVuZGVkKCl7cmV0dXJuIHRoaXMuX3N1c3BlbmRlZH1nZXROb2RlKGUpe3JldHVybiB0aGlzLmNvbnRleHQubm9kZXMuZ2V0Tm9kZShlKX1yZXNldCgpe3RoaXMuY29udGV4dC5yZXNldCgpfXN1c3BlbmQoKXt0aGlzLl9zdXNwZW5kZWQ9ITB9cmVzdW1lKCl7dGhpcy5fc3VzcGVuZGVkPSExfXJlZ2lzdGVyTm9kZVJlbmRlcmVyKGUsLi4ubil7Y29uc3Qgcz1SZWZsZWN0LmNvbnN0cnVjdChlLFsuLi5uXSk7dGhpcy5jb250ZXh0LnJlZ2lzdGVyTm9kZVJlbmRlcmVyKHMpfXJlbmRlcihlKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7aWYoZS52ZXJzaW9uIT09MSl0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFcnJvcihgVW5zdXBwb3J0ZWQgc25hcHNob3QgdmVyc2lvbiAke2UudmVyc2lvbn0uYCk7dGhpcy5jb250ZXh0LnNldFNuYXBzaG90SWQoZS5pZCksdGhpcy5yZXNldCgpO2NvbnN0IG49dGhpcy5zdXNwZW5kZWQ7dGhpcy5zdXNwZW5kKCksdGhpcy5yZW5kZXJXaW5kb3coZS53aW5kb3cpLHRoaXMucmVuZGVyRG9jdW1lbnQoZS5kb2N1bWVudCksbnx8dGhpcy5yZXN1bWUoKX0pfXBlcmZvcm1FdmVudChlKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7dHJ5e3N3aXRjaChlLmV2ZW50VHlwZSl7Y2FzZSBUcmFja2VyRXZlbnRUeXBlLkhUTUxTbmFwc2hvdDp5aWVsZCB0aGlzLnJlbmRlcihlLmRhdGEpO3JldHVybjtjYXNlIFRyYWNrZXJFdmVudFR5cGUuSFRNTE11dGF0aW9uczp0aGlzLnBlcmZvcm1NdXRhdGlvbnMoZS5kYXRhKTticmVhaztjYXNlIFRyYWNrZXJFdmVudFR5cGUuSFRNTE5hdmlnYXRpb246dGhpcy5wZXJmb3JtTmF2aWdhdGlvbihlLmRhdGEpO2JyZWFrO2Nhc2UgVHJhY2tlckV2ZW50VHlwZS5IVE1MU2Nyb2xsOnRoaXMucGVyZm9ybVNjcm9sbChlLmRhdGEpO2JyZWFrO2Nhc2UgVHJhY2tlckV2ZW50VHlwZS5IVE1MRm9jdXM6dGhpcy5wZXJmb3JtRm9jdXMoZS5kYXRhKTticmVhaztjYXNlIFRyYWNrZXJFdmVudFR5cGUuSFRNTEJsdXI6dGhpcy5wZXJmb3JtQmx1cihlLmRhdGEpO2JyZWFrO2Nhc2UgVHJhY2tlckV2ZW50VHlwZS5IVE1MVmFsdWVDaGFuZ2U6dGhpcy5wZXJmb3JtVmFsdWVDaGFuZ2UoZS5kYXRhKTticmVhaztjYXNlIFRyYWNrZXJFdmVudFR5cGUuSFRNTFNlbGVjdGlvbkNoYW5nZTp0aGlzLnBlcmZvcm1TZWxlY3Rpb25DaGFuZ2UoZS5kYXRhKTticmVhaztjYXNlIFRyYWNrZXJFdmVudFR5cGUuSFRNTFJlc2l6ZTp0aGlzLnBlcmZvcm1SZXNpemUoZS5kYXRhKTticmVha310aGlzLmNvbnRleHQucGVyZm9ybUV2ZW50KGUpLHlpZWxkIHRoaXMucGVyZm9ybVBvc3RSZW5kZXJpbmcoKX1jYXRjaChuKXtjb25zb2xlLmVycm9yKG4pfWlmKHRoaXMuX25lZWRSZWJ1aWxkSWQyTm9kZU1hcCl7Y29uc3Qgbj1uZXcgSWQyTm9kZU1hcDt0aGlzLnJlYnVpbGROb2RlcyhuKSx0aGlzLmNvbnRleHQuc2V0Tm9kZXMobiksdGhpcy5fbmVlZFJlYnVpbGRJZDJOb2RlTWFwPSExfX0pfXBlcmZvcm1NdXRhdGlvbnMoZSl7Zm9yKGNvbnN0IG4gb2YgZSl0cnl7dGhpcy5wZXJmb3JtTXV0YXRpb24obil9Y2F0Y2gocyl7Y29uc29sZS5lcnJvcihzKX19cGVyZm9ybU11dGF0aW9uKGUpe3N3aXRjaChlLnR5cGUpe2Nhc2UgVk11dGF0aW9uVHlwZS5BZGROb2RlOnRoaXMucGVyZm9ybUFkZE5vZGVNdXRhdGlvbihlKTticmVhaztjYXNlIFZNdXRhdGlvblR5cGUuQ2hhbmdlQXR0cmlidXRlczp0aGlzLnBlcmZvcm1DaGFuZ2VBdHRyaWJ1dGVNdXRhdGlvbihlKTticmVhaztjYXNlIFZNdXRhdGlvblR5cGUuUmVtb3ZlTm9kZTp0cnl7dGhpcy5wZXJmb3JtUmVtb3ZlTm9kZU11dGF0aW9uKGUpfWNhdGNoKG4pe31icmVhaztjYXNlIFZNdXRhdGlvblR5cGUuQ2hhcmFjdGVyRGF0YTp0aGlzLnBlcmZvcm1DaGFyYWN0ZXJEYXRhTXV0YXRpb24oZSk7YnJlYWs7Y2FzZSBWTXV0YXRpb25UeXBlLkRvY3VtZW50OnRoaXMucGVyZm9ybURvY3VtZW50TXV0YXRpb24oZSk7YnJlYWt9fXBlcmZvcm1Qb3N0UmVuZGVyaW5nKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe30pfXBlcmZvcm1DaGFuZ2VBdHRyaWJ1dGVNdXRhdGlvbihlKXtjb25zdCBuPXRoaXMuZ2V0Tm9kZShlLnRhcmdldCk7aWYoIW4pdGhyb3cgbmV3IFJlbmRlcmluZ0Vycm9yKGBOb2RlIHdpdGggSUQgJyR7ZS50YXJnZXR9JyBub3QgZm91bmQuYCk7dGhpcy5hcHBseUF0dHJzKGUuZGF0YSxuKX1wZXJmb3JtU2Nyb2xsKGUpe2NvbnN0IG49dGhpcy5nZXROb2RlKGUudGFyZ2V0KTtuJiZ0aGlzLmFwcGx5U2Nyb2xsaW5nKGUuc2Nyb2xsLG4pfXBlcmZvcm1Gb2N1cyhlKXtjb25zdCBuPXRoaXMuZ2V0Tm9kZShlLnRhcmdldCk7aWYobil0aGlzLmFwcGx5Rm9jdXMobik7ZWxzZSB0aHJvdyBuZXcgUmVuZGVyaW5nRXJyb3IoYE5vZGUgd2l0aCBJRCAnJHtlLnRhcmdldH0nIG5vdCBmb3VuZC5gKX1wZXJmb3JtQmx1cihlKXtjb25zdCBuPXRoaXMuZ2V0Tm9kZShlLnRhcmdldCk7aWYobil0aGlzLmFwcGx5Qmx1cihuKTtlbHNlIHRocm93IG5ldyBSZW5kZXJpbmdFcnJvcihgTm9kZSB3aXRoIElEICcke2UudGFyZ2V0fScgbm90IGZvdW5kLmApfXBlcmZvcm1WYWx1ZUNoYW5nZShlKXtjb25zdCBuPXRoaXMuZ2V0Tm9kZShlLnRhcmdldCk7biYmKHR5cGVvZiBlLnZhbHVlPT0ic3RyaW5nIj90aGlzLmFwcGx5VmFsdWUoZS52YWx1ZSxuKTp0aGlzLmFwcGx5Q2hlY2tlZFN0YXRlKGUudmFsdWUsbikpfXBlcmZvcm1TZWxlY3Rpb25DaGFuZ2UoZSl7dGhpcy5hcHBseVNlbGVjdGlvbihlKX1wZXJmb3JtUmVzaXplKGUpe3RoaXMuYXBwbHlTaXplKGUuc2l6ZSl9fWNsYXNzIFZpcnR1YWxTbmFwc2hvdFJlbmRlcmVyIGV4dGVuZHMgQWJzdHJhY3RTbmFwc2hvdFJlbmRlcmVye2NvbnN0cnVjdG9yKGUpe3N1cGVyKFJlbmRlck1vZGUuVmlydHVhbERPTSxlKTtmKHRoaXMsIl9jb250ZW50V2luZG93Iik7Zih0aGlzLCJfY29udGVudERvY3VtZW50Iik7dGhpcy5fY3JlYXRlTmV3Q29udGVudCgpfWdldCBjb250ZW50V2luZG93KCl7cmV0dXJuIHRoaXMuX2NvbnRlbnRXaW5kb3d9Z2V0IGNvbnRlbnREb2N1bWVudCgpe3JldHVybiB0aGlzLl9jb250ZW50RG9jdW1lbnR9Z2V0IHNpemUoKXtyZXR1cm4gdGhpcy5jb250ZW50V2luZG93LnNpemV9Z2V0IGRvY3VtZW50VGl0bGUoKXtyZXR1cm4gdGhpcy5jb250ZW50RG9jdW1lbnQudGl0bGV9Z2V0IGRvY3VtZW50VVJMKCl7cmV0dXJuIHRoaXMuY29udGVudFdpbmRvdy5sb2NhdGlvbn1nZXQgZG9jdW1lbnRCYXNlVVJJKCl7cmV0dXJuIHRoaXMuY29udGVudERvY3VtZW50LmJhc2VVUkl9Z2V0Tm9kZShlKXtyZXR1cm4gdGhpcy5jb250ZXh0Lm5vZGVzLmdldE5vZGUoZSl9cmVzZXQoKXtzdXBlci5yZXNldCgpLHRoaXMuX2NyZWF0ZU5ld0NvbnRlbnQoKX1jYXB0dXJlU25hcHNob3QoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Y29uc3QgZT17dmVyc2lvbjoxLHdpbmRvdzp0aGlzLmNvbnRlbnRXaW5kb3csZG9jdW1lbnQ6dGhpcy5fY29udGVudERvY3VtZW50LGlkOnRoaXMuY29udGV4dC5zbmFwc2hvdElkfTtyZXR1cm4gdGhpcy5jb250ZXh0LmNhcHR1cmUoKSx5aWVsZCB0aGlzLmNvbnRleHQud2FpdEFzeW5jVGFzaygpLGRlZXBDbG9uZShlKX0pfW1lcmdlSW5jcmVtZW50YWxTbmFwc2hvdChlLG4pe2xldCBvPWRlZXBDbG9uZShlKTtyZXR1cm4gbi5mb3JFYWNoKGE9Pntjb25zdCBjPW5ldyBNYXA7dGhpcy52aXNpdFZFbGVtZW50KG8uZG9jdW1lbnQucm9vdCxjKSxvPXRoaXMucGF0Y2hJbmNyZW1lbnRhbFNuYXBzaG90KG8sZGVlcENsb25lKGEpLGMpfSksb312aXNpdFZFbGVtZW50KGUsbil7dmFyIHM7bi5zZXQoZS5pZCxlKSwocz1lLmNoaWxkcmVuKT09bnVsbHx8cy5mb3JFYWNoKG89Pnt0aGlzLnZpc2l0VkVsZW1lbnQobyxuKX0pfXBhdGNoVkVsZW1lbnQoZSxuKXt2YXIgYTtjb25zdCBzPW4uZ2V0KGUuaWQpO2lmKHMpe2NvbnN0IG89cyx7Y2hpbGRyZW46YyxzaGFkb3dSb290OmwsaWQ6dSx0eXBlOmgsdGFnOnAsZXh0cmE6bX09byx2PWNlKG8sWyJjaGlsZHJlbiIsInNoYWRvd1Jvb3QiLCJpZCIsInR5cGUiLCJ0YWciLCJleHRyYSJdKTtbImlkIiwidHlwZSIsInRhZyIsLi4uT2JqZWN0LmtleXModiksImV4dHJhIl0uZm9yRWFjaCh3PT57Y29uc3QgVD13O2VbVF09PT12b2lkIDA/UmVmbGVjdC5zZXQoZSxULHNbVF0pOnRoaXMuY29udGV4dC5vblBhdGNoKFQsZSxzKX0pLGlzVlBhcmVudE5vZGUoZSkmJigoYT1lLmNoaWxkcmVuKT09bnVsbHx8YS5mb3JFYWNoKHc9Pnt0aGlzLnBhdGNoVkVsZW1lbnQodyxuKX0pKSxsJiYoZS5zaGFkb3dSb290PXRoaXMucGF0Y2hWRWxlbWVudChsLG4pKX1yZXR1cm4gZX1wYXRjaEluY3JlbWVudGFsU25hcHNob3QoZSxuLHMpe2NvbnN0IG89dGhpcy5wYXRjaFZFbGVtZW50KG4uZG9jdW1lbnQucm9vdCxzKTtlLndpbmRvdz1OKE4oe30sZS53aW5kb3cpLG4ud2luZG93KTtjb25zdHt2aXNpYmlsaXR5U3RhdGU6YX09bi5kb2N1bWVudDtyZXR1cm4gZS5kb2N1bWVudC5yb290PW8sYSYmKGUuZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlPWEpLGV9X2NyZWF0ZU5ld0NvbnRlbnQoKXt0aGlzLl9jb250ZW50V2luZG93PXtsb2NhdGlvbjoiYWJvdXQ6YmxhbmsiLHNpemU6WzAsMF19LHRoaXMuX2NvbnRlbnREb2N1bWVudD17dHlwZTpWTm9kZVR5cGUuRG9jdW1lbnROb2RlLGlkOjEsYmFzZVVSSToiYWJvdXQ6YmxhbmsiLHRpdGxlOiIiLHJvb3Q6e2lkOjIscGFyZW50SWQ6MSx0YWc6IkhUTUwiLHR5cGU6Vk5vZGVUeXBlLkVsZW1lbnROb2RlfSx2aXNpYmlsaXR5U3RhdGU6ImhpZGRlbiJ9fXJlbmRlcldpbmRvdyhlKXt0aGlzLl9jb250ZW50V2luZG93PWRlZXBDbG9uZShlKX1yZW5kZXJEb2N1bWVudChlKXt0aGlzLl9jb250ZW50RG9jdW1lbnQ9ZGVlcENsb25lKGUpLHRoaXMucmVuZGVyTm9kZSh0aGlzLl9jb250ZW50RG9jdW1lbnQucm9vdCwhMSl9cmVuZGVyTm9kZShlLG49ITApe2NvbnN0IHM9bj9kZWVwQ2xvbmUoZSk6ZTtyZXR1cm4gdGhpcy5jb250ZXh0Lm5vZGVzLmFkZE5vZGUoZS5pZCxzKSx0aGlzLmNvbnRleHQub25Ob2RlUmVuZGVyKGUscyksaXNWRWxlbWVudChzKSYmdGhpcy5fcmVuZGVyRWxlbWVudE5vZGUocyksaXNWUGFyZW50Tm9kZShzKSYmdGhpcy5fcmVuZGVyQ2hpbGRyZW4ocyksc31fcmVuZGVyRWxlbWVudE5vZGUoZSl7ZS5zaGFkb3dSb290JiZ0aGlzLnJlbmRlck5vZGUoZS5zaGFkb3dSb290LCExKX1fcmVuZGVyQ2hpbGRyZW4oZSl7aWYoZS5jaGlsZHJlbilmb3IoY29uc3QgbiBvZiBlLmNoaWxkcmVuKXRoaXMucmVuZGVyTm9kZShuLCExKX1wZXJmb3JtTmF2aWdhdGlvbihlKXt0aGlzLl9jb250ZW50V2luZG93LmxvY2F0aW9uPWUudG8sdGhpcy5lbWl0KCJuYXZpZ2F0ZSIsZSl9cGVyZm9ybUFkZE5vZGVNdXRhdGlvbihlKXtjb25zdCBuPXRoaXMuZ2V0Tm9kZShlLnRhcmdldCk7aWYoIW4pdGhyb3cgbmV3IFJlbmRlcmluZ0Vycm9yKGBUYXJnZXQgd2l0aCBJRCAnJHtlLnRhcmdldH0nIG5vdCBmb3VuZC5gKTtjb25zdCBzPXRoaXMucmVuZGVyTm9kZShlLmRhdGEubm9kZSk7bi5jaGlsZHJlbnx8KG4uY2hpbGRyZW49W10pO2xldCBvO2UuZGF0YS5iZWZvcmUmJihvPXRoaXMuZ2V0Tm9kZShlLmRhdGEuYmVmb3JlKSk7bGV0IGE7byYmKGE9bi5jaGlsZHJlbi5maW5kSW5kZXgoYz0+Yy5pZD09PShvPT1udWxsP3ZvaWQgMDpvLmlkKSkpIT09LTE/bi5jaGlsZHJlbi5zcGxpY2UoYSwwLHMpOm4uY2hpbGRyZW4ucHVzaChzKX1wZXJmb3JtUmVtb3ZlTm9kZU11dGF0aW9uKGUpe2NvbnN0IG49dGhpcy5nZXROb2RlKGUudGFyZ2V0KTtpZighbil0aHJvdyBuZXcgUmVuZGVyaW5nRXJyb3IoYE5vZGUgd2l0aCBJRCAnJHtlLnRhcmdldH0nIG5vdCBmb3VuZC5gKTtsZXQgcyxvPVtdO3R5cGVvZiBlLmRhdGE9PSJvYmplY3QiPyhzPWUuZGF0YS5pZCxvPWUuZGF0YS5jaGlsZHJlbik6cz1lLmRhdGE7Y29uc3QgYT10aGlzLmdldE5vZGUocyk7aWYoIWEpdGhyb3cgbmV3IFJlbmRlcmluZ0Vycm9yKGBOb2RlIHdpdGggSUQgJyR7c30nIG5vdCBmb3VuZC5gKTtpZihuLmNoaWxkcmVuKXtjb25zdCBjPW4uY2hpbGRyZW4uZmluZEluZGV4KGw9PmwuaWQ9PT1hLmlkKTtjIT09LTEmJm4uY2hpbGRyZW4uc3BsaWNlKGMsMSl9by5mb3JFYWNoKGM9Pnt0aGlzLmNvbnRleHQub25Ob2RlUmVtb3ZlKGMpLHRoaXMuY29udGV4dC5ub2Rlcy5yZW1vdmVOb2RlKGMpfSksdGhpcy5jb250ZXh0Lm9uTm9kZVJlbW92ZShzKSx0aGlzLmNvbnRleHQubm9kZXMucmVtb3ZlTm9kZShzKX1wZXJmb3JtQ2hhcmFjdGVyRGF0YU11dGF0aW9uKGUpe2NvbnN0IG49dGhpcy5nZXROb2RlKGUudGFyZ2V0KTtpZighbil0aHJvdyBuZXcgUmVuZGVyaW5nRXJyb3IoYE5vZGUgd2l0aCBJRCAnJHtlLnRhcmdldH0nIG5vdCBmb3VuZC5gKTtlLmRhdGEhPT1udWxsP24udGV4dD1lLmRhdGE6ZGVsZXRlIG4udGV4dH1wZXJmb3JtRG9jdW1lbnRNdXRhdGlvbihlKXtlLmRhdGEudmlzaWJpbGl0eVN0YXRlJiYodGhpcy5jb250ZW50RG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlPWUuZGF0YS52aXNpYmlsaXR5U3RhdGUpfWFwcGx5QXR0cnMoZSxuKXtmb3IoY29uc3RbcyxvXW9mIE9iamVjdC5lbnRyaWVzKGUpKW8hPT1udWxsPyhuLmF0dHJzfHwobi5hdHRycz17fSksbi5hdHRyc1tzXT1vKTpuLmF0dHJzJiZkZWxldGUgbi5hdHRyc1tzXX1hcHBseVNjcm9sbGluZyhlLG4pe24uc2Nyb2xsPVsuLi5lXX1hcHBseVZhbHVlKGUsbil7bi52YWx1ZT1lfWFwcGx5Q2hlY2tlZFN0YXRlKGUsbil7bi5jaGVja2VkPWV9YXBwbHlTaXplKGUsbj0hMCl7dGhpcy5jb250ZW50V2luZG93LnNpemU9Wy4uLmVdLG4mJnRoaXMuZW1pdCgicmVzaXplIil9YXBwbHlCbHVyKCl7fWFwcGx5Rm9jdXMoKXt9YXBwbHlTZWxlY3Rpb24oKXt9cmVidWlsZE5vZGVzKGUpe2UuYWRkTm9kZSh0aGlzLl9jb250ZW50RG9jdW1lbnQucm9vdC5pZCx0aGlzLl9jb250ZW50RG9jdW1lbnQpLHRoaXMuX3JlYnVpbGROb2RlKGUsdGhpcy5fY29udGVudERvY3VtZW50LnJvb3QpfV9yZWJ1aWxkTm9kZShlLG4pe3ZhciBzO2UuYWRkTm9kZShuLmlkLG4pLGlzVlBhcmVudE5vZGUobikmJigocz1uLmNoaWxkcmVuKT09bnVsbHx8cy5mb3JFYWNoKG89PnRoaXMuX3JlYnVpbGROb2RlKGUsbykpKSxpc1ZFbGVtZW50KG4pJiZuLnNoYWRvd1Jvb3QmJnRoaXMuX3JlYnVpbGROb2RlKGUsbi5zaGFkb3dSb290KX19Y2xhc3MgSW5jcmVtZW50YWxTbmFwc2hvdFJlbmRlcmVyIGV4dGVuZHMgVmlydHVhbFNuYXBzaG90UmVuZGVyZXJ7Y29uc3RydWN0b3IoZSl7c3VwZXIoZSk7Zih0aGlzLCJfY2hhbmdlZFdpbmRvdyIpO2YodGhpcywiX2NoYW5nZWREb2N1bWVudCIpO2YodGhpcywiX2NoYW5nZWRDb3VudCIsMCk7dGhpcy5jb250ZXh0LnNldEluY3JlbWVudGFsKCEwKSx0aGlzLl9pbml0SW5jcmVtZW50YWwoKX1nZXQgc2l6ZSgpe3JldHVybiB0aGlzLl9jaGFuZ2VkV2luZG93LnNpemV8fHN1cGVyLnNpemV9Z2V0IGRvY3VtZW50VGl0bGUoKXtyZXR1cm4gdGhpcy5fY2hhbmdlZERvY3VtZW50LnRpdGxlfHxzdXBlci5kb2N1bWVudFRpdGxlfWdldCBkb2N1bWVudFVSTCgpe3JldHVybiB0aGlzLl9jaGFuZ2VkV2luZG93LmxvY2F0aW9ufHxzdXBlci5kb2N1bWVudFVSTH1nZXQgZG9jdW1lbnRCYXNlVVJJKCl7cmV0dXJuIHRoaXMuX2NoYW5nZWREb2N1bWVudC5iYXNlVVJJfHxzdXBlci5kb2N1bWVudEJhc2VVUkl9cmVzZXQoKXtzdXBlci5yZXNldCgpLHRoaXMuX2luaXRJbmNyZW1lbnRhbCgpfV9pbml0SW5jcmVtZW50YWwoKXt0aGlzLl9jaGFuZ2VkV2luZG93PXt9LHRoaXMuX2NoYW5nZWREb2N1bWVudD17fSx0aGlzLl9jaGFuZ2VkQ291bnQ9MH1nZXRJbmNyZW1lbnRhbFBlcmNlbnQoKXtyZXR1cm4gdGhpcy5fY2hhbmdlZENvdW50L3RoaXMuY29udGV4dC5ub2Rlcy5zaXplKCl9cmVuZGVyV2luZG93KGUpe3N1cGVyLnJlbmRlcldpbmRvdyhlKX1yZW5kZXJEb2N1bWVudChlKXtzdXBlci5yZW5kZXJEb2N1bWVudChlKSx0aGlzLl9jaGFuZ2VkRG9jdW1lbnQucm9vdD10aGlzLnJlbmRlck5vZGUoZS5yb290LCExKX1jYXB0dXJlSW5jcmVtZW50YWxTbmFwc2hvdCgpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdCBlPXt2ZXJzaW9uOjEsd2luZG93OnRoaXMuX2NoYW5nZWRXaW5kb3csZG9jdW1lbnQ6dGhpcy5fY2hhbmdlZERvY3VtZW50LGlkOnRoaXMuY29udGV4dC5zbmFwc2hvdElkfTt0aGlzLmNvbnRleHQuY2FwdHVyZSgpLHlpZWxkIHRoaXMuY29udGV4dC53YWl0QXN5bmNUYXNrKCk7Y29uc3Qgbj1kZWVwQ2xvbmUoZSk7cmV0dXJuIHRoaXMuX2luaXRJbmNyZW1lbnRhbCgpLHRoaXMuY29udGV4dC5yZXNldCgpLHRoaXMuX2NoYW5nZWREb2N1bWVudC5yb290PXRoaXMucmVuZGVyTm9kZShlLmRvY3VtZW50LnJvb3QsITEpLG59KX1yZW5kZXJOb2RlKGUsbj0hMCl7Y29uc3R7aWQ6cyx0eXBlOm99PWUsYT1uP2RlZXBDbG9uZShlKTp7aWQ6cyx0eXBlOm99O3JldHVybiBpc1ZQYXJlbnROb2RlKGUpJiYoYS5jaGlsZHJlbj10aGlzLl9fcmVuZGVyQ2hpbGRyZW4oZSxuKSksaXNWRWxlbWVudChlKSYmZS5zaGFkb3dSb290JiYoYS5zaGFkb3dSb290PXRoaXMucmVuZGVyTm9kZShlLnNoYWRvd1Jvb3QsbikpLHRoaXMuY29udGV4dC5ub2Rlcy5hZGROb2RlKGUuaWQsYSksYX1fX3JlbmRlckNoaWxkcmVuKGUsbj0hMCl7aWYoZS5jaGlsZHJlbilyZXR1cm4gZS5jaGlsZHJlbi5tYXAocz0+dGhpcy5yZW5kZXJOb2RlKHMsbikpfXBlcmZvcm1BZGROb2RlTXV0YXRpb24oZSl7c3VwZXIucGVyZm9ybUFkZE5vZGVNdXRhdGlvbihlKSx0aGlzLl9jaGFuZ2VkQ291bnQrK31wZXJmb3JtTmF2aWdhdGlvbihlKXt0aGlzLl9jaGFuZ2VkV2luZG93LmxvY2F0aW9uPWUudG99YXBwbHlBdHRycyhlLG4pe2Zvcihjb25zdFtzLG9db2YgT2JqZWN0LmVudHJpZXMoZSkpbi5hdHRyc3x8KG4uYXR0cnM9e30pLG4uYXR0cnNbc109b31hcHBseVNpemUoZSxuKXt0aGlzLl9jaGFuZ2VkV2luZG93LnNpemU9ZSxuJiZ0aGlzLmVtaXQoInJlc2l6ZSIpfXJlYnVpbGROb2RlcyhlKXt0aGlzLl9jaGFuZ2VkRG9jdW1lbnQuaWQhPW51bGwmJmUuYWRkTm9kZSh0aGlzLl9jaGFuZ2VkRG9jdW1lbnQucm9vdC5pZCx0aGlzLl9jaGFuZ2VkRG9jdW1lbnQpLHRoaXMuX3JlYnVpbGROb2RlKGUsdGhpcy5fY2hhbmdlZERvY3VtZW50LnJvb3QpfX1jb25zdCBERUZBVUxUX0JMQUNLQk9YX0JVRkZFUl9USU1FPTEyZTQ7Y2xhc3MgQmxhY2tib3hQcm9jZXNzb3IgZXh0ZW5kcyBBYnN0cmFjdFByb2Nlc3Nvcntjb25zdHJ1Y3RvcihlLG4scyl7dmFyIG8sYTtzdXBlcihlKTtmKHRoaXMsInN1YnNjcmlwdGlvbiIpO2YodGhpcywiX2NvbnRleHRNYXAiLG5ldyBNYXApO2YodGhpcywiX2NhY2hlTGltaXQiKTtmKHRoaXMsIl9zdG9yYWdlIik7Zih0aGlzLCJfYnVmZmVyVGltZSIpO2YodGhpcywiX3JldHJ5Iik7Zih0aGlzLCJfc3RhcnRUaW1lIiwwKTtmKHRoaXMsIl9lbmRUaW1lIiwwKTtmKHRoaXMsIl9lbmRSZWFsVGltZSIsMCk7Zih0aGlzLCJfaGFzUm90YXRlZCIsITEpO2YodGhpcywiX3F1ZXVlIixbXSk7Zih0aGlzLCJfdmlydHVhbFJlbmRlcmVyIixuZXcgVmlydHVhbFNuYXBzaG90UmVuZGVyZXIpO2YodGhpcywiX21hbmFnZXIiKTt0aGlzLl9tYW5hZ2VyPW4sdGhpcy5fcmV0cnk9bmV3IFJldHJ5LHRoaXMuX2J1ZmZlclRpbWU9KHM9PW51bGw/dm9pZCAwOnMuYnVmZmVyVGltZSl8fERFRkFVTFRfQkxBQ0tCT1hfQlVGRkVSX1RJTUUsdGhpcy5fY2FjaGVMaW1pdD0obz1zPT1udWxsP3ZvaWQgMDpzLmNhY2hlKT09bnVsbD92b2lkIDA6by5saW1pdCx0aGlzLl9zdG9yYWdlPShhPXM9PW51bGw/dm9pZCAwOnMuY2FjaGUpPT1udWxsP3ZvaWQgMDphLnN0b3JhZ2VQcm92aWRlci5nZXRTdG9yYWdlKCl9am9pbihlKXt0aGlzLl9jb250ZXh0TWFwLnNldChlLmlkLGUpfXJlbW92ZShlKXt0aGlzLl9jb250ZXh0TWFwLmRlbGV0ZShlLmlkKX1nZXRTaXplKCl7cmV0dXJuIHRoaXMuX2NvbnRleHRNYXAuc2l6ZX1zdWJzY3JpYmUoZSl7dGhpcy5zdWJzY3JpcHRpb249ZS5zdWJzY3JpYmUobj0+e3RoaXMuaGFuZGxlSW5wdXQobil9KX1oYW5kbGVGcmFtZShlKXt0aGlzLl9lbnF1ZXVlKGUpfWNhY2hlKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2NvbnN0IGU9W107aWYodGhpcy5fc3RvcmFnZSYmdGhpcy5fY29udGV4dE1hcC5zaXplPjApe2NvbnN0IG49eWllbGQgdGhpcy5fY3JlYXRlRnJhbWVzKCk7Zm9yKGNvbnN0W3Msb11vZiB0aGlzLl9jb250ZXh0TWFwLmVudHJpZXMoKSl7Y29uc3QgYT10aGlzLl9jcmVhdGVSZWNvcmRpbmdPcHRpb25zKHMsbyksYz17aWQ6YS5pZCxmcmFtZXM6bixzdGFydFRpbWU6dGhpcy5fc3RhcnRUaW1lLGVuZFRpbWU6dGhpcy5fZW5kVGltZSxtb2RlOlJlY29yZGluZ01vZGUuQmxhY2tib3gscmVjb3JkaW5nT3B0aW9uczphfTt5aWVsZCB0aGlzLl9zdG9yYWdlLmRlbGV0ZVJlY29yZGluZ3MoYykseWllbGQgdGhpcy5fc3RvcmFnZS5wdXRSZWNvcmRpbmdzKFtjXSx0aGlzLl9jYWNoZUxpbWl0KSxlLnB1c2goYy5pZCl9fXJldHVybiBlfSl9ZHVtcChlLG4pe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdCBzPXRoaXMuX2NvbnRleHRNYXAuZ2V0KGUpO2lmKCFzKXRocm93IG5ldyBFcnJvcigiTm90IGV4aXN0cyBibGFja2JveCByZWNvcmRpbmciKTtjb25zdCBvPXRoaXMuX2NyZWF0ZVJlY29yZGluZ09wdGlvbnMoZSxzLG4pLHtyZWNvcmRpbmc6YSx0cmFuc3BvcnQ6Y309eWllbGQgY3JlYXRlUmVjb3JkaW5nKHRoaXMuX21hbmFnZXIuYXBpQ2xpZW50LG8pLGw9Yy5zdHJhdGVnaWVzLmZpbmQobT0+bS5tb2RlPT09UmVjb3JkaW5nTW9kZS5CbGFja2JveCYmImNoYW5uZWxUeXBlImluIG0pLHU9eWllbGQgdGhpcy5fY3JlYXRlRnJhbWVzKCksaD15aWVsZCBwYWNrKGVuY29kZSh1LHRoaXMuX3N0YXJ0VGltZSksdS5sZW5ndGgsdVswXS50aW1lLHRoaXMuX2VuZFRpbWUsYS5pZCx0aGlzLl9zdGFydFRpbWUpO3lpZWxkIHRoaXMuX3JldHJ5LmF0dGVtcHQoKCk9PmNyZWF0ZUJsb2NrKHRoaXMuX21hbmFnZXIuYXBpQ2xpZW50LHtibG9iOm5ldyBCbG9iKFtoLmRhdGFdLHt0eXBlOiJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0ifSkscmVjb3JkaW5nSWQ6YS5pZCx0b2tlbjpsLmNvbmZpZy50b2tlbixvZmZzZXQ6aC5mcmFtZVJhbmdlWzBdLGNvdW50OmguZnJhbWVSYW5nZVsxXSxmaXJzdEZyYW1lVGltZTpoLmZpcnN0RnJhbWVUaW1lLGxhc3RGcmFtZVRpbWU6aC5sYXN0RnJhbWVUaW1lfSkpO2NvbnN0IHA9Yy5zdHJhdGVnaWVzLmZpbmQobT0+bS5uYW1lPT09ImJsYWNrYm94LXJlY29yZC1kdW1wIik7aWYocCl7Y29uc3QgbT1wLmNvbmZpZztzLmR1bXBDb25maWc9bX1lbHNlIHMuZHVtcENvbmZpZz17aWQ6Z2VuZXJhdGVVVUlEKCksdG9rZW46by50b2tlbn07cmV0dXJue2lkOmEuaWQsbW9kZTpSZWNvcmRpbmdNb2RlLkJsYWNrYm94LGNyZWF0ZVRpbWU6bmV3IERhdGUoYS5jcmVhdGVUaW1lKS5nZXRUaW1lKCksbWV0YTphLm1ldGEsZW52aXJvbm1lbnQ6YS5lbnZpcm9ubWVudH19KX1kaXNwb3NlKCl7dmFyIGU7KGU9dGhpcy5zdWJzY3JpcHRpb24pPT1udWxsfHxlLnVuc3Vic2NyaWJlKCksdGhpcy5fcXVldWUuc3BsaWNlKDAsdGhpcy5fcXVldWUubGVuZ3RoKSx0aGlzLl92aXJ0dWFsUmVuZGVyZXIucmVzZXQoKSx0aGlzLl92aXJ0dWFsUmVuZGVyZXI9bmV3IFZpcnR1YWxTbmFwc2hvdFJlbmRlcmVyfV9lbnF1ZXVlKGUpe3RoaXMuX3F1ZXVlLmxlbmd0aD09PTAmJmUudHJhY2tUeXBlPT09VHJhY2tUeXBlLkhUTUwmJmUuZXZlbnQuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5IVE1MU25hcHNob3QmJih0aGlzLl9zdGFydFRpbWU9ZS50aW1lKSx0aGlzLl9xdWV1ZS5wdXNoKGUpLHRoaXMuX3JvdGF0ZShlLnRpbWUpfV9yb3RhdGUoZSl7dGhpcy5fZW5kVGltZT1lLHRoaXMuX2VuZFJlYWxUaW1lPW5vdygpO2NvbnN0IG49ZS10aGlzLl9idWZmZXJUaW1lO2xldCBzO2Zvcig7KHM9dGhpcy5fcXVldWVbMF0pJiZzLnRpbWU8bjspdGhpcy5fcXVldWUuc2hpZnQoKSx0aGlzLl92aXJ0dWFsUmVuZGVyZXIucGVyZm9ybUV2ZW50KHMuZXZlbnQpLHRoaXMuX3N0YXJ0VGltZT1zLnRpbWUsdGhpcy5faGFzUm90YXRlZD0hMDtuPnRoaXMuX3N0YXJ0VGltZSYmKHRoaXMuX3N0YXJ0VGltZT1uKX1fY3JlYXRlUmVjb3JkaW5nT3B0aW9ucyhlLG4scyl7cmV0dXJuIFEoTihOKHt9LHMpLG4uZHVtcENvbmZpZykse2NsaWVudFRpbWU6bmV3IERhdGUoKS50b0lTT1N0cmluZygpLG1vZGU6UmVjb3JkaW5nTW9kZS5CbGFja2JveCxwYXJlbnQ6ZSxyZWZUeXBlOiJibGFja2JveCIsdHJhY2tlcnM6bi50cmFja2VycyxlbnZpcm9ubWVudDpuLnJlY29yZGluZy5lbnZpcm9ubWVudCxtZXRhOk4oTih7fSxuLnJlY29yZGluZy5tZXRhKSxzPT1udWxsP3ZvaWQgMDpzLm1ldGEpfSl9X2NyZWF0ZUZyYW1lcygpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdCBlPW5vdygpLXRoaXMuX2VuZFJlYWxUaW1lLG49dGhpcy5fZW5kVGltZStlO3RoaXMuX3JvdGF0ZShuKTtjb25zdCBzPVsuLi50aGlzLl9xdWV1ZV07aWYocy5sZW5ndGg9PT0wfHx0aGlzLl9oYXNSb3RhdGVkKXtjb25zdCBvPXlpZWxkIHRoaXMuX3ZpcnR1YWxSZW5kZXJlci5jYXB0dXJlU25hcHNob3QoKSxhPXt0cmFja1R5cGU6VHJhY2tUeXBlLkhUTUwsdGltZTp0aGlzLl9zdGFydFRpbWUsZXZlbnQ6e2V2ZW50VHlwZTpUcmFja2VyRXZlbnRUeXBlLkhUTUxTbmFwc2hvdCxkYXRhOm99fTtzLnVuc2hpZnQoYSl9cmV0dXJuIHN9KX19Y2xhc3MgQ29udHJvbGxlciBleHRlbmRzIEFic3RyYWN0Rmxvd3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyk7Zih0aGlzLCJfYnVmZmVyIixuZXcgQXJyYXkpO2YodGhpcywiX3N1c3BlbmQiLCExKX1nZXQgaXNTdXNwZW5kKCl7cmV0dXJuIHRoaXMuX3N1c3BlbmR9c3VzcGVuZCgpe3RoaXMuX3N1c3BlbmQ9ITB9cmVzdW1lKCl7bGV0IGU9dGhpcy5fYnVmZmVyLnNoaWZ0KCk7Zm9yKDtlOyl0aGlzLm91dHB1dChlKSxlPXRoaXMuX2J1ZmZlci5zaGlmdCgpO3RoaXMuX3N1c3BlbmQ9ITF9aGFuZGxlSW5wdXQoZSl7dGhpcy5pc1N1c3BlbmQ/dGhpcy5fYnVmZmVyLnB1c2goZSk6dGhpcy5vdXRwdXQoZSl9fWNvbnN0IE9ORV9QSVhFTF9UUkFOU1BBUkVOVD0iZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3IjtmdW5jdGlvbiBjcmVhdGVGcmFtZUZyb21FdmVudChyLHQsZSl7cmV0dXJue3RpbWU6ZSx0cmFja1R5cGU6cixldmVudDp0fX1mdW5jdGlvbiBnZXRNb3VzZVBvc2l0aW9uKHIpe2NvbnN0W3QsZV09ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlRG93bnx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlTW92ZXx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlVXB8fHIuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5Nb3VzZUNsaWNrP3IuZGF0YTpyLmRhdGFbMF07cmV0dXJuW3QsZV19ZnVuY3Rpb24gZ2V0TW91c2VUYXJnZXRJZChyKXtyZXR1cm4oci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlRG93bnx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlTW92ZXx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlVXB8fHIuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5Nb3VzZUNsaWNrP3IuZGF0YTpyLmRhdGFbMF0pWzNdfWZ1bmN0aW9uIGdldE1vdXNlVGFyZ2V0Q29udGV4dChyKXtyZXR1cm4oci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlRG93bnx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlTW92ZXx8ci5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlVXB8fHIuZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5Nb3VzZUNsaWNrP3IuZGF0YTpyLmRhdGFbMF0pWzRdfWNsYXNzIEhUTUxEYXRhTWFza3tjb25zdHJ1Y3Rvcih0LGUpe2YodGhpcywiX3JlbmRlcmVyIik7Zih0aGlzLCJfdGV4dERhdGFNYXNrIik7Zih0aGlzLCJfbmFtZURhdGFNYXNrIik7Zih0aGlzLCJfY29tbW9uRGF0YU1hc2siKTtmKHRoaXMsIl9zdHJpY3QiLCExKTt0aGlzLl9yZW5kZXJlcj10LHRoaXMuX25hbWVEYXRhTWFzaz1uZXcgQ29tYmluZWREYXRhTWFzayhuZXcgQ2hpbmVzZU5hbWVEYXRhTWFzayxuZXcgRW5nbGlzaE5hbWVEYXRhTWFzayksdGhpcy5fdGV4dERhdGFNYXNrPW5ldyBUZXh0RGF0YU1hc2s7Y29uc3R7ZGlzYWJsZUJ1aWx0SW5EYXRhTWFza3M6bj0hMSxkYXRhTWFza3M6cz1bXSxtYXNraW5nTGV2ZWw6bz1EYXRhTWFza2luZ0xldmVsLkJBTEFOQ0V9PWU7dGhpcy5fc3RyaWN0PW89PT1EYXRhTWFza2luZ0xldmVsLlNUUklDVCxufHwodGhpcy5fc3RyaWN0P3RoaXMuX2NvbW1vbkRhdGFNYXNrPW5ldyBUZXh0RGF0YU1hc2s6dGhpcy5fY29tbW9uRGF0YU1hc2s9bmV3IENvbWJpbmVkRGF0YU1hc2sobmV3IEVtYWlsRGF0YU1hc2ssbmV3IElEQ2FyZERhdGFNYXNrLG5ldyBJUEFkZHJlc3NEYXRhTWFzayxuZXcgTGljZW5zZVBsYXRlRGF0YU1hc2ssbmV3IE1BQ0FkZHJlc3NEYXRhTWFzayxuZXcgVklORGF0YU1hc2ssbmV3IE1vYmlsZVBob25lRGF0YU1hc2ssbmV3IEJhbmtBY2NvdW50RGF0YU1hc2spKSxzLmxlbmd0aD4wJiYodGhpcy5fY29tbW9uRGF0YU1hc2s9dGhpcy5fY29tbW9uRGF0YU1hc2s/bmV3IENvbWJpbmVkRGF0YU1hc2soLi4ucyx0aGlzLl9jb21tb25EYXRhTWFzayk6bmV3IENvbWJpbmVkRGF0YU1hc2soLi4ucykpfW1hc2sodCl7dmFyIHMsbztjb25zdHtkYXRhOmUsZXZlbnRUeXBlOm59PXQuZXZlbnQ7aWYobj09PVRyYWNrZXJFdmVudFR5cGUuSFRNTFNuYXBzaG90KWlzU3RyaW5nKGUuZG9jdW1lbnQudGl0bGUpJiYodGhpcy5fY29tbW9uRGF0YU1hc2smJihlLmRvY3VtZW50LnRpdGxlPXRoaXMuX2NvbW1vbkRhdGFNYXNrLm1hc2soZS5kb2N1bWVudC50aXRsZSkpLHRoaXMubWFza0VsZW1lbnQoZS5kb2N1bWVudC5yb290KSk7ZWxzZSBpZihuPT09VHJhY2tlckV2ZW50VHlwZS5IVE1MTXV0YXRpb25zKWUuZm9yRWFjaChhPT57dmFyIGMsbCx1LGg7aWYoYS50eXBlPT09Vk11dGF0aW9uVHlwZS5BZGROb2RlKXRoaXMubWFza0VsZW1lbnQoYS5kYXRhLm5vZGUsdGhpcy5fcmVuZGVyZXIuZ2V0Tm9kZShhLnRhcmdldCkpO2Vsc2UgaWYoYS50eXBlPT09Vk11dGF0aW9uVHlwZS5DaGFuZ2VBdHRyaWJ1dGVzKWEuZGF0YT10aGlzLm1hc2tBdHRyaWJ1dGUoYS5kYXRhLHRoaXMuX3JlbmRlcmVyLmdldE5vZGUoYS50YXJnZXQpKTtlbHNlIGlmKGEudHlwZT09PVZNdXRhdGlvblR5cGUuQ2hhcmFjdGVyRGF0YSYmaXNTdHJpbmcoYS5kYXRhKSl7bGV0IHA7Y29uc3QgbT10aGlzLl9yZW5kZXJlci5nZXROb2RlKGEudGFyZ2V0KTttJiZpc1ZUZXh0Tm9kZShtKSYmbS5wYXJlbnRJZCE9bnVsbCYmKHA9dGhpcy5fcmVuZGVyZXIuZ2V0Tm9kZShtLnBhcmVudElkKSksKChjPW09PW51bGw/dm9pZCAwOm0uYXR0cnMpPT1udWxsP3ZvaWQgMDpjW0RBVEFfTUFTS10pPT09REFUQV9NQVNLX01BUC5uYW1lfHwoKGw9cD09bnVsbD92b2lkIDA6cC5hdHRycyk9PW51bGw/dm9pZCAwOmxbREFUQV9NQVNLXSk9PT1EQVRBX01BU0tfTUFQLm5hbWU/YS5kYXRhPXRoaXMuX25hbWVEYXRhTWFzay5tYXNrKGEuZGF0YSk6aW5jbHVkZXMoREFUQV9NQVNLX0VNUFRZLCh1PW09PW51bGw/dm9pZCAwOm0uYXR0cnMpPT1udWxsP3ZvaWQgMDp1W0RBVEFfTUFTS10pfHxpbmNsdWRlcyhEQVRBX01BU0tfRU1QVFksKGg9cD09bnVsbD92b2lkIDA6cC5hdHRycyk9PW51bGw/dm9pZCAwOmhbREFUQV9NQVNLXSk/YS5kYXRhPXRoaXMuX3RleHREYXRhTWFzay5tYXNrKGEuZGF0YSk6dGhpcy5fY29tbW9uRGF0YU1hc2smJighcHx8IWlzVlN0eWxlRWxlbWVudChwKSkmJihhLmRhdGE9dGhpcy5fY29tbW9uRGF0YU1hc2subWFzayhhLmRhdGEpKX19KTtlbHNlIGlmKG49PT1UcmFja2VyRXZlbnRUeXBlLkhUTUxWYWx1ZUNoYW5nZSYmaXNTdHJpbmcoZS52YWx1ZSkpe2NvbnN0IGE9dGhpcy5fcmVuZGVyZXIuZ2V0Tm9kZShlLnRhcmdldCk7KChzPWE9PW51bGw/dm9pZCAwOmEuYXR0cnMpPT1udWxsP3ZvaWQgMDpzW0RBVEFfTUFTS10pPT09REFUQV9NQVNLX01BUC5uYW1lP2UudmFsdWU9dGhpcy5fbmFtZURhdGFNYXNrLm1hc2soZS52YWx1ZSk6aW5jbHVkZXMoREFUQV9NQVNLX0VNUFRZLChvPWE9PW51bGw/dm9pZCAwOmEuYXR0cnMpPT1udWxsP3ZvaWQgMDpvW0RBVEFfTUFTS10pP2UudmFsdWU9dGhpcy5fdGV4dERhdGFNYXNrLm1hc2soZS52YWx1ZSk6dGhpcy5fY29tbW9uRGF0YU1hc2smJihlLnZhbHVlPXRoaXMuX2NvbW1vbkRhdGFNYXNrLm1hc2soZS52YWx1ZSkpfXJldHVybiB0fW1hc2tFbGVtZW50KHQsZSl7dmFyIG4scyxvLGEsYztpZighX2lzSWdub3JlZChlKSYmIV9pc0lnbm9yZWQodCkpe2xldCBsPXRoaXMuX2NvbW1vbkRhdGFNYXNrOygobj10LmF0dHJzKT09bnVsbD92b2lkIDA6bltEQVRBX01BU0tdKT09PURBVEFfTUFTS19NQVAubmFtZXx8KChzPWU9PW51bGw/dm9pZCAwOmUuYXR0cnMpPT1udWxsP3ZvaWQgMDpzW0RBVEFfTUFTS10pPT09REFUQV9NQVNLX01BUC5uYW1lP2w9dGhpcy5fbmFtZURhdGFNYXNrOihpbmNsdWRlcyhEQVRBX01BU0tfRU1QVFksKG89dC5hdHRycyk9PW51bGw/dm9pZCAwOm9bREFUQV9NQVNLXSl8fGluY2x1ZGVzKERBVEFfTUFTS19FTVBUWSwoYT1lPT1udWxsP3ZvaWQgMDplLmF0dHJzKT09bnVsbD92b2lkIDA6YVtEQVRBX01BU0tdKSkmJihsPXRoaXMuX3RleHREYXRhTWFzayksbCYmdGhpcy5fbWFza0VsZW1lbnQobCx0KSwoYz10LmNoaWxkcmVuKT09bnVsbHx8Yy5mb3JFYWNoKHU9PnRoaXMubWFza0VsZW1lbnQodSx0KSl9fW1hc2tBdHRyaWJ1dGUodCxlKXt2YXIgbixzO2lmKCFfaXNJZ25vcmVkKGUpKXtsZXQgbz10aGlzLl9jb21tb25EYXRhTWFzaztpZigoKG49ZT09bnVsbD92b2lkIDA6ZS5hdHRycyk9PW51bGw/dm9pZCAwOm5bREFUQV9NQVNLXSk9PT1EQVRBX01BU0tfTUFQLm5hbWU/bz10aGlzLl9uYW1lRGF0YU1hc2s6aW5jbHVkZXMoREFUQV9NQVNLX0VNUFRZLChzPWU9PW51bGw/dm9pZCAwOmUuYXR0cnMpPT1udWxsP3ZvaWQgMDpzW0RBVEFfTUFTS10pJiYobz10aGlzLl90ZXh0RGF0YU1hc2spLG8pcmV0dXJuIHRoaXMuX21hc2tBdHRyaWJ1dGUobyx0LGUpfXJldHVybiB0fV9tYXNrRWxlbWVudCh0LGUpe2NvbnN0e3RleHQ6bix2YWx1ZTpzfT1lO2lzU3RyaW5nKG4pJiYoZS50ZXh0PXQubWFzayhuKSksaXNTdHJpbmcocykmJihlLnZhbHVlPXQubWFzayhzKSksZS5hdHRycz10aGlzLl9tYXNrQXR0cmlidXRlKHQsZS5hdHRycyxlKX1fbWFza0F0dHJpYnV0ZSh0LGUsbil7aWYoIWUpcmV0dXJuIGU7Y29uc3Qgcz1OKHt9LGUpO2Zvcihjb25zdCBvIG9mWyJ2YWx1ZSIsInRpdGxlIiwiYXJpYS1sYWJlbCIsImFyaWEtdmFsdWV0ZXh0IiwicGxhY2Vob2xkZXIiLCJhbHQiXSl7Y29uc3QgYT1zW29dO2lzU3RyaW5nKGEpJiYoc1tvXT10Lm1hc2soYSkpfWlmKCF0aGlzLl9zdHJpY3QpcmV0dXJuIHM7aWYoKG49PW51bGw/dm9pZCAwOm4udGFnKT09PSJJTUciPyhzLnNyYz1PTkVfUElYRUxfVFJBTlNQQVJFTlQsZGVsZXRlIHMuc3Jjc2V0KToobj09bnVsbD92b2lkIDA6bi50YWcpPT09IlNPVVJDRSI/ZGVsZXRlIHMuc3JjOihuPT1udWxsP3ZvaWQgMDpuLnRhZyk9PT0iQSImJmRlbGV0ZSBzLmhyZWYscy5zdHlsZSl7Y29uc3Qgbz0vdXJsXChbJyJdPyhbXiciKV0rKVsnIl0/XCkvZztzLnN0eWxlPXMuc3R5bGUucmVwbGFjZShvLGZ1bmN0aW9uKGEsYyl7cmV0dXJuL1wuKHBuZ3xqcGU/Z3xnaWZ8d2VicHxibXB8dGlmZnxzdmcpKFw/LiopPyQvaS50ZXN0KGMpP2B1cmwoJHtPTkVfUElYRUxfVFJBTlNQQVJFTlR9KWA6YX0pfXJldHVybiBzfX1jb25zdCBJR05PUkVEX1RBR1M9e1NUWUxFOiEwLFNDUklQVDohMCxzdmc6ITB9O2Z1bmN0aW9uIF9pc0lnbm9yZWQocil7cmV0dXJuKHI9PW51bGw/dm9pZCAwOnIudHlwZSk9PT1WTm9kZVR5cGUuQ29tbWVudE5vZGU/ITA6KHI9PW51bGw/dm9pZCAwOnIudGFnKSE9bnVsbD9JR05PUkVEX1RBR1Nbci50YWddOiExfWNsYXNzIEhUTUxQcm9jZXNzb3IgZXh0ZW5kcyBBYnN0cmFjdFByb2Nlc3Nvcntjb25zdHJ1Y3RvcihlLG4pe3N1cGVyKGUsVHJhY2tUeXBlLkhUTUwpO2YodGhpcywiX2xhc3RTbmFwc2hvdFRpbWUiLC0xKTtmKHRoaXMsIl92aXJ0dWFsUmVuZGVyZXIiKTtmKHRoaXMsIl9jYXB0dXJlckF3YWl0IixudWxsKTtmKHRoaXMsIl9jYWxsYmFja3MiLG5ldyBBcnJheSk7Zih0aGlzLCJfZGF0YU1hc2siKTt0aGlzLl92aXJ0dWFsUmVuZGVyZXI9bmV3IFZpcnR1YWxTbmFwc2hvdFJlbmRlcmVyLHRoaXMuX2NvbnRleHQudmlydHVhbFJlbmRlcmVyPXRoaXMuX3ZpcnR1YWxSZW5kZXJlcix0aGlzLnN5bmNPcHRpb25zKG4pfXN5bmNPcHRpb25zKGUpe2UhPW51bGwmJmUuZGlzYWJsZURhdGFNYXNraW5nP3RoaXMuX2RhdGFNYXNrPXZvaWQgMDp0aGlzLl9kYXRhTWFzaz1uZXcgSFRNTERhdGFNYXNrKHRoaXMuX3ZpcnR1YWxSZW5kZXJlcix7ZGlzYWJsZURhdGFNYXNraW5nOmU9PW51bGw/dm9pZCAwOmUuZGlzYWJsZURhdGFNYXNraW5nLGRpc2FibGVCdWlsdEluRGF0YU1hc2tzOmU9PW51bGw/dm9pZCAwOmUuZGlzYWJsZUJ1aWx0SW5EYXRhTWFza3MsZGF0YU1hc2tzOmU9PW51bGw/dm9pZCAwOmUuZGF0YU1hc2tzLG1hc2tpbmdMZXZlbDplPT1udWxsP3ZvaWQgMDplLm1hc2tpbmdMZXZlbH0pfWNhcHR1cmVTbmFwc2hvdEZyYW1lKGUpe2lmKHRoaXMuX2xhc3RTbmFwc2hvdFRpbWU9PT0tMSl7ZShudWxsKTtyZXR1cm59cmV0dXJuIHRoaXMuX2NhbGxiYWNrcy5wdXNoKGUpLHRoaXMuX2NhcHR1cmVyQXdhaXQ/dGhpcy5fY2FwdHVyZXJBd2FpdDoodGhpcy5fY29udGV4dC5jb250cm9sbGVyLnN1c3BlbmQoKSx0aGlzLl9jYXB0dXJlckF3YWl0PSgoKT0+Yih0aGlzLG51bGwsZnVuY3Rpb24qKCl7dHJ5e2NvbnN0IG49eWllbGQgdGhpcy5fdmlydHVhbFJlbmRlcmVyLmNhcHR1cmVTbmFwc2hvdCgpO3RoaXMuX2xhc3RTbmFwc2hvdFRpbWU9dGltZS5ub3coKTtjb25zdCBzPXt0cmFja1R5cGU6VHJhY2tUeXBlLkhUTUwsdGltZTp0aGlzLl9sYXN0U25hcHNob3RUaW1lLGV2ZW50OntldmVudFR5cGU6VHJhY2tlckV2ZW50VHlwZS5IVE1MU25hcHNob3QsZGF0YTpufX07dGhpcy5fY2FsbGJhY2tzLmZvckVhY2gobz0+e28ocyl9KSx0aGlzLl9jYWxsYmFja3M9bmV3IEFycmF5fWNhdGNoKG4pe2NvbnNvbGUuZXJyb3IoIkNhcHR1cmUgdmlydHVhbCBzbmFwc2hvdCBlcnJvciIsbil9dGhpcy5fY29udGV4dC5jb250cm9sbGVyLnJlc3VtZSgpLHRoaXMuX2NhcHR1cmVyQXdhaXQ9bnVsbH0pKSgpLHRoaXMuX2NhcHR1cmVyQXdhaXQpfW91dHB1dFNuYXBzaG90RnJhbWUoKXt0aGlzLmNhcHR1cmVTbmFwc2hvdEZyYW1lKGU9PntlJiZ0aGlzLm91dHB1dChlKX0pfWhhbmRsZUZyYW1lKGUpe2NvbnN0IG49ZS5ldmVudDt0aGlzLl92aXJ0dWFsUmVuZGVyZXIucGVyZm9ybUV2ZW50KG4pLG4uZXZlbnRUeXBlPT09VHJhY2tlckV2ZW50VHlwZS5IVE1MU25hcHNob3QmJih0aGlzLl9sYXN0U25hcHNob3RUaW1lPWUudGltZSksdGhpcy5vdXRwdXQodGhpcy5fZGF0YU1hc2s/dGhpcy5fZGF0YU1hc2subWFzayhlKTplKX19Y29uc3QgTUlOVVRFPTYwKjFlMyxPTkVfVElDSz0xZS02O2NsYXNzIEluY3JlbWVudGFsUHJvY2Vzc29yIGV4dGVuZHMgQWJzdHJhY3RQcm9jZXNzb3J7Y29uc3RydWN0b3IoZSxuKXtzdXBlcihlLFRyYWNrVHlwZS5IVE1MKTtmKHRoaXMsIl9yZWNvcmRpbmdDb250ZXh0Iik7Zih0aGlzLCJpbmNyZW1lbnRhbFNuYXBzaG90UmVuZGVyZXIiLG5ldyBJbmNyZW1lbnRhbFNuYXBzaG90UmVuZGVyZXIpO2YodGhpcywiX2luZGV4IiwwKTtmKHRoaXMsIl9sYXN0U25hcHNob3RUaW1lIik7Zih0aGlzLCJfY2FwdHVyZXJBd2FpdCIsbnVsbCk7dGhpcy5fcmVjb3JkaW5nQ29udGV4dD1ufWhhbmRsZUZyYW1lKGUpe2NvbnN0IG49ZS5ldmVudDtpZih0aGlzLmluY3JlbWVudGFsU25hcHNob3RSZW5kZXJlci5wZXJmb3JtRXZlbnQobiksbi5ldmVudFR5cGU9PT1UcmFja2VyRXZlbnRUeXBlLkhUTUxTbmFwc2hvdCYmKHRoaXMuX2xhc3RTbmFwc2hvdFRpbWU9ZS50aW1lKSx0aGlzLm91dHB1dChlKSx0aGlzLl9sYXN0U25hcHNob3RUaW1lJiZ0aGlzLl9yZWNvcmRpbmdDb250ZXh0Lm5vdy10aGlzLl9sYXN0U25hcHNob3RUaW1lPjIqTUlOVVRFJiZ0aGlzLmluY3JlbWVudGFsU25hcHNob3RSZW5kZXJlci5nZXRJbmNyZW1lbnRhbFBlcmNlbnQoKT4uMyl7Y29uc3Qgbz1lLnRpbWU7dGhpcy5fY3JlYXRlSW5jcmVtZW50YWxTbmFwc2hvdChvKX19X2NyZWF0ZUluY3JlbWVudGFsU25hcHNob3QoZSl7cmV0dXJuIHRoaXMuX2NhcHR1cmVyQXdhaXQ/dGhpcy5fY2FwdHVyZXJBd2FpdDoodGhpcy5fY29udGV4dC5jb250cm9sbGVyLnN1c3BlbmQoKSx0aGlzLl9jYXB0dXJlckF3YWl0PSgoKT0+Yih0aGlzLG51bGwsZnVuY3Rpb24qKCl7dHJ5e3RoaXMuX2xhc3RTbmFwc2hvdFRpbWU9ZTtjb25zdCBuPXlpZWxkIHRoaXMuaW5jcmVtZW50YWxTbmFwc2hvdFJlbmRlcmVyLmNhcHR1cmVJbmNyZW1lbnRhbFNuYXBzaG90KCkscz0rK3RoaXMuX2luZGV4LG89e3RyYWNrVHlwZTpUcmFja1R5cGUuSFRNTCx0aW1lOmUrT05FX1RJQ0ssZXZlbnQ6e2V2ZW50VHlwZTpUcmFja2VyRXZlbnRUeXBlLkhUTUxJbmNyZW1lbnRhbFNuYXBzaG90LGRhdGE6e3NuYXBzaG90Om4saW5kZXg6c319fTt0aGlzLm91dHB1dChvKX1jYXRjaChuKXtjb25zb2xlLmVycm9yKCJDYXB0dXJlIHZpcnR1YWwgc25hcHNob3QgZXJyb3IiLG4pfXRoaXMuX2NvbnRleHQuY29udHJvbGxlci5yZXN1bWUoKSx0aGlzLl9jYXB0dXJlckF3YWl0PW51bGx9KSkoKSx0aGlzLl9jYXB0dXJlckF3YWl0KX19Y2xhc3MgQWJzdHJhY3RJbnNpZ2h0RGV0ZWN0b3IgZXh0ZW5kcyBFdmVudEVtaXR0ZXJ7Y29uc3RydWN0b3IoZSl7c3VwZXIoKTtmKHRoaXMsIl9jb25maWciKTt0aGlzLnNldE9wdGlvbnMoZSl9c2V0T3B0aW9ucyhlKXt0aGlzLl9jb25maWc9TihOKHt9LHRoaXMuZ2V0RGVmYXVsdE9wdGlvbnMoKSksZSl9Z2V0RGVmYXVsdE9wdGlvbnMoKXtyZXR1cm57fX19Y2xhc3MgRGVhZENsaWNrRGV0ZWN0b3IgZXh0ZW5kcyBBYnN0cmFjdEluc2lnaHREZXRlY3Rvcntjb25zdHJ1Y3RvcihlLG4pe3N1cGVyKG4pO2YodGhpcywiX0hBTkRMRURfRlJBTUVTIixuZXcgU2V0KFtUcmFja1R5cGUuSFRNTCxUcmFja1R5cGUuTW91c2UsVHJhY2tUeXBlLk5ldHdvcmtdKSk7Zih0aGlzLCJfSUdOT1JFRF9FVkVOVFMiLG5ldyBTZXQoW1RyYWNrZXJFdmVudFR5cGUuSFRNTFNuYXBzaG90LFRyYWNrZXJFdmVudFR5cGUuSFRNTEluY3JlbWVudGFsU25hcHNob3QsVHJhY2tlckV2ZW50VHlwZS5IVE1MSUZyYW1lLFRyYWNrZXJFdmVudFR5cGUuTW91c2VNb3ZlLFRyYWNrZXJFdmVudFR5cGUuTW91c2VEb3duLFRyYWNrZXJFdmVudFR5cGUuTW91c2VVcCxUcmFja2VyRXZlbnRUeXBlLlRvdWNoU3RhcnQsVHJhY2tlckV2ZW50VHlwZS5Ub3VjaE1vdmUsVHJhY2tlckV2ZW50VHlwZS5Ub3VjaEVuZCxUcmFja2VyRXZlbnRUeXBlLlRvdWNoQ2FuY2VsLFRyYWNrZXJFdmVudFR5cGUuTkVUV09SS19BQk9SVCxUcmFja2VyRXZlbnRUeXBlLk5FVFdPUktfRE9ORSxUcmFja2VyRXZlbnRUeXBlLk5FVFdPUktfRVJST1IsVHJhY2tlckV2ZW50VHlwZS5ORVRXT1JLX1RJTUVPVVRdKSk7Zih0aGlzLCJfdlJlbmRlcmVyIik7Zih0aGlzLCJfc3Vic2VxdWVudEZyYW1lcyIsW10pO2YodGhpcywiX3RpbWVyIik7dGhpcy5fdlJlbmRlcmVyPWV9Z2V0RGVmYXVsdE9wdGlvbnMoKXtyZXR1cm57Y2hhbmdlc1RocmVzaG9sZDoxLHRpbWVvdXRUaHJlc2hvbGQ6NTAwfX1oYW5kbGUoZSl7Y29uc3R7dHJhY2tUeXBlOm4sZXZlbnQ6c309ZSxvPXMuZXZlbnRUeXBlO2lmKCEoaXNDdXN0b21UcmFja1R5cGUobil8fCF0aGlzLl9IQU5ETEVEX0ZSQU1FUy5oYXMobil8fHRoaXMuX0lHTk9SRURfRVZFTlRTLmhhcyhvKSkmJiEodGhpcy5fdGltZXI9PW51bGwmJm8hPT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlQ2xpY2spKXtpZihvPT09VHJhY2tlckV2ZW50VHlwZS5Nb3VzZUNsaWNrKXt0aGlzLl9zdG9wKCk7Y29uc3QgYT1zLmRhdGFbM107aWYoYSE9bnVsbCl7Y29uc3QgYz10aGlzLl92UmVuZGVyZXIuZ2V0Tm9kZShhKTsoYz09bnVsbD92b2lkIDA6Yy50eXBlKT09PVZOb2RlVHlwZS5FbGVtZW50Tm9kZSYmdGhpcy5fc2hvdWxkSGFuZGxlKGMpJiZ0aGlzLl9zdGFydChlKX1yZXR1cm59dGhpcy5fc3Vic2VxdWVudEZyYW1lcy5wdXNoKGUpfX1fc3RhcnQoZSl7dGhpcy5fc3Vic2VxdWVudEZyYW1lcy5wdXNoKGUpLHRoaXMuX3RpbWVyPXNldFRpbWVvdXQoKCk9PntpZih0aGlzLl9zdWJzZXF1ZW50RnJhbWVzLmxlbmd0aC0xPHRoaXMuX2NvbmZpZy5jaGFuZ2VzVGhyZXNob2xkKXtjb25zdCBzPXRoaXMuX3N1YnNlcXVlbnRGcmFtZXNbMF0sW28sYSxjLGwsdV09cy5ldmVudC5kYXRhLGg9e2R1cmF0aW9uOnRpbWUubm93KCktcy50aW1lLHg6byx5OmEsYnV0dG9uczpjfTtsIT1udWxsJiYoaC50YXJnZXRJZD1sKSx1IT1udWxsJiYoaC5jb250ZXh0PXUpLHRoaXMuZW1pdCgiZGV0ZWN0ZWQiLGgpfXRoaXMuX3N0b3AoKX0sdGhpcy5fY29uZmlnLnRpbWVvdXRUaHJlc2hvbGQpfV9zdG9wKCl7dGhpcy5fdGltZXIhPW51bGwmJih0aGlzLl9zdWJzZXF1ZW50RnJhbWVzPVtdLGNsZWFyVGltZW91dCh0aGlzLl90aW1lciksdGhpcy5fdGltZXI9dm9pZCAwKX1fc2hvdWxkSGFuZGxlKGUpe2NvbnN0e3RhZzpuLGF0dHJzOnN9PWU7cmV0dXJuIG49PT0iQSJ8fG49PT0iQlVUVE9OInx8bj09PSJJTlBVVCImJnMhPW51bGwmJihzLnR5cGU9PT0iYnV0dG9uInx8cy50eXBlPT09ImNoZWNrYm94Inx8cy50eXBlPT09InN1Ym1pdCJ8fHMudHlwZT09PSJyYWRpbyImJiFlLmNoZWNrZWQpfX1jbGFzcyBFeGNlc3NpdmVTY3JvbGxpbmdEZXRlY3RvciBleHRlbmRzIEFic3RyYWN0SW5zaWdodERldGVjdG9ye2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKTtmKHRoaXMsIl9kaXN0YW5jZSIsMCk7Zih0aGlzLCJfc3RhcnRUaW1lIik7Zih0aGlzLCJfbGFzdFNjcm9sbCIpfWdldERlZmF1bHRPcHRpb25zKCl7cmV0dXJue3Njcm9sbFRocmVzaG9sZDoxZTMsdGltZW91dFRocmVzaG9sZDozZTN9fWhhbmRsZShlKXt2YXIgYSxjLGw7aWYoZS5ldmVudC5ldmVudFR5cGUhPT1UcmFja2VyRXZlbnRUeXBlLkhUTUxTY3JvbGwpcmV0dXJuO2NvbnN0IG49ZS5ldmVudC5kYXRhLHtzY3JvbGw6cyx0YXJnZXQ6b309bjtpZih0aGlzLl9zdGFydFRpbWU9PW51bGwmJih0aGlzLl9zdGFydFRpbWU9dGltZS5ub3coKSksKChhPXRoaXMuX2xhc3RTY3JvbGwpPT1udWxsP3ZvaWQgMDphLnRhcmdldCkhPT1vKXRoaXMuX2Rpc3RhbmNlPTAsdGhpcy5fc3RhcnRUaW1lPXRpbWUubm93KCksdGhpcy5fbGFzdFNjcm9sbD1uO2Vsc2V7Y29uc3QgdT10aW1lLm5vdygpLXRoaXMuX3N0YXJ0VGltZTt1Pj10aGlzLl9jb25maWcudGltZW91dFRocmVzaG9sZD90aGlzLl9yZXNldCgpOih0aGlzLl9kaXN0YW5jZSs9TWF0aC5hYnMoc1sxXS0oKGw9KGM9dGhpcy5fbGFzdFNjcm9sbCk9PW51bGw/dm9pZCAwOmMuc2Nyb2xsWzFdKSE9bnVsbD9sOjApKSx0aGlzLl9kaXN0YW5jZT49dGhpcy5fY29uZmlnLnNjcm9sbFRocmVzaG9sZD8odGhpcy5lbWl0KCJkZXRlY3RlZCIse2Rpc3RhbmNlOnRoaXMuX2Rpc3RhbmNlLGR1cmF0aW9uOnUsdGFyZ2V0SWQ6b30pLHRoaXMuX3Jlc2V0KCkpOnRoaXMuX2xhc3RTY3JvbGw9bil9fV9yZXNldCgpe3RoaXMuX2Rpc3RhbmNlPTAsdGhpcy5fc3RhcnRUaW1lPXZvaWQgMCx0aGlzLl9sYXN0U2Nyb2xsPXZvaWQgMH19Y2xhc3MgTG9uZ0hvdmVyRGV0ZWN0b3IgZXh0ZW5kcyBBYnN0cmFjdEluc2lnaHREZXRlY3Rvcntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyk7Zih0aGlzLCJfSEFORExFRF9GUkFNRVMiLG5ldyBTZXQoW1RyYWNrVHlwZS5IVE1MLFRyYWNrVHlwZS5Nb3VzZSxUcmFja1R5cGUuS2V5Ym9hcmRdKSk7Zih0aGlzLCJfSUdOT1JFRF9FVkVOVFMiLG5ldyBTZXQoW1RyYWNrZXJFdmVudFR5cGUuSFRNTFNuYXBzaG90LFRyYWNrZXJFdmVudFR5cGUuSFRNTE11dGF0aW9ucyxUcmFja2VyRXZlbnRUeXBlLkhUTUxJbmNyZW1lbnRhbFNuYXBzaG90LFRyYWNrZXJFdmVudFR5cGUuSFRNTElGcmFtZV0pKTtmKHRoaXMsIl9sYXN0TW91c2VGcmFtZSIpO2YodGhpcywiX2xhc3RJbnRlcmFjdGlvbiIpO2YodGhpcywiX3RpbWVyIil9Z2V0RGVmYXVsdE9wdGlvbnMoKXtyZXR1cm57dGltZVRocmVzaG9sZDoxZTR9fWhhbmRsZShlKXtjb25zdHt0cmFja1R5cGU6bixldmVudDpzfT1lLG89cy5ldmVudFR5cGU7aWYoIShpc0N1c3RvbVRyYWNrVHlwZShuKXx8IXRoaXMuX0hBTkRMRURfRlJBTUVTLmhhcyhuKXx8dGhpcy5fSUdOT1JFRF9FVkVOVFMuaGFzKG8pKSl7aWYobj09PVRyYWNrVHlwZS5Nb3VzZSYmKHRoaXMuX2xhc3RNb3VzZUZyYW1lPWUpLHRoaXMuX2xhc3RJbnRlcmFjdGlvbj09bnVsbCl7dGhpcy5fc3RhcnQoZSk7cmV0dXJufXRoaXMuX3Jlc3RhcnQoZSl9fV9zdGFydChlKXt0aGlzLl9sYXN0SW50ZXJhY3Rpb249ZSx0aGlzLl90aW1lcj1zZXRUaW1lb3V0KCgpPT57aWYodGhpcy5fbGFzdE1vdXNlRnJhbWUhPW51bGwmJnRoaXMuX2xhc3RJbnRlcmFjdGlvbiE9bnVsbCl7Y29uc3RbbixzXT1nZXRNb3VzZVBvc2l0aW9uKHRoaXMuX2xhc3RNb3VzZUZyYW1lLmV2ZW50KSxvPWdldE1vdXNlVGFyZ2V0SWQodGhpcy5fbGFzdE1vdXNlRnJhbWUuZXZlbnQpLGE9Z2V0TW91c2VUYXJnZXRDb250ZXh0KHRoaXMuX2xhc3RNb3VzZUZyYW1lLmV2ZW50KSxjPXtkdXJhdGlvbjp0aW1lLm5vdygpLXRoaXMuX2xhc3RJbnRlcmFjdGlvbi50aW1lLHg6bix5OnN9O28hPW51bGwmJihjLnRhcmdldElkPW8pLGEhPW51bGwmJihjLmNvbnRleHQ9YSksdGhpcy5lbWl0KCJkZXRlY3RlZCIsYyl9dGhpcy5fc3RvcCgpLHRoaXMuX2xhc3RNb3VzZUZyYW1lPXZvaWQgMH0sdGhpcy5fY29uZmlnLnRpbWVUaHJlc2hvbGQpfV9yZXN0YXJ0KGUpe3RoaXMuX3N0b3AoKSx0aGlzLl9zdGFydChlKX1fc3RvcCgpe3RoaXMuX3RpbWVyIT1udWxsJiYodGhpcy5fbGFzdEludGVyYWN0aW9uPXZvaWQgMCxjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpLHRoaXMuX3RpbWVyPXZvaWQgMCl9fWNsYXNzIFJhZ2VDbGlja0RldGVjdG9yIGV4dGVuZHMgQWJzdHJhY3RJbnNpZ2h0RGV0ZWN0b3J7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpO2YodGhpcywiX2NsaWNrcyIsW10pO2YodGhpcywiX3RpbWVyIil9Z2V0RGVmYXVsdE9wdGlvbnMoKXtyZXR1cm57Y2xpY2tzVGhyZXNob2xkOjQsZGlzdGFuY2VUaHJlc2hvbGQ6MzAsdGltZW91dFRocmVzaG9sZDo4MDB9fWhhbmRsZShlKXtpZighKGlzQ3VzdG9tVHJhY2tUeXBlKGUudHJhY2tUeXBlKXx8ZS5ldmVudC5ldmVudFR5cGUhPT1UcmFja2VyRXZlbnRUeXBlLk1vdXNlQ2xpY2spKXtpZih0aGlzLl9jbGlja3MubGVuZ3RoPT09MCl7dGhpcy5fc3RhcnQoZSk7cmV0dXJufWlmKHRoaXMuX2lzV2l0aEluRGlzdGFuY2UodGhpcy5fY2xpY2tzWzBdLGUpKXt0aGlzLl9jbGlja3MucHVzaChlKTtyZXR1cm59dGhpcy5fcmVzdGFydChlKX19X3N0YXJ0KGUpe3RoaXMuX2NsaWNrcy5wdXNoKGUpLHRoaXMuX3RpbWVyPXNldFRpbWVvdXQoKCk9Pntjb25zdHtsZW5ndGg6bn09dGhpcy5fY2xpY2tzO2lmKG4+PXRoaXMuX2NvbmZpZy5jbGlja3NUaHJlc2hvbGQpe2NvbnN0IHM9dGhpcy5fY2xpY2tzWzBdLG89dGhpcy5fY2xpY2tzW24tMV0sW2EsYyxsLHUsaF09cy5ldmVudC5kYXRhLHA9e2R1cmF0aW9uOm8udGltZS1zLnRpbWUsY2xpY2tzOm4seDphLHk6YyxidXR0b25zOmx9O3UhPW51bGwmJihwLnRhcmdldElkPXUpLGghPW51bGwmJihwLmNvbnRleHQ9aCksdGhpcy5lbWl0KCJkZXRlY3RlZCIscCl9dGhpcy5fc3RvcCgpfSx0aGlzLl9jb25maWcudGltZW91dFRocmVzaG9sZCl9X3Jlc3RhcnQoZSl7dGhpcy5fc3RvcCgpLHRoaXMuX3N0YXJ0KGUpfV9zdG9wKCl7dGhpcy5fdGltZXIhPW51bGwmJih0aGlzLl9jbGlja3M9W10sY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKSx0aGlzLl90aW1lcj12b2lkIDApfV9pc1dpdGhJbkRpc3RhbmNlKGUsbil7Y29uc3RbcyxvXT1lLmV2ZW50LmRhdGEsW2EsY109bi5ldmVudC5kYXRhO3JldHVybiBNYXRoLmFicyhhLXMpK01hdGguYWJzKGMtbyk8PXRoaXMuX2NvbmZpZy5kaXN0YW5jZVRocmVzaG9sZH19Y2xhc3MgSW5zaWdodFByb2Nlc3NvciBleHRlbmRzIEFic3RyYWN0UHJvY2Vzc29ye2NvbnN0cnVjdG9yKGUsbil7c3VwZXIoZSk7Zih0aGlzLCJfZGVhZENsaWNrRGV0ZWN0b3IiKTtmKHRoaXMsIl9sb25nSG92ZXJEZXRlY3RvciIpO2YodGhpcywiX3JhZ2VDbGlja0RldGVjdG9yIik7Zih0aGlzLCJfZXhjZXNzaXZlU2Nyb2xsaW5nRGV0ZWN0b3IiKTtmKHRoaXMsIl9oYW5kbGVJbnNpZ2h0IixlPT5uPT57dGhpcy5vdXRwdXQoY3JlYXRlRnJhbWVGcm9tRXZlbnQoVHJhY2tUeXBlLkluc2lnaHQse2V2ZW50VHlwZTplLGRhdGE6bn0sdGltZS5ub3coKSkpfSk7dGhpcy5faW5pdERldGVjdG9ycyhuKX1zeW5jT3B0aW9ucyhlKXt2YXIgbixzLG8sYSxjLGwsdSxoO3RoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUuZGVhZENsaWNrKT8obj10aGlzLl9kZWFkQ2xpY2tEZXRlY3Rvcik9PW51bGx8fG4uc2V0T3B0aW9ucyhlPT1udWxsP3ZvaWQgMDplLmRlYWRDbGljayk6KChzPXRoaXMuX2RlYWRDbGlja0RldGVjdG9yKT09bnVsbHx8cy5yZW1vdmVBbGxMaXN0ZW5lcnMoKSx0aGlzLl9kZWFkQ2xpY2tEZXRlY3Rvcj12b2lkIDApLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUuZXhjZXNzaXZlU2Nyb2xsaW5nKT8obz10aGlzLl9leGNlc3NpdmVTY3JvbGxpbmdEZXRlY3Rvcik9PW51bGx8fG8uc2V0T3B0aW9ucyhlPT1udWxsP3ZvaWQgMDplLmV4Y2Vzc2l2ZVNjcm9sbGluZyk6KChhPXRoaXMuX2V4Y2Vzc2l2ZVNjcm9sbGluZ0RldGVjdG9yKT09bnVsbHx8YS5yZW1vdmVBbGxMaXN0ZW5lcnMoKSx0aGlzLl9leGNlc3NpdmVTY3JvbGxpbmdEZXRlY3Rvcj12b2lkIDApLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUubG9uZ0hvdmVyKT8oYz10aGlzLl9sb25nSG92ZXJEZXRlY3Rvcik9PW51bGx8fGMuc2V0T3B0aW9ucyhlPT1udWxsP3ZvaWQgMDplLmxvbmdIb3Zlcik6KChsPXRoaXMuX2xvbmdIb3ZlckRldGVjdG9yKT09bnVsbHx8bC5yZW1vdmVBbGxMaXN0ZW5lcnMoKSx0aGlzLl9sb25nSG92ZXJEZXRlY3Rvcj12b2lkIDApLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUucmFnZUNsaWNrKT8odT10aGlzLl9yYWdlQ2xpY2tEZXRlY3Rvcik9PW51bGx8fHUuc2V0T3B0aW9ucyhlPT1udWxsP3ZvaWQgMDplLnJhZ2VDbGljayk6KChoPXRoaXMuX3JhZ2VDbGlja0RldGVjdG9yKT09bnVsbHx8aC5yZW1vdmVBbGxMaXN0ZW5lcnMoKSx0aGlzLl9yYWdlQ2xpY2tEZXRlY3Rvcj12b2lkIDApfWhhbmRsZUZyYW1lKGUpe3ZhciBuLHMsbyxhO3RoaXMub3V0cHV0KGUpLChuPXRoaXMuX2RlYWRDbGlja0RldGVjdG9yKT09bnVsbHx8bi5oYW5kbGUoZSksKHM9dGhpcy5fZXhjZXNzaXZlU2Nyb2xsaW5nRGV0ZWN0b3IpPT1udWxsfHxzLmhhbmRsZShlKSwobz10aGlzLl9sb25nSG92ZXJEZXRlY3Rvcik9PW51bGx8fG8uaGFuZGxlKGUpLChhPXRoaXMuX3JhZ2VDbGlja0RldGVjdG9yKT09bnVsbHx8YS5oYW5kbGUoZSl9X2luaXREZXRlY3RvcnMoZSl7dGhpcy5faXNEZXRlY3RvckVuYWJsZWQoZT09bnVsbD92b2lkIDA6ZS5kZWFkQ2xpY2spJiZ0aGlzLl9jb250ZXh0LnZpcnR1YWxSZW5kZXJlciYmKHRoaXMuX2RlYWRDbGlja0RldGVjdG9yPW5ldyBEZWFkQ2xpY2tEZXRlY3Rvcih0aGlzLl9jb250ZXh0LnZpcnR1YWxSZW5kZXJlcixlPT1udWxsP3ZvaWQgMDplLmRlYWRDbGljayksdGhpcy5fZGVhZENsaWNrRGV0ZWN0b3Iub24oImRldGVjdGVkIix0aGlzLl9oYW5kbGVJbnNpZ2h0KFRyYWNrZXJFdmVudFR5cGUuSU5TSUdIVF9ERUFEX0NMSUNLKSkpLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUuZXhjZXNzaXZlU2Nyb2xsaW5nKSYmKHRoaXMuX2V4Y2Vzc2l2ZVNjcm9sbGluZ0RldGVjdG9yPW5ldyBFeGNlc3NpdmVTY3JvbGxpbmdEZXRlY3RvcihlPT1udWxsP3ZvaWQgMDplLmV4Y2Vzc2l2ZVNjcm9sbGluZyksdGhpcy5fZXhjZXNzaXZlU2Nyb2xsaW5nRGV0ZWN0b3Iub24oImRldGVjdGVkIix0aGlzLl9oYW5kbGVJbnNpZ2h0KFRyYWNrZXJFdmVudFR5cGUuSU5TSUdIVF9FWENFU1NJVkVfU0NST0xMSU5HKSkpLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUubG9uZ0hvdmVyKSYmKHRoaXMuX2xvbmdIb3ZlckRldGVjdG9yPW5ldyBMb25nSG92ZXJEZXRlY3RvcihlPT1udWxsP3ZvaWQgMDplLmxvbmdIb3ZlciksdGhpcy5fbG9uZ0hvdmVyRGV0ZWN0b3Iub24oImRldGVjdGVkIix0aGlzLl9oYW5kbGVJbnNpZ2h0KFRyYWNrZXJFdmVudFR5cGUuSU5TSUdIVF9MT05HX0hPVkVSKSkpLHRoaXMuX2lzRGV0ZWN0b3JFbmFibGVkKGU9PW51bGw/dm9pZCAwOmUucmFnZUNsaWNrKSYmKHRoaXMuX3JhZ2VDbGlja0RldGVjdG9yPW5ldyBSYWdlQ2xpY2tEZXRlY3RvcihlPT1udWxsP3ZvaWQgMDplLnJhZ2VDbGljayksdGhpcy5fcmFnZUNsaWNrRGV0ZWN0b3Iub24oImRldGVjdGVkIix0aGlzLl9oYW5kbGVJbnNpZ2h0KFRyYWNrZXJFdmVudFR5cGUuSU5TSUdIVF9SQUdFX0NMSUNLKSkpfV9pc0RldGVjdG9yRW5hYmxlZChlKXtyZXR1cm4gZSE9PSExfX1jbGFzcyBOZXR3b3JrRGF0YU1hc2t7Y29uc3RydWN0b3IodCl7Zih0aGlzLCJfY29tbW9uRGF0YU1hc2siKTtjb25zdHtkaXNhYmxlQnVpbHRJbkRhdGFNYXNrczplPSExLGRhdGFNYXNrczpuPVtdLG1hc2tpbmdMZXZlbDpzPURhdGFNYXNraW5nTGV2ZWwuQkFMQU5DRX09dDtlfHwocz09PURhdGFNYXNraW5nTGV2ZWwuU1RSSUNUP3RoaXMuX2NvbW1vbkRhdGFNYXNrPW5ldyBUZXh0RGF0YU1hc2s6dGhpcy5fY29tbW9uRGF0YU1hc2s9bmV3IENvbWJpbmVkRGF0YU1hc2sobmV3IEVtYWlsRGF0YU1hc2ssbmV3IElEQ2FyZERhdGFNYXNrLG5ldyBJUEFkZHJlc3NEYXRhTWFzayxuZXcgTGljZW5zZVBsYXRlRGF0YU1hc2ssbmV3IE1BQ0FkZHJlc3NEYXRhTWFzayxuZXcgVklORGF0YU1hc2ssbmV3IE1vYmlsZVBob25lRGF0YU1hc2ssbmV3IEJhbmtBY2NvdW50RGF0YU1hc2spKSxuLmxlbmd0aD4wJiYodGhpcy5fY29tbW9uRGF0YU1hc2s9dGhpcy5fY29tbW9uRGF0YU1hc2s/bmV3IENvbWJpbmVkRGF0YU1hc2soLi4ubix0aGlzLl9jb21tb25EYXRhTWFzayk6bmV3IENvbWJpbmVkRGF0YU1hc2soLi4ubikpfW1hc2sodCl7Y29uc3R7ZGF0YTplLGV2ZW50VHlwZTpufT10LmV2ZW50O2lmKG49PT1UcmFja2VyRXZlbnRUeXBlLk5FVFdPUktfRE9ORSYmdGhpcy5fY29tbW9uRGF0YU1hc2spe2NvbnN0e2JvZHk6c309ZTtpZihzIT1udWxsKWlmKGlzU3RyaW5nKHMpKWUuYm9keT10aGlzLl9jb21tb25EYXRhTWFzay5tYXNrKHMpO2Vsc2UgdHJ5e2xldCBvPSExO2NvbnN0IGE9SlNPTi5zdHJpbmdpZnkocywoYyxsKT0+aXNTdHJpbmcobCk/KG89ITAsdGhpcy5fY29tbW9uRGF0YU1hc2subWFzayhsKSk6bCk7byYmKGUuYm9keT1hKX1jYXRjaChvKXt9fXJldHVybiB0fX1jbGFzcyBOZXR3b3JrUHJvY2Vzc29yIGV4dGVuZHMgQWJzdHJhY3RQcm9jZXNzb3J7Y29uc3RydWN0b3IoZSxuKXtzdXBlcihlLFRyYWNrVHlwZS5OZXR3b3JrKTtmKHRoaXMsIl9kYXRhTWFzayIpO3RoaXMuc3luY09wdGlvbnMobil9c3luY09wdGlvbnMoZSl7ZSE9bnVsbCYmZS5kaXNhYmxlRGF0YU1hc2tpbmc/dGhpcy5fZGF0YU1hc2s9dm9pZCAwOnRoaXMuX2RhdGFNYXNrPW5ldyBOZXR3b3JrRGF0YU1hc2soe2Rpc2FibGVEYXRhTWFza2luZzplPT1udWxsP3ZvaWQgMDplLmRpc2FibGVEYXRhTWFza2luZyxkaXNhYmxlQnVpbHRJbkRhdGFNYXNrczplPT1udWxsP3ZvaWQgMDplLmRpc2FibGVCdWlsdEluRGF0YU1hc2tzLGRhdGFNYXNrczplPT1udWxsP3ZvaWQgMDplLmRhdGFNYXNrcyxtYXNraW5nTGV2ZWw6ZT09bnVsbD92b2lkIDA6ZS5tYXNraW5nTGV2ZWx9KX1oYW5kbGVGcmFtZShlKXt0aGlzLm91dHB1dCh0aGlzLl9kYXRhTWFzaz90aGlzLl9kYXRhTWFzay5tYXNrKGUpOmUpfX1jbGFzcyBQcm9jZXNzb3JDb250ZXh0e2NvbnN0cnVjdG9yKHQpe2YodGhpcywiX3RyYWNrVHlwZXMiKTtmKHRoaXMsIl9jb250cm9sbGVyIik7Zih0aGlzLCJfdmlydHVhbFJlbmRlcmVyIik7dGhpcy5fY29udHJvbGxlcj10fWdldCB0cmFja1R5cGVzKCl7cmV0dXJuIHRoaXMuX3RyYWNrVHlwZXN9c2V0IHRyYWNrVHlwZXModCl7dGhpcy5fdHJhY2tUeXBlcz10fWdldCBjb250cm9sbGVyKCl7cmV0dXJuIHRoaXMuX2NvbnRyb2xsZXJ9Z2V0IHZpcnR1YWxSZW5kZXJlcigpe3JldHVybiB0aGlzLl92aXJ0dWFsUmVuZGVyZXJ9c2V0IHZpcnR1YWxSZW5kZXJlcih0KXt0aGlzLl92aXJ0dWFsUmVuZGVyZXI9dH19Y2xhc3MgUmVjb3JkaW5nQ29udGV4dHtjb25zdHJ1Y3Rvcih0LGUsbil7Zih0aGlzLCJtYW5hZ2VyIik7Zih0aGlzLCJfaWQiKTtmKHRoaXMsIl9yZWNvcmRpbmciKTtmKHRoaXMsIl9zdGFydFRpbWUiKTtmKHRoaXMsIl9vZmZzZXRUaW1lIik7Zih0aGlzLCJfdHJhY2tlcnMiKTtmKHRoaXMsIl90cmFuc21pdHRlciIpO2YodGhpcywiX2V2ZW50cyIsbmV3IEV2ZW50RW1pdHRlcik7dmFyIG8sYTt0aGlzLm9wdGlvbnM9bix0aGlzLm1hbmFnZXI9dCx0aGlzLl9yZWNvcmRpbmc9ZSx0aGlzLl9pZD1lLmlkLHRoaXMuX3N0YXJ0VGltZT0obz1uLnN0YXJ0VGltZSkhPW51bGw/bzpub3coKSx0aGlzLl90cmFja2Vycz1uLnRyYWNrZXJzLHRoaXMuX29mZnNldFRpbWU9dGhpcy5nZXRPZmZzZXRUaW1lKHRoaXMuX3N0YXJ0VGltZSk7Y29uc3Qgcz0oYT1uLnRyYW5zcG9ydCk9PW51bGw/dm9pZCAwOmEuc3RyYXRlZ2llcy5maW5kKGM9PmMubW9kZT09PW4ubW9kZSYmImNoYW5uZWxUeXBlImluIGMpO3RoaXMuX3RyYW5zbWl0dGVyPXtzdHJhdGVneTpzfX1nZXQgaWQoKXtyZXR1cm4gdGhpcy5faWR9Z2V0IHJlY29yZGluZygpe3JldHVybiB0aGlzLl9yZWNvcmRpbmd9Z2V0IGJhc2VVUkwoKXtyZXR1cm4gdGhpcy5tYW5hZ2VyLmVudi5iYXNlVVJMfWdldCBlbnYoKXtyZXR1cm4gdGhpcy5tYW5hZ2VyLmVudn1nZXQgc3RhcnRUaW1lKCl7cmV0dXJuIHRoaXMuX3N0YXJ0VGltZX1nZXQgb2Zmc2V0VGltZSgpe3JldHVybiB0aGlzLl9vZmZzZXRUaW1lfWdldCBub3coKXtyZXR1cm4gbm93KCkrdGhpcy5fb2Zmc2V0VGltZX1nZXQgdHJhbnNtaXR0ZXIoKXtyZXR1cm4gdGhpcy5fdHJhbnNtaXR0ZXJ9Z2V0IHRyYWNrZXJzKCl7cmV0dXJuIHRoaXMuX3RyYWNrZXJzfWR1bXBSZWNvcmRpbmcodCl7cmV0dXJuIHRoaXMubWFuYWdlci5kdW1wUmVjb3JkaW5nKHRoaXMuX2lkLHQpfWNhY2hlUmVjb3JkaW5ncygpe3JldHVybiB0aGlzLm1hbmFnZXIuY2FjaGVSZWNvcmRpbmdzKCl9c3RvcFJlY29yZGluZygpe3JldHVybiB0aGlzLm1hbmFnZXIuc3RvcFJlY29yZGluZ0NvbnRleHQodGhpcy5faWQpfXRvU3RyaW5nKCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuX3JlY29yZGluZyl9ZW1pdCh0LC4uLmUpe3JldHVybiB0aGlzLl9ldmVudHMuZW1pdCh0LC4uLmUpfW9uKHQsZSl7dGhpcy5fZXZlbnRzLm9uKHQsZSx7fSl9b25jZSh0LGUpe3RoaXMuX2V2ZW50cy5vbmNlKHQsZSx7fSl9b2ZmKHQsZSl7dGhpcy5fZXZlbnRzLm9mZih0LGUse30pfWFkZExpc3RlbmVyKHQsZSl7dGhpcy5fZXZlbnRzLmFkZExpc3RlbmVyKHQsZSx7fSl9cmVtb3ZlTGlzdGVuZXIodCxlKXt0aGlzLl9ldmVudHMucmVtb3ZlTGlzdGVuZXIodCxlLHt9KX1nZXRPZmZzZXRUaW1lKHQpe3JldHVybiB0LW5vdygpfX1jbGFzcyBCbGFja2JveFJlY29yZGluZ0NvbnRleHQgZXh0ZW5kcyBSZWNvcmRpbmdDb250ZXh0e2NvbnN0cnVjdG9yKGUsbixzKXt2YXIgYTtzdXBlcihlLG4scyk7Zih0aGlzLCJfZHVtcENvbmZpZyIpO2NvbnN0IG89KGE9cy50cmFuc3BvcnQpPT1udWxsP3ZvaWQgMDphLnN0cmF0ZWdpZXMuZmluZChjPT5jLm5hbWU9PT0iYmxhY2tib3gtcmVjb3JkLWR1bXAiKTtvP3RoaXMuX2R1bXBDb25maWc9bz09bnVsbD92b2lkIDA6by5jb25maWc6dGhpcy5fZHVtcENvbmZpZz17aWQ6Z2VuZXJhdGVVVUlEKCksdG9rZW46cy50b2tlbn19Z2V0IGR1bXBDb25maWcoKXtyZXR1cm4gdGhpcy5fZHVtcENvbmZpZ31zZXQgZHVtcENvbmZpZyhlKXt0aGlzLl9kdW1wQ29uZmlnPWV9ZHVtcFJlY29yZGluZyhlKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Y29uc3Qgbj15aWVsZCBwZShCbGFja2JveFJlY29yZGluZ0NvbnRleHQucHJvdG90eXBlLHRoaXMsImR1bXBSZWNvcmRpbmciKS5jYWxsKHRoaXMsZSk7cmV0dXJuIHRoaXMuZW1pdCgiZHVtcGVkIixuLmlkLHRoaXMuZHVtcENvbmZpZyksbi5pZH0pfWdldER1bXBDb25maWcoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmR1bXBDb25maWcpfSl9fWNsYXNzIEluTWVtb3J5UmVjb3JkaW5nQ29udGV4dCBleHRlbmRzIFJlY29yZGluZ0NvbnRleHR7ZHVtcFJlY29yZGluZygpe3JldHVybiBzdXBlci5kdW1wUmVjb3JkaW5nKCl9fWZ1bmN0aW9uIG5vcm1hbGl6ZVRyYWNrVHlwZShyKXtyZXR1cm4gaXNTdHJpbmcocik/VHJhY2tUeXBlW3JdOnJ9ZnVuY3Rpb24gbm9ybWFsaXplVHJhY2tUeXBlcyhyKXtjb25zdCB0PXI9PW51bGw/dm9pZCAwOnIubWFwKGU9Pm5vcm1hbGl6ZVRyYWNrVHlwZShlKSkuZmlsdGVyKGU9PiEhZSk7cmV0dXJuIHQmJnQubGVuZ3RoPjA/dDpbVHJhY2tUeXBlLkhUTUwsVHJhY2tUeXBlLk1vdXNlXX1jbGFzcyBSZWNvcmRpbmdFcnJvciBleHRlbmRzIFJ1bnRpbWVFcnJvcntjb25zdHJ1Y3Rvcih0LGUpe3N1cGVyKHQsZSksdGhpcy5uYW1lPSJieXRlcmVwbGF5LnJlY29yZGVyLlJlY29yZGluZ0Vycm9yIn19Y2xhc3MgRnJhbWVCdWZmZXIgZXh0ZW5kcyBBYnN0cmFjdEZsb3d7Y29uc3RydWN0b3IoZSl7c3VwZXIoKTtmKHRoaXMsIl9idWZmZXJlZEZyYW1lcyIsW10pO2YodGhpcywiX3RpbWVyIiwwKTtmKHRoaXMsIl9oYW5kbGVUaWNrIiwoKT0+e3RoaXMuX2J1ZmZlcmVkRnJhbWVzLmxlbmd0aD90aGlzLmZsdXNoKCk6dGhpcy5kaXNwb3NlKCl9KTt0aGlzLm9wdGlvbnM9ZX1oYW5kbGVJbnB1dChlKXt0aGlzLl9idWZmZXJlZEZyYW1lcy5wdXNoKGUpLHRoaXMuX3RpbWVyfHwodGhpcy5fdGltZXI9c2V0SW50ZXJ2YWwodGhpcy5faGFuZGxlVGljayx0aGlzLm9wdGlvbnMuYnVmZmVyVGltZSkpfWZsdXNoKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9idWZmZXJlZEZyYW1lcy5sZW5ndGg/KHRoaXMub3V0cHV0KFsuLi50aGlzLl9idWZmZXJlZEZyYW1lc10pLHRoaXMuX2J1ZmZlcmVkRnJhbWVzLnNwbGljZSgwLHRoaXMuX2J1ZmZlcmVkRnJhbWVzLmxlbmd0aCksbmV3IFByb21pc2UoZT0+e3NldFRpbWVvdXQoZSwwKX0pKTpQcm9taXNlLnJlc29sdmUoKX0pfWRpc3Bvc2UoKXtjbGVhckludGVydmFsKHRoaXMuX3RpbWVyKSx0aGlzLl90aW1lcj0wfX1jbGFzcyBCbG9iVHJhbnNtaXR0ZXIgZXh0ZW5kcyBBYnN0cmFjdEZsb3d7Y29uc3RydWN0b3IoZSl7c3VwZXIoKTtmKHRoaXMsIl9jaHVua3MiLFtdKTt0aGlzLmNvbnRleHQ9ZX1oYW5kbGVJbnB1dChlKXt0aGlzLl9jaHVua3MucHVzaChlLmRhdGEpfW9wZW4oKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7fSl9Y2xvc2UoKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7fSl9ZHVtcCgpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtyZXR1cm4gbmV3IEJsb2IodGhpcy5fY2h1bmtzLHt0eXBlOiJ0ZXh0L3BsYWluIn0pfSl9fWNsYXNzIEJsb2NrVHJhbnNtaXR0ZXIgZXh0ZW5kcyBBYnN0cmFjdEZsb3d7Y29uc3RydWN0b3IoZSl7dmFyIG47c3VwZXIoKTtmKHRoaXMsIl9yZXRyeSIpO2YodGhpcywiX3N0cmF0ZWd5Iik7Zih0aGlzLCJfY2xvc2luZyIpO3RoaXMuY29udGV4dD1lLHRoaXMuX3N0cmF0ZWd5PShuPWUudHJhbnNtaXR0ZXIpPT1udWxsP3ZvaWQgMDpuLnN0cmF0ZWd5LHRoaXMuX3JldHJ5PW5ldyBSZXRyeX1vcGVuKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe30pfWNsb3NlKCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiBuZXcgUHJvbWlzZSgoZSxuKT0+e3RoaXMuX2Nsb3Npbmc9cz0+e3RoaXMuX2Nsb3Npbmc9dm9pZCAwLHM/bihzKTplKCl9fSl9KX1oYW5kbGVJbnB1dChlKXt0aGlzLmNvbnRleHQuZW1pdCgiZmVlZGJhY2siLHt0eXBlOlNpZ25hbFR5cGUuQ29tcGVuc2F0ZVNuYXBzaG90LHJlY29yZGluZ0lkOnRoaXMuY29udGV4dC5pZH0pLHRoaXMuX3JldHJ5LmF0dGVtcHQoKCk9PmIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3ZhciBuLHM7dHJ5e3JldHVybiBjcmVhdGVCbG9jayh0aGlzLmNvbnRleHQubWFuYWdlci5hcGlDbGllbnQse2Jsb2I6bmV3IEJsb2IoW2UuZGF0YV0se3R5cGU6KChzPShuPXRoaXMuX3N0cmF0ZWd5LnBhY2tlcik9PW51bGw/dm9pZCAwOm4uY29tcHJlc3Npb24pPT1udWxsP3ZvaWQgMDpzLm1vZGUpPT09Imd6aXAiPyJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iOiJ0ZXh0L3BsYWluIn0pLHJlY29yZGluZ0lkOnRoaXMuY29udGV4dC5yZWNvcmRpbmcuaWQsdG9rZW46dGhpcy5fc3RyYXRlZ3kuY29uZmlnLnRva2VuLG9mZnNldDplLmZyYW1lUmFuZ2VbMF0sY291bnQ6ZS5mcmFtZVJhbmdlWzFdLGZpcnN0RnJhbWVUaW1lOmUuZmlyc3RGcmFtZVRpbWUsbGFzdEZyYW1lVGltZTplLmxhc3RGcmFtZVRpbWV9KX1jYXRjaChvKXt0aHJvdyBvfX0pKS50aGVuKG49Pnt2YXIgczt0aGlzLmNvbnRleHQuZW1pdCgiZmVlZGJhY2siLHt0eXBlOlNpZ25hbFR5cGUuQmxvY2tDcmVhdGVkLGJsb2NrOm59KSwocz10aGlzLl9jbG9zaW5nKT09bnVsbHx8cy5jYWxsKHRoaXMpfSkuY2F0Y2gobj0+e3ZhciBzOyhzPXRoaXMuX2Nsb3NpbmcpPT1udWxsfHxzLmNhbGwodGhpcyxuKX0pfX12YXIgU2Vla09yaWdpbj0ocj0+KHJbci5CZWdpbj0wXT0iQmVnaW4iLHJbci5FbmQ9MV09IkVuZCIscltyLkN1cnJlbnQ9Ml09IkN1cnJlbnQiLHIpKShTZWVrT3JpZ2lufHx7fSk7Y2xhc3MgQmluYXJ5V3JpdGVye2NvbnN0cnVjdG9yKHQ9MTAyNCxlPXQpe2YodGhpcywiX2J5dGVMZW5ndGgiLDApO2YodGhpcywiX3Bvc2l0aW9uIiwwKTtmKHRoaXMsIl9ieXRlcyIpO2YodGhpcywiX2J1ZmZlciIpO2YodGhpcywiX3ZpZXciKTtmKHRoaXMsIl9lbmNvZGVyIixudWxsKTtmKHRoaXMsIl9hbGxvY0NvdW50IiwwKTtmKHRoaXMsIl9hbGxvY1dhcm5lZCIsITEpO3RoaXMuaW5pdGlhbEJ1ZmZlclNpemU9dCx0aGlzLmluY3JlbWVudGFsU2l6ZT1lLHRoaXMucmVhbGxvYyh0KX1nZXQgYnl0ZUxlbmd0aCgpe3JldHVybiB0aGlzLl9ieXRlTGVuZ3RofWdldCBjYXBhY2l0eSgpe3JldHVybiB0aGlzLl9ieXRlcy5sZW5ndGh9Z2V0IGN1cnJlbnRQb3NpdGlvbigpe3JldHVybiB0aGlzLl9wb3NpdGlvbn1lbmNvZGUodCl7cmV0dXJuIHRoaXMuX2VuY29kZXJ8fCh0aGlzLl9lbmNvZGVyPW5ldyBUZXh0RW5jb2RlciksdGhpcy5fZW5jb2Rlci5lbmNvZGUodCl9c2Vlayh0LGU9U2Vla09yaWdpbi5CZWdpbil7bGV0IG47aWYoZT09PVNlZWtPcmlnaW4uQ3VycmVudD9uPXRoaXMuY3VycmVudFBvc2l0aW9uOmU9PT1TZWVrT3JpZ2luLkVuZD9uPXRoaXMuYnl0ZUxlbmd0aDpuPTAsbj1uK3QsbjwwKXRocm93IG5ldyBJT0Vycm9yKCJUaGUgc2Vla2luZyBwb3NpdGlvbiBtdXN0IGVxdWFsIHRvIG9yIGJlIGdyZWF0ZXIgdGhhbiAwLiIpO3RoaXMuX3Bvc2l0aW9uPW59d3JpdGVVaW50OCh0KXt0aGlzLmNoZWNrQWxsb2MoMSksdGhpcy5fdmlldy5zZXRVaW50OCh0aGlzLmN1cnJlbnRQb3NpdGlvbix0KSx0aGlzLmluY3JlYXNlU2l6ZSgxKX13cml0ZVVpbnQ4QXJyYXkodCl7Y29uc3QgZT10LmJ5dGVMZW5ndGg7dGhpcy5jaGVja0FsbG9jKGUpLHRoaXMuX2J5dGVzLnNldCh0LHRoaXMuY3VycmVudFBvc2l0aW9uKSx0aGlzLmluY3JlYXNlU2l6ZShlKX13cml0ZVVpbnQxNih0KXt0aGlzLmNoZWNrQWxsb2MoMiksdGhpcy5fdmlldy5zZXRVaW50MTYodGhpcy5jdXJyZW50UG9zaXRpb24sdCksdGhpcy5pbmNyZWFzZVNpemUoMil9d3JpdGVVaW50MzIodCl7dGhpcy5jaGVja0FsbG9jKDQpLHRoaXMuX3ZpZXcuc2V0VWludDMyKHRoaXMuY3VycmVudFBvc2l0aW9uLHQsITEpLHRoaXMuaW5jcmVhc2VTaXplKDQpfXdyaXRlU3RyaW5nKHQsZSl7bGV0IG49dGhpcy5lbmNvZGUodCk7aWYoZSYmbi5sZW5ndGg+ZSYmKG49bi5zbGljZSgwLGUpKSx0aGlzLndyaXRlVWludDhBcnJheShuKSxlKXtjb25zdCBzPWUtbi5sZW5ndGg7cyYmKHRoaXMuX2J5dGVzLmZpbGwoMCx0aGlzLmN1cnJlbnRQb3NpdGlvbix0aGlzLmN1cnJlbnRQb3NpdGlvbitzKSx0aGlzLmluY3JlYXNlU2l6ZShzKSl9fXRvVWludDhBcnJheSgpe3JldHVybiB0aGlzLl9ieXRlcy5zbGljZSgwLHRoaXMuYnl0ZUxlbmd0aCl9dG9CdWZmZXIoKXtyZXR1cm4gdGhpcy5fYnVmZmVyLnNsaWNlKDAsdGhpcy5ieXRlTGVuZ3RoKX10b1N0cmluZygpe3JldHVybiB0aGlzLnRvVWludDhBcnJheSgpLnRvU3RyaW5nKCl9aW5jcmVhc2VTaXplKHQpe3RoaXMuX3Bvc2l0aW9uPXRoaXMuY3VycmVudFBvc2l0aW9uK3QsdGhpcy5fYnl0ZUxlbmd0aD1NYXRoLm1heCh0aGlzLl9ieXRlTGVuZ3RoLHRoaXMuY3VycmVudFBvc2l0aW9uKX1jaGVja0FsbG9jKHQpe2NvbnN0IGU9dGhpcy5jdXJyZW50UG9zaXRpb24rdDtpZih0aGlzLl9idWZmZXIuYnl0ZUxlbmd0aD49ZSlyZXR1cm47bGV0IG49dGhpcy5ieXRlTGVuZ3RoO2Zvcig7bjxlOyluKz10aGlzLmluY3JlbWVudGFsU2l6ZTt0aGlzLnJlYWxsb2Mobil9cmVhbGxvYyh0KXtjb25zdCBlPW5ldyBBcnJheUJ1ZmZlcih0KSxuPW5ldyBVaW50OEFycmF5KGUpO3RoaXMuX2J5dGVzJiZuLnNldCh0aGlzLl9ieXRlcywwKSx0aGlzLl9idWZmZXI9ZSx0aGlzLl9ieXRlcz1uLHRoaXMuX3ZpZXc9bmV3IERhdGFWaWV3KHRoaXMuX2J1ZmZlciksdGhpcy5fYWxsb2NDb3VudCsrLCF0aGlzLl9hbGxvY1dhcm5lZCYmdGhpcy5fYWxsb2NDb3VudD41JiYoY29uc29sZS53YXJuKCJUaGlzIEJpbmFyeVdyaXRlciBmcmVxdWVudGx5IHJlYWxsb2NhdGVzIGl0c2VsZi4gVHJ5IHRvIGF2b2lkIHRoaXMgYnkgYWRqdXN0aW5nIGJ1ZmZlciBzZXR0aW5ncy4iLHRoaXMpLHRoaXMuX2FsbG9jV2FybmVkPSEwKX19Y2xhc3MgQm94V3JpdGVye2NvbnN0cnVjdG9yKHQsZT0xMDI0LG49ZSl7Zih0aGlzLCJfYmluYXJ5V3JpdGVyIik7dGhpcy5uYW1lPXQsdGhpcy5pbml0aWFsQnVmZmVyU2l6ZT1lLHRoaXMuaW5jcmVtZW50YWxTaXplPW4sdGhpcy5fYmluYXJ5V3JpdGVyPW5ldyBCaW5hcnlXcml0ZXIoZSxuKSx0aGlzLl9iaW5hcnlXcml0ZXIud3JpdGVVaW50MzIoMCksdGhpcy5fYmluYXJ5V3JpdGVyLndyaXRlU3RyaW5nKHQsNCl9Z2V0IGJ5dGVMZW5ndGgoKXtyZXR1cm4gdGhpcy5fYmluYXJ5V3JpdGVyLmJ5dGVMZW5ndGh9Z2V0IGNhcGFjaXR5KCl7cmV0dXJuIHRoaXMuX2JpbmFyeVdyaXRlci5jYXBhY2l0eX1hcHBlbmRVaW50OCh0LGUpe3RoaXMud3JpdGVLVkhlYWRlcih0LDgvOCksdGhpcy5fYmluYXJ5V3JpdGVyLndyaXRlVWludDgoZSl9YXBwZW5kQm9vbGVhbih0LGUpe3RoaXMuYXBwZW5kVWludDgodCxlPzE6MCl9YXBwZW5kVWludDE2KHQsZSl7dGhpcy53cml0ZUtWSGVhZGVyKHQsMTYvOCksdGhpcy5fYmluYXJ5V3JpdGVyLndyaXRlVWludDE2KGUpfWFwcGVuZFVpbnQzMih0LGUpe3RoaXMud3JpdGVLVkhlYWRlcih0LDMyLzgpLHRoaXMuX2JpbmFyeVdyaXRlci53cml0ZVVpbnQzMihlKX1hcHBlbmRVaW50MzJUdXBsZSh0LGUpe3RoaXMud3JpdGVLVkhlYWRlcih0LDMyLzgrMzIvOCksdGhpcy5fYmluYXJ5V3JpdGVyLndyaXRlVWludDMyKGVbMF0pLHRoaXMuX2JpbmFyeVdyaXRlci53cml0ZVVpbnQzMihlWzFdKX1hcHBlbmRVaW50OEFycmF5KHQsZSl7dGhpcy53cml0ZUtWSGVhZGVyKHQsZS5ieXRlTGVuZ3RoKSx0aGlzLl9iaW5hcnlXcml0ZXIud3JpdGVVaW50OEFycmF5KGUpfWFwcGVuZFN0cmluZyh0LGUpe2NvbnN0IG49dGhpcy5fYmluYXJ5V3JpdGVyLmVuY29kZShlKTt0aGlzLmFwcGVuZFVpbnQ4QXJyYXkodCxuKX1hcHBlbmRCb3godCl7Y29uc3QgZT10LnRvVWludDhBcnJheSgpO3RoaXMuX2JpbmFyeVdyaXRlci53cml0ZVVpbnQ4QXJyYXkoZSl9dG9VaW50OEFycmF5KCl7Y29uc3QgdD10aGlzLl9iaW5hcnlXcml0ZXIuY3VycmVudFBvc2l0aW9uO3JldHVybiB0aGlzLl9iaW5hcnlXcml0ZXIuc2VlaygwKSx0aGlzLl9iaW5hcnlXcml0ZXIud3JpdGVVaW50MzIodGhpcy5fYmluYXJ5V3JpdGVyLmJ5dGVMZW5ndGgpLHRoaXMuX2JpbmFyeVdyaXRlci5zZWVrKHQpLHRoaXMuX2JpbmFyeVdyaXRlci50b1VpbnQ4QXJyYXkoKX10b1N0cmluZygpe3JldHVybiB0aGlzLnRvVWludDhBcnJheSgpLnRvU3RyaW5nKCl9d3JpdGVLVkhlYWRlcih0LGUpe3RoaXMuX2JpbmFyeVdyaXRlci53cml0ZVVpbnQzMih0aGlzLl9jYWxjS1ZCeXRlTGVuZ3RoKGUpKSx0aGlzLl9iaW5hcnlXcml0ZXIud3JpdGVTdHJpbmcodCw0KX1fY2FsY0tWQnl0ZUxlbmd0aCh0KXtyZXR1cm4gNCs0K3R9fWNvbnN0IENIVU5LX05BTUU9ImNobmsiO2Z1bmN0aW9uIHNlcmlhbGl6ZUNodW5rKHIpe2NvbnN0IHQ9bmV3IEJveFdyaXRlcigiaGVhZCIsMTYwLDY0KTt0LmFwcGVuZFVpbnQzMigiaWQiLHIuaGVhZGVyLmlkKSx0LmFwcGVuZFN0cmluZygidmVyIixyLmhlYWRlci52ZXJzaW9uKSx0LmFwcGVuZFVpbnQxNigiaWR4IixyLmhlYWRlci5pbmRleCksdC5hcHBlbmRTdHJpbmcoInBpZCIsci5oZWFkZXIucGFja2V0SWQpLHQuYXBwZW5kVWludDMyVHVwbGUoInJuZyIsci5oZWFkZXIucGFja2V0RnJhbWVSYW5nZSksdC5hcHBlbmRCb29sZWFuKCJmaW4iLHIuaGVhZGVyLmZpbik7Y29uc3QgZT10LmJ5dGVMZW5ndGgrci5ib2R5Lmxlbmd0aCs4Kzgsbj1uZXcgQm94V3JpdGVyKENIVU5LX05BTUUsZSw2NCk7cmV0dXJuIG4uYXBwZW5kQm94KHQpLG4uYXBwZW5kVWludDhBcnJheSgiYm9keSIsci5ib2R5KSxuLnRvVWludDhBcnJheSgpfWZ1bmN0aW9uIHN0cmluZ2lmeUNodW5rKHIpe3JldHVybiBKU09OLnN0cmluZ2lmeShyLCh0LGUpPT5lIGluc3RhbmNlb2YgVWludDhBcnJheT9uZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZSk6ZSl9Y2xhc3MgQ2h1bmtTcGxpdHRlcntjb25zdHJ1Y3Rvcih0KXtmKHRoaXMsIl9jaHVua0lkIiwwKTt0aGlzLmNvbnRleHQ9dH1zcGxpdCh0LGU9MSl7Y29uc3Qgbj1bXTtmb3IobGV0IHM9MDtzPGU7cysrKXtjb25zdCBvPXtoZWFkZXI6e2ZpbjohMCxpZDp0aGlzLl9uZXh0Q2h1bmtJZCgpLGluZGV4OnMscGFja2V0SWQ6dC5pZCxwYWNrZXRGcmFtZVJhbmdlOnQuZnJhbWVSYW5nZSx2ZXJzaW9uOiIxLjAuMCJ9LGJvZHk6dC5kYXRhfTtuLnB1c2gobyl9cmV0dXJuIG59X25leHRDaHVua0lkKCl7cmV0dXJuIHRoaXMuX2NodW5rSWQrK319Y2xhc3MgU3RyZWFtaW5nQ29tcGVuc2F0b3IgZXh0ZW5kcyBFdmVudEVtaXR0ZXJ7Y29uc3RydWN0b3IoZT0xMDApe3N1cGVyKCk7Zih0aGlzLCJfYnVmZmVyU2l6ZSIpO2YodGhpcywiX2Nvbm5lY3Rpb24iKTtmKHRoaXMsIl9tYWlsYm94Iik7Zih0aGlzLCJfaGFuZGxlU2VuZCIsZT0+e3RoaXMuX21haWxib3gmJnR5cGVvZiBlPT0ib2JqZWN0IiYmZS50eXBlPT09V2ViU29ja2V0TWVzc2FnZVR5cGUuQ2h1bmsmJnRoaXMuX21haWxib3guZW5xdWV1ZShbZS5zZXF1ZW5jZSxlLmRhdGFdKX0pO2YodGhpcywiX2hhbmRsZU1lc3NhZ2UiLGU9Pnt2YXIgbjtpZighKCF0aGlzLl9tYWlsYm94fHwhdGhpcy5fY29ubmVjdGlvbikmJiEoZT09PUhlYXJ0YmVhdFNpZ25hbC5QaW5nfHxlPT09SGVhcnRiZWF0U2lnbmFsLlBvbmcpKWlmKGUudHlwZT09PVdlYlNvY2tldE1lc3NhZ2VUeXBlLkFDSyl7Y29uc3Qgcz0obj10aGlzLl9tYWlsYm94LnBlZWsoKSk9PW51bGw/dm9pZCAwOm5bMF07aWYocyE9bnVsbClpZihlLnNlcXVlbmNlPnMpe2NvbnN0IG89dGhpcy5fbWFpbGJveC5maW5kSW5kZXgoYT0+YVswXT09PWUuc2VxdWVuY2UpO28hPT0tMSYmdGhpcy5fbWFpbGJveC5yZW1vdmUobyk7Zm9yKGNvbnN0IGEgb2Ygbz09PS0xP3RoaXMuX21haWxib3guc2xpY2UoKTp0aGlzLl9tYWlsYm94LnNsaWNlKDAsbykpdGhpcy5fY29ubmVjdGlvbi5zZW5kKGFbMV0pfWVsc2UgZS5zZXF1ZW5jZT09PXMmJnRoaXMuX21haWxib3guZGVxdWV1ZSgpfWVsc2UgZS50eXBlPT09V2ViU29ja2V0TWVzc2FnZVR5cGUuQ29tbWFuZCYmdGhpcy5lbWl0KCJjb21tYW5kIixlLmRhdGEpfSk7Zih0aGlzLCJfaGFuZGxlT3BlbiIsKCk9Pnt0aGlzLl9zZW5kQWxsKCl9KTtmKHRoaXMsIl9oYW5kbGVSb3RhdGVkIiwoKT0+e3ZhciBlOyhlPXRoaXMuX21haWxib3gpPT1udWxsfHxlLmNsZWFyKCksdGhpcy5lbWl0KCJjb21wZW5zYXRlIil9KTt0aGlzLl9idWZmZXJTaXplPWV9YXR0YWNoKGUpe3RoaXMuZGV0YWNoKCksdGhpcy5fY29ubmVjdGlvbj1lLGUub24oInNlbmQiLHRoaXMuX2hhbmRsZVNlbmQpLGUub24oIm1lc3NhZ2UiLHRoaXMuX2hhbmRsZU1lc3NhZ2UpLGUub24oIm9wZW4iLHRoaXMuX2hhbmRsZU9wZW4pLHRoaXMuX21haWxib3g9bmV3IFJvdGF0aW5nUXVldWUodGhpcy5fYnVmZmVyU2l6ZSksdGhpcy5fbWFpbGJveC5vbigicm90YXRlZCIsdGhpcy5faGFuZGxlUm90YXRlZCl9ZGV0YWNoKCl7dmFyIGUsbixzLG8sYTsoZT10aGlzLl9jb25uZWN0aW9uKT09bnVsbHx8ZS5vZmYoInNlbmQiLHRoaXMuX2hhbmRsZVNlbmQpLChuPXRoaXMuX2Nvbm5lY3Rpb24pPT1udWxsfHxuLm9mZigibWVzc2FnZSIsdGhpcy5faGFuZGxlTWVzc2FnZSksKHM9dGhpcy5fY29ubmVjdGlvbik9PW51bGx8fHMub2ZmKCJvcGVuIix0aGlzLl9oYW5kbGVPcGVuKSx0aGlzLl9jb25uZWN0aW9uPXZvaWQgMCwobz10aGlzLl9tYWlsYm94KT09bnVsbHx8by5vZmYoInJvdGF0ZWQiLHRoaXMuX2hhbmRsZVJvdGF0ZWQpLChhPXRoaXMuX21haWxib3gpPT1udWxsfHxhLmNsZWFyKCksdGhpcy5fbWFpbGJveD12b2lkIDB9Zmx1c2goKXt0aGlzLl9zZW5kQWxsKCl9X3NlbmRBbGwoKXt2YXIgZTsoZT10aGlzLl9tYWlsYm94KT09bnVsbHx8ZS5mb3JFYWNoKG49Pnt2YXIgczsocz10aGlzLl9jb25uZWN0aW9uKT09bnVsbHx8cy5zZW5kKG5bMV0pfSl9fWNsYXNzIFN0cmVhbWluZ1RyYW5zbWl0dGVyIGV4dGVuZHMgQWJzdHJhY3RGbG93e2NvbnN0cnVjdG9yKGUpe3ZhciBvO3N1cGVyKCk7Zih0aGlzLCJfY29ubmVjdGlvbiIpO2YodGhpcywiX2NvbXBlbnNhdG9yIik7Zih0aGlzLCJfc3BsaXR0ZXIiKTtmKHRoaXMsIl9zdHJhdGVneSIpO2YodGhpcywiX2Nsb3NpbmciKTtmKHRoaXMsIl9oYW5kbGVDb21wZW5zYXRlIiwoKT0+e3RoaXMuY29udGV4dC5lbWl0KCJmZWVkYmFjayIse3R5cGU6U2lnbmFsVHlwZS5Db21wZW5zYXRlU25hcHNob3QscmVjb3JkaW5nSWQ6dGhpcy5jb250ZXh0LmlkfSl9KTtmKHRoaXMsIl9oYW5kbGVDb21tYW5kIixlPT57dmFyIG47c3dpdGNoKGUuY29tbWFuZCl7Y2FzZSBTdHJlYW1pbmdDb21tYW5kVHlwZS5TeW5jQmxvY2s6e3RoaXMuY29udGV4dC5lbWl0KCJmZWVkYmFjayIse3R5cGU6U2lnbmFsVHlwZS5CbG9ja0NyZWF0ZWQsYmxvY2s6ZS5ibG9ja30pO2JyZWFrfWNhc2UgU3RyZWFtaW5nQ29tbWFuZFR5cGUuUmVjZWl2ZXJTdG9wcGVkOnsobj10aGlzLl9jbG9zaW5nKT09bnVsbHx8bi5jYWxsKHRoaXMpO2JyZWFrfX19KTtmKHRoaXMsIl9oYW5kbGVDbG9zZUJ5Q29ubiIsKCk9Pnt0aGlzLmNvbnRleHQuc3RvcFJlY29yZGluZygpfSk7dGhpcy5jb250ZXh0PWUsdGhpcy5fc3BsaXR0ZXI9bmV3IENodW5rU3BsaXR0ZXIoZSksdGhpcy5fc3RyYXRlZ3k9KG89ZT09bnVsbD92b2lkIDA6ZS50cmFuc21pdHRlcik9PW51bGw/dm9pZCAwOm8uc3RyYXRlZ3k7Y29uc3QgYT10aGlzLnN0cmF0ZWd5LmNvbmZpZyx7YnVmZmVyU2l6ZTpufT1hLHM9Y2UoYSxbImJ1ZmZlclNpemUiXSk7dGhpcy5fY29ubmVjdGlvbj1uZXcgV2ViU29ja2V0Q29ubmVjdGlvbihlLmVudi5nZXRGdWxsVXJsKHRoaXMuc3RyYXRlZ3kudXJsLCEwKSxzKSx0aGlzLl9jb21wZW5zYXRvcj1uZXcgU3RyZWFtaW5nQ29tcGVuc2F0b3IobiksdGhpcy5fY29ubmVjdGlvbi5vbigiY2xvc2VkIix0aGlzLl9oYW5kbGVDbG9zZUJ5Q29ubil9Z2V0IHN0cmF0ZWd5KCl7cmV0dXJuIHRoaXMuX3N0cmF0ZWd5fW9wZW4oKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7dGhpcy5fY29tcGVuc2F0b3IuYXR0YWNoKHRoaXMuX2Nvbm5lY3Rpb24pLHRoaXMuX2NvbXBlbnNhdG9yLm9uKCJjb21wZW5zYXRlIix0aGlzLl9oYW5kbGVDb21wZW5zYXRlKSx0aGlzLl9jb21wZW5zYXRvci5vbigiY29tbWFuZCIsdGhpcy5faGFuZGxlQ29tbWFuZCkseWllbGQgdGhpcy5fY29ubmVjdGlvbi5vcGVuKCl9KX1jbG9zZSgpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fY29tcGVuc2F0b3IuZmx1c2goKSx0aGlzLl9jb25uZWN0aW9uLnNlbmQoSlNPTi5zdHJpbmdpZnkoTmV3Q29tbWFuZCh7Y29tbWFuZDpTdHJlYW1pbmdDb21tYW5kVHlwZS5SZWNvcmRlclN0b3BwZWR9KSkpLG5ldyBQcm9taXNlKChlLG4pPT57dGhpcy5fY2xvc2luZz1zPT57cz9uKHMpOmUoKSx0aGlzLl9jbG9zaW5nPXZvaWQgMH19KS50aGVuKCgpPT4odGhpcy5fY29tcGVuc2F0b3IuZGV0YWNoKCksdGhpcy5fY29tcGVuc2F0b3Iub2ZmKCJjb21wZW5zYXRlIix0aGlzLl9oYW5kbGVDb21wZW5zYXRlKSx0aGlzLl9jb21wZW5zYXRvci5vZmYoImNvbW1hbmQiLHRoaXMuX2hhbmRsZUNvbW1hbmQpLHRoaXMuX2Nvbm5lY3Rpb24uY2xvc2UoKSkpfSl9aGFuZGxlSW5wdXQoZSl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe2lmKHRoaXMuc3RyYXRlZ3kuY29uZmlnLnNwbGl0Q2h1bmtzIT09ITEpe2NvbnN0IG49dGhpcy5fc3BsaXR0ZXIuc3BsaXQoZSk7Zm9yKGNvbnN0IHMgb2Ygbil0aGlzLl9jb25uZWN0aW9uLnNlbmRDaHVuayh7dHlwZTpXZWJTb2NrZXRNZXNzYWdlVHlwZS5DaHVuayxzZXF1ZW5jZTpzLmhlYWRlci5pZCxkYXRhOnNlcmlhbGl6ZUNodW5rKHMpfSl9ZWxzZXtjb25zdCBzPXRoaXMuX3NwbGl0dGVyLnNwbGl0KGUsMSlbMF0sbz15aWVsZCBnemlwKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzdHJpbmdpZnlDaHVuayhzKSkpO3RoaXMuX2Nvbm5lY3Rpb24uc2VuZENodW5rKHt0eXBlOldlYlNvY2tldE1lc3NhZ2VUeXBlLkNodW5rLHNlcXVlbmNlOnMuaGVhZGVyLmlkLGRhdGE6b30pfX0pfX1jbGFzcyBSZWNvcmRpbmdGbG93IGV4dGVuZHMgQWJzdHJhY3RGbG93e2NvbnN0cnVjdG9yKGUpe3ZhciBsLHUsaCxwO3N1cGVyKCk7Zih0aGlzLCJfdHJhbnNtaXR0ZXIiKTtmKHRoaXMsIl9mcmFtZUJ1ZmZlciIpO2YodGhpcywiX3N1YnNjcmlwdGlvbiIpO3RoaXMuY29udGV4dD1lO2NvbnN0IG49bmV3IERlZmF1bHRQYWNrZXIoZSk7bGV0IHM9MWUzO2NvbnN0IG89KGw9ZS50cmFuc21pdHRlcik9PW51bGw/dm9pZCAwOmwuc3RyYXRlZ3k7aWYoKG89PW51bGw/dm9pZCAwOm8ubW9kZSk9PT1SZWNvcmRpbmdNb2RlLlN0cmVhbWluZ3x8KG89PW51bGw/dm9pZCAwOm8ubW9kZSk9PT1SZWNvcmRpbmdNb2RlLkxpdmVTdHJlYW1pbmcpdGhpcy5fdHJhbnNtaXR0ZXI9bmV3IFN0cmVhbWluZ1RyYW5zbWl0dGVyKGUpLHM9KHU9by5jb25maWcuYnVmZmVyVGltZSkhPW51bGw/dToxZTM7ZWxzZSBpZigobz09bnVsbD92b2lkIDA6by5tb2RlKT09PVJlY29yZGluZ01vZGUuQmxvY2tpbmcpe2NvbnN0IG09dGhpcy5jb250ZXh0Lm9wdGlvbnMubW9kZU9wdGlvbjt0aGlzLl90cmFuc21pdHRlcj1uZXcgQmxvY2tUcmFuc21pdHRlcihlKSxzPShwPShoPW09PW51bGw/dm9pZCAwOm0uYnVmZmVyVGltZSkhPW51bGw/aDpvLmNvbmZpZy5idWZmZXJUaW1lKSE9bnVsbD9wOjEyZTR9ZWxzZSB0aGlzLl90cmFuc21pdHRlcj1uZXcgQmxvYlRyYW5zbWl0dGVyKGUpO3RoaXMuX2ZyYW1lQnVmZmVyPW5ldyBGcmFtZUJ1ZmZlcih7YnVmZmVyVGltZTpzfSk7Y29uc3QgYT1uZXcgUHJvY2Vzc29yQ29udGV4dChuZXcgQ29udHJvbGxlciksYz1uZXcgSW5jcmVtZW50YWxQcm9jZXNzb3IoYSxlKTt0aGlzLnBpcGUoYS5jb250cm9sbGVyLmFzUGlwZWFibGUoKSkucGlwZShjLmFzUGlwZWFibGUoKSkucGlwZSh0aGlzLl9mcmFtZUJ1ZmZlci5hc1BpcGVhYmxlKCkpLnBpcGUobi5hc1BpcGVhYmxlKCkpLnBpcGUodGhpcy5fdHJhbnNtaXR0ZXIuYXNQaXBlYWJsZSgpKX1zdWJzY3JpYmUoZSl7dGhpcy5fc3Vic2NyaXB0aW9uPWUuc3Vic2NyaWJlKG49Pnt0aGlzLmhhbmRsZUlucHV0KG4pfSl9aGFuZGxlSW5wdXQoZSl7dGhpcy5vdXRwdXQoZSl9b3Blbigpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXt5aWVsZCB0aGlzLl90cmFuc21pdHRlci5vcGVuKCl9KX1jbG9zZSgpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXt2YXIgZTt0aGlzLm91dHB1dChuZXdOb29wRnJhbWUodGltZS5ub3coKSkpLChlPXRoaXMuX3N1YnNjcmlwdGlvbik9PW51bGx8fGUudW5zdWJzY3JpYmUoKSx5aWVsZCB0aGlzLl9mcmFtZUJ1ZmZlci5mbHVzaCgpLHRoaXMuX2ZyYW1lQnVmZmVyLmRpc3Bvc2UoKSx5aWVsZCB0aGlzLl90cmFuc21pdHRlci5jbG9zZSgpfSl9ZHVtcCgpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtpZih0aGlzLl90cmFuc21pdHRlci5kdW1wKXJldHVybiB0aGlzLl90cmFuc21pdHRlci5kdW1wKCk7dGhyb3cgbmV3IFJlY29yZGluZ0Vycm9yKGBUcmFuc21pdHRlciBmb3IgJyR7dGhpcy5jb250ZXh0LnJlY29yZGluZy5pZH0nIGRvZXMgbm90IHN1cHBvcnQgZHVtcGluZy5gKX0pfX1jbGFzcyBSZWNvcmRpbmdNYW5hZ2VySW1wbHtjb25zdHJ1Y3Rvcih0KXtmKHRoaXMsImlucHV0Iik7Zih0aGlzLCJfcmV0cnkiKTtmKHRoaXMsImVudiIpO2YodGhpcywiYXBpQ2xpZW50Iik7Zih0aGlzLCJodG1sUHJvY2Vzc29yIik7Zih0aGlzLCJpbnNpZ2h0UHJvY2Vzc29yIik7Zih0aGlzLCJuZXR3b3JrUHJvY2Vzc29yIik7Zih0aGlzLCJfcHJvY2Vzc29yQ29udGV4dCIpO2YodGhpcywiX2NhY2hlT3B0aW9ucyIpO2YodGhpcywiX2JsYWNrYm94T3B0aW9ucyIpO2YodGhpcywiX2Jsb2NraW5nT3B0aW9ucyIpO2YodGhpcywiX2JsYWNrYm94UHJvY2Vzc29yIik7Zih0aGlzLCJfZXZlbnRzIixuZXcgRXZlbnRFbWl0dGVyKTtmKHRoaXMsIl9jb250ZXh0TWFwIixuZXcgTWFwKTtmKHRoaXMsIl9mbG93TWFwIixuZXcgTWFwKTtmKHRoaXMsImhhbmRsZUZlZWRiYWNrIix0PT57c3dpdGNoKHQudHlwZSl7Y2FzZSBTaWduYWxUeXBlLkNvbXBlbnNhdGVTbmFwc2hvdDp0aGlzLmh0bWxQcm9jZXNzb3IuY2FwdHVyZVNuYXBzaG90RnJhbWUoZT0+e2lmKCFlKXJldHVybjtjb25zdCBuPXRoaXMuX2Zsb3dNYXAuZ2V0KHQucmVjb3JkaW5nSWQpO24mJm4ub3V0cHV0KGUpfSk7YnJlYWt9fSk7Zih0aGlzLCJfaGFuZGxlRnJhbWUiLHQ9Pnt0aGlzLl9lbWl0KCJmcmFtZSIsdCl9KTt0aGlzLl9yZXRyeT1uZXcgUmV0cnk7Y29uc3R7ZW52aXJvbm1lbnQ6ZSxodG1sOm4sbmV0d29yazpzLGluc2lnaHQ6byxpbnRlcmNlcHRSZXF1ZXN0OmF9PXQ7dGhpcy5lbnY9bmV3IEVudmlyb25tZW50KGUpLHRoaXMuYXBpQ2xpZW50PW5ldyBBUElDbGllbnQodGhpcy5lbnYpLGEmJih0aGlzLmFwaUNsaWVudC5yZXF1ZXN0SW50ZXJjZXB0b3I9YSksdGhpcy5fcHJvY2Vzc29yQ29udGV4dD1uZXcgUHJvY2Vzc29yQ29udGV4dChuZXcgQ29udHJvbGxlciksdGhpcy5fcHJvY2Vzc29yQ29udGV4dC50cmFja1R5cGVzPW5vcm1hbGl6ZVRyYWNrVHlwZXModC50cmFja2VycyksdGhpcy5odG1sUHJvY2Vzc29yPW5ldyBIVE1MUHJvY2Vzc29yKHRoaXMuX3Byb2Nlc3NvckNvbnRleHQsbiksdGhpcy5uZXR3b3JrUHJvY2Vzc29yPW5ldyBOZXR3b3JrUHJvY2Vzc29yKHRoaXMuX3Byb2Nlc3NvckNvbnRleHQscyksdGhpcy5pbnNpZ2h0UHJvY2Vzc29yPW5ldyBJbnNpZ2h0UHJvY2Vzc29yKHRoaXMuX3Byb2Nlc3NvckNvbnRleHQsbyksdGhpcy5faW5pdENhY2hlT3B0aW9ucyh0KSx0aGlzLl9pbml0QmxhY2tib3hPcHRpb25zKHQpfW9ic2VydmUodCl7bGV0IGU9dC5waXBlKHRoaXMuX3Byb2Nlc3NvckNvbnRleHQuY29udHJvbGxlci5hc1BpcGVhYmxlKCkpLnBpcGUodGhpcy5odG1sUHJvY2Vzc29yLmFzUGlwZWFibGUoKSkucGlwZSh0aGlzLm5ldHdvcmtQcm9jZXNzb3IuYXNQaXBlYWJsZSgpKTt0aGlzLmluc2lnaHRQcm9jZXNzb3ImJihlPWUucGlwZSh0aGlzLmluc2lnaHRQcm9jZXNzb3IuYXNQaXBlYWJsZSgpKSksdGhpcy5pbnB1dD1lLnBpcGUodGFwKHRoaXMuX2hhbmRsZUZyYW1lKSkucGlwZShzaGFyZSgpKX1zeW5jT3B0aW9ucyh0LGUpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXt2YXIgbixzLG8sYSxjO3RoaXMuZW52LmJhc2VVUkw9KG49dC5lbnZpcm9ubWVudCk9PW51bGw/dm9pZCAwOm4uYmFzZVVSTCx0aGlzLmVudi50eXBlPShzPXQuZW52aXJvbm1lbnQpPT1udWxsP3ZvaWQgMDpzLnR5cGUsdGhpcy5lbnYuYXBpUHJlZml4PShvPXQuZW52aXJvbm1lbnQpPT1udWxsP3ZvaWQgMDpvLmFwaVByZWZpeCx0aGlzLmVudi5oZWFkZXJzPShhPXQuZW52aXJvbm1lbnQpPT1udWxsP3ZvaWQgMDphLmhlYWRlcnMsdC5pbnRlcmNlcHRSZXF1ZXN0JiYodGhpcy5hcGlDbGllbnQucmVxdWVzdEludGVyY2VwdG9yPXQuaW50ZXJjZXB0UmVxdWVzdCksdGhpcy5faW5pdEJsYWNrYm94T3B0aW9ucyh0KSx0aGlzLl9ibG9ja2luZ09wdGlvbnM9dC5ibG9ja2luZyx0aGlzLmh0bWxQcm9jZXNzb3Iuc3luY09wdGlvbnModC5odG1sKSx0aGlzLm5ldHdvcmtQcm9jZXNzb3Iuc3luY09wdGlvbnModC5uZXR3b3JrKSwoYz10aGlzLmluc2lnaHRQcm9jZXNzb3IpPT1udWxsfHxjLnN5bmNPcHRpb25zKHQuaW5zaWdodCksdGltZS5zeW5jKGUubWFpblRpbWUpfSl9Z2V0Q3VycmVudFJlY29yZGluZ0NvdW50KCl7cmV0dXJuIGIodGhpcyxudWxsLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9jb250ZXh0TWFwLnNpemV9KX1jcmVhdGVSZWNvcmRpbmdDb250ZXh0KHQpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtpZighdGhpcy5pbnB1dCl0aHJvdyBuZXcgRXJyb3IoIlRyYWNraW5nIHNvdXJjZSBpcyBub3QgcmVhZHkuIik7Y29uc3R7cmVjb3JkaW5nOmUsdHJhbnNwb3J0Om59PXlpZWxkIGNyZWF0ZVJlY29yZGluZyh0aGlzLmFwaUNsaWVudCx0KSxzPVEoTih7fSxlKSx7Y3JlYXRlVGltZTpuZXcgRGF0ZShlLmNyZWF0ZVRpbWUpLmdldFRpbWUoKX0pLG89UShOKHt9LHQpLHt0cmFuc3BvcnQ6bn0pO2xldCBhO2lmKHQubW9kZT09PVJlY29yZGluZ01vZGUuQmxhY2tib3g/YT1uZXcgQmxhY2tib3hSZWNvcmRpbmdDb250ZXh0KHRoaXMscyxvKTp0Lm1vZGU9PT1SZWNvcmRpbmdNb2RlLkluTWVtb3J5P2E9bmV3IEluTWVtb3J5UmVjb3JkaW5nQ29udGV4dCh0aGlzLHMsbyk6KHQubW9kZT09PVJlY29yZGluZ01vZGUuQmxvY2tpbmcmJihvLm1vZGVPcHRpb249dGhpcy5fYmxvY2tpbmdPcHRpb25zKSxhPW5ldyBSZWNvcmRpbmdDb250ZXh0KHRoaXMscyxvKSksYS5vbigiZmVlZGJhY2siLHRoaXMuaGFuZGxlRmVlZGJhY2spLHQubW9kZT09PVJlY29yZGluZ01vZGUuQmxhY2tib3gpe2lmKCF0aGlzLl9ibGFja2JveFByb2Nlc3Nvcil7Y29uc3QgYz1uZXcgQmxhY2tib3hQcm9jZXNzb3IodGhpcy5fcHJvY2Vzc29yQ29udGV4dCx0aGlzLHRoaXMuX2JsYWNrYm94T3B0aW9ucyk7Yy5zdWJzY3JpYmUodGhpcy5pbnB1dCksdGhpcy5fYmxhY2tib3hQcm9jZXNzb3I9Y310aGlzLl9ibGFja2JveFByb2Nlc3Nvci5qb2luKGEpfWVsc2V7Y29uc3QgYz1uZXcgUmVjb3JkaW5nRmxvdyhhKTt5aWVsZCBjLm9wZW4oKSxjLnN1YnNjcmliZSh0aGlzLmlucHV0KSx0aGlzLl9jb250ZXh0TWFwLnNpemU+MCYmKHlpZWxkIHRoaXMuaHRtbFByb2Nlc3Nvci5jYXB0dXJlU25hcHNob3RGcmFtZShsPT57bCYmKGwudGltZT1hLnN0YXJ0VGltZSxjLmhhbmRsZUlucHV0KGwpKX0pKSx0aGlzLl9mbG93TWFwLnNldChzLmlkLGMpfXJldHVybiB0aGlzLl9jb250ZXh0TWFwLnNldChhLmlkLGEpLHRoaXMuX2VtaXQoInN0YXJ0UmVjb3JkaW5nIixhLnJlY29yZGluZyksYX0pfXN0b3BSZWNvcmRpbmdDb250ZXh0KHQpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtjb25zdCBlPXRoaXMuX2Zsb3dNYXAuZ2V0KHQpO2UmJih5aWVsZCBlLmNsb3NlKCkpLHRoaXMuX2NsZWFuUmVjb3JkaW5nQ29udGV4dCh0KX0pfV9jbGVhblJlY29yZGluZ0NvbnRleHQodCl7dmFyIHMsbyxhLGM7Y29uc3QgZT10aGlzLl9mbG93TWFwLmdldCh0KSxuPXRoaXMuX2NvbnRleHRNYXAuZ2V0KHQpO2UmJihlLmNvbnRleHQub2ZmKCJmZWVkYmFjayIsdGhpcy5oYW5kbGVGZWVkYmFjayksZS5jb250ZXh0LmVtaXQoInN0b3BwZWQiKSksdGhpcy5fZmxvd01hcC5kZWxldGUodCksbiYmKHRoaXMuX2NvbnRleHRNYXAuZGVsZXRlKHQpLHRoaXMuX2VtaXQoInN0b3BSZWNvcmRpbmciLG4ucmVjb3JkaW5nKSwocz10aGlzLl9ibGFja2JveFByb2Nlc3Nvcik9PW51bGx8fHMucmVtb3ZlKG4pLCgoYT0obz10aGlzLl9ibGFja2JveFByb2Nlc3Nvcik9PW51bGw/dm9pZCAwOm8uZ2V0U2l6ZSgpKSE9bnVsbD9hOjApPT09MCYmKChjPXRoaXMuX2JsYWNrYm94UHJvY2Vzc29yKT09bnVsbHx8Yy5kaXNwb3NlKCksdGhpcy5fYmxhY2tib3hQcm9jZXNzb3I9dm9pZCAwKSl9ZHVtcFJlY29yZGluZyh0LGUpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtpZih0aGlzLl9mbG93TWFwLmhhcyh0KSlyZXR1cm4gdGhpcy5fZmxvd01hcC5nZXQodCkuZHVtcCgpO2lmKHRoaXMuX2JsYWNrYm94UHJvY2Vzc29yKXtjb25zdCBuPXttZXRhOmV9LHM9eWllbGQgdGhpcy5fYmxhY2tib3hQcm9jZXNzb3IuZHVtcCh0LG4pO3JldHVybiB0aGlzLl9lbWl0KCJkdW1wUmVjb3JkaW5nIixRKE4oe30scykse3BhcmVudDp0LHJlZlR5cGU6ImJsYWNrYm94In0pKSxzfXRocm93IG5ldyBSZWNvcmRpbmdFcnJvcihgVW5rbm93biByZWNvcmRpbmcgJHt0fS5gKX0pfWNhY2hlUmVjb3JkaW5ncygpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fYmxhY2tib3hQcm9jZXNzb3I/dGhpcy5fYmxhY2tib3hQcm9jZXNzb3IuY2FjaGUoKTpbXX0pfXVwbG9hZFJlY29yZGluZ0NhY2hlcygpe3JldHVybiBiKHRoaXMsbnVsbCxmdW5jdGlvbiooKXt2YXIgZTtjb25zdCB0PShlPXRoaXMuX2NhY2hlT3B0aW9ucyk9PW51bGw/dm9pZCAwOmUuc3RvcmFnZVByb3ZpZGVyLmdldFN0b3JhZ2UoKTtpZih0KXtjb25zdCBuPXlpZWxkIHQuZ2V0UmVjb3JkaW5ncygpO3RoaXMuX3VwbG9hZFJlY29yZGluZ0NhY2hlcyhuLHQpfX0pfV91cGxvYWRSZWNvcmRpbmdDYWNoZXModCxlKXtyZXR1cm4gYih0aGlzLG51bGwsZnVuY3Rpb24qKCl7Zm9yKGNvbnN0IG4gb2YgdCl0cnl7Y29uc3R7ZnJhbWVzOnMsc3RhcnRUaW1lOm8sZW5kVGltZTphLG1vZGU6YyxyZWNvcmRpbmdPcHRpb25zOmx9PW47aWYoYz09PVJlY29yZGluZ01vZGUuQmxhY2tib3gpe2NvbnN0e3JlY29yZGluZzp1LHRyYW5zcG9ydDpofT15aWVsZCBjcmVhdGVSZWNvcmRpbmcodGhpcy5hcGlDbGllbnQsbCkscD1oLnN0cmF0ZWdpZXMuZmluZCh2PT52Lm1vZGU9PT1SZWNvcmRpbmdNb2RlLkJsYWNrYm94JiYiY2hhbm5lbFR5cGUiaW4gdiksbT15aWVsZCBwYWNrKGVuY29kZShzLG8pLHMubGVuZ3RoLHNbMF0udGltZSxhLHUuaWQsbyk7eWllbGQgdGhpcy5fcmV0cnkuYXR0ZW1wdCgoKT0+Y3JlYXRlQmxvY2sodGhpcy5hcGlDbGllbnQse2Jsb2I6bmV3IEJsb2IoW20uZGF0YV0se3R5cGU6ImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSJ9KSxyZWNvcmRpbmdJZDp1LmlkLHRva2VuOnAuY29uZmlnLnRva2VuLG9mZnNldDptLmZyYW1lUmFuZ2VbMF0sY291bnQ6bS5mcmFtZVJhbmdlWzFdLGZpcnN0RnJhbWVUaW1lOm0uZmlyc3RGcmFtZVRpbWUsbGFzdEZyYW1lVGltZTptLmxhc3RGcmFtZVRpbWV9KSl9eWllbGQgZS5kZWxldGVSZWNvcmRpbmdzKG4pfWNhdGNoKHMpe2lmKHMuY29kZT09PUJSX1JFQ09SRElOR19EVVBMSUNBVEVEKXRyeXt5aWVsZCBlLmRlbGV0ZVJlY29yZGluZ3Mobil9Y2F0Y2goYSl7fX19KX1faW5pdENhY2hlT3B0aW9ucyh0KXtjb25zdCBlPU4oe2xpbWl0OjEwfSx0eXBlb2YodD09bnVsbD92b2lkIDA6dC5jYWNoZSk9PSJib29sZWFuIj97fTp0LmNhY2hlKTtlLnN0b3JhZ2VQcm92aWRlcnx8KGUuc3RvcmFnZVByb3ZpZGVyPW5ldyBJbmRleGVkREJSZWNvcmRpbmdTdG9yYWdlUHJvdmlkZXIpLHRoaXMuX2NhY2hlT3B0aW9ucz1lfV9pbml0QmxhY2tib3hPcHRpb25zKHQpe3RoaXMuX2JsYWNrYm94T3B0aW9ucz1RKE4oe30sdC5ibGFja2JveCkse2NhY2hlOnRoaXMuX2NhY2hlT3B0aW9uc30pfV9lbWl0KHQsLi4uZSl7dGhpcy5fZXZlbnRzLmVtaXQodCwuLi5lKX1vbih0LGUpe3RoaXMuX2V2ZW50cy5vbih0LGUse30pfW9uY2UodCxlKXt0aGlzLl9ldmVudHMub25jZSh0LGUse30pfW9mZih0LGUsbixzKXt0aGlzLl9ldmVudHMub2ZmKHQsZSx7fSxzKX1hZGRMaXN0ZW5lcih0LGUpe3RoaXMuX2V2ZW50cy5hZGRMaXN0ZW5lcih0LGUse30pfXJlbW92ZUxpc3RlbmVyKHQsZSxuLHMpe3RoaXMuX2V2ZW50cy5yZW1vdmVMaXN0ZW5lcih0LGUse30scyl9fXZhciBUcmFuc2ZlclBvc2l0aW9uPShyPT4oci5Xb3JrZXI9IndvcmtlciIsci5NYWluPSJtYWluIixyKSkoVHJhbnNmZXJQb3NpdGlvbnx8e30pO2NsYXNzIFJlY29yZGluZ0NvbnRleHRUcmFuc2ZlckhhbmRsZXJ7Y29uc3RydWN0b3IodCl7dGhpcy5wb3NpdGlvbj10fWNhbkhhbmRsZSh0KXtyZXR1cm4gdCBpbnN0YW5jZW9mIFJlY29yZGluZ0NvbnRleHR9c2VyaWFsaXplKHQpe2NvbnN0e3BvcnQxOmUscG9ydDI6bn09bmV3IE1lc3NhZ2VDaGFubmVsO2lmKHQgaW5zdGFuY2VvZiBSZWNvcmRpbmdDb250ZXh0KXtjb25zdCBzPXtpZDp0LmlkLHN0YXJ0VGltZTp0LnN0YXJ0VGltZSxyZWNvcmRpbmc6dC5yZWNvcmRpbmcsdHJhbnNtaXR0ZXI6dC50cmFuc21pdHRlcixiYXNlVVJMOnQuYmFzZVVSTCx0cmFja2Vyczp0LnRyYWNrZXJzfTt0IGluc3RhbmNlb2YgQmxhY2tib3hSZWNvcmRpbmdDb250ZXh0JiYocy5kdW1wQ29uZmlnPXQuZHVtcENvbmZpZyksZS5wb3N0TWVzc2FnZSh7dHlwZToiUmVjb3JkaW5nQ29udGV4dE1hbmlmZXN0Iix2YWx1ZTp7aWQ6Z2VuZXJhdGVVVUlEKCksc3RhdGljUHJvcGVydGllczpzLGV4cG9zZU1ldGhvZHM6WyJvbiIsIm9uY2UiLCJvZmYiLCJzdG9wUmVjb3JkaW5nIiwiY2FjaGVSZWNvcmRpbmdzIiwiZHVtcFJlY29yZGluZyIsImdldER1bXBDb25maWciLCJhZGRMaXN0ZW5lciIsInJlbW92ZUxpc3RlbmVyIl19fSl9cmV0dXJuIGV4cG9zZSh0LGUpLFtuLFtuXV19ZGVzZXJpYWxpemUodCl7bGV0IGU7Y29uc3Qgbj1uZXcgU2V0LHM9bmV3IFNldCxvPW5ldyBTZXQsYT13cmFwJDEodCksYz1uZXcgUHJveHkoYSx7Z2V0KHUsaCxwKXtjb25zdCBtPWg7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJSZWNvcmRpbmdDb250ZXh0IG1hbmlmZXN0IG5vdCBmb3VuZCBmcm9tIHdvcmtlciIpO2lmKG4uaGFzKG0pKXJldHVybiBlLnN0YXRpY1Byb3BlcnRpZXNbbV07aWYobT09PSJ0b1N0cmluZyIpcmV0dXJuKCk9PkpTT04uc3RyaW5naWZ5KGU9PW51bGw/dm9pZCAwOmUuc3RhdGljUHJvcGVydGllcy5yZWNvcmRpbmcpO2NvbnN0IHY9UmVmbGVjdC5nZXQodSxoLHApO2lmKHMuaGFzKG0pKXJldHVybiguLi53KT0+e2NvbnN0IFQ9dy5tYXAoQz0+e2lmKHR5cGVvZiBDPT0iZnVuY3Rpb24iKXtjb25zdCBNPXByb3h5KEMpO3JldHVybiBvLmFkZChNKSxNfXJldHVybiBDfSk7cmV0dXJuIFJlZmxlY3QuYXBwbHkodix1LFsuLi5UXSl9O2lmKGg9PT0idGhlbiJ8fGg9PT1yZWxlYXNlUHJveHkpcmV0dXJuIHZ9fSk7cmV0dXJuIG5ldyBQcm9taXNlKHU9Pntjb25zdCBoPXA9Pnt0eXBlb2YgcC5kYXRhPT0ib2JqZWN0IiYmcC5kYXRhLnR5cGU9PT0iUmVjb3JkaW5nQ29udGV4dE1hbmlmZXN0IiYmKGU9cC5kYXRhLnZhbHVlLE9iamVjdC5rZXlzKGUuc3RhdGljUHJvcGVydGllcykuZm9yRWFjaChtPT57bi5hZGQobSl9KSxlLmV4cG9zZU1ldGhvZHMuZm9yRWFjaChtPT57cy5hZGQobSl9KSx1KCksdC5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIixoKSl9O3QuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsaCwhMCksdC5zdGFydCgpfSkudGhlbigoKT0+KGMub25jZSgic3RvcHBlZCIsKCk9Pnt0cnl7YVtyZWxlYXNlUHJveHldKCksby5mb3JFYWNoKHU9Pnt0eXBlb2YgdVtyZWxlYXNlUHJveHldPT0iZnVuY3Rpb24iJiZ1W3JlbGVhc2VQcm94eV0oKX0pLG8uY2xlYXIoKSxzLmNsZWFyKCl9Y2F0Y2godSl7Y29uc29sZS5lcnJvcih1KX19KSxjKSl9fXRyeXtzZWxmLndpbmRvdz1zZWxmfWNhdGNoKHIpe310cmFuc2ZlckhhbmRsZXJzLnNldCgiUmVjb3JkaW5nQ29udGV4dCIsbmV3IFJlY29yZGluZ0NvbnRleHRUcmFuc2ZlckhhbmRsZXIoVHJhbnNmZXJQb3NpdGlvbi5Xb3JrZXIpKTtmdW5jdGlvbiBtYWluKCl7Y29uc3Qgcj13b3JrZXJCcmlkZ2UoKSx0PW5ldyBSZWNvcmRpbmdNYW5hZ2VySW1wbCh7fSk7dC5vYnNlcnZlKHIpLGV4cG9zZSh0KX10eXBlb2YgZ2xvYmFsVGhpcy5Xb3JrZXJHbG9iYWxTY29wZSE9InVuZGVmaW5lZCImJnNlbGYgaW5zdGFuY2VvZiBnbG9iYWxUaGlzLldvcmtlckdsb2JhbFNjb3BlJiZtYWluKCl9KSgpOwo=",blob="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(){let e;try{if(e=blob&&(window.URL||window.webkitURL).createObjectURL(blob),!e)throw"";return new Worker(e)}catch(t){return new Worker("data:application/javascript;base64,"+encodedJs)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class MultithreadedRecorder extends AbstractRecorder{constructor(e){super(RecorderMode.Multithreaded,e),d(this,"_workerProvider"),d(this,"_worker"),this._verifyOptions(e),this._workerProvider=null==e?void 0:e.worker}get worker(){const e=this._workerProvider||WorkerWrapper;return null==this._worker&&(this._worker="string"==typeof e?new Worker(e,{type:"module"}):"function"==typeof e?new e:e),this._worker}onInit(){}createRecordingManager(){const e=createRecordingManagerFromWorker(this.worker),t=new Environment(this.options.environment);return this.addInitialTask(new Promise((e=>{if(!this.trackerSource)throw new RecordingError("Trackers must be initialized before creating recording manager.");{const e=new WorkerBridgeFlow(this.worker);this.trackerSource.pipe(e.asPipeable())}e()}))),this.addInitialTask(e.syncOptions(serialize(M(v({},this.options),{environment:t.toOptions()})),{mainTime:now()})),e.on("stopRecording",proxy(this._watchRecordingStop)),e.on("dumpRecording",proxy(this._watchRecordingDump)),e.on("frame",proxy(this._watchRecordingFrame)),e}_verifyOptions(e){var t,n,l,i;if(null!=(n=null==(t=null==e?void 0:e.html)?void 0:t.dataMasks)&&n.length||null!=(i=null==(l=null==e?void 0:e.network)?void 0:l.dataMasks)&&i.length)throw console.log("\ud83c\udfa5 ByteReplay: %cPlease note that custom DataMasks are not supported in multithreaded mode yet.","font-weight:bold;color:#446EEA"),new RecordingError("Custom DataMasks are not supported in multithreaded mode.");this.options.interceptRequest&&(this.options.interceptRequest=String(this.options.interceptRequest))}}class InMemoryRecordingContext extends RecordingContext{dumpRecording(){return super.dumpRecording()}}function createRecording(e,t){const{id:n,token:l,mode:i,clientTime:s,meta:c,environment:o,parent:a,refType:r,trackers:d}=t;return e.post(`recording/${null!=n?n:generateUUID$1()}/create`,{mode:i,clientTime:s,meta:c,environment:o,parent:a,refType:r,trackers:d},l?{Authorization:l}:void 0)}function createBlock(e,t){return V(this,null,(function*(){const{token:n,recordingId:l,blob:i,offset:s,count:c,firstFrameTime:o,lastFrameTime:a}=t,r=createFormData();r.append("block",i),r.append("offset",`${s}`),r.append("count",`${c}`),r.append("firstFrameTime",`${o}`),r.append("lastFrameTime",`${a}`);const d={};return n&&(d.Authorization=n),e.post(`storage/${l}/block`,r,d)}))}const BR_RECORDING_DUPLICATED="BR_RECORDING_DUPLICATED";function encode(e,t){const n=e.map((e=>JSON.stringify([e.time-t,e.trackType,e.event.eventType,e.event.data])));n.push("");const l=n.join("\n");return(new TextEncoder).encode(l)}class DefaultEncoder{constructor(e){this.context=e}encode(e){return encode(e,this.context.startTime)}}var SignalType=(e=>(e.CompensateSnapshot="CompensateSnapshot",e.BlockCreated="BlockCreated",e.FrameIndex="FrameIndex",e))(SignalType||{}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,t){for(var n=new u16(31),l=0;l<31;++l)n[l]=t+=1<<e[l-1];var i=new i32(n[30]);for(l=1;l<30;++l)for(var s=n[l];s<n[l+1];++s)i[s]=s-n[l]<<5|l;return{b:n,r:i}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),revfd=_b.r,rev=new u16(32768),i=0;i<32768;++i){var x=(43690&i)>>1|(21845&i)<<1;x=(52428&x)>>2|(13107&x)<<2,x=(61680&x)>>4|(3855&x)<<4,rev[i]=((65280&x)>>8|(255&x)<<8)>>1}for(var hMap=function(e,t,n){for(var l=e.length,i=0,s=new u16(t);i<l;++i)e[i]&&++s[e[i]-1];var c,o=new u16(t);for(i=1;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;if(n){c=new u16(1<<t);var a=15-t;for(i=0;i<l;++i)if(e[i])for(var r=i<<4|e[i],d=t-e[i],h=o[e[i]-1]++<<d,u=h|(1<<d)-1;h<=u;++h)c[rev[h]>>a]=r}else for(c=new u16(l),i=0;i<l;++i)e[i]&&(c[i]=rev[o[e[i]-1]++]>>15-e[i]);return c},flt=new u8(288),i=0;i<144;++i)flt[i]=8;for(var i=144;i<256;++i)flt[i]=9;for(var i=256;i<280;++i)flt[i]=7;for(var i=280;i<288;++i)flt[i]=8;for(var fdt=new u8(32),i=0;i<32;++i)fdt[i]=5;var flm=hMap(flt,9,0),fdm=hMap(fdt,5,0),shft=function(e){return(e+7)/8|0},slc=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new u8(e.subarray(t,n))},wbits=function(e,t,n){n<<=7&t;var l=t/8|0;e[l]|=n,e[l+1]|=n>>8},wbits16=function(e,t,n){n<<=7&t;var l=t/8|0;e[l]|=n,e[l+1]|=n>>8,e[l+2]|=n>>16},hTree=function(e,t){for(var n=[],l=0;l<e.length;++l)e[l]&&n.push({s:l,f:e[l]});var i=n.length,s=n.slice();if(!i)return{t:et,l:0};if(1==i){var c=new u8(n[0].s+1);return c[n[0].s]=1,{t:c,l:1}}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var o=n[0],a=n[1],r=0,d=1,h=2;for(n[0]={s:-1,f:o.f+a.f,l:o,r:a};d!=i-1;)o=n[n[r].f<n[h].f?r++:h++],a=n[r!=d&&n[r].f<n[h].f?r++:h++],n[d++]={s:-1,f:o.f+a.f,l:o,r:a};var u=s[0].s;for(l=1;l<i;++l)s[l].s>u&&(u=s[l].s);var b=new u16(u+1),m=ln(n[d-1],b,0);if(m>t){l=0;var p=0,Z=m-t,y=1<<Z;for(s.sort((function(e,t){return b[t.s]-b[e.s]||e.f-t.f}));l<i;++l){var X=s[l].s;if(!(b[X]>t))break;p+=y-(1<<m-b[X]),b[X]=t}for(p>>=Z;p>0;){var G=s[l].s;b[G]<t?p-=1<<t-b[G]++-1:++l}for(;l>=0&&p;--l){var V=s[l].s;b[V]==t&&(--b[V],++p)}m=t}return{t:new u8(b),l:m}},ln=function(e,t,n){return-1==e.s?Math.max(ln(e.l,t,n+1),ln(e.r,t,n+1)):t[e.s]=n},lc=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new u16(++t),l=0,i=e[0],s=1,c=function(e){n[l++]=e},o=1;o<=t;++o)if(e[o]==i&&o!=t)++s;else{if(!i&&s>2){for(;s>138;s-=138)c(32754);s>2&&(c(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(c(i),--s;s>6;s-=6)c(8304);s>2&&(c(s-3<<5|8208),s=0)}for(;s--;)c(i);s=1,i=e[o]}return{c:n.subarray(0,l),n:t}},clen=function(e,t){for(var n=0,l=0;l<t.length;++l)n+=e[l]*t[l];return n},wfblk=function(e,t,n){var l=n.length,i=shft(t+2);e[i]=255&l,e[i+1]=l>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var s=0;s<l;++s)e[i+s+4]=n[s];return 8*(i+4+l)},wblk=function(e,t,n,l,i,s,c,o,a,r,d){wbits(t,d++,n),++i[256];for(var h=hTree(i,15),u=h.t,b=h.l,m=hTree(s,15),p=m.t,Z=m.l,y=lc(u),X=y.c,G=y.n,V=lc(p),W=V.c,R=V.n,v=new u16(19),Y=0;Y<X.length;++Y)++v[31&X[Y]];for(Y=0;Y<W.length;++Y)++v[31&W[Y]];for(var T=hTree(v,7),g=T.t,N=T.l,J=19;J>4&&!g[clim[J-1]];--J);var S,f,x,I,L=r+5<<3,k=clen(i,flt)+clen(s,fdt)+c,H=clen(i,u)+clen(s,p)+c+14+3*J+clen(v,g)+2*v[16]+3*v[17]+7*v[18];if(a>=0&&L<=k&&L<=H)return wfblk(t,d,e.subarray(a,a+r));if(wbits(t,d,1+(H<k)),d+=2,H<k){S=hMap(u,b,0),f=u,x=hMap(p,Z,0),I=p;var K=hMap(g,N,0);wbits(t,d,G-257),wbits(t,d+5,R-1),wbits(t,d+10,J-4),d+=14;for(Y=0;Y<J;++Y)wbits(t,d+3*Y,g[clim[Y]]);d+=3*J;for(var F=[X,W],U=0;U<2;++U){var C=F[U];for(Y=0;Y<C.length;++Y){var z=31&C[Y];wbits(t,d,K[z]),d+=g[z],z>15&&(wbits(t,d,C[Y]>>5&127),d+=C[Y]>>12)}}}else S=flm,f=flt,x=fdm,I=fdt;for(Y=0;Y<o;++Y){var M=l[Y];if(M>255){wbits16(t,d,S[(z=M>>18&31)+257]),d+=f[z+257],z>7&&(wbits(t,d,M>>23&31),d+=fleb[z]);var w=31&M;wbits16(t,d,x[w]),d+=I[w],w>3&&(wbits16(t,d,M>>5&8191),d+=fdeb[w])}else wbits16(t,d,S[M]),d+=f[M]}return wbits16(t,d,S[256]),d+f[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(e,t,n,l,i,s){var c=s.z||e.length,o=new u8(l+c+5*(1+Math.ceil(c/7e3))+i),a=o.subarray(l,o.length-i),r=s.l,d=7&(s.r||0);if(t){d&&(a[0]=s.r>>3);for(var h=deo[t-1],u=h>>13,b=8191&h,m=(1<<n)-1,p=s.p||new u16(32768),Z=s.h||new u16(m+1),y=Math.ceil(n/3),X=2*y,G=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<X)&m},V=new i32(25e3),W=new u16(288),R=new u16(32),v=0,Y=0,T=s.i||0,g=0,N=s.w||0,J=0;T+2<c;++T){var S=G(T),f=32767&T,x=Z[S];if(p[f]=x,Z[S]=f,N<=T){var I=c-T;if((v>7e3||g>24576)&&(I>423||!r)){d=wblk(e,a,0,V,W,R,Y,g,J,T-J,d),g=v=Y=0,J=T;for(var L=0;L<286;++L)W[L]=0;for(L=0;L<30;++L)R[L]=0}var k=2,H=0,K=b,F=f-x&32767;if(I>2&&S==G(T-F))for(var U=Math.min(u,I)-1,C=Math.min(32767,T),z=Math.min(258,I);F<=C&&--K&&f!=x;){if(e[T+k]==e[T+k-F]){for(var M=0;M<z&&e[T+M]==e[T+M-F];++M);if(M>k){if(k=M,H=F,M>U)break;var w=Math.min(F,M-2),E=0;for(L=0;L<w;++L){var _=T-F+L&32767,P=_-p[_]&32767;P>E&&(E=P,x=_)}}}F+=(f=x)-(x=p[f])&32767}if(H){V[g++]=268435456|revfl[k]<<18|revfd[H];var B=31&revfl[k],j=31&revfd[H];Y+=fleb[B]+fdeb[j],++W[257+B],++R[j],N=T+k,++v}else V[g++]=e[T],++W[e[T]]}}for(T=Math.max(T,N);T<c;++T)V[g++]=e[T],++W[e[T]];d=wblk(e,a,r,V,W,R,Y,g,J,T-J,d),r||(s.r=7&d|a[d/8|0]<<3,d-=7,s.h=Z,s.p=p,s.i=T,s.w=N)}else{for(T=s.w||0;T<c+r;T+=65535){var Q=T+65535;Q>=c&&(a[d/8|0]=r,Q=c),d=wfblk(a,d+1,e.subarray(T,Q))}s.i=c}return slc(o,0,l+shft(d)+i)},crct=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var n=t,l=9;--l;)n=(1&n&&-306674912)^n>>>1;e[t]=n}return e}(),crc=function(){var e=-1;return{p:function(t){for(var n=e,l=0;l<t.length;++l)n=crct[255&n^t[l]]^n>>>8;e=n},d:function(){return~e}}},dopt=function(e,t,n,l,i){if(!i&&(i={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),c=new u8(s.length+e.length);c.set(s),c.set(e,s.length),e=c,i.w=s.length}return dflt(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,l,i)},wbytes=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},gzh=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&wbytes(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var l=0;l<=n.length;++l)e[l+10]=n.charCodeAt(l)}},gzhl=function(e){return 10+(e.filename?e.filename.length+1:0)};function gzipSync(e,t){t||(t={});var n=crc(),l=e.length;n.p(e);var i=dopt(e,t,gzhl(t),8),s=i.length;return gzh(i,t),wbytes(i,s-8,n.d()),wbytes(i,s-4,l),i}var td="undefined"!=typeof TextDecoder&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(n){}function gzip(e){return V(this,null,(function*(){if(caniuse.compressionStream())try{const t=createReadableStreamFromUint8Array(e),n=new globalThis.CompressionStream("gzip"),l=t.pipeThrough(n);return yield readAllFromStream(l)}catch(t){}return gzipSync(e)}))}const DefaultPackerConfig={compression:{mode:"gzip"}};class DefaultPacker extends AbstractFlow{constructor(e){super(),d(this,"_packetId",0),d(this,"_frameOffset",0),d(this,"_encoder"),this.context=e,this._encoder=new DefaultEncoder(e)}handleInput(e){return V(this,null,(function*(){if(e.length>0){const t=this.encode(e),n=yield this.pack(t,e.length,e[0].time,e[e.length-1].time);this.output(n)}}))}encode(e){return e.forEach(((e,t)=>{if(e.trackType===TrackType.HTML&&e.event.eventType===TrackerEventType.HTMLIncrementalSnapshot){const n={id:`frame/${this._frameOffset+t}`,time:e.time,type:"frame",recordingId:this.context.id,data:{trackType:e.trackType,eventType:e.event.eventType,offset:this._frameOffset+t}};this.context.emit("feedback",{type:SignalType.FrameIndex,index:n})}})),this._encoder.encode(e)}pack(e,t,n,l){return V(this,null,(function*(){var i,s;let c=e;"gzip"===((null==(s=null==(i=this.context.transmitter)?void 0:i.strategy)?void 0:s.packer)||DefaultPackerConfig).compression.mode&&(c=yield gzip(e));const o={id:`${this.context.recording.id}/${this._nextPacketId()}`,frameRange:[this._frameOffset,t],data:c,firstFrameTime:n-this.context.startTime,lastFrameTime:l-this.context.startTime};return this._frameOffset+=t,o}))}_nextPacketId(){return this._packetId++}}function pack(e,t,n,l,i,s){return V(this,null,(function*(){const c=yield gzip(e);return{id:`${i}/0`,frameRange:[0,t],data:c,firstFrameTime:n-s,lastFrameTime:l-s}}))}class AbstractProcessor extends AbstractFlow{constructor(e,t){if(super(),d(this,"_trackTypesToHandle"),d(this,"_context"),this._context=e,null!=t){const e={};Array.isArray(t)?t.forEach((t=>{e[t]=!0})):e[t]=!0,this._trackTypesToHandle=e}}handleInput(e){this._shouldHandle(e)?this.handleFrame(e):this.output(e)}_shouldHandle(e){return null==this._trackTypesToHandle||!0===this._trackTypesToHandle[e.trackType]}}const DEFAULT_BLACKBOX_BUFFER_TIME=12e4;class BlackboxProcessor extends AbstractProcessor{constructor(e,t,n){var l,i;super(e),d(this,"subscription"),d(this,"_contextMap",new Map),d(this,"_cacheLimit"),d(this,"_storage"),d(this,"_bufferTime"),d(this,"_retry"),d(this,"_startTime",0),d(this,"_endTime",0),d(this,"_endRealTime",0),d(this,"_hasRotated",!1),d(this,"_queue",[]),d(this,"_virtualRenderer",new VirtualSnapshotRenderer),d(this,"_manager"),this._manager=t,this._retry=new Retry,this._bufferTime=(null==n?void 0:n.bufferTime)||DEFAULT_BLACKBOX_BUFFER_TIME,this._cacheLimit=null==(l=null==n?void 0:n.cache)?void 0:l.limit,this._storage=null==(i=null==n?void 0:n.cache)?void 0:i.storageProvider.getStorage()}join(e){this._contextMap.set(e.id,e)}remove(e){this._contextMap.delete(e.id)}getSize(){return this._contextMap.size}subscribe(e){this.subscription=e.subscribe((e=>{this.handleInput(e)}))}handleFrame(e){this._enqueue(e)}cache(){return V(this,null,(function*(){const e=[];if(this._storage&&this._contextMap.size>0){const t=yield this._createFrames();for(const[n,l]of this._contextMap.entries()){const i=this._createRecordingOptions(n,l),s={id:i.id,frames:t,startTime:this._startTime,endTime:this._endTime,mode:RecordingMode.Blackbox,recordingOptions:i};yield this._storage.deleteRecordings(s),yield this._storage.putRecordings([s],this._cacheLimit),e.push(s.id)}}return e}))}dump(e,t){return V(this,null,(function*(){const n=this._contextMap.get(e);if(!n)throw new Error("Not exists blackbox recording");const l=this._createRecordingOptions(e,n,t),{recording:i,transport:s}=yield createRecording(this._manager.apiClient,l),c=s.strategies.find((e=>e.mode===RecordingMode.Blackbox&&"channelType"in e)),o=yield this._createFrames(),a=yield pack(encode(o,this._startTime),o.length,o[0].time,this._endTime,i.id,this._startTime);yield this._retry.attempt((()=>createBlock(this._manager.apiClient,{blob:new Blob([a.data],{type:"application/octet-stream"}),recordingId:i.id,token:c.config.token,offset:a.frameRange[0],count:a.frameRange[1],firstFrameTime:a.firstFrameTime,lastFrameTime:a.lastFrameTime})));const r=s.strategies.find((e=>"blackbox-record-dump"===e.name));if(r){const e=r.config;n.dumpConfig=e}else n.dumpConfig={id:generateUUID$1(),token:l.token};return{id:i.id,mode:RecordingMode.Blackbox,createTime:new Date(i.createTime).getTime(),meta:i.meta,environment:i.environment}}))}dispose(){var e;null==(e=this.subscription)||e.unsubscribe(),this._queue.splice(0,this._queue.length),this._virtualRenderer.reset(),this._virtualRenderer=new VirtualSnapshotRenderer}_enqueue(e){0===this._queue.length&&e.trackType===TrackType.HTML&&e.event.eventType===TrackerEventType.HTMLSnapshot&&(this._startTime=e.time),this._queue.push(e),this._rotate(e.time)}_rotate(e){this._endTime=e,this._endRealTime=now();const t=e-this._bufferTime;let n;for(;(n=this._queue[0])&&n.time<t;)this._queue.shift(),this._virtualRenderer.performEvent(n.event),this._startTime=n.time,this._hasRotated=!0;t>this._startTime&&(this._startTime=t)}_createRecordingOptions(e,t,n){return M(v(v({},n),t.dumpConfig),{clientTime:(new Date).toISOString(),mode:RecordingMode.Blackbox,parent:e,refType:"blackbox",trackers:t.trackers,environment:t.recording.environment,meta:v(v({},t.recording.meta),null==n?void 0:n.meta)})}_createFrames(){return V(this,null,(function*(){const e=now()-this._endRealTime,t=this._endTime+e;this._rotate(t);const n=[...this._queue];if(0===n.length||this._hasRotated){const e=yield this._virtualRenderer.captureSnapshot(),t={trackType:TrackType.HTML,time:this._startTime,event:{eventType:TrackerEventType.HTMLSnapshot,data:e}};n.unshift(t)}return n}))}}class Controller extends AbstractFlow{constructor(){super(...arguments),d(this,"_buffer",new Array),d(this,"_suspend",!1)}get isSuspend(){return this._suspend}suspend(){this._suspend=!0}resume(){let e=this._buffer.shift();for(;e;)this.output(e),e=this._buffer.shift();this._suspend=!1}handleInput(e){this.isSuspend?this._buffer.push(e):this.output(e)}}class HTMLDataMask{constructor(e,t){d(this,"_renderer"),d(this,"_textDataMask"),d(this,"_nameDataMask"),d(this,"_commonDataMask"),d(this,"_strict",!1),this._renderer=e,this._nameDataMask=new CombinedDataMask(new ChineseNameDataMask,new EnglishNameDataMask),this._textDataMask=new TextDataMask;const{disableBuiltInDataMasks:n=!1,dataMasks:l=[],maskingLevel:i=DataMaskingLevel.BALANCE}=t;this._strict=i===DataMaskingLevel.STRICT,n||(this._strict?this._commonDataMask=new TextDataMask:this._commonDataMask=new CombinedDataMask(new EmailDataMask,new IDCardDataMask,new IPAddressDataMask,new LicensePlateDataMask,new MACAddressDataMask,new VINDataMask,new MobilePhoneDataMask,new BankAccountDataMask)),l.length>0&&(this._commonDataMask=this._commonDataMask?new CombinedDataMask(...l,this._commonDataMask):new CombinedDataMask(...l))}mask(e){var t,n;const{data:l,eventType:i}=e.event;if(i===TrackerEventType.HTMLSnapshot)isString(l.document.title)&&(this._commonDataMask&&(l.document.title=this._commonDataMask.mask(l.document.title)),this.maskElement(l.document.root));else if(i===TrackerEventType.HTMLMutations)l.forEach((e=>{var t,n,l,i;if(e.type===VMutationType.AddNode)this.maskElement(e.data.node,this._renderer.getNode(e.target));else if(e.type===VMutationType.ChangeAttributes)e.data=this.maskAttribute(e.data,this._renderer.getNode(e.target));else if(e.type===VMutationType.CharacterData&&isString(e.data)){let s;const c=this._renderer.getNode(e.target);c&&isVTextNode(c)&&null!=c.parentId&&(s=this._renderer.getNode(c.parentId)),(null==(t=null==c?void 0:c.attrs)?void 0:t[DATA_MASK])===DATA_MASK_MAP.name||(null==(n=null==s?void 0:s.attrs)?void 0:n[DATA_MASK])===DATA_MASK_MAP.name?e.data=this._nameDataMask.mask(e.data):includes(DATA_MASK_EMPTY,null==(l=null==c?void 0:c.attrs)?void 0:l[DATA_MASK])||includes(DATA_MASK_EMPTY,null==(i=null==s?void 0:s.attrs)?void 0:i[DATA_MASK])?e.data=this._textDataMask.mask(e.data):this._commonDataMask&&(!s||!isVStyleElement(s))&&(e.data=this._commonDataMask.mask(e.data))}}));else if(i===TrackerEventType.HTMLValueChange&&isString(l.value)){const e=this._renderer.getNode(l.target);(null==(t=null==e?void 0:e.attrs)?void 0:t[DATA_MASK])===DATA_MASK_MAP.name?l.value=this._nameDataMask.mask(l.value):includes(DATA_MASK_EMPTY,null==(n=null==e?void 0:e.attrs)?void 0:n[DATA_MASK])?l.value=this._textDataMask.mask(l.value):this._commonDataMask&&(l.value=this._commonDataMask.mask(l.value))}return e}maskElement(e,t){var n,l,i,s,c;if(!_isIgnored(t)&&!_isIgnored(e)){let o=this._commonDataMask;(null==(n=e.attrs)?void 0:n[DATA_MASK])===DATA_MASK_MAP.name||(null==(l=null==t?void 0:t.attrs)?void 0:l[DATA_MASK])===DATA_MASK_MAP.name?o=this._nameDataMask:(includes(DATA_MASK_EMPTY,null==(i=e.attrs)?void 0:i[DATA_MASK])||includes(DATA_MASK_EMPTY,null==(s=null==t?void 0:t.attrs)?void 0:s[DATA_MASK]))&&(o=this._textDataMask),o&&this._maskElement(o,e),null==(c=e.children)||c.forEach((t=>this.maskElement(t,e)))}}maskAttribute(e,t){var n,l;if(!_isIgnored(t)){let i=this._commonDataMask;if((null==(n=null==t?void 0:t.attrs)?void 0:n[DATA_MASK])===DATA_MASK_MAP.name?i=this._nameDataMask:includes(DATA_MASK_EMPTY,null==(l=null==t?void 0:t.attrs)?void 0:l[DATA_MASK])&&(i=this._textDataMask),i)return this._maskAttribute(i,e,t)}return e}_maskElement(e,t){const{text:n,value:l}=t;isString(n)&&(t.text=e.mask(n)),isString(l)&&(t.value=e.mask(l)),t.attrs=this._maskAttribute(e,t.attrs,t)}_maskAttribute(e,t,n){if(!t)return t;const l=v({},t);for(const i of["value","title","aria-label","aria-valuetext","placeholder","alt"]){const t=l[i];isString(t)&&(l[i]=e.mask(t))}if(!this._strict)return l;if("IMG"===(null==n?void 0:n.tag)?(l.src=ONE_PIXEL_TRANSPARENT,delete l.srcset):"SOURCE"===(null==n?void 0:n.tag)?delete l.src:"A"===(null==n?void 0:n.tag)&&delete l.href,l.style){const e=/url\(['"]?([^'")]+)['"]?\)/g;l.style=l.style.replace(e,(function(e,t){return/\.(png|jpe?g|gif|webp|bmp|tiff|svg)(\?.*)?$/i.test(t)?`url(${ONE_PIXEL_TRANSPARENT})`:e}))}return l}}const IGNORED_TAGS={STYLE:!0,SCRIPT:!0,svg:!0};function _isIgnored(e){return(null==e?void 0:e.type)===VNodeType.CommentNode||null!=(null==e?void 0:e.tag)&&IGNORED_TAGS[e.tag]}class HTMLProcessor extends AbstractProcessor{constructor(e,t){super(e,TrackType.HTML),d(this,"_lastSnapshotTime",-1),d(this,"_virtualRenderer"),d(this,"_capturerAwait",null),d(this,"_callbacks",new Array),d(this,"_dataMask"),this._virtualRenderer=new VirtualSnapshotRenderer,this._context.virtualRenderer=this._virtualRenderer,this.syncOptions(t)}syncOptions(e){null!=e&&e.disableDataMasking?this._dataMask=void 0:this._dataMask=new HTMLDataMask(this._virtualRenderer,{disableDataMasking:null==e?void 0:e.disableDataMasking,disableBuiltInDataMasks:null==e?void 0:e.disableBuiltInDataMasks,dataMasks:null==e?void 0:e.dataMasks,maskingLevel:null==e?void 0:e.maskingLevel})}captureSnapshotFrame(e){if(-1!==this._lastSnapshotTime)return this._callbacks.push(e),this._capturerAwait||(this._context.controller.suspend(),this._capturerAwait=(()=>V(this,null,(function*(){try{const e=yield this._virtualRenderer.captureSnapshot();this._lastSnapshotTime=time.now();const t={trackType:TrackType.HTML,time:this._lastSnapshotTime,event:{eventType:TrackerEventType.HTMLSnapshot,data:e}};this._callbacks.forEach((e=>{e(t)})),this._callbacks=new Array}catch(e){console.error("Capture virtual snapshot error",e)}this._context.controller.resume(),this._capturerAwait=null})))()),this._capturerAwait;e(null)}outputSnapshotFrame(){this.captureSnapshotFrame((e=>{e&&this.output(e)}))}handleFrame(e){const t=e.event;this._virtualRenderer.performEvent(t),t.eventType===TrackerEventType.HTMLSnapshot&&(this._lastSnapshotTime=e.time),this.output(this._dataMask?this._dataMask.mask(e):e)}}const MINUTE=6e4,ONE_TICK=1e-6;class IncrementalProcessor extends AbstractProcessor{constructor(e,t){super(e,TrackType.HTML),d(this,"_recordingContext"),d(this,"incrementalSnapshotRenderer",new IncrementalSnapshotRenderer),d(this,"_index",0),d(this,"_lastSnapshotTime"),d(this,"_capturerAwait",null),this._recordingContext=t}handleFrame(e){const t=e.event;if(this.incrementalSnapshotRenderer.performEvent(t),t.eventType===TrackerEventType.HTMLSnapshot&&(this._lastSnapshotTime=e.time),this.output(e),this._lastSnapshotTime&&this._recordingContext.now-this._lastSnapshotTime>2*MINUTE&&this.incrementalSnapshotRenderer.getIncrementalPercent()>.3){const t=e.time;this._createIncrementalSnapshot(t)}}_createIncrementalSnapshot(e){return this._capturerAwait||(this._context.controller.suspend(),this._capturerAwait=(()=>V(this,null,(function*(){try{this._lastSnapshotTime=e;const t=yield this.incrementalSnapshotRenderer.captureIncrementalSnapshot(),n=++this._index,l={trackType:TrackType.HTML,time:e+ONE_TICK,event:{eventType:TrackerEventType.HTMLIncrementalSnapshot,data:{snapshot:t,index:n}}};this.output(l)}catch(t){console.error("Capture virtual snapshot error",t)}this._context.controller.resume(),this._capturerAwait=null})))()),this._capturerAwait}}class AbstractInsightDetector extends EventEmitter{constructor(e){super(),d(this,"_config"),this.setOptions(e)}setOptions(e){this._config=v(v({},this.getDefaultOptions()),e)}getDefaultOptions(){return{}}}class DeadClickDetector extends AbstractInsightDetector{constructor(e,t){super(t),d(this,"_HANDLED_FRAMES",new Set([TrackType.HTML,TrackType.Mouse,TrackType.Network])),d(this,"_IGNORED_EVENTS",new Set([TrackerEventType.HTMLSnapshot,TrackerEventType.HTMLIncrementalSnapshot,TrackerEventType.HTMLIFrame,TrackerEventType.MouseMove,TrackerEventType.MouseDown,TrackerEventType.MouseUp,TrackerEventType.TouchStart,TrackerEventType.TouchMove,TrackerEventType.TouchEnd,TrackerEventType.TouchCancel,TrackerEventType.NETWORK_ABORT,TrackerEventType.NETWORK_DONE,TrackerEventType.NETWORK_ERROR,TrackerEventType.NETWORK_TIMEOUT])),d(this,"_vRenderer"),d(this,"_subsequentFrames",[]),d(this,"_timer"),this._vRenderer=e}getDefaultOptions(){return{changesThreshold:1,timeoutThreshold:500}}handle(e){const{trackType:t,event:n}=e,l=n.eventType;if(!isCustomTrackType(t)&&this._HANDLED_FRAMES.has(t)&&!this._IGNORED_EVENTS.has(l)&&(null!=this._timer||l===TrackerEventType.MouseClick)){if(l===TrackerEventType.MouseClick){this._stop();const t=n.data[3];if(null!=t){const n=this._vRenderer.getNode(t);(null==n?void 0:n.type)===VNodeType.ElementNode&&this._shouldHandle(n)&&this._start(e)}return}this._subsequentFrames.push(e)}}_start(e){this._subsequentFrames.push(e),this._timer=setTimeout((()=>{if(this._subsequentFrames.length-1<this._config.changesThreshold){const e=this._subsequentFrames[0],[t,n,l,i,s]=e.event.data,c={duration:time.now()-e.time,x:t,y:n,buttons:l};null!=i&&(c.targetId=i),null!=s&&(c.context=s),this.emit("detected",c)}this._stop()}),this._config.timeoutThreshold)}_stop(){null!=this._timer&&(this._subsequentFrames=[],clearTimeout(this._timer),this._timer=void 0)}_shouldHandle(e){const{tag:t,attrs:n}=e;return"A"===t||"BUTTON"===t||"INPUT"===t&&null!=n&&("button"===n.type||"checkbox"===n.type||"submit"===n.type||"radio"===n.type&&!e.checked)}}class ExcessiveScrollingDetector extends AbstractInsightDetector{constructor(){super(...arguments),d(this,"_distance",0),d(this,"_startTime"),d(this,"_lastScroll")}getDefaultOptions(){return{scrollThreshold:1e3,timeoutThreshold:3e3}}handle(e){var t,n,l;if(e.event.eventType!==TrackerEventType.HTMLScroll)return;const i=e.event.data,{scroll:s,target:c}=i;if(null==this._startTime&&(this._startTime=time.now()),(null==(t=this._lastScroll)?void 0:t.target)!==c)this._distance=0,this._startTime=time.now(),this._lastScroll=i;else{const e=time.now()-this._startTime;e>=this._config.timeoutThreshold?this._reset():(this._distance+=Math.abs(s[1]-(null!=(l=null==(n=this._lastScroll)?void 0:n.scroll[1])?l:0)),this._distance>=this._config.scrollThreshold?(this.emit("detected",{distance:this._distance,duration:e,targetId:c}),this._reset()):this._lastScroll=i)}}_reset(){this._distance=0,this._startTime=void 0,this._lastScroll=void 0}}class LongHoverDetector extends AbstractInsightDetector{constructor(){super(...arguments),d(this,"_HANDLED_FRAMES",new Set([TrackType.HTML,TrackType.Mouse,TrackType.Keyboard])),d(this,"_IGNORED_EVENTS",new Set([TrackerEventType.HTMLSnapshot,TrackerEventType.HTMLMutations,TrackerEventType.HTMLIncrementalSnapshot,TrackerEventType.HTMLIFrame])),d(this,"_lastMouseFrame"),d(this,"_lastInteraction"),d(this,"_timer")}getDefaultOptions(){return{timeThreshold:1e4}}handle(e){const{trackType:t,event:n}=e,l=n.eventType;if(!isCustomTrackType(t)&&this._HANDLED_FRAMES.has(t)&&!this._IGNORED_EVENTS.has(l)){if(t===TrackType.Mouse&&(this._lastMouseFrame=e),null==this._lastInteraction)return void this._start(e);this._restart(e)}}_start(e){this._lastInteraction=e,this._timer=setTimeout((()=>{if(null!=this._lastMouseFrame&&null!=this._lastInteraction){const[e,t]=getMousePosition(this._lastMouseFrame.event),n=getMouseTargetId(this._lastMouseFrame.event),l=getMouseTargetContext(this._lastMouseFrame.event),i={duration:time.now()-this._lastInteraction.time,x:e,y:t};null!=n&&(i.targetId=n),null!=l&&(i.context=l),this.emit("detected",i)}this._stop(),this._lastMouseFrame=void 0}),this._config.timeThreshold)}_restart(e){this._stop(),this._start(e)}_stop(){null!=this._timer&&(this._lastInteraction=void 0,clearTimeout(this._timer),this._timer=void 0)}}class RageClickDetector extends AbstractInsightDetector{constructor(){super(...arguments),d(this,"_clicks",[]),d(this,"_timer")}getDefaultOptions(){return{clicksThreshold:4,distanceThreshold:30,timeoutThreshold:800}}handle(e){if(!isCustomTrackType(e.trackType)&&e.event.eventType===TrackerEventType.MouseClick){if(0===this._clicks.length)return void this._start(e);if(this._isWithInDistance(this._clicks[0],e))return void this._clicks.push(e);this._restart(e)}}_start(e){this._clicks.push(e),this._timer=setTimeout((()=>{const{length:e}=this._clicks;if(e>=this._config.clicksThreshold){const t=this._clicks[0],n=this._clicks[e-1],[l,i,s,c,o]=t.event.data,a={duration:n.time-t.time,clicks:e,x:l,y:i,buttons:s};null!=c&&(a.targetId=c),null!=o&&(a.context=o),this.emit("detected",a)}this._stop()}),this._config.timeoutThreshold)}_restart(e){this._stop(),this._start(e)}_stop(){null!=this._timer&&(this._clicks=[],clearTimeout(this._timer),this._timer=void 0)}_isWithInDistance(e,t){const[n,l]=e.event.data,[i,s]=t.event.data;return Math.abs(i-n)+Math.abs(s-l)<=this._config.distanceThreshold}}class InsightProcessor extends AbstractProcessor{constructor(e,t){super(e),d(this,"_deadClickDetector"),d(this,"_longHoverDetector"),d(this,"_rageClickDetector"),d(this,"_excessiveScrollingDetector"),d(this,"_handleInsight",(e=>t=>{this.output(createFrameFromEvent(TrackType.Insight,{eventType:e,data:t},time.now()))})),this._initDetectors(t)}syncOptions(e){var t,n,l,i,s,c,o,a;this._isDetectorEnabled(null==e?void 0:e.deadClick)?null==(t=this._deadClickDetector)||t.setOptions(null==e?void 0:e.deadClick):(null==(n=this._deadClickDetector)||n.removeAllListeners(),this._deadClickDetector=void 0),this._isDetectorEnabled(null==e?void 0:e.excessiveScrolling)?null==(l=this._excessiveScrollingDetector)||l.setOptions(null==e?void 0:e.excessiveScrolling):(null==(i=this._excessiveScrollingDetector)||i.removeAllListeners(),this._excessiveScrollingDetector=void 0),this._isDetectorEnabled(null==e?void 0:e.longHover)?null==(s=this._longHoverDetector)||s.setOptions(null==e?void 0:e.longHover):(null==(c=this._longHoverDetector)||c.removeAllListeners(),this._longHoverDetector=void 0),this._isDetectorEnabled(null==e?void 0:e.rageClick)?null==(o=this._rageClickDetector)||o.setOptions(null==e?void 0:e.rageClick):(null==(a=this._rageClickDetector)||a.removeAllListeners(),this._rageClickDetector=void 0)}handleFrame(e){var t,n,l,i;this.output(e),null==(t=this._deadClickDetector)||t.handle(e),null==(n=this._excessiveScrollingDetector)||n.handle(e),null==(l=this._longHoverDetector)||l.handle(e),null==(i=this._rageClickDetector)||i.handle(e)}_initDetectors(e){this._isDetectorEnabled(null==e?void 0:e.deadClick)&&this._context.virtualRenderer&&(this._deadClickDetector=new DeadClickDetector(this._context.virtualRenderer,null==e?void 0:e.deadClick),this._deadClickDetector.on("detected",this._handleInsight(TrackerEventType.INSIGHT_DEAD_CLICK))),this._isDetectorEnabled(null==e?void 0:e.excessiveScrolling)&&(this._excessiveScrollingDetector=new ExcessiveScrollingDetector(null==e?void 0:e.excessiveScrolling),this._excessiveScrollingDetector.on("detected",this._handleInsight(TrackerEventType.INSIGHT_EXCESSIVE_SCROLLING))),this._isDetectorEnabled(null==e?void 0:e.longHover)&&(this._longHoverDetector=new LongHoverDetector(null==e?void 0:e.longHover),this._longHoverDetector.on("detected",this._handleInsight(TrackerEventType.INSIGHT_LONG_HOVER))),this._isDetectorEnabled(null==e?void 0:e.rageClick)&&(this._rageClickDetector=new RageClickDetector(null==e?void 0:e.rageClick),this._rageClickDetector.on("detected",this._handleInsight(TrackerEventType.INSIGHT_RAGE_CLICK)))}_isDetectorEnabled(e){return!1!==e}}class NetworkDataMask{constructor(e){d(this,"_commonDataMask");const{disableBuiltInDataMasks:t=!1,dataMasks:n=[],maskingLevel:l=DataMaskingLevel.BALANCE}=e;t||(l===DataMaskingLevel.STRICT?this._commonDataMask=new TextDataMask:this._commonDataMask=new CombinedDataMask(new EmailDataMask,new IDCardDataMask,new IPAddressDataMask,new LicensePlateDataMask,new MACAddressDataMask,new VINDataMask,new MobilePhoneDataMask,new BankAccountDataMask)),n.length>0&&(this._commonDataMask=this._commonDataMask?new CombinedDataMask(...n,this._commonDataMask):new CombinedDataMask(...n))}mask(e){const{data:t,eventType:n}=e.event;if(n===TrackerEventType.NETWORK_DONE&&this._commonDataMask){const{body:e}=t;if(null!=e)if(isString(e))t.body=this._commonDataMask.mask(e);else try{let n=!1;const l=JSON.stringify(e,((e,t)=>isString(t)?(n=!0,this._commonDataMask.mask(t)):t));n&&(t.body=l)}catch(l){}}return e}}class NetworkProcessor extends AbstractProcessor{constructor(e,t){super(e,TrackType.Network),d(this,"_dataMask"),this.syncOptions(t)}syncOptions(e){null!=e&&e.disableDataMasking?this._dataMask=void 0:this._dataMask=new NetworkDataMask({disableDataMasking:null==e?void 0:e.disableDataMasking,disableBuiltInDataMasks:null==e?void 0:e.disableBuiltInDataMasks,dataMasks:null==e?void 0:e.dataMasks,maskingLevel:null==e?void 0:e.maskingLevel})}handleFrame(e){this.output(this._dataMask?this._dataMask.mask(e):e)}}class ProcessorContext{constructor(e){d(this,"_trackTypes"),d(this,"_controller"),d(this,"_virtualRenderer"),this._controller=e}get trackTypes(){return this._trackTypes}set trackTypes(e){this._trackTypes=e}get controller(){return this._controller}get virtualRenderer(){return this._virtualRenderer}set virtualRenderer(e){this._virtualRenderer=e}}class FrameBuffer extends AbstractFlow{constructor(e){super(),d(this,"_bufferedFrames",[]),d(this,"_timer",0),d(this,"_handleTick",(()=>{this._bufferedFrames.length?this.flush():this.dispose()})),this.options=e}handleInput(e){this._bufferedFrames.push(e),this._timer||(this._timer=setInterval(this._handleTick,this.options.bufferTime))}flush(){return V(this,null,(function*(){return this._bufferedFrames.length?(this.output([...this._bufferedFrames]),this._bufferedFrames.splice(0,this._bufferedFrames.length),new Promise((e=>{setTimeout(e,0)}))):Promise.resolve()}))}dispose(){clearInterval(this._timer),this._timer=0}}class BlobTransmitter extends AbstractFlow{constructor(e){super(),d(this,"_chunks",[]),this.context=e}handleInput(e){this._chunks.push(e.data)}open(){return V(this,null,(function*(){}))}close(){return V(this,null,(function*(){}))}dump(){return V(this,null,(function*(){return new Blob(this._chunks,{type:"text/plain"})}))}}class BlockTransmitter extends AbstractFlow{constructor(e){var t;super(),d(this,"_retry"),d(this,"_strategy"),d(this,"_closing"),this.context=e,this._strategy=null==(t=e.transmitter)?void 0:t.strategy,this._retry=new Retry}open(){return V(this,null,(function*(){}))}close(){return V(this,null,(function*(){return new Promise(((e,t)=>{this._closing=n=>{this._closing=void 0,n?t(n):e()}}))}))}handleInput(e){this.context.emit("feedback",{type:SignalType.CompensateSnapshot,recordingId:this.context.id}),this._retry.attempt((()=>V(this,null,(function*(){var t,n;try{return createBlock(this.context.manager.apiClient,{blob:new Blob([e.data],{type:"gzip"===(null==(n=null==(t=this._strategy.packer)?void 0:t.compression)?void 0:n.mode)?"application/octet-stream":"text/plain"}),recordingId:this.context.recording.id,token:this._strategy.config.token,offset:e.frameRange[0],count:e.frameRange[1],firstFrameTime:e.firstFrameTime,lastFrameTime:e.lastFrameTime})}catch(l){throw l}})))).then((e=>{var t;this.context.emit("feedback",{type:SignalType.BlockCreated,block:e}),null==(t=this._closing)||t.call(this)})).catch((e=>{var t;null==(t=this._closing)||t.call(this,e)}))}}var SeekOrigin=(e=>(e[e.Begin=0]="Begin",e[e.End=1]="End",e[e.Current=2]="Current",e))(SeekOrigin||{});class BinaryWriter{constructor(e=1024,t=e){d(this,"_byteLength",0),d(this,"_position",0),d(this,"_bytes"),d(this,"_buffer"),d(this,"_view"),d(this,"_encoder",null),d(this,"_allocCount",0),d(this,"_allocWarned",!1),this.initialBufferSize=e,this.incrementalSize=t,this.realloc(e)}get byteLength(){return this._byteLength}get capacity(){return this._bytes.length}get currentPosition(){return this._position}encode(e){return this._encoder||(this._encoder=new TextEncoder),this._encoder.encode(e)}seek(e,t=SeekOrigin.Begin){let n;if(n=t===SeekOrigin.Current?this.currentPosition:t===SeekOrigin.End?this.byteLength:0,n+=e,n<0)throw new IOError("The seeking position must equal to or be greater than 0.");this._position=n}writeUint8(e){this.checkAlloc(1),this._view.setUint8(this.currentPosition,e),this.increaseSize(1)}writeUint8Array(e){const t=e.byteLength;this.checkAlloc(t),this._bytes.set(e,this.currentPosition),this.increaseSize(t)}writeUint16(e){this.checkAlloc(2),this._view.setUint16(this.currentPosition,e),this.increaseSize(2)}writeUint32(e){this.checkAlloc(4),this._view.setUint32(this.currentPosition,e,!1),this.increaseSize(4)}writeString(e,t){let n=this.encode(e);if(t&&n.length>t&&(n=n.slice(0,t)),this.writeUint8Array(n),t){const e=t-n.length;e&&(this._bytes.fill(0,this.currentPosition,this.currentPosition+e),this.increaseSize(e))}}toUint8Array(){return this._bytes.slice(0,this.byteLength)}toBuffer(){return this._buffer.slice(0,this.byteLength)}toString(){return this.toUint8Array().toString()}increaseSize(e){this._position=this.currentPosition+e,this._byteLength=Math.max(this._byteLength,this.currentPosition)}checkAlloc(e){const t=this.currentPosition+e;if(this._buffer.byteLength>=t)return;let n=this.byteLength;for(;n<t;)n+=this.incrementalSize;this.realloc(n)}realloc(e){const t=new ArrayBuffer(e),n=new Uint8Array(t);this._bytes&&n.set(this._bytes,0),this._buffer=t,this._bytes=n,this._view=new DataView(this._buffer),this._allocCount++,!this._allocWarned&&this._allocCount>5&&(console.warn("This BinaryWriter frequently reallocates itself. Try to avoid this by adjusting buffer settings.",this),this._allocWarned=!0)}}class BoxWriter{constructor(e,t=1024,n=t){d(this,"_binaryWriter"),this.name=e,this.initialBufferSize=t,this.incrementalSize=n,this._binaryWriter=new BinaryWriter(t,n),this._binaryWriter.writeUint32(0),this._binaryWriter.writeString(e,4)}get byteLength(){return this._binaryWriter.byteLength}get capacity(){return this._binaryWriter.capacity}appendUint8(e,t){this.writeKVHeader(e,1),this._binaryWriter.writeUint8(t)}appendBoolean(e,t){this.appendUint8(e,t?1:0)}appendUint16(e,t){this.writeKVHeader(e,2),this._binaryWriter.writeUint16(t)}appendUint32(e,t){this.writeKVHeader(e,4),this._binaryWriter.writeUint32(t)}appendUint32Tuple(e,t){this.writeKVHeader(e,8),this._binaryWriter.writeUint32(t[0]),this._binaryWriter.writeUint32(t[1])}appendUint8Array(e,t){this.writeKVHeader(e,t.byteLength),this._binaryWriter.writeUint8Array(t)}appendString(e,t){const n=this._binaryWriter.encode(t);this.appendUint8Array(e,n)}appendBox(e){const t=e.toUint8Array();this._binaryWriter.writeUint8Array(t)}toUint8Array(){const e=this._binaryWriter.currentPosition;return this._binaryWriter.seek(0),this._binaryWriter.writeUint32(this._binaryWriter.byteLength),this._binaryWriter.seek(e),this._binaryWriter.toUint8Array()}toString(){return this.toUint8Array().toString()}writeKVHeader(e,t){this._binaryWriter.writeUint32(this._calcKVByteLength(t)),this._binaryWriter.writeString(e,4)}_calcKVByteLength(e){return 8+e}}const CHUNK_NAME="chnk";function serializeChunk(e){const t=new BoxWriter("head",160,64);t.appendUint32("id",e.header.id),t.appendString("ver",e.header.version),t.appendUint16("idx",e.header.index),t.appendString("pid",e.header.packetId),t.appendUint32Tuple("rng",e.header.packetFrameRange),t.appendBoolean("fin",e.header.fin);const n=t.byteLength+e.body.length+8+8,l=new BoxWriter(CHUNK_NAME,n,64);return l.appendBox(t),l.appendUint8Array("body",e.body),l.toUint8Array()}function stringifyChunk(e){return JSON.stringify(e,((e,t)=>t instanceof Uint8Array?(new TextDecoder).decode(t):t))}class ChunkSplitter{constructor(e){d(this,"_chunkId",0),this.context=e}split(e,t=1){const n=[];for(let l=0;l<t;l++){const t={header:{fin:!0,id:this._nextChunkId(),index:l,packetId:e.id,packetFrameRange:e.frameRange,version:"1.0.0"},body:e.data};n.push(t)}return n}_nextChunkId(){return this._chunkId++}}class StreamingCompensator extends EventEmitter{constructor(e=100){super(),d(this,"_bufferSize"),d(this,"_connection"),d(this,"_mailbox"),d(this,"_handleSend",(e=>{this._mailbox&&"object"==typeof e&&e.type===WebSocketMessageType.Chunk&&this._mailbox.enqueue([e.sequence,e.data])})),d(this,"_handleMessage",(e=>{var t;if(this._mailbox&&this._connection&&e!==HeartbeatSignal.Ping&&e!==HeartbeatSignal.Pong)if(e.type===WebSocketMessageType.ACK){const n=null==(t=this._mailbox.peek())?void 0:t[0];if(null!=n)if(e.sequence>n){const t=this._mailbox.findIndex((t=>t[0]===e.sequence));-1!==t&&this._mailbox.remove(t);for(const e of-1===t?this._mailbox.slice():this._mailbox.slice(0,t))this._connection.send(e[1])}else e.sequence===n&&this._mailbox.dequeue()}else e.type===WebSocketMessageType.Command&&this.emit("command",e.data)})),d(this,"_handleOpen",(()=>{this._sendAll()})),d(this,"_handleRotated",(()=>{var e;null==(e=this._mailbox)||e.clear(),this.emit("compensate")})),this._bufferSize=e}attach(e){this.detach(),this._connection=e,e.on("send",this._handleSend),e.on("message",this._handleMessage),e.on("open",this._handleOpen),this._mailbox=new RotatingQueue(this._bufferSize),this._mailbox.on("rotated",this._handleRotated)}detach(){var e,t,n,l,i;null==(e=this._connection)||e.off("send",this._handleSend),null==(t=this._connection)||t.off("message",this._handleMessage),null==(n=this._connection)||n.off("open",this._handleOpen),this._connection=void 0,null==(l=this._mailbox)||l.off("rotated",this._handleRotated),null==(i=this._mailbox)||i.clear(),this._mailbox=void 0}flush(){this._sendAll()}_sendAll(){var e;null==(e=this._mailbox)||e.forEach((e=>{var t;null==(t=this._connection)||t.send(e[1])}))}}class StreamingTransmitter extends AbstractFlow{constructor(e){var t;super(),d(this,"_connection"),d(this,"_compensator"),d(this,"_splitter"),d(this,"_strategy"),d(this,"_closing"),d(this,"_handleCompensate",(()=>{this.context.emit("feedback",{type:SignalType.CompensateSnapshot,recordingId:this.context.id})})),d(this,"_handleCommand",(e=>{var t;switch(e.command){case StreamingCommandType.SyncBlock:this.context.emit("feedback",{type:SignalType.BlockCreated,block:e.block});break;case StreamingCommandType.ReceiverStopped:null==(t=this._closing)||t.call(this)}})),d(this,"_handleCloseByConn",(()=>{this.context.stopRecording()})),this.context=e,this._splitter=new ChunkSplitter(e),this._strategy=null==(t=null==e?void 0:e.transmitter)?void 0:t.strategy;const n=this.strategy.config,{bufferSize:l}=n,i=le(n,["bufferSize"]);this._connection=new WebSocketConnection(e.env.getFullUrl(this.strategy.url,!0),i),this._compensator=new StreamingCompensator(l),this._connection.on("closed",this._handleCloseByConn)}get strategy(){return this._strategy}open(){return V(this,null,(function*(){this._compensator.attach(this._connection),this._compensator.on("compensate",this._handleCompensate),this._compensator.on("command",this._handleCommand),yield this._connection.open()}))}close(){return V(this,null,(function*(){return this._compensator.flush(),this._connection.send(JSON.stringify(NewCommand({command:StreamingCommandType.RecorderStopped}))),new Promise(((e,t)=>{this._closing=n=>{n?t(n):e(),this._closing=void 0}})).then((()=>(this._compensator.detach(),this._compensator.off("compensate",this._handleCompensate),this._compensator.off("command",this._handleCommand),this._connection.close())))}))}handleInput(e){return V(this,null,(function*(){if(!1!==this.strategy.config.splitChunks){const t=this._splitter.split(e);for(const e of t)this._connection.sendChunk({type:WebSocketMessageType.Chunk,sequence:e.header.id,data:serializeChunk(e)})}else{const t=this._splitter.split(e,1)[0],n=yield gzip((new TextEncoder).encode(stringifyChunk(t)));this._connection.sendChunk({type:WebSocketMessageType.Chunk,sequence:t.header.id,data:n})}}))}}class TransmittingError extends RecordingError{constructor(e,t){super(e,t),this.name="bytereplay.recorder.TransmittingError"}}class RecordingFlow extends AbstractFlow{constructor(e){var t,n,l,i;super(),d(this,"_transmitter"),d(this,"_frameBuffer"),d(this,"_subscription"),this.context=e;const s=new DefaultPacker(e);let c=1e3;const o=null==(t=e.transmitter)?void 0:t.strategy;if((null==o?void 0:o.mode)===RecordingMode.Streaming||(null==o?void 0:o.mode)===RecordingMode.LiveStreaming)this._transmitter=new StreamingTransmitter(e),c=null!=(n=o.config.bufferTime)?n:1e3;else if((null==o?void 0:o.mode)===RecordingMode.Blocking){const t=this.context.options.modeOption;this._transmitter=new BlockTransmitter(e),c=null!=(i=null!=(l=null==t?void 0:t.bufferTime)?l:o.config.bufferTime)?i:12e4}else this._transmitter=new BlobTransmitter(e);this._frameBuffer=new FrameBuffer({bufferTime:c});const a=new ProcessorContext(new Controller),r=new IncrementalProcessor(a,e);this.pipe(a.controller.asPipeable()).pipe(r.asPipeable()).pipe(this._frameBuffer.asPipeable()).pipe(s.asPipeable()).pipe(this._transmitter.asPipeable())}subscribe(e){this._subscription=e.subscribe((e=>{this.handleInput(e)}))}handleInput(e){this.output(e)}open(){return V(this,null,(function*(){yield this._transmitter.open()}))}close(){return V(this,null,(function*(){var e;this.output(newNoopFrame(time.now())),null==(e=this._subscription)||e.unsubscribe(),yield this._frameBuffer.flush(),this._frameBuffer.dispose(),yield this._transmitter.close()}))}dump(){return V(this,null,(function*(){if(this._transmitter.dump)return this._transmitter.dump();throw new RecordingError(`Transmitter for '${this.context.recording.id}' does not support dumping.`)}))}}class RecordingManagerImpl{constructor(e){d(this,"input"),d(this,"_retry"),d(this,"env"),d(this,"apiClient"),d(this,"htmlProcessor"),d(this,"insightProcessor"),d(this,"networkProcessor"),d(this,"_processorContext"),d(this,"_cacheOptions"),d(this,"_blackboxOptions"),d(this,"_blockingOptions"),d(this,"_blackboxProcessor"),d(this,"_events",new EventEmitter),d(this,"_contextMap",new Map),d(this,"_flowMap",new Map),d(this,"handleFeedback",(e=>{if(e.type===SignalType.CompensateSnapshot)this.htmlProcessor.captureSnapshotFrame((t=>{if(!t)return;const n=this._flowMap.get(e.recordingId);n&&n.output(t)}))})),d(this,"_handleFrame",(e=>{this._emit("frame",e)})),this._retry=new Retry;const{environment:t,html:n,network:l,insight:i,interceptRequest:s}=e;this.env=new Environment(t),this.apiClient=new APIClient(this.env),s&&(this.apiClient.requestInterceptor=s),this._processorContext=new ProcessorContext(new Controller),this._processorContext.trackTypes=normalizeTrackTypes(e.trackers),this.htmlProcessor=new HTMLProcessor(this._processorContext,n),this.networkProcessor=new NetworkProcessor(this._processorContext,l),this.insightProcessor=new InsightProcessor(this._processorContext,i),this._initCacheOptions(e),this._initBlackboxOptions(e)}observe(e){let t=e.pipe(this._processorContext.controller.asPipeable()).pipe(this.htmlProcessor.asPipeable()).pipe(this.networkProcessor.asPipeable());this.insightProcessor&&(t=t.pipe(this.insightProcessor.asPipeable())),this.input=t.pipe(tap(this._handleFrame)).pipe(share())}syncOptions(e,t){return V(this,null,(function*(){var n,l,i,s,c;this.env.baseURL=null==(n=e.environment)?void 0:n.baseURL,this.env.type=null==(l=e.environment)?void 0:l.type,this.env.apiPrefix=null==(i=e.environment)?void 0:i.apiPrefix,this.env.headers=null==(s=e.environment)?void 0:s.headers,e.interceptRequest&&(this.apiClient.requestInterceptor=e.interceptRequest),this._initBlackboxOptions(e),this._blockingOptions=e.blocking,this.htmlProcessor.syncOptions(e.html),this.networkProcessor.syncOptions(e.network),null==(c=this.insightProcessor)||c.syncOptions(e.insight),time.sync(t.mainTime)}))}getCurrentRecordingCount(){return V(this,null,(function*(){return this._contextMap.size}))}createRecordingContext(e){return V(this,null,(function*(){if(!this.input)throw new Error("Tracking source is not ready.");const{recording:t,transport:n}=yield createRecording(this.apiClient,e),l=M(v({},t),{createTime:new Date(t.createTime).getTime()}),i=M(v({},e),{transport:n});let s;if(e.mode===RecordingMode.Blackbox?s=new BlackboxRecordingContext(this,l,i):e.mode===RecordingMode.InMemory?s=new InMemoryRecordingContext(this,l,i):(e.mode===RecordingMode.Blocking&&(i.modeOption=this._blockingOptions),s=new RecordingContext(this,l,i)),s.on("feedback",this.handleFeedback),e.mode===RecordingMode.Blackbox){if(!this._blackboxProcessor){const e=new BlackboxProcessor(this._processorContext,this,this._blackboxOptions);e.subscribe(this.input),this._blackboxProcessor=e}this._blackboxProcessor.join(s)}else{const e=new RecordingFlow(s);yield e.open(),e.subscribe(this.input),this._contextMap.size>0&&(yield this.htmlProcessor.captureSnapshotFrame((t=>{t&&(t.time=s.startTime,e.handleInput(t))}))),this._flowMap.set(l.id,e)}return this._contextMap.set(s.id,s),this._emit("startRecording",s.recording),s}))}stopRecordingContext(e){return V(this,null,(function*(){const t=this._flowMap.get(e);t&&(yield t.close()),this._cleanRecordingContext(e)}))}_cleanRecordingContext(e){var t,n,l,i;const s=this._flowMap.get(e),c=this._contextMap.get(e);s&&(s.context.off("feedback",this.handleFeedback),s.context.emit("stopped")),this._flowMap.delete(e),c&&(this._contextMap.delete(e),this._emit("stopRecording",c.recording),null==(t=this._blackboxProcessor)||t.remove(c),0===(null!=(l=null==(n=this._blackboxProcessor)?void 0:n.getSize())?l:0)&&(null==(i=this._blackboxProcessor)||i.dispose(),this._blackboxProcessor=void 0))}dumpRecording(e,t){return V(this,null,(function*(){if(this._flowMap.has(e))return this._flowMap.get(e).dump();if(this._blackboxProcessor){const n={meta:t},l=yield this._blackboxProcessor.dump(e,n);return this._emit("dumpRecording",M(v({},l),{parent:e,refType:"blackbox"})),l}throw new RecordingError(`Unknown recording ${e}.`)}))}cacheRecordings(){return V(this,null,(function*(){return this._blackboxProcessor?this._blackboxProcessor.cache():[]}))}uploadRecordingCaches(){return V(this,null,(function*(){var e;const t=null==(e=this._cacheOptions)?void 0:e.storageProvider.getStorage();if(t){const e=yield t.getRecordings();this._uploadRecordingCaches(e,t)}}))}_uploadRecordingCaches(e,t){return V(this,null,(function*(){for(const i of e)try{const{frames:e,startTime:n,endTime:l,mode:s,recordingOptions:c}=i;if(s===RecordingMode.Blackbox){const{recording:t,transport:i}=yield createRecording(this.apiClient,c),s=i.strategies.find((e=>e.mode===RecordingMode.Blackbox&&"channelType"in e)),o=yield pack(encode(e,n),e.length,e[0].time,l,t.id,n);yield this._retry.attempt((()=>createBlock(this.apiClient,{blob:new Blob([o.data],{type:"application/octet-stream"}),recordingId:t.id,token:s.config.token,offset:o.frameRange[0],count:o.frameRange[1],firstFrameTime:o.firstFrameTime,lastFrameTime:o.lastFrameTime})))}yield t.deleteRecordings(i)}catch(n){if(n.code===BR_RECORDING_DUPLICATED)try{yield t.deleteRecordings(i)}catch(l){}}}))}_initCacheOptions(e){const t=v({limit:10},"boolean"==typeof(null==e?void 0:e.cache)?{}:e.cache);t.storageProvider||(t.storageProvider=new IndexedDBRecordingStorageProvider),this._cacheOptions=t}_initBlackboxOptions(e){this._blackboxOptions=M(v({},e.blackbox),{cache:this._cacheOptions})}_emit(e,...t){this._events.emit(e,...t)}on(e,t){this._events.on(e,t,{})}once(e,t){this._events.once(e,t,{})}off(e,t,n,l){this._events.off(e,t,{},l)}addListener(e,t){this._events.addListener(e,t,{})}removeListener(e,t,n,l){this._events.removeListener(e,t,{},l)}}class StandardRecorder extends AbstractRecorder{constructor(e){super(RecorderMode.Standard,e)}createRecordingManager(){const e=new RecordingManagerImpl(this.options);return e.on("stopRecording",this._watchRecordingStop),e.on("dumpRecording",this._watchRecordingDump),e.on("frame",this._watchRecordingFrame),this.addInitialTask(new Promise((t=>{this.trackerSource&&e.observe(this.trackerSource),t()}))),e}}class ReceiveContext{constructor(e){d(this,"envelop"),d(this,"_source"),this.envelop=e.envelop,this._source=e.source}message(){return this.envelop.message}sourceId(){return this.envelop.fromId}sourceWindow(){return isWindow(this._source)?this._source:null}}class MessageBridge extends EventEmitter{constructor(e){super(),d(this,"uuid"),d(this,"_connections",new WeakMap),d(this,"_allowedOrigins",new Set),d(this,"_handleMessage",(e=>{const{origin:t,source:n,data:l}=e;if(this.isAllowedOrigin(t))try{if(isEnvelop(l)){const e=new ReceiveContext({origin:t,source:n,envelop:l});switch(e.message().type){case InternalMessageType.Handshake:n&&(this._sendMessage({type:InternalMessageType.Connected,payload:{}},n),this._connections.get(n)||this.handshake(n));break;case InternalMessageType.Connected:if(n){if(this._connections.get(n))return;this._connections.set(n,t)}}this.onReceive(e)}}catch(i){}})),d(this,"_handleSelfUnload",(e=>{e.currentTarget&&this._connections.has(e.currentTarget)&&(this._connections.delete(e.currentTarget),this.onReceive(new ReceiveContext({origin:origin,source:e.currentTarget,envelop:this._newEnvelop({type:InternalMessageType.Stopped,payload:{}})})))})),this.options=e,this.uuid=generateUUID$1(),globalThis.addEventListener("message",this._handleMessage),globalThis.addEventListener("beforeunload",this._handleSelfUnload),globalThis.addEventListener("DOMContentLoaded",(()=>{globalThis.removeEventListener("message",this._handleMessage),globalThis.removeEventListener("beforeunload",this._handleSelfUnload),globalThis.addEventListener("message",this._handleMessage),globalThis.addEventListener("beforeunload",this._handleSelfUnload)}))}get connections(){return this._connections}isAllowedOrigin(e){return 0===this._allowedOrigins.size||this._allowedOrigins.has(e)}addAllowedOrigins(...e){for(const t of e)this._allowedOrigins.add(t)}handshake(e){this._connections.get(e)||this._sendMessage({type:InternalMessageType.Handshake,payload:{}},e)}send(e,t){this._sendMessage(e,t)}_sendMessage(e,t){var n,l;if(isWindow(t)){const i=this._connections.get(t);t.postMessage(this._newEnvelop(e),null!=(l=null!=i?i:null==(n=this.options)?void 0:n.targetOrigin)?l:"*")}else t.postMessage(this._newEnvelop(e))}_newEnvelop(e){return{id:generateUUID$1(),fromId:this.uuid,topic:BRIDGING_TOPIC,message:e}}}var BridgeMessageType=(e=>(e.InitRecorder="InitRecorder",e.StartRecording="StartRecording",e.DumpRecording="DumpRecording",e.StopRecording="StopRecording",e.RecordingStarted="RecordingStarted",e.RecordingStopped="RecordingStopped",e))(BridgeMessageType||{});class RecorderFrameBridge extends MessageBridge{constructor(e){super({namespace:"data.dp.bytereplay.iframe",targetOrigin:"*"}),d(this,"localRecordings",new Map),d(this,"mapping",new Map),this._options=e,globalThis.self&&globalThis.self.parent!==globalThis.self&&this.handshake(globalThis.self.parent)}onReceive(e){var t,n,l;const i=e.message(),s=e.sourceWindow();switch(i.type){case InternalMessageType.Stopped:this.send({type:InternalMessageType.Disconnected,payload:{}},window.parent);break;case InternalMessageType.Connected:if(s&&this.connections.has(s)&&s!==globalThis.self.parent){try{null!=(t=bridge.global)&&t.recorder&&this.send({type:"InitRecorder",payload:{options:serialize(v({},null==(n=bridge.global.recorder)?void 0:n.options))}},s)}catch(c){console.error("send InitRecorder",c)}this.localRecordings.forEach(((e,t)=>{this.send({type:"StartRecording",payload:M(v({},e),{parent:t,refType:"iframe"})},s)}))}break;case InternalMessageType.Disconnected:s&&this.emit("unload",s);break;case"InitRecorder":null==(l=bridge.global)||l.initRecorder(i.payload.options);break;case"StartRecording":i.payload.parent&&this._options.onParentStart(i.payload);break;case"DumpRecording":const e=this.mapping.get(i.payload.id);e&&this._options.onParentDump(e,i.payload.meta);break;case"StopRecording":const o=this.mapping.get(i.payload.id);o&&this._options.onParentStop(o);break;case"RecordingStarted":this.emit("recordingStarted",i.payload,s);break;case"RecordingStopped":this.emit("recordingStopped",i.payload,s)}}get children(){const e=document.querySelectorAll("iframe"),t=[];for(let n=0;n<e.length;n++){const{contentWindow:l}=e[n];if(null!=l){const e=this.connections.get(l);null!=e&&t.push({id:e,target:l})}}return t}initRecorder(e){var t;const n=null==(t=e.html)?void 0:t.iframe;"object"==typeof n&&n.allowOrigins&&this.addAllowedOrigins(...n.allowOrigins),this.children.forEach((({id:t,target:n})=>{null!=t&&this.send({type:"InitRecorder",payload:{options:serialize(v({},e))}},n)}))}startRecording(e,t){this.localRecordings.set(t.id,e),this.children.forEach((({id:n,target:l})=>{null!=n&&this.send({type:"StartRecording",payload:M(v({},e),{parent:t.id,refType:"iframe"})},l)}))}dumpRecording(e){this.children.forEach((({id:t,target:n})=>{null!=t&&e.parent&&this.send({type:"DumpRecording",payload:{id:e.parent,meta:e.meta}},n)}))}sendStartedToParent(e,t){if(e.parent){const n=v({},t.recording);t.recording.mode===RecordingMode.Blackbox&&(n.id=t.dumpConfig.id),this.send({type:"RecordingStarted",payload:{recording:n,parentId:e.parent}},window.parent),this.mapping.set(e.parent,t.id)}}stopRecording(e){this.children.forEach((({id:t,target:n})=>{null!=t&&n!==self.parent&&this.send({type:"StopRecording",payload:{id:e}},n)}))}sendStoppedToParent(e){const t=this.localRecordings.get(e);null!=t&&t.parent&&this.send({type:"RecordingStopped",payload:{recordingId:e,parentId:t.parent}},window.parent)}connect(e,t){var n;try{if(!this.isAllowedOrigin(t.origin))return;this.handshake(e),!t.isCrossOrigin&&e&&e.document&&(null==(n=bridge.global)||n.inject(e))}catch(l){}}}function injectScriptURL(e,t){if(globalThis.__bytereplay_bridge__){const e=globalThis.__bytereplay_bridge__;return void(null==e||e.initRecorder(t))}let n;self.define&&self.define.amd&&(n=self.define.amd,self.define.amd=void 0);const l=document.createElement("script");l.src=e,l.crossOrigin="anonymous",l.onload=()=>{const e=globalThis.__bytereplay_bridge__;null==e||e.initRecorder(t),n&&(self.define.amd=n)},l.onerror=()=>{n&&(self.define.amd=n)},self.document.body.append(l)}function injectTo(e,t,n){"function"==typeof e.eval&&e.eval(`(${injectScriptURL.toString()})('${t}', ${JSON.stringify(n||{})})`)}class GlobalBridge{constructor(){d(this,"recorder"),d(this,"iframe"),this.iframe=new RecorderFrameBridge({onParentStart:e=>{var t;null==(t=this.recorder)||t.startRecording(e).then((t=>{this.iframe.sendStartedToParent(e,t)}))},onParentDump:(e,t)=>{var n,l;null==(l=null==(n=this.recorder)?void 0:n.getManager())||l.dumpRecording(e,t)},onParentStop:e=>{var t;null==(t=this.recorder)||t.stopRecording(e).then((()=>{this.iframe.sendStoppedToParent(e)}))}})}inject(e){var t,n,l;const i=null==(n=null==(t=this.recorder)?void 0:t.options.html)?void 0:n.iframe;if("object"!=typeof i||!i.autoInject||!i.injectScript)return;const s=i.injectScript;e.document&&e.document.body&&e.document.body.children.length>0&&injectTo(e,s,null==(l=this.recorder)?void 0:l.options),e.addEventListener("load",(()=>{var t;injectTo(e,s,null==(t=this.recorder)?void 0:t.options)}),{once:!0}),e.addEventListener("DOMContentLoaded",(()=>{var t;injectTo(e,s,null==(t=this.recorder)?void 0:t.options)}))}setRecorder(e){this.recorder=e,this.iframe.initRecorder(e.options)}initRecorder(e){null==e||delete e.worker,this.setRecorder(new MultithreadedRecorder(e))}startRecording(e,t){this.iframe.startRecording(e,t)}dumpRecording(e){this.iframe.dumpRecording(e)}stopRecording(e){this.iframe.stopRecording(e.id)}}const globalBridge=new GlobalBridge;globalThis[GLOBAL_BRIDGE_SYMBOL]=globalBridge;const container$4="_container_1lxa9_1",second="_second_1lxa9_11",tips="_tips_1lxa9_19",cancelButton="_cancelButton_1lxa9_28",stopped="_stopped_1lxa9_38",styles$4={container:container$4,second:second,tips:tips,cancelButton:cancelButton,stopped:stopped};class Countdown extends Component{constructor(e){var t,n,l;super("div"),d(this,"_svg"),d(this,"_progressPath"),d(this,"_second"),d(this,"_stopped",!0),d(this,"_startTime",0),d(this,"_totalDuration",0),this.options=e,this.addClass(styles$4.container);const i=(new DOMParser).parseFromString('<svg width="120" height="120" xmlns="http://www.w3.org/2000/svg"><path d="m 60,2\n    a 58,58 0 1,0 0,116\n    a 58,58 0 1,0 0,-116" fill="none" stroke="rgba(255, 255, 255, 0.3)" stroke-width="4"></path><path id="progress" d="m 60,2\n    a 58,58 0 1,0 0,116\n    a 58,58 0 1,0 0,-116" fill="none" stroke="rgba(254, 200, 75, 1)" stroke-linecap="round" stroke-width="4" stroke-dasharray="360" stroke-dashoffset="0"></path></svg>',"image/svg+xml");this._svg=this.container.ownerDocument.importNode(i.documentElement,!0),this._progressPath=this._svg.querySelector("path#progress"),this.container.appendChild(this._svg),this._second=document.createElement("div"),this._second.classList.add(styles$4.second),this.container.appendChild(this._second);const s=document.createElement("div");s.classList.add(styles$4.tips),"string"==typeof(null==(t=this.options)?void 0:t.tips)?s.innerHTML=this.options.tips:(null==(n=this.options)?void 0:n.tips)instanceof HTMLElement?s.appendChild(this.options.tips):s.innerHTML="\u4ec5\u80fd\u5f55\u5236<span>\u5f53\u524d\u9875</span>",this.container.appendChild(s);const c=document.createElement("button");c.classList.add(styles$4.cancelButton),c.innerText=(null==(l=this.options)?void 0:l.cancelText)||"\u4e0d\u5f55\u4e86",c.addEventListener("click",(()=>{this.emit("cancelled"),this.reset()})),this.container.appendChild(c),this.reset()}get stopped(){return this._stopped}reset(){this._stopped=!0,this._second.innerText="",this.addClass(styles$4.stopped)}start(e=3){return this.reset(),this._totalDuration=1e3*e,this._startTime=Date.now(),this._stopped=!1,this.removeClass(styles$4.stopped),this.render(),new Promise(((e,t)=>{this.once("finished",(()=>{e()})),this.once("cancelled",(()=>{const e=new Error("cancelled");e.name="CancelledError",t(e)}))}))}stop(){this._stopped=!0,this.addClass(styles$4.stopped),this.emit("finished")}render(){const e=Date.now()-this._startTime;if(e<this._totalDuration){const t=e/this._totalDuration;this._progressPath.style.strokeDashoffset=""+360*t,this._progressPath.style.display="",this._second.innerText=(this._totalDuration/1e3-Math.floor(e/1e3)).toString(),window.requestAnimationFrame((()=>{this._stopped||this.render()}))}else this._progressPath.style.display="none",this.stop()}}const container$3="_container_2hh0t_1",title="_title_2hh0t_6",message$1="_message_2hh0t_10",buttons$1="_buttons_2hh0t_13",primary="_primary_2hh0t_29",styles$3={container:container$3,title:title,message:message$1,buttons:buttons$1,primary:primary};class MessageBox extends Component{constructor(){super("div"),d(this,"_title"),d(this,"_message"),d(this,"_confirmButton"),d(this,"_confirmCallback",null),d(this,"_cancelCallback",null),this.addClass(styles$3.container),this._title=document.createElement("div"),this._title.classList.add(styles$3.title),this.container.appendChild(this._title),this._message=document.createElement("div"),this._message.classList.add(styles$3.message),this.container.appendChild(this._message);const e=document.createElement("div");e.classList.add(styles$3.buttons),this.container.appendChild(e);const t=document.createElement("button");t.innerText="\u6211\u518d\u60f3\u60f3",e.appendChild(t),this._confirmButton=document.createElement("button"),this._confirmButton.classList.add(styles$3.primary),this._confirmButton.innerText="OK",e.appendChild(this._confirmButton),this._confirmButton.addEventListener("click",(()=>{this._confirmCallback&&this._confirmCallback()})),t.addEventListener("click",(()=>{this._cancelCallback&&this._cancelCallback()}))}show(e,t,n,l=null,i=null){this._title.innerText=e,this._message.innerText=t,this._confirmButton.innerText=n,this._confirmCallback=l,this._cancelCallback=i}}const container$2="_container_15hlf_1",circle="_circle_15hlf_11",rect="_rect_15hlf_20",active="_active_15hlf_26",styles$2={container:container$2,circle:circle,rect:rect,active:active,"stop-button-animation":"_stop-button-animation_15hlf_1"};class StopButton extends Component{constructor(){super("div"),d(this,"_circle"),d(this,"_rect"),d(this,"_enabled",!0),this.addClass(styles$2.container,styles$2.recording),this.container.title="\u505c\u6b62\u5f55\u5236",this._circle=this.createElement("div",styles$2.circle),this.container.appendChild(this._circle),this._rect=this.createElement("div",styles$2.rect),this._circle.appendChild(this._rect),this.container.addEventListener("click",(()=>{this.emit("click",{command:"stop"})}),!0)}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.toggleClass(styles$2.active,e)}}class TimeDisplay extends Component{constructor(){super("div"),d(this,"_time"),d(this,"_timer"),d(this,"_startTime",0),d(this,"_enabled",!1),d(this,"_updateTime",(()=>{this._time.style.display="inline";let e=0;e=now()-this.startTime,this.enabled&&(0===this.startTime?this._time.childNodes[0].nodeValue="00:00":this._time.childNodes[0].nodeValue=formatTime(e,e>36e5))})),this._time=document.createElement("span"),this._time.appendChild(document.createTextNode("")),this.container.appendChild(this._time),this._timer=window.setInterval(this._updateTime,1e3),this._updateTime()}get startTime(){return this._startTime}set startTime(e){this._startTime=e,this._updateTime()}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(){this._startTime=0,this._time.childNodes[0].nodeValue="00:00"}}function formatTime(e,t=!1){const n=Math.round(e/1e3),l=Math.floor(n/3600),i=Math.floor((n-3600*l)/60),s=n-3600*l-60*i;return`${t?`${l}:`:""}${format2Digits(i)}:${format2Digits(s)}`}function format2Digits(e){return e<10?`0${e}`:e}const container$1="_container_14o0x_1",stopButton$1="_stopButton_14o0x_5",timeDisplay="_timeDisplay_14o0x_8",buttons="_buttons_14o0x_13",recording$1="_recording_14o0x_21",styles$1={container:container$1,stopButton:stopButton$1,timeDisplay:timeDisplay,buttons:buttons,recording:recording$1,"mini-recorder-controller-animation":"_mini-recorder-controller-animation_14o0x_1"};class RecorderController extends Component{constructor(){super("div"),d(this,"_overlay"),d(this,"_stopButton"),d(this,"_timeDisplay"),d(this,"_enabled",!0),d(this,"_recordingContext",null),d(this,"_handleClick",(({command:e})=>{this.emit("click",{command:e})})),d(this,"_handleStopped",(()=>{var e;this.removeClass(styles$1.recording),null!=(e=this.recordingContext)&&e.removeListener&&this.recordingContext.removeListener("stopped",this._handleStopped)})),this.addClass(styles$1.container),this._overlay=document.createElement("div"),this._overlay.classList.add(styles$1.overlay),document.body.appendChild(this._overlay),this._stopButton=new StopButton,this._stopButton.addClass(styles$1.stopButton),this._stopButton.addClass("stopButton"),this._stopButton.placeAt(this),this._timeDisplay=new TimeDisplay,this._timeDisplay.addClass(styles$1.timeDisplay),this._timeDisplay.placeAt(this),this._stopButton.addListener("click",this._handleClick)}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._stopButton.enabled=this._enabled,this._timeDisplay.enabled=this._enabled}get recordingContext(){return this._recordingContext}set recordingContext(e){this._recordingContext=e,this._recordingContext?(this.enabled=!0,this._timeDisplay.startTime=this._recordingContext.startTime):(this.enabled=!1,this._timeDisplay.reset())}}const controllerWidth="136px",controllerHeight="48px",miniControllerWidth="64px",miniControllerHeight="32px",container="_container_36akj_7",overlay="_overlay_36akj_27",masking="_masking_36akj_37",controller="_controller_36akj_41",countdown="_countdown_36akj_47",messageBox="_messageBox_36akj_52",handleBar="_handleBar_36akj_62",dot="_dot_36akj_78",initial="_initial_36akj_93",countingDown="_countingDown_36akj_97",center="_center_36akj_103",stopButton="_stopButton_36akj_106",recording="_recording_36akj_113",mini="_mini_36akj_130",message="_message_36akj_52",dragContainer="_dragContainer_36akj_170",styles={controllerWidth:controllerWidth,controllerHeight:controllerHeight,miniControllerWidth:miniControllerWidth,miniControllerHeight:miniControllerHeight,container:container,overlay:overlay,masking:masking,controller:controller,countdown:countdown,messageBox:messageBox,handleBar:handleBar,dot:dot,initial:initial,countingDown:countingDown,center:center,stopButton:stopButton,recording:recording,mini:mini,"mini-recorder-controller-animation":"_mini-recorder-controller-animation_36akj_1",message:message,dragContainer:dragContainer},DISPLAY_MODES=["none","initial","countingDown","recording","mini","message"],CONTAINER_WIDTH=parseInt(styles.controllerWidth),CONTAINER_HEIGHT=parseInt(styles.controllerHeight);class RecorderIsland extends Component{constructor(e,t){super("div"),d(this,"_config"),d(this,"_mouseEnter",!1),d(this,"_disableMouseEnterDetection",!1),d(this,"_isCountingDown",!1),d(this,"_recordingContext",null),d(this,"_overlay"),d(this,"_handleBar"),d(this,"_dragContainer",null),d(this,"_controller"),d(this,"_countdown"),d(this,"_messageBox"),d(this,"_displayMode","none"),d(this,"_handleRecordingStopped",(()=>{this._recordingContext=null,this._controller.recordingContext=null,this.setDisplayMode("none")})),d(this,"_handleClick",(e=>V(this,[e],(function*({command:e}){switch(e){case"stop":this.isRecording&&(yield this.stopRecording());break;case"restart":this.isRecording&&(this.setDisplayMode("message"),this._messageBox.show("\u786e\u5b9a\u91cd\u65b0\u5f55\u5236\u5417\uff1f","\u91cd\u65b0\u610f\u5473\u7740\u5df2\u5f55\u5236\u7684\u90e8\u5206\u5c06\u6c38\u4e45\u5220\u9664\uff0c\u4f60\u786e\u5b9a\u8981\u91cd\u65b0\u5f55\u5236\u5417\uff1f","\u91cd\u65b0\u5f55\u5236",(()=>V(this,null,(function*(){this.reset(),this.setDisplayMode("initial")}))),(()=>{this.setDisplayMode("mini")})))}})))),d(this,"_horizontalAlign","center"),d(this,"_verticalAlign","top"),d(this,"_isDragging",!1),d(this,"_draggingContext",null),d(this,"_handleDraggingMouseMove",(e=>{if(this._draggingContext){const{startX:t,startY:n,startMouseX:l,startMouseY:i}=this._draggingContext;let s=t+(e.clientX-l);s<this._config.leftOffset?s=this._config.leftOffset:s+CONTAINER_WIDTH>=window.innerWidth-this._config.rightOffset&&(s=window.innerWidth-CONTAINER_WIDTH-this._config.rightOffset);let c=n+(e.clientY-i);c<this._config.topOffset?c=this._config.topOffset:c+CONTAINER_HEIGHT>=window.innerHeight-this._config.bottomOffset&&(c=window.innerHeight-CONTAINER_HEIGHT-this._config.bottomOffset),this.container.style.left=`${s}px`,this.container.style.top=`${c}px`}})),d(this,"_handleDraggingMouseUp",(()=>{this._endDragging()})),this.recorder=e,this.addClass("bytereplay-recorder-island",styles.container,styles.center),this.setAttribute(DATA_MASK,"ignore"),this._config=v({countdown:{},topOffset:0,bottomOffset:0,leftOffset:0,rightOffset:0},t),this._overlay=document.createElement("div"),this._overlay.classList.add(styles.overlay),this._overlay.setAttribute(DATA_MASK,"ignore"),this._controller=new RecorderController,this._controller.addClass(styles.controller),this._controller.placeAt(this),this._controller.addListener("click",this._handleClick),this._countdown=new Countdown(null==t?void 0:t.countdown),this._countdown.addClass(styles.countdown),this._countdown.placeAt(this),this._countdown.on("cancelled",(()=>{this.emit("cancelled")})),this._messageBox=new MessageBox,this._messageBox.addClass(styles.messageBox),this._messageBox.placeAt(this),this._handleBar=document.createElement("div");for(let n=0;n<6;n++){const e=document.createElement("div");e.innerHTML="<div></div>",e.classList.add(styles.dot),this._handleBar.appendChild(e)}this._handleBar.classList.add(styles.handleBar),this.container.appendChild(this._handleBar),this.container.addEventListener("mouseenter",(()=>{this._mouseEnter=!0,"mini"===this.displayMode&&!this._isDragging&&(this._speedUpTransition(),this.setDisplayMode("recording"))}),!0),this.container.addEventListener("mouseleave",(e=>{!this._disableMouseEnterDetection&&"recording"===this.displayMode&&!this._isDragging&&(this._mouseEnter=!1,e.target===this.container&&(this._speedUpTransition(),this.setDisplayMode("mini")))}),!0),this._handleBar.addEventListener("mousedown",(e=>{this._isDragging||this._beginDragging(e)})),this.setDisplayMode("none")}get recordingContext(){return this._recordingContext}get recording(){var e;return null==(e=this._recordingContext)?void 0:e.recording}get isRecording(){return null!==this._recordingContext}get isCountingDown(){return this._isCountingDown}get isBusy(){return this.isCountingDown||this.isRecording}get displayMode(){return this._displayMode}startRecording(e){return V(this,null,(function*(){var t,n;if(this.resetPosition(),0!==e.countdown){this.setDisplayMode("initial"),setTimeout((()=>{this.setDisplayMode("countingDown")}),0);try{this._isCountingDown=!0,yield this._countdown.start(null!=(t=e.countdown)?t:3),this._isCountingDown=!1}catch(l){throw this._isCountingDown=!1,this.setDisplayMode("initial"),this.reset(),l}}try{this.setDisplayMode("mini"),this._controller.enabled=!0,this.addClass("recording"),this._recordingContext=yield this.recorder.startRecording(e),this._recordingContext.once("stopped",this._handleRecordingStopped),this._controller.recordingContext=this.recordingContext;const t=null==(n=this.recording)?void 0:n.id;return setTimeout((()=>{var e;!this._mouseEnter&&(null==(e=this.recording)?void 0:e.id)===t&&this.setDisplayMode("mini")}),3e3),this._recordingContext}catch(l){throw this._isCountingDown=!1,this.setDisplayMode("initial"),this.reset(),l}}))}stopRecording(){return V(this,null,(function*(){this.removeClass("recording"),this.recordingContext&&(yield this.recordingContext.stopRecording(),this.emit("stopped",this.recordingContext),this._recordingContext=null,this._controller.recordingContext=null)}))}setDisplayMode(e){var t;this.container.style.display="none"===e?"none":"","countingDown"===e?(null==(t=this.container.parentElement)||t.appendChild(this._overlay),setTimeout((()=>{this._overlay.classList.add(styles.masking)}),0)):(this._overlay.remove(),this._overlay.classList.remove(styles.masking)),this.container.classList.toggle("mini","mini"===e);for(const n of DISPLAY_MODES)this.container.classList.toggle(styles[n],n===e);switch("countingDown"===this.displayMode&&"recording"===e&&(this._disableMouseEnterDetection=!0,setTimeout((()=>{this._disableMouseEnterDetection=!1}),300)),e){case"initial":this._controller.container.style.display="none",this._countdown.container.style.display="none";break;case"countingDown":this._controller.container.style.display="",this._countdown.container.style.display="";break;default:this._controller.container.style.display="",this._countdown.container.style.display="none"}this._displayMode=e}reset(){this._isCountingDown=!1,this._controller.recordingContext=null,this._recordingContext=null,this._countdown.reset(),this.resetPosition(),this.setDisplayMode("none")}resetPosition(){var e;this._horizontalAlign="center",this._verticalAlign="top",this.container.style.left=(window.innerWidth-CONTAINER_WIDTH)/2+"px",this.container.style.top=`${null!=(e=this._config.topOffset)?e:8}px`,this.container.style.right="",this.container.style.bottom=""}_speedUpTransition(){this.container.style.transitionDuration="200ms",setTimeout((()=>{this.container.style.transitionDuration=""}),200)}_beginDragging({clientX:e,clientY:t}){this._dragContainer||(this._dragContainer=document.createElement("div"),this._dragContainer.classList.add(styles.dragContainer),document.body.appendChild(this._dragContainer)),this._isDragging=!0,this._draggingContext={startX:this.container.offsetLeft,startY:this.container.offsetTop,startMouseX:e,startMouseY:t},this.container.style.left=`${this.container.offsetLeft}px`,this.container.style.top=`${this.container.offsetTop}px`,this.container.style.right="",this.container.style.bottom="",this.addClass(styles.dragging),this.container.style.transitionDuration="0ms",window.addEventListener("mousemove",this._handleDraggingMouseMove,!0),window.addEventListener("mouseup",this._handleDraggingMouseUp,!0)}_endDragging(){if(this._dragContainer&&(this._dragContainer.remove(),this._dragContainer=null),this._isDragging=!1,this._draggingContext=null,this.container.style.transitionDuration="",this.removeClass(styles.dragging),this._updateAlign(),"right"===this._horizontalAlign){const e=window.innerWidth-this.container.offsetLeft-this.container.offsetWidth;this.container.style.right=`${e}px`,this.container.style.left=""}if("bottom"===this._verticalAlign){const e=window.innerHeight-this.container.offsetTop-this.container.offsetHeight;this.container.style.bottom=`${e}px`,this.container.style.top=""}window.removeEventListener("mousemove",this._handleDraggingMouseMove,!0),window.removeEventListener("mouseup",this._handleDraggingMouseUp,!0)}_updateAlign(){this.container.offsetLeft+this.container.offsetWidth/2>window.innerWidth/9*4&&this.container.offsetLeft+this.container.offsetWidth/2<window.innerWidth/9*5?this._centralize():this.container.offsetLeft<window.innerWidth/2?(this._horizontalAlign="left",this.removeClass(styles.center)):(this._horizontalAlign="right",this.removeClass(styles.center)),this.container.offsetTop<window.innerHeight/2?this._verticalAlign="top":this._verticalAlign="bottom"}_centralize(){this._horizontalAlign="center",this.container.style.left=(window.innerWidth-parseInt(styles.width))/2+"px",this.container.style.right="",this.addClass(styles.center)}}}}]);
//# sourceMappingURL=vendors-bytereplay-recorder.657f7c20.js.map